# 构建 HTML5 游戏的 5 大最佳实践…在行动中！

> 原文:[https://www . site point . com/top-5-best-practices-for-building-html 5-gamesin-action/](https://www.sitepoint.com/top-5-best-practices-for-building-html5-gamesin-action/)

HTML5 很棒，因为它是通用的——它不特定于单一的用例。更重要的是，HTML5 无处不在。它存在于你的电脑、手机、平板设备上——据我所知，它甚至可能存在于你的厨房电器上。

以 HTML5 的这两个属性——多功能性和无处不在——为例，为什么这么多开发人员受到它的启发应该就很清楚了。正如谚语所说，“当开发者受到启发时，他们通常会编写游戏。”(好吧，也许是我瞎编的。)

幸运的是，[关于 HTML5 游戏开发的深度文章](http://blogs.msdn.com/b/davrous/)现在随处可见。相反，我想给你一个概述，在你用 HTML5 写游戏之前和在你工作的时候，你应该考虑的事情。

你会从这篇文章中学到什么？我将介绍 HTML5 游戏开发框架，如何通过支持智能手机和平板设备来吸引更多人，如何管理游戏状态，如何处理性能问题，以及如何充分利用浏览器平台。

所以，事不宜迟，下面是构建 HTML5 游戏的 5 大最佳实践！(“行动中”是为了戏剧效果而添加的)。

## 最佳实践#1:使用框架

用 HTML5 编写简单的游戏很容易，但随着赌注的增加，你需要做一些事情来确保你的游戏运行平稳。

例如，当您使用大量图像、声音效果和其他资源时，您的浏览器将需要一些时间来从您的 web 服务器下载所有内容。如果你在写游戏时不考虑这一点，你会大吃一惊的。因为图像和声音文件是异步加载的，所以您的 JavaScript 代码将在所有资源加载之前开始执行。这通常会导致“爆音”(图像突然出现)，以及音效不能正常播放。**解决这个问题的一个好办法是创建一个预加载程序，它会推迟脚本的执行，直到所有的资源都下载完毕。**

你可能遇到的另一个问题是不同的机器和/或浏览器会以不同的速度运行你的游戏。虽然你对此无能为力，但你仍然应该确保动画和移动速度与游戏运行的帧速率无关。

本质上，每个游戏都需要大量的样板代码才能正常运行。幸运的是，您不必自己编写所有的代码。现在有各种各样的框架，让你可以专注于你的游戏逻辑，而不必担心让你的游戏流畅运行所需的所有小(大)事情。

使用框架的唯一警告是有太多的框架可供选择。例如，像 [ImpactJS](http://impactjs.com/) 这样的框架旨在帮助游戏开发过程的几乎每一个方面，而像 [EaselJS](http://easeljs.com/) 这样的框架主要关注图形方面的事情。最后，由您来选择您最满意的框架。这似乎是显而易见的，但是在 JavaScript 世界中，选择一个框架通常意味着选择一种特定的编程风格。

```
ig.module(
    'monster'
)
.requires(
    'impact.game',
)
.defines(function(){

Monster = ig.Entity.extend({
    eyes: 42
});

});
```

一个很好的例子是 ImpactJS，它不仅提供了显示图形或播放声音效果的抽象，还引入了自己的对象和继承模型，如上所示。

![Ascend Arcade ](../Images/b50d5211b338bf0b3fb0baf79442a45d.png "fig1")

使用 ImpactJS 框架，eleven Arcade 在三个月内交付了三款游戏。

虽然现在很多 HTML5 游戏依赖于某种形式的框架，但许多开发者仍然走在试图自己做所有事情的艰难道路上。虽然这可能是一次很好的学习经历，但是如果你想在合理的时间内完成工作，使用框架绝对是一条可行之路。这方面的一个很好的例子是 elegand Arcade(不再提供)的伟大作品，他使用 ImpactJS 框架在短短三个月内成功发布了三款非常令人愉快(并且有些受到好评)的游戏。

## 最佳实践#2:考虑小屏幕和触摸屏设备

也许 HTML5 最有说服力的卖点之一是，它可以在台式电脑、笔记本电脑、平板电脑甚至智能手机上运行(如果你没有看过 IE9 在 Windows Phone 7 Mango 上运行，[看看这个视频](http://www.youtube.com/watch?v=vohmbZjRXqk#t=4m7s))。

这种独特的跨平台性(拿那个，韦氏词典！)是 HTML5 所固有的，通常只需要开发人员做很少的额外工作。然而，有几件事你应该考虑…

![Spychase](../Images/462d89e974d2c7d26ac9da2ce698996d.png "fig2")

*运行在 Windows Phone 7 芒果上的 SpyChase。*

**首先也是最重要的一点是，不同设备类别的屏幕尺寸会有很大差异，屏幕分辨率和长宽比也是如此。如果你想让你的 HTML5 游戏在移动设备上运行良好，你应该确保它们要么支持多种分辨率，要么不超过 800×480 的 WVGA 帧大小。**

此外，由于大多数移动设备的屏幕尺寸不足以一次呈现整个网页，因此在编写游戏时，他们通常会采用复杂的缩放和平移技术，这可能会适得其反。这些可以使用[视口元标签](http://blogs.msdn.com/b/iemobile/archive/2010/11/22/the-ie-mobile-viewport-on-windows-phone-7.aspx)以编程方式关闭。以下代码片段将导致游戏的视口占据所有可用的水平屏幕空间。将参数“用户可缩放”设置为“否”会告诉移动浏览器禁用缩放，否则缩放通常会与基于手指的游戏控制相冲突。

```
<meta name="Viewport"
content="width=device-width; user-scaleable=no; initial-scale=1.0" />
```

一旦你的游戏在小屏幕设备上表现良好，你也应该花一分钟考虑输入。大多数纯触摸设备都有一个虚拟键盘，但它们往往会占用太多的屏幕空间，不利于控制游戏角色。如果完全基于触摸的输入是不可能的，你应该建立一个有限的虚拟键盘，只有你的游戏需要的按钮(如箭头键)。然而，最好是创造性地使用不需要额外屏幕元素的替代方法来控制你的游戏。一个很好的例子是游戏[间谍追逐](http://www.spacemonsters.co.uk/games/mobile/spychase/)，你用一个手指驾驶车辆(这在现实生活中是不应该尝试的)。

## 最佳实践#3:自动保存玩家的进度

有了像[站点锁定](http://www.buildmypinnedsite.com/)这样的功能，网络浏览器试图给网络应用程序和普通桌面应用程序一样的地位。然而，网站作为应用程序运行的想法是相当新的，持有客户端状态的网页的概念也是如此。**在关闭一个 Microsoft Word 实例之前，你可能会三思而行，但对于一个打开的网页，你可能不会这么小心。**大多数时候，这不是问题——大多数网页要么是无状态的，要么在服务器上保留着您的信息记录。

然而，浏览器游戏是一种略有不同的野兽。由于 JavaScript 代码是在客户端执行的，HTML5 游戏通常会将游戏状态保存在临时内存(又名 RAM)中。关闭浏览器窗口，你辛苦赚来的高分就永远失去了。

现在，你可能会说，一个明智的人会足够谨慎，不会关闭他们已经玩了八个小时的游戏，但意外确实会发生，特别是当涉及多个标签或电池没电时。

**长话短说:在编写 HTML5 游戏时，定期保存玩家的进度，并允许玩家在返回他们关闭的网页时继续游戏，这绝对是最佳实践。**

现在你应该在哪里记录玩家的进度？在过去，显而易见的地方不是服务器端数据库就是客户端 cookie。这两种解决方案都不是特别吸引人。对于服务器端方法，每当需要存储或检索信息时，都必须发出 HTTP 请求。cookie 方法给你的工作空间非常有限，cookie 的寿命很大程度上取决于浏览器的配置。

一个更可行的解决方案是使用 [HTML5 DOM 存储](http://msdn.microsoft.com/en-us/library/cc197062%28VS.85%29.aspx) **。** DOM storage 通过一个类似于键值存储(或 JavaScript expando 对象)的接口，让您为每个网站保存几兆字节的数据。这非常方便，但是在 HTML5 游戏的上下文中，您可能还想记住复杂的数据结构——这是 DOM storage 本身不支持的。

幸运的是，现代 JavaScript 实现内置了一些机制，可以将对象序列化为一种紧凑的符号，称为 [JSON](http://msdn.microsoft.com/en-us/library/bb299886.aspx#intro_to_json_topic4) 。使用这种方法，DOM 存储也可以用来记忆任意信息。以下两个辅助函数说明了如何使用 HTML5 DOM 存储和 ECMAScript5 内置的 JSON 功能来存储和检索游戏状态:

```
function saveState(state) {
      window.localStorage.setItem("gameState", JSON.stringify(state));
}

function restoreState() {
      var state = window.localStorage.getItem("gameState");
      if (state) {
            return JSON.parse(state);
      } else {
            return null;
      }
}
```

## 最佳实践#4:使用分析器

开发一款游戏最大的挑战之一就是在你添加越来越多的功能时保持高帧率。

好消息是，在过去几年中，浏览器的速度总体上变得更快了，HTML5 驱动的游戏以恒定的 60 fps 运行已经成为现实。

这并不容易。对于 Internet Explorer 9，这意味着编写一个全新的 JavaScript 引擎，它可以使用多个 CPU 内核和一个基于 Direct2D 的完全硬件加速的渲染管道。换句话说:如果你在游戏装备上花了很多钱，ie 9 会好好利用它。

![IE9 integrated JavaScript profile](../Images/09c5a090474f9d1b86fedd1db4f128c2.png "fig3")

Internet Explorer 9 的集成 JavaScript profiler 可帮助您定位性能瓶颈。

对于简单的游戏，这意味着你不必担心性能。但是由于 HTML5 是平台不可知的，你有可能为一系列的设备和浏览器开发，其中一些不会像你希望的那样快。即使你只针对高性能电脑(我们说过我们不会这么做，记得吗？)，性能仍然会成为一个问题。

如果你想让你的游戏以 60 fps 的速度运行，你只有不超过 16 毫秒的时间来渲染任何一个单独的帧。在你眨眼的时间里，你必须渲染至少 6 个完整的帧。现在，这可能看起来是一个令人生畏的任务…对于任何不平凡的游戏，它肯定可以。

**幸运的是，有** [工具](http://msdn.microsoft.com/en-us/library/dd565629%28VS.85%29.aspx) **可以帮助你。**在 Internet Explorer 9 ( [或 10)中，按 F12 键打开开发者工具。选择“Profiler”选项卡并点击“Start profiling”。](http://www.ietestdrive.com/)

现在导航到您认为性能应该更好的地方，给分析器大约 30 秒的时间来收集数据，然后点击“停止分析”你将会看到一个游戏的每个功能消耗了多少累计执行时间的概览。大多数时候，您会发现有许多函数占据了总执行时间的大部分。优化这些函数将会给你带来最大的收益，当你分析你的代码时，缓慢的子程序将会立即凸显出来。

但是不要太盲目地相信你的直觉——看起来很慢的代码实际上可能在今天的 JavaScript 引擎中执行得很快。最佳的优化方法是经常进行重新配置，并始终衡量您对代码所做的更改是否对性能有积极的影响。

![Warimals](../Images/d91ce680e1b0375a8ad856b55bc7a249.png "fig4")

游戏社交化:Warimals 基于 HTML5，允许你和你的脸书朋友一起玩。

## 最佳实践#5:有创意！

能够编写在你的浏览器中运行的游戏是非常棒的，但是更酷的是 HTML5 允许你编写在你的浏览器中运行的游戏！HTML5 不仅从技术角度来看很有趣，浏览器也是一个完美的游戏平台。

想想看…浏览器存在于许多不同的设备上，它们(几乎)总是在线，并且是人们用来通过电子邮件、聊天和社交网络相互联系的工具。作为一名浏览器游戏开发人员，您可以开发有趣的游戏，将世界各地的人聚集在一起。

如果你是 HTML5 游戏开发的新手，可能会很想克隆你离线玩过的游戏。这种做法绝对没有错。但是，如果你想到你的游戏是在一个“通信应用程序”中运行的，那么你很有可能会想到全新的、极具创意的游戏创意。一个有趣的例子是第一款基于 HTML5 的脸书游戏 [Warimals](http://apps.facebook.com/warimals) 。在 Warimals 中，你可以扮演狗或小猫，你也可以邀请你的脸书朋友和你一起玩。不喜欢什么？

**总而言之……**

由于框架开发人员和 JavaScript 先驱的出色工作，HTML5 已经成为一个相当成熟的游戏编写平台。这是个好消息，因为 Web 是任何类型的应用程序最普遍的运行时。使用正确的工具(其中许多工具可以方便地集成到 Internet Explorer 9 和 10 中，或者可以免费下载)和正确的框架，HTML5 游戏开发体验可以是令人愉快的，也是非常有益的，特别是在以有趣和创新的方式创建互联体验时。

## 帮助您入门的工具:

*   [漂亮的 HTML5 展示区](http://www.beautyoftheweb.com/)
*   [学习 HTML5](http://msdn.microsoft.com/en-us/ie/aa740476)
*   [impact js–html 5 游戏引擎](http://impactjs.com/)
*   [EaselJS–html 5 游戏引擎](http://easeljs.com/)
*   [下载 IE10 平台预览版](http://ie.microsoft.com/testdrive/Info/Downloads/Default.html)

## 分享这篇文章