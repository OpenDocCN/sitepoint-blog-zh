# 重新设计站点点:缓存和速度

> 原文:[https://www . site point . com/re design-site point-caching-speed/](https://www.sitepoint.com/redesigning-sitepoint-caching-speed/)

新 SitePoint 网站开发人员的目标之一是让它更快。非常快。

在我们深入研究我们做了什么之前，我想让你看看我们从何而来:

*   到达第一个字节的时间:~3 秒
*   文档完成:6-9 秒
*   HTTP 请求:100+(第一次)，35+(重复)

如你所见，这很糟糕。作为一个开发者，看到那些数字就很心痛。我们希望创建世界级的代码，但一个页面有 100 多个请求并不现实。

但是，速度只是我们开发人员关心的事情，还是对您的业务真的很重要？

关于这个话题已经写了很多，统一的结论是[加载时间影响你的底线](http://blog.kissmetrics.com/loading-time/?wide=1)。还有一个就是页面速度是[谷歌搜索引擎排名](http://www.mattcutts.com/blog/site-speed/)的因素之一。

如果你仍然不相信，更快的后端可以让你用同样的基础设施提供更多的流量，为你省钱。最后，加载时间的增加被证明会导致每次访问页面浏览量的[增加。](http://programming.oreilly.com/2009/07/velocity-making-your-site-fast.html)

那么，究竟是什么因素加速了加载时间呢？当我们想到一个网站有多快时，我们最有可能谈论的是速度的各个方面。我认为最好提出两个问题并分别回答，即使这两个问题有些关联:

*   我们可以处理多少请求(后端有多快)？
*   网站感觉有多快(用户感知有多快)？

我们将逐一探讨这些问题，然后看看我们如何在 SitePoint 回答这些问题。

## 我们能处理多少请求？

这很大程度上取决于一个请求到达时需要多长时间，以及我们必须实际处理多少传入的请求，而不是提供缓存的版本。在 SitePoint，我们很幸运能够提供相对静态的内容，这对我们所有的访问者都是一样的。这使我们能够缓存大多数响应，这意味着大多数请求不会命中我们的应用程序。

相反，我们的代理服务在网站的前面服务响应。如果你在浏览器中查看你的网络流量，你会看到大多数网页都有一个`304 Not modified`头。

加速生成响应的时间是一个棘手的问题，因为我们不能改变 WordPress 的内部结构。然而，使用插件如 [W3 总缓存](http://wordpress.org/plugins/w3-total-cache/)，我们可以缓存一些更昂贵的部分，例如利用 [WordPress 对象缓存](http://codex.wordpress.org/Class_Reference/WP_Object_Cache)。

## 网站感觉有多快？

除了响应所需的时间之外，我们还需要解决以下问题:

*   浏览器开始渲染需要多长时间？
*   网站准备好投入使用需要多长时间？
*   浏览器完成加载需要多长时间？

从技术上讲，我们希望将触发`DOMContentLoaded`事件之前的时间保持在最小。很多时候，当你把时间缩短到`DOMContentLoaded`时，网站会感觉更快，而不需要改变任何后端代码。

在告诉您我们在 SitePoint 如何做到这一点之前，我想回顾一下关于前端性能的一些一般规则:

*   发出尽可能少的 HTTP 请求(结合您的资产)
*   尽可能少地下载(缩小所有内容并以 gzip 格式提供)
*   尽可能积极地缓存所有内容
*   在底部包含 JavaScript

为此，我们在构建过程中生成了三个文件:

*   样式表
*   需要放入`head`中的 JavaScript(这几乎没什么)
*   可以放在结束标签`body`之前的 JavaScript

所有的文件都被缩小了。现在，为了能够尽可能长时间地缓存它们而不必担心无效，我们将内容的 md5 散列包含到文件名中，就像这样:`styles-3ed1dd875e184c186ecdce24235a714d.css`。有了这些，我们使用`Expires`头将每个特定的文件缓存很长时间(`Etag`也同样适用)。

如果你使用像 Rails 或 Symfony2 这样的框架来构建你的网站，你可以免费获得所有这些。然而，SitePoint 运行的是 WordPress，不幸的是，它并不支持开箱即用。有一对[夫妇](http://wordpress.org/plugins/wp-minify/) [的](http://wordpress.org/plugins/bwp-minify/) [外挂](http://wordpress.org/plugins/assetsminify/)，但最后我们决定不使用其中任何一个。

相反，我们在构建期间使用 [Grunt](http://gruntjs.com) 处理我们的资产。这样做的原因是，在没有共享存储器[的多服务器设置上，不可能在 WordPress 内部进行可靠的资产处理，我们不再使用共享存储器](https://www.sitepoint.com/8-things-learned-relaunching-sitepoint/)。

## 结果

有了这些，我们就有了一个响应迅速的网站，很容易地提供大量的流量。让我们看看这在数字上是什么样的:

*   到达第一个字节的时间:~1 秒
*   文档完成:1-2 秒
*   HTTP 请求:~20(第一次)，~7(重复)

对于主页，典型的页面加载将在两秒钟内触发`DOMContentLoaded`事件，缓存响应大约需要一秒钟。当然，这些时间会根据您的位置以及您访问的页面的内部缓存是否已被清空而有所不同。

总的来说，来自 6-9 秒和 100 个请求，这是一个惊人的成就，我们希望你每次将浏览器指向[www.sitepoint.com](https://www.sitepoint.com)时都能享受到。

## 分享这篇文章