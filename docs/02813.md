# 将您的 Raspberry Pi 设置为 Git 服务器

> 原文:[https://www . site point . com/setting-up-your-raspberry-pi-as-a-git-server/](https://www.sitepoint.com/setting-up-your-raspberry-pi-as-a-git-server/)

在最近的一篇文章中，Jérémy [介绍了树莓派](https://www.sitepoint.com/creating-amazing-projects-with-a-5-raspberry-pi-computer/)，一种只有你的手那么大的微型电脑。在这篇文章中，他给出了另一个令人印象深刻的使用这一惊人的设备的例子。

![Git to Raspberry Pi](../Images/3a0af88c8d55a21bdf77b0f661a501fe.png)

管理项目的版本非常有用。即使你的项目是私有的，如果(比如)新版本由于某种原因被破坏了，能够恢复旧版本总是一件好事。

为了管理项目的版本，我们可以为每个新版本创建一个新的文件夹，但是今天，我们有很好的工具可以让我们做得更好。

这些工具之一就是 [Git](https://www.sitepoint.com/git-for-beginners/) 。Git 非常适合管理项目的版本，不管你是不是一个人在做这个项目。这个工具可以在单台计算机上使用，没有任何问题。然而，如果你想在几台计算机之间共享你的代码，你需要一个 Git 服务器。这就是我们将在本教程中构建的。

首先，我会解释我们将建立什么，以及为什么我们需要它。然后，我们将具体看看如何用 Raspberry Pi 构建我们的服务器。最后，我们将看到如何使用我们的服务器。

## 我们想做什么？

### 服务器呢？

如上所述，你可以在一台电脑上使用 Git，仅仅是为了管理一个私有项目的版本。当您想要共享您的代码时，无论是公开共享还是在两台或多台计算机之间共享，问题就来了。

在这种情况下，您需要一个地方来发送您的修改，以便可以在其他计算机上检索它们。这个地方是一个服务器。

使用该服务器，流程如下:

1.  你修改你的代码
2.  您将更改发送到服务器
3.  在另一台计算机上，您或其他任何人从服务器下载更改
4.  从这台计算机进行了新的更改
5.  这些更改被发送到服务器，以便其他人可以下载它们，等等。

Git 服务器基本上是一台连接到互联网的计算机，我们可以在上面存储 Git 库。任何计算机都可以用于此，在这里，我们将使用 [Raspberry Pi](https://www.sitepoint.com/creating-amazing-projects-with-a-5-raspberry-pi-computer/) ，因为它的优势是成本非常低，同时提供良好的性能。

### 为什么要创建我们自己的服务器？

网络上有各种各样的服务允许我们共享 Git 库——比如 GitHub，这是最流行的服务之一。

问题是，像这样的服务库通常是公开的。有时，我们不想公开共享我们的代码，而是只与少数人共享(甚至只是我们拥有的另一台计算机)。

一些像 GitHub 这样的服务提供私有库——这样你就可以选择谁可以看到你的代码——尽管它们不是免费的。这就是为什么创建我们自己的服务器可能是一个好主意。

### 我们不是在这里重现 GitHub

不过，需要澄清的是:我们并没有试图用一个简单的 Raspberry Pi 来复制 GitHub。我们将创建的服务器非常简单，具有 Git 的所有特性，但仅此而已。所以不会有像拉请求这样的工具，甚至没有图形界面。

尽管很简单，这个服务器也远非无用。我目前在我的 Raspberry Pi 上有一个 Git 服务器。我用它在我的台式机和笔记本电脑之间共享代码。我在一些项目中使用 GitHub，但不是所有的项目。对于一些私人项目，或者暂时不想分享的实验性的东西，我用我的小服务器。这样，我可以在任何电脑上工作，而不必公开分享我的代码。

### 我们需要什么？

树莓 Pi 有几个版本，从非常小而便宜的树莓 Pi Zero 到最近功能强大的树莓 Pi 3。您应该为您的 Git 服务器选择哪一个？

我没有在 Raspberry Pi Zero 上测试，所以，老实说，我不能说这个是否足够(虽然我认为它足够)。然而，树莓派的第一个版本已经足够了，随着 Pi 2 和 Pi 3 的推出，也许你可以花很少的钱找到第一个树莓派，所以这是一个值得考虑的好选择。

反正树莓派就是个主板。无论你选择哪个版本，你至少需要一个保护它的外壳，一个电源(通过 microUSB，像智能手机一样)，一个存储操作系统的 SD 卡(一个经典的 SD 卡或跟随你选择的 Pi 版本的 microSD)，以及一个将 Pi 连接到互联网的方法。根据您拥有的 Pi，您可以通过以太网、直接通过 Wi-Fi(对于 Pi 3)或使用 Wi-Fi 钥匙连接它。

现在您已经拥有了这个项目所需的一切，让我们看看如何从这台小型计算机上获得一个 Git 服务器！

## 如何用树莓 Pi 构建 Git 服务器

### 安装 Git

我们的服务器首先需要的是 Git。您可以在`git`包中找到它，您可以通过在 Raspberry Pi 上执行以下命令来安装它:

```
sudo apt-get install git
```

从一个非常基本的角度来看，这就是我们获得 Git 服务器所需要的全部。然而，我们可以添加一些细节来获得一个合适的、更安全的服务器。

### 创建专用用户

每次使用 Raspberry Pi 时创建一个新用户是一个很好的实践。该用户是其相应用途的正式管理者。

有些程序会自动添加自己的用户。例如，媒体中心 Kodi 创建了用户`kodi`。同样，安装一个<abbr title="Linux, Apache, MySQL, PHP">灯</abbr>解决方案(用于获得一个 web 服务器)将创建用户`www-data`。这里我们将创建用户`git`。为此，在 Raspberry Pi 上键入以下命令:

```
sudo adduser git
```

如果您愿意，您可以通过更改上述命令中的`git`将专用用户的名称更改为另一个名称。

您将被要求输入该用户的密码。然后，您将能够输入一些其他信息，如用户的真实姓名或他们的电话号码。由于`git`不是真人，你可以跳过所有这些问题，没有任何问题。

### 使用 SSH 访问服务器

为服务器配备一个专用屏幕几乎没有任何用处。很多时候，我们只是想和它交换数据。为此，我们可以使用 SSH，一种在两台计算机之间进行通信的安全方式。

解释 SSH 如何工作不是本文的目的，所以我不会描述如何使用它。不过你可以在树莓 Pi 的官网上找到[优秀文档](https://www.raspberrypi.org/documentation/remote-access/ssh/)。

## 如何使用我们的服务器

![Raspberry Pi logo](../Images/25c8e0aee2e77953dd3ab41aa09c2118.png)

我们的服务器现在可以使用了。所以是时候看看怎么用了。我们将在这里看到如何创建一个新的存储库，以及如何更新它。

让我们通过创建一个名为`Hello-World`的测试存储库来向世界展示我们强大的想象力。

### 在树莓派上创建新的回购协议

首先要做的是在 Raspberry Pi 上初始化我们的新存储库。在服务器端，存储库基本上和你在计算机上找到的一样:一个带有`.git`子文件夹的文件夹。所以首先要做的是创建这个文件夹。

在 Raspberry Pi 上，使用`git`用户来创建它(无论是否通过 SSH，但是您应该总是使用这个用户来创建新的存储库)。你可以在任何你想要的地方创建这个文件夹:例如，在 Raspberry Pi 的 SD 卡上，或者在外部<abbr title="hard disk drive">硬盘</abbr>上。在下面的命令中，我们在`git`的主文件夹中创建文件夹:

```
mkdir /home/git/Hello-World.git
```

注意文件夹名称中的`.git`后缀。这个后缀不是强制性的，只是一个约定:在服务器端，存储库有这个后缀。例如，你可以在 GitHub 上找到这种约定。

现在将当前目录更改为这个新目录:

```
cd /home/git/Hello-World.git
```

最后，我们初始化存储库:

```
git init --bare
```

这里的`--bare`选项表示我们想要在 Raspberry Pi 上创建一个空的存储库。再一次，这是一个约定:裸回购并不像工作回购那样存储数据。裸存储库不适合作为工作存储库，但是它们对于服务器来说是完美的。关于裸库的更多信息可以在 Git 的文档中找到。

### 在您的计算机上初始化 repo

在您将用来处理项目的电脑上，创建一个新文件夹(在您想要的任何位置)。在终端中，转到该目录(使用`cd`)并使用以下命令初始化 repo:

```
git init
```

这里我们创建了一个普通的存储库，而不是一个空的。这样，我们就可以在电脑上看到我们期望的文件。

### 创建链接

我们两个空回购需要沟通。为了实现这种通信，我们将在工作存储库上创建一个远程。仍然在您计算机上的工作存储库文件夹中(您启动`git init`的地方)，键入以下命令:

```
git remote add pi git@XXX.XXX.XXX.XXX:/home/git/Hello-World.git
```

该命令创建一个名为`pi`的新遥控器(您可以随意选择名称)。`XXX.XXX.XXX.XXX`必须替换为树莓 Pi 的 IP 地址(本地或非本地)。最后，`/home/git/Hello-World.git`部分指的是到服务器上存储库的绝对路径，所以考虑修改它！

### 使用存储库

现在我们的回购已经可以使用了。像往常一样，创建新文件，编辑它们，删除一些其他文件。当您准备好创建您的第一个提交时，只需做通常的事情:

```
git commit -m 'My first commit'
```

在几次提交之后，您需要将您的更改发送到您的服务器。要做到这一点，请使用下面的命令，如果您已经使用过类似 GitHub 的东西，您应该对这个命令很熟悉:

```
git push pi master
```

在上面的命令中，我们将`master`分支发送到名为`pi`的远程存储库。这是我们在上一部分中创建的遥控器，所以如果您选择了另一个遥控器，请考虑更改它的名称！

现在，可以访问服务器的其他人(或者另一台计算机上的您)可以下载您的更改并提交。要下载最新的更改并在您的计算机上获得更新的工作存储库，请键入以下命令:

```
git pull pi master
```

### 克隆存储库

引入新用户？或者将自己添加到另一台计算机上？该存储库存在于服务器上，但需要添加到另一台计算机上。这是时候克隆存储库了。

克隆一个回购协议需要知道它在哪里，或者换句话说，它的地址是什么。因为它是您的服务器，所以您应该知道它，它与我们上面使用的服务器相同:

```
git clone git@XXX.XXX.XXX.XXX:/home/git/Hello-World.git
```

通过克隆一个存储库，会自动创建一个名为`origin`的远程存储库，因此您不必像上面那样创建自己的存储库。

## 结束语

如上所述，我们刚刚构建的服务器非常简单，但对于小型或私人项目来说可能已经足够了。如果你需要更多的功能，你应该考虑另一个工具，或者类似私有 GitHub 库的东西。

*你设置了一个 Raspberry Pi 作为 Git 服务器吗？或者用圆周率做了其他有趣的事？请在评论中告诉我们。*

## 分享这篇文章