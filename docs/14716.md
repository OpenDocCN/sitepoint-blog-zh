# 凶杀小说

> 原文:[https://www.sitepoint.com/whodunnit/](https://www.sitepoint.com/whodunnit/)

曾经需要知道是谁调用了导致你的应用程序出错的函数或类方法吗？试试 [debug_backtrace()](http://www.php.net/debug_backtrace) 。

将它放到发现问题的函数中，您会看到导致该函数调用的*调用堆栈*。

调用栈实质上是所有当前活动的函数/方法，它们还没有返回到它们被调用的点。举个例子最容易看出来。

假设你有一些代码，其中一个函数调用另一个函数，后者调用另一个函数；

 `";
}`

 `函数 format name($ name){
$ name = strtolower($ name)；
$ name = UC first($ name)；
你好(姓名)；
}` 

`function displayMessage($name) {
formatName($name);
}
?>`

因此，如果调用 displayMessage()，它会调用 formatName()，后者本身会调用 hello()(好吧，这是一个愚蠢的示例，但说明了这一点)。

现在一个简单的控制器实现上述功能；

 `if ( isset($_GET['name']) ) {
displayMessage($_GET['name']);
} else {
?>`

 `<form action="" method="GET">Enter your name <input type="text" name="name"> <input type="submit">
</form>` 

到目前为止一切顺利。但是假设在几周内，您修改了 formatName()函数，并且错误地插入了一个 bug

 `function formatName($name) {
$name = strtolower($name);`

`if ($name == 'ted') {
$name .= ' (nice to see you)';
} else {
$name = ucfirst($name);
}
hello($name);
}`

尽管 Ted 的本意是接收一条额外的友好信息，但他名字的第一个字母现在不再被转换成大写字母。

没有意识到有问题，几天后你就接到一些客户打来的愤怒电话，说他们名字的第一个字母是小写的。其他人似乎都很开心，所以你有点困惑。

由于代码的复杂性，找到问题所在是很棘手的，所以你可以在 hello()函数中使用 [debug_backtrace()](http://www.php.net/debug_backtrace) ，比如；

 `function hello($name) {
if ( $name != ucfirst($name) ) {
// In reality, log to some log file...
echo "`

 ````
";
         print_r(debug_backtrace());
         echo "
```` 

`";
}
echo "Hello $name
";
}`

现在，如果名字的第一个字母不是大写的，您将看到调用堆栈。这是它的样子。

 `Array
(
[0] => Array
(
[file] => /home/hfuecks/public_html/debug.php
[line] => 20
[function] => hello
[args] => Array
(
[0] => ted (nice to see you)
)`

 `)

[1] = >数组
(
[file]=>/home/hfuecks/public _ html/debug . PHP
[line]=>24
[函数] = >格式名
[args] = >数组
(
[0] = > Ted
)

)

[2] = >数组
(
[file]=>/home/hfuecks/public _ html/debug . PHP
[line]=>28
[函数]=>display message
[args]=>数组
(
[0] = > Ted
)

)` 

`)`

一阶数组的每个元素显示了调用的函数，元素 0 是调用 debug_backtrace()的点，而它下面的元素是在它之前调用的函数(即 displayMessage()首先被调用，所以它出现在最后)。在二阶数组中，您可以看到被调用函数的名称、定义函数的文件和行号，以及给出的参数。

在上面的跟踪中，您可以看到 formatName()函数被赋予了字符串参数“Ted ”,但是在 hello()函数中，它现在是小写的。突然你意识到发生了什么…

像 [XDebug](http://www.xdebug.org/docs.php) 这样的工具提供了更强大的调试工具，但是 [debug_backtrace()](http://www.php.net/debug_backtrace) 在您无法选择添加自己的 PHP 扩展的环境中会很方便，并且可能是值得添加到您的错误日志中的细节。需要 PHP 4.3.x+才能顺便使用。

## 分享这篇文章