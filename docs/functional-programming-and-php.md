# 函数式编程和 PHP

> 原文：<https://www.sitepoint.com/functional-programming-and-php/>

许多程序员喜欢谈论函数式编程，但如果你问他们是否做过，他们的回答大多会是“没有”。原因很简单:当我们第一次开始学习编程时，我们被教导以命令的方式思考，按照流程图和程序中要遵循的步骤。所以在这篇文章中，我将解释函数式编程的一些重要概念，以及如何用 PHP 编写函数式代码。

## 函数式编程的重要概念

从行话开始， [Wikipedia 将函数式编程](http://en.wikipedia.org/wiki/Functional_programming "Functional programming - Wikipedia, the free encyclopedia")定义为“一种将计算视为数学函数的评估并避免状态和可变数据的编程范式。”在函数式编程中，函数被视为一等公民，而在命令式编程中，我们最关心的是数据和改变数据以达到预期结果的步骤。

当我们说函数是一流的，这意味着我们可以像在命令式编程中使用值一样使用函数。它们可以作为参数传递给函数，在另一个函数中定义，甚至可以作为结果返回。换句话说，“功能就是价值”。

我们稍后将再次回到这一点，但是函数式编程还有许多其他重要的概念。举几个例子:

### 不变

不变性是变量的值一旦被定义就不能被改变的行为。不同的语言有不同的实现方式；例如，在 PHP 中，使变量不可变的唯一方法是将其定义为常量。

### 递归

递归在函数式编程中也非常突出。在命令式编程中，当我们需要操作集合或数组时，我们可以使用像`for`和`foreach`这样的循环结构，遍历每个元素并保留一个临时变量来保存当前值。但是由于不变性，这种方法在函数式编程中是不可能的。递归是答案，因为这样的簿记是通过调用堆栈隐式完成的。

假设我们要写一个函数，求一个数组中所有元素的和(暂且忘记`array_sum()`的存在)。在函数式风格中，我们会写:

```
<?php
function sum($array) {
    if (empty($array))
        return 0;
    else
        return $array[0] + sum(array_slice($array, 1));
}

$total = sum(array(1, 2, 3)); // 6
```

空列表将返回 0，这是我们的基本条件。对于具有多个值的数组，它将返回第一个元素与所有其他元素的递归和相加的结果。

### 纯函数和参照透明性

如果一个函数不改变自身外部对象的值(如全局或静态变量),并且没有任何 I/O 效应(如写入文件、数据库等),则称该函数没有副作用。这样的函数被称为纯函数。

对于给定的一组参数，一个纯函数的输出总是相同的，这导致了另一个称为参照透明性的特性。当一个函数是引用透明的时，我们可以用它的值替换这个函数，而不会影响程序的行为。所有的数学函数都是纯函数，而日期函数、`rand()`等。是不纯洁的。

### 高阶函数

上述概念几乎可以在任何编程语言中实现，但是一级函数和高阶函数是函数式编程的两个最显著的特征。我解释了一级函数意味着函数可以被当作值来处理。高阶函数是可以将函数作为参数并可以返回一个函数作为结果的函数。最近增加了两个重要的特性，使我们能够用 PHP 编写高阶函数:lambdas 和 closures。

### λ函数

lambda 函数(也称为匿名函数)只不过是一个没有名字的函数。当我们定义一个匿名函数时，会返回一个对该函数的引用，并存储在一个变量中以备后用。我们使用这个变量在需要的时候调用函数。

这一概念已被许多不同的语言所采用。事实上，您可能在日常 JavaScript 编程中使用 lambda 函数，将它们作为回调函数传递给不同的用户交互和 Ajax 调用。

```
$("#myButton").click(function () {
    // do something
});
```

这段代码非常简单易懂，这可能会让我们忘记它的功能性。

PHP 在 5.3 版本中引入了这个令人敬畏的特性，它让我们可以用类似的方式编写 PHP 代码:

```
<?php
$square = function ($arg) {
    return $arg * $arg;
};

$value = $square(2); // 4
```

当谈到函数，尤其是匿名函数时，理解如何处理变量作用域是很重要的。例如，JavaScript 允许您从 lambda 内部的外部作用域访问变量，而 PHP 不允许。lambda 内部有自己的作用域，就像普通的 PHP 函数一样。

### 关闭

有时你会想在你的函数中引用父作用域中的变量。闭包类似于 lambda 函数，唯一的不同是可以从外部作用域访问变量。我们可以使用“reach out”并使用 PHP 的`use`关键字绑定一个外部变量，这也是 PHP 5.3 中引入的。

```
<?php
$rate = .12;

$findInterest = function ($value) use ($rate) {
    return $value * $rate;
};

$interest = $findInterest(100);
```

在这种情况下，我们不会在每次调用函数时都传递利率。相反，我们在外部定义了它，并通过关键字`use`使它在函数内部可用。

### 部分函数和 Currying

简单来说，部分函数是通过部分应用其参数从现有函数创建的函数。当您调用创建的函数时，您只需要传递剩余的参数。

我们可以使用闭包在 PHP 中创建部分函数。这里有一个例子，已知一个盒子的长、宽和高，求它的体积。所有参数都是可选的；如果您没有提供所有的参数，该函数将返回另一个函数来接受剩余的必要值。

```
<?php
$volume = function ($length = 0, $width = 0, $height = 0) use (&$volume) {
    $args = func_get_args();
    $numArgs = func_num_args();
    if ($numArgs == 3) {
        return $length * $width * $height;
    }
    else if ($numArgs < 3) {
        return function() use(&$volume, $args) {
            $newArgs = array_merge($args, func_get_args());
            return call_user_func_array($volume, $newArgs);
        };
    }
    else {
        throw new BadFunctionCallException("Too many arguments");
    }
};
```

所有参数都是可选的。首先进行检查以确定调用者是否传递了所有参数。在这种情况下，我们可以通过乘以长度、宽度和高度来直接返回体积。如果参数的数量少于参数，则返回一个新函数来查找带有给定参数的“预播种”卷。

现在假设大部分时间我们在寻找一个固定长度的盒子的体积，比如说 10。这可以通过将 10 作为第一个参数轻松完成，或者我们可以通过将 10 固定为第一个参数来创建部分函数，然后只要求其余的值。

```
<?php
$standardVolume = $volume(10);

$vol = $standardVolume(5, 5); // 250
```

Currying 是部分函数的一个特例，它将一个接受多个参数的函数转换成多个接受单个参数的函数。比如类似于 *f(x，y，z)* 到 *f(x)(y)(z)* 的东西(虽然 PHP 语法不允许像这样嵌套函数调用)。如果你有兴趣了解更多，Timothy Boronczyk 写了一篇关于奉承的[优秀文章和一个实际例子。](http://zaemis.blogspot.com/2009/06/currying-in-php.html "Zaemis: Currying in PHP")

## 优点和缺点

PHP 中函数式编程特性有许多实际用途。例如，lambda 函数在处理回调时被广泛使用。例如，使用 Slim 框架，您可以像这样定义一条路线:

```
<?php
$app = new SlimSlim();
$app->get("/home", function () {
    // show home page
});
```

当请求 URL 匹配这个路由时，Slim 调用回调函数。Vance Lucas 不久前写了一些关于 Lambda 函数的其他有趣的用例。

通过避免状态和可变数据，鼓励安全编程。在函数式编程中，你应该编写每个函数只做一件事，并且不会产生任何副作用的函数。范式对功能的模块化和简明性的强调可以使你的程序更容易根据不同的小子程序进行推理。

函数式编程还可以帮助您编写专注于您想要实现的目标的代码，而不是显式地管理过程中的意外事件(比较递归和必须管理循环计数器变量)。

但是请记住，一些传统上与函数式编程相关的优势并不适用于 PHP，因为它不是为函数式编程语言而设计的。例如，无副作用的函数非常适合并行处理，但是 PHP 脚本不能以这种方式运行。

计算递归和惰性函数的成本并不总是容易的，而且由于内部开销，可能会有显著的性能问题。有时，根据可变性编写程序以提高效率更有意义。

也许函数式编程最大的缺点是，对于那些以命令式方式训练的人来说，它的学习曲线很陡。但总的来说，函数式编程是有趣的，学习它会给你以新的视角思考老问题的工具，帮助你成长为一名程序员。这不是一个放之四海而皆准的解决方案，但是它可以适用于更干净、更有说服力的 PHP 代码。

## 摘要

函数式编程不仅仅是一种编程范式；这是对你的程序进行思考和推理的一种方式。如果你能进行函数式思考，你几乎可以用任何语言进行函数式编程。

在本文中，我们讨论了函数式编程的基础，利用 PHP 的特性编写并提供了它们的例子。尽管本文给出的例子可能对您没有实际用处，但您会发现在许多情况下函数式风格可以显著提高您所编写代码的质量。尽量找这样的案例，功能性的思考，乐趣无穷！

图片 via[Fotolia](http://us.fotolia.com/?utm_source=sitepoint&utm_medium=website_link&utm=campaign=sitepoint "Royalty Free Stock Photos at Fotolia.com")

## 分享这篇文章