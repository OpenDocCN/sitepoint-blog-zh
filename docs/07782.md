# 使用 HTTP 进行页面缓存

> 原文:[https://www.sitepoint.com/page-caching-with-http/](https://www.sitepoint.com/page-caching-with-http/)

如果你已经有了受益于全页面缓存的应用程序，那么你可能已经看过了 [rails 风格的页面缓存](http://api.rubyonrails.org/classes/ActionController/Caching/Pages.html)。对于不熟悉的人来说，当你的应用程序中有一个对每个访问者都不唯一的动作时，页面缓存是有用的，因此可以保存下来，并在下次有请求时完整地重用。

Rails 中的页面缓存将您的操作结果写到磁盘上，您的 http 服务器可以发出下一个请求。这很好，但是有一些事情可能会给你带来一些问题:

1.  页面缓存写入磁盘，因此如果您有多个服务器想要在一个公共缓存层后面保护，您将不得不做额外的工作。
2.  因为页面缓存直接写入磁盘，所以不支持基于时间的缓存过期。
3.  磁盘往往很慢，也许缓存到内存会让你的服务器发挥更大的作用？

标准的 HTTP 缓存将帮助我们解决这个问题。基本原理是:我们不在控制器中调用页面缓存过滤器，而是设置一些 HTTP 头来指示我们选择的缓存技术如何处理响应。

许多客户端也实现了基于标准的缓存，这意味着我们标记为缓存的资源也能够在浏览器中缓存。这不仅为我们节省了呈现新页面所需的额外数据库和 CPU 资源，还节省了请求的实际带宽

## HTTP 缓存的类型

最容易实现的缓存是基于时间的缓存，如`Expires`或`max-age`。在创建响应时，我们设置了一个缓存头，上面写着“3 小时后过期”或“15:00 时过期”。使用 ActionController 方法 [expires_in](http://apidock.com/rails/ActionController/Base/expires_in) 将允许您为基于时间的过期设置适当的头。你会希望避免缓存错误，所以最好在 after 过滤器中执行标题设置，你的应用程序 500 不会调用这个过滤器。