# Apache Cassandra 快速介绍

> 原文:[https://www . site point . com/a-quick-introduction-to-Apache-Cassandra/](https://www.sitepoint.com/a-quick-introduction-to-apache-cassandra/)

被网飞、易贝、推特、Reddit 和许多其他人使用的 Cassandra 是当今最受欢迎的 NoSQL 数据库之一。据[网站](http://cassandra.apache.org/)称，已知最大的 Cassandra 安装涉及 400 多台机器上超过 300 TB 的数据。

Cassandra 提供无单点故障的可扩展、高可用性数据存储。最初由脸书的 Avinash Lakshman(亚马逊发电机的作者)和 T2 Prashant Malik(T3)开发，以解决他们的收件箱搜索问题，该代码于 2008 年 7 月在阿帕奇 V2 许可下作为自由软件发布。开发一直以惊人的速度继续，部分是由 IBM、Twitter 和 Rackspace 的贡献推动的。从 2010 年 2 月开始，Cassandra 就是一个“阿帕奇顶级项目”。

## 体系结构

有趣的是，Cassandra 放弃了广泛使用的主从设置，转而支持对等集群。这有助于 Cassandra 没有单点故障，因为没有主服务器，当面临大量请求或中断时，会使所有的从服务器变得无用。任何数量的商用服务器都可以组成一个 Cassandra 集群。

这个架构在幕后实现要复杂得多，但是我们不需要处理它。在 Cassandra 核心工作的好心人绞尽脑汁反对分布式系统的怪癖(感兴趣的读者可能会从这里的、这里的或这里的开始，以了解如何实现这样的集群设计)。

无需区分主节点和从节点，您就可以将任意数量的机器添加到任意数据中心的任意集群中，而不必担心此时需要什么类型的机器。每台服务器都接受来自任何客户端的请求。每台服务器都是平等的。

## 上限定理与可调一致性

分布式系统最著名的特性可能是 E. A. Brewer 博士的 [CAP 定理](http://en.wikipedia.org/wiki/CAP_theorem)。它指出，在三个属性中， *C 一致性*、 *A 可用性*和 *P 分割容差、*任何这样的系统一次只能满足两个(对此有所保留)。

不涉及太多的细节，RDBMS 多年来一直专注于前两个方面，一致性和可用性，允许事务这样的大事。整个 NoSQL 运动(从 10，000 英尺的角度看)本质上是选择分区容差，而不是(强)一致性。这使得人们普遍认为 NoSQL 数据库完全不适合有这种需求的应用程序。虽然对某些人来说这可能是真的，但对卡珊德拉来说却不是。

Cassandra 的一个突出特点是“可调一致性”。这意味着程序员可以在每个查询级别上决定是性能更重要还是准确性更重要。对于写请求，Cassandra 将复制到任何可用的(复制)节点、节点的仲裁或所有节点，甚至提供如何处理多数据中心设置的选项。

对于读取请求，您可以指示 Cassandra 要么等待任何可用的节点(可能会返回陈旧数据)、机器的仲裁(从而减少获得陈旧数据的可能性)，要么等待每个节点，这将总是返回最新的数据，并为我们提供长期寻求的强一致性。

在这里了解更多关于可调一致性的信息。

## 数据模型

从表面上看，Cassandra 的数据模型似乎相当关系化。考虑到这一点，更深入地研究 ColumnFamilies、SuperColumns 之类的东西，会使 Cassandra 看起来像一个未完成的 RDBMS，缺少像连接和大多数富查询功能这样的特性。

要理解像 Cassandra、HBase 和 BigTable 这样的数据库(从现在开始，我将称它们为 DSS、*分布式存储服务*)为什么会被设计成这样，我们首先要理解它们是为了什么而建造的。

DSS 是为处理大量数据而设计的，这些数据存储在大型集群的数十亿行中。关系数据库包含了很多东西，这使得很难在多台机器上有效地分布它们。发展支助部只是取消一些或所有这些联系。不允许需要扫描大部分数据集的操作，这意味着没有连接或丰富查询。

只有两种查询方式，按键或按键范围。DSS 将其数据模型保持在最低限度的原因是，单个表比几个规范化的关系或图更容易分布在多台机器上。

可以把 ColumnFamily 模型想象成一个(分布式散列)映射，最多有三个维度。二维设置只包含一个 ColumnFamily，其中有一些列，“一些”意味着几十亿，如果你愿意的话。所以 ColumnFamily 只是列的映射。

我还没有弄清楚为什么，但似乎所有这些术语只是地图不同维度的名称。三维 Cassandra“表”将通过将超列放入 ColumnFamily 中来实现，从而使其成为超列族(请抑制任何惊讶的叫声)，即列映射的映射。

在这个设置中，SuperColumnFamily 将代表最高的维度，而 SuperColumn 将代表剩余的两个维度，取代上一个示例中的 ColumnFamily。这个多维映射包含列、由名称、值和时间戳组成的三元组。

Cassandra 中的数据存储是面向行的，这意味着一行中的所有内容在磁盘上都是序列化的。每行列都有其唯一的键。每行最多可以容纳 20 亿列[ ]。此外，每一行都必须适合一台服务器，因为数据只按行键进行分区。正如在此更详细讨论的[，一些其他限制适用，这些在大多数情况下不应该与您有关。](http://wiki.apache.org/cassandra/CassandraLimitations)

## 卡珊德拉适合我吗？

Cassandra 大量借鉴了 BigTable(数据模型)和 Dynamo(架构)这两个当今最著名和最强大的数据库。仅这一点可能就足够考虑了，但我会继续提供一系列你可能会问自己的问题:

**1** **您是否需要在大型数据集上获得卓越的性能？**
Cassandra 提供了出色的写作和非常好的阅读量([击败了最受欢迎的竞争对手](http://www.networkworld.com/news/tech/2012/102212-nosql-263595.html?page=1))，只有 HBase 可以与之媲美。在两者之间做出选择主要是个人喜好的问题。如果你不想要整个 Hadoop 堆栈及其所有移动部件和增加的架构复杂性，请选择 Cassandra，如果 Hadoop 没问题，HBase 可能是更好的集成适合。如果您正在处理中小型数据量，关系解决方案会变得更有趣，因为它们提供了灵活性。

你需要丰富、灵活的查询和高级数据模型吗？
Cassandra 将其数据模型缩减到绝对最小值，以尽可能保持数据集的可分区性。当谈到线性可伸缩性时，这是有回报的，但是留给你的只是一个分布式哈希表。但不要过早下判断，因为即使是谷歌的核心技术之一， [BigTable](http://research.google.com/archive/bigtable.html) 也是完全一样的。就像 C 以垃圾收集等舒适功能为代价为程序员提供了出色的性能一样，Cassandra 为您提供了谷歌级技术的核心部分，代价是您自己处理索引或预先考虑您需要的查询。

**3** **你要求应用程序透明吗？**

由于 Cassandra 非常低级的数据模型，应用程序需要关于数据集的广泛知识。如果您需要应用程序透明性，那么 Cassandra 不适合您。

## 入门指南

如果你已经决定卡桑德拉可能值得一试，我会在这里列出一些起点。DataStax 是一家为企业提供 Cassandra 工具、支持和解决方案的公司，它有一个[社区版](http://www.datastax.com/products/community)来为你简化事情。该软件包包括所有主要操作系统的智能安装程序、可视化管理 Cassandra 设置的 DataStax 实用程序和一些示例应用程序/数据库。

不过要小心，这个包附带了 python，这可能会搞乱默认的 python 解释器。在这种情况下，只需从(PYTHON) PATH 变量中删除 DataStax python 目录。现在选择一个[客户端](http://wiki.apache.org/cassandra/ClientOptions)(推荐)或者使用[节俭](http://thrift.apache.org/)，一个语言独立服务的框架。

从那时起，你可能想看看这个阅读清单，通过跟随[这个教程](http://nosql.mypopescu.com/post/573604395/tutorial-getting-started-with-cassandra)立即开始实验，或者通过例子尝试[卡珊德拉。](http://www.rackspace.com/blog/cassandra-by-example/)

## 分享这篇文章