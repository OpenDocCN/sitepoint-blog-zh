# 检查 UNIX 服务器性能

> 原文:[https://www.sitepoint.com/unix-server-performance/](https://www.sitepoint.com/unix-server-performance/)

今天，快速的加载时间对网站的成功至关重要。他们改善用户体验，让你的访问者充分利用你的网站的功能，并最终帮助你获得更多的流量。但是，如何实现这些快速加载时间呢？好的服务器性能是答案。

如今，许多网站管理员都懒得或者不知道如何检查服务器的性能。虚拟(或共享)Web 主机可能会不时检查其服务器的性能；但是，如果您运行在专用服务器上，您确实需要定期检查它的性能。如果一个潜在的问题没有被迅速解决，它可能会很快使整个服务器陷入瘫痪。

##### 入门指南

有许多不同的协议和其他方式连接到您的服务器，其中最流行的命令行变体是 Telnet 和 SSH。您通过 Telnet 传输的任何信息都是以纯文本形式发送的，因此任何运行网络数据包嗅探器的人都可以获得您发送的任何敏感信息。为了满足安全和隐私的需求，安全套接字协议层(SSH)被开发出来，它基本上是一个安全的 Telnet 版本，在通过网络发送数据之前，它会对您输入的任何信息进行加密。按照 SSH read me 文件的术语表述，

<q>*“SSH(Secure Shell)是一种通过网络登录到另一台计算机，在远程机器上执行命令，以及将文件从一台机器移动到另一台机器的程序。它在不安全的通道上提供强大的身份验证和安全的通信。它旨在替代 rlogin、rsh 和 rcp。*T3】</q>

更多关于 SSH 的信息和帮助，请访问 SSH 主页。

为了访问你的服务器，你需要一个能够使用 SSH 协议的程序。我最喜欢的 Windows 程序之一是 [Putty](http://www.chiark.greenend.org.uk/~sgtatham/putty/) ，它有一个漂亮、简洁的命令提示界面。一旦启动 Putty 或您选择的另一个 SSH 程序，在运行任何命令之前，您需要连接到您的 Web 服务器。有些程序会提供一个 GUI(图形用户界面),通过它你可以输入你的信息，而其他程序会提供一个命令行界面。如果只剩下一个简单的命令行，显然你需要输入一个命令来连接。

```
ssh hostname -l username
```

您需要将主机名替换为您正在连接的站点的域名或 IP 地址。`-l`参数告诉程序不要让你以 root 用户身份登录，而是以其他用户名登录。提交命令，系统会提示您输入密码。请注意，与您可能熟悉的 Windows 不同，当您输入密码时，您不会看到任何星号。通过身份验证后，您将会登录。

如果您忘记了登录的用户名，您可以运行这个简单的 UNIX 命令:

```
whoami
```

一旦您登录，您就可以看到操作系统的命令行命令。探索你所希望的一切，但是在你运行它之前，试着找出一个命令是做什么的。您可以使用`man`命令获得任何 UNIX 命令的功能描述，后跟您有兴趣了解的命令。例如:

```
man top
```

这会给你一个关于`top`命令的解释，我们稍后会讲到。不要运行任何你不确定的命令——只需要一个命令就可以清除你的硬盘，所以要小心！

##### 服务器规格

你的服务器能做什么很大程度上受其内部硬件的影响。CPU 和 RAM 是两个主要的参与者。您如何知道您的服务器的能力？嗯，关于性能最有用的 UNIX 命令之一是`top`。它显示关于您的服务器上正在发生的事情的最重要的数据。下面是一个典型的例子，说明作为`top`查询结果的一部分，您可能会得到什么:

<q>*晚上 7:06 up 81 天，7:47，1 用户，负载平均:2.90，2.25，2.14
214 进程:209 休眠，5 运行，0 僵尸，0 停止
CPU0 状态:66.3%用户，14.4%系统，27.1% nice，18.4%空闲
CPU1 状态:71.1%用户，14.4%系统，37.1% nice，13*</q>

现在，让我们一步一步地浏览这些信息。

*晚 7 点 06 分 81 天，7 点 47 分，1 个用户，平均负载:2.90，2.25，2.14*

第一个数字是服务器时间，接下来是服务器最后一次重新启动的天数和小时数。下图显示了有多少用户连接到该机器(通过 SSH 之类的协议)。最后，是服务器平均负载。第一个数字表示过去一分钟内运行的平均进程数。秒表示过去 5 分钟的平均值。第三个显示过去 15 分钟的平均值。下一行显示了关于进程的信息，但是我们一会儿再回来看。前两行之后的代码行提供了 CPU 使用统计信息(在本例中，服务器有两个 CPU):

*CPU0 状态:66.3%用户，14.4%系统，27.1% nice，18.4%空闲
CPU1 状态:71.1%用户，14.4%系统，37.1% nice，13.2%空闲*

最前面的 CPU 由其编号(从 0 开始)来标识。处理器执行模式分为两类—非特权模式(用户)和特权模式(系统)。特权模式通常被称为“内核”(系统)模式；非特权模式可被称为“用户”模式。如果在非特权模式下执行，一个进程将只能访问它自己的内存，而在特权模式下，可以访问内核的所有数据结构以及底层硬件。内核以非特权模式执行进程，以防止用户进程访问可能影响其他进程或操作环境的数据结构或硬件寄存器。

在 UNIX 系统上，每个进程根据所谓的调度优先级运行。一个称为“调度程序”的进程根据进程的优先级或级别将 CPU 时间分配给进程。具有较高优先级的进程(-20 是最高的)可以在具有较低优先级的进程之前运行。空闲百分比显示未使用的 CPU 能力。下面两行给出了内存和交换文件使用情况的数据:

*Mem: 3867832K av，3853780K 已用，14052K 空闲，0K shrd，100388K buff
Swap: 530104K av，45980K 已用，484124K 空闲 3228192K 缓存*

第一个数字表示可用的总量，而第二个数字以千字节为单位显示已用的量。第三个是空闲量，同样以千字节为单位，最后是缓冲区和缓存统计数据。缓冲区是系统在写入磁盘之前写入的空间，缓存可以优化程序的性能。

##### 处理

在分析一个典型的`top`结果的开始的过程中，我们跳过了关于过程的一行和一些其他的图。所有这些统计数据都涉及到称为流程的东西。进程是在 Web 服务器上执行或运行的程序。让我们从之前忽略的`top`结果的第二行开始。

*214 个进程:209 个休眠，5 个运行，0 个僵尸，0 个停止*

该行以总进程数开始。随后是对每一个过程所属类别的解释。进程有四个默认类别:睡眠、运行、僵停和停止。大多数进程都属于休眠类别—它们是在队列中等待处理的进程，一旦轮到它们，它们就变成正在运行的进程。正在运行的进程很少—这些是目前正在处理的进程。

在休眠进程的生命周期中，可以产生子进程。通常，一个主进程会在它结束之前杀死它的子进程，但是，如果没有发生，子进程会在没有父进程的情况下继续运行。当这种情况发生时，这个“丢失的孩子”被归类为僵尸进程。大量的僵尸是系统管理员害怕的一件事，尽管幸运的是那些进程被系统在预定的时间间隔终止。最后，停止的进程是那些暂停的进程，通常是因为它们在等待资源。

正如您可能已经注意到的，在`top`结果的底部是一个大列表——这是一个包含在`top`结果第二行中的流程的更完整的列表。下面是列表中的一部分示例。

*PID 用户 PRI NI 大小 RSS SHARE STAT %CPU %MEM 时间命令
10685 ze-card 19 19 984 736 724 R N 93.3 0.0 5671m webalizer
32072 nobody 9 0 16932 15M 12156S 6.0 0 0.3 0:01 httpd
32196 nobody 9 0 16224 14M 12144S 3.5 0.3 0 没人 9 0 16300 14M 12136S 2.3 0.3 0:00 httpd
32231 没人 9 0 16316 14M 12172S 2.3 0.3 0:00 httpd
32124 没人 9 0 16620 14M 12184S 1.9 0.3 0:01 httpd*

列表顶部是对每一列的简短描述，为了理解清单，了解每一列显示了什么是一个好主意。第一列显示了任务的唯一标识符，称为“进程 id”。“用户”列显示任务的所有者。“PRI”是 priority 的缩写，象征着一项任务有多重要。“NI”代表 Nice，也是一个与队列相关的因素，其中负值具有更高的优先级。

接下来是任务代码、数据和堆栈空间的大小(以千字节为单位)。“RSS”是进程的总物理内存利用率。“SHARE”代表共享内存。“STAT”是单词“state”的缩写，指的是进程的状态。这里，“S”代表睡眠，“D”代表不间断睡眠，“R”代表运行，“Z”代表僵尸，“T”代表停止或跟踪，“N”代表具有正 nice 值的进程，“W”代表换出的进程。%CPU 和%MEM 表示自上次屏幕更新以来使用的总 CPU 功率或内存的份额。“时间”显示了进程在其生命周期中使用的 CPU 时间总量(即它在“运行”状态下花费的时间)。最后，“COMMAND”显示任务正在运行的命令。

##### 用户和帐户

虚拟或半专用帐户上的网站管理员可能会问自己的一个问题是，除了他们之外，服务器上还有多少人——因为没有人希望服务器过载。另一个 UNIX 命令可以解决这个问题:

```
wc -l </etc/passwd
```

该命令是“单词计数”的首字母缩写。`-l`参数告诉程序计算行数，而行的剩余部分告诉程序计算什么。在这种情况下，该命令告诉程序用系统上所有帐户的列表来计算文件的数量。请记住，不仅用户帐户会被计算在内，所有系统帐户也会被计算在内。默认情况下，UNIX 将有大约 15 个系统帐户。除此之外，您的服务器系统管理员很可能添加了更多的系统用户来适应服务器上的许多功能。通常，在一个虚拟主机服务器上，你会发现大约 40 个没有托管客户端的用户。如果您想查看用户的完整列表，可以使用一个命令。

```
more /etc/passwd
```

`more`命令将调用 passwd 文件，该文件实际上包含系统上每个帐户的列表。您可以查看您的服务器上还有哪些其他网站或用户，统计所有实际的托管帐户(基于他们的用户名)，或者完成一系列其他查询。此外，如果您想知道当时登录到机器的每个人的列表，您可以运行“who”命令。

##### 附加实用程序

一些服务器上提供的一个更有用的工具是系统帐户报告，或简称为“SAR”。该命令是这样组成的:

```
sar parameter count timeinterval
```

```
Parameter is a dash followed by a letter, which tells SAR what to report on. Following this are commands of how many times to check, and how many seconds to wait between checks. Usually the results aren't hard to decipher, especially with the help of the man command; but some common result abbreviations are "TPS" and "BPS". "TPS" stands for transfers per second, in kilobytes. "BPS" is an acronym for blocks per second; one block is half of a kilobyte, or 512 bytes.以下是一些有用的参数:

```

*   -b (I/O 和传输速率统计)
*   -c(流程创建活动)
*   -d(磁盘活动)

还有很多其他的方法来检查性能，但这涵盖了最相关的。如果你不确定的话，不要忘记使用`man`命令。探索愉快！

##### 延伸阅读(书籍)

*   [《现代操作系统》](http://www.amazon.com/exec/obidos/ASIN/0130313580/webmasterresou05)作者安德鲁·s·塔嫩鲍姆
*   [“基本系统管理”](http://www.amazon.com/exec/obidos/ASIN/1565921275/webmasterresou05)艾伦·弗里希著
*   ["TCP/IP Illustrated, Vol. 1"](http://www.amazon.com/exec/obidos/ASIN/0201633469/webmasterresou05) by Richard Stevens

## 分享这篇文章