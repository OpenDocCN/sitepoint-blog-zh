# IE 陷阱:记录“输入”请求

> 原文：<https://www.sitepoint.com/ie-contype-request/>

这篇文章描述了从版本 4 开始在 Internet Explorer 中出现的稍微奇怪的行为。如果你使用插件或者 SVG 图片，你会遇到这个问题

```
 <object type="image/svg+xml" data="image.svg"></object> 
```

当解析这段代码时，IE 将发出两个 GET 请求:

1.  第一个是对内容类型(image/svg+xml)的请求，这样浏览器就可以在浏览器窗口中调用处理程序应用程序。该请求由“contype”用户代理字符串标识。
2.  第二个是对文档本身的请求(也必须返回正确的内容类型)。

*(如果你仍然担心 IE 4.x 和 5.0.x，它们会发出额外的初始请求来获取内容类型，并执行注册表查找来确定需要哪个应用程序。)*

没有其他浏览器实现这一过程，但它出现在每个版本的 Internet Explorer 中，包括 IE9。

不幸的是，这会导致问题…

**大型文档**
如果您正在返回一个大型文档，如 PDF，如果时间超过 10 秒，初始内容类型请求将超时。静态文件可能不是问题，因为您的服务器*可能会*自动识别“contype”请求并做出相应的响应。但是，如果您正在生成一个文档，它会增加超时的可能性。在最好的情况下，IE 会使你的服务器负载加倍，并扭曲你的统计数据。

**用户代理检查**
这是我遇到的问题。出于安全目的，Web 应用程序通常会检查用户代理字符串，也就是说，如果用户代理在后续请求之间发生变化，则有人可能会试图劫持会话——会话会失效，用户会被注销。

如果您在一个典型的 MVC 应用程序中生成一个 SVG，IE 对包含该图像的资源发出以下请求:

1.  HTML 页面。向服务器传递标准 MSIE 用户代理字符串(会话有效)。
2.  SVG 内容类型。向服务器传递一个“contype”用户代理，该代理使会话无效。
3.  SVG 文档。向服务器传递标准的 MSIE 用户代理字符串，但不返回任何内容，因为会话不再可用。

这是一个很难调试的问题，因为 IE 用户每次遇到带有 SVG 图像的页面都会注销。

## 反向解决方案

防止问题的最好方法是检测“contype”用户代理，返回适当的内容类型并取消进一步的呈现。例如，在 PHP 中:

```
 if($_SERVER['HTTP_USER_AGENT'] == 'contype') {
	header('Content-Type: image/svg+xml');
	die();
} 
```

呃。没有其他供应商发现有必要进行初始内容类型请求，所以让我们希望微软从 IE10 中剽窃这个“特性”。

有关更多信息，请参考 [PRB:当您检索插件提供的内容](http://support.microsoft.com/default.aspx?scid=kb;en-us;293792)时，会发送三个 GET 请求。

## 分享这篇文章