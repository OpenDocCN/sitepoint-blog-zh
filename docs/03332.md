# 如何使用 modernizr 责任

> 原文:[https://www.sitepoint.com/how-to-use-modernizr-responsibly/](https://www.sitepoint.com/how-to-use-modernizr-responsibly/)

如果你喜欢玩一些并非所有浏览器都有的新功能，你肯定已经尝试过 [Modernizr](http://modernizr.com/) 。这个库允许测试您想要的特性是否可用。由于 Modernizr 在`html`元素上添加了一些 CSS 类来指示一个给定的特性是否可用，所以您可能想直接将它包含在`head`标记中，以便尽快知道您想要的特性是否可用。

这种方法是 Modernizr 的开发人员自己在开始时推荐的。它的问题是，它与我们都应该有的负责任的方法不兼容。这就是为什么该项目的开发者之一 Paul Irish 分享了他对如何纳入 Modernizr 的想法。这些想法激发了这篇文章。在这篇文章中，我们将讨论当我们想要使用 Modernizr 时，为什么我们应该采取一种负责任的方法。然后，我们将看到在可能的情况下将这种方法付诸实践的一些方法。

## 为什么要关心 Modernizr 是如何包含的

负责任的方法的用处可以归结为一个问题:你喜欢等几秒钟才能访问一个网页吗？当然不是，你的访客也讨厌这样。这就是为什么，如果他们等待页面显示很长时间，他们不会回来。我很确定你不想那样。我们都喜欢花哨的功能，但如果它们让我们的网站太慢就不会了。好消息是，即使采取负责任的方法，你仍然可以保持你的迷人特征。区别在于你不会以同样的方式加载它们。

让我们讨论一个 JavaScript 文件的具体例子。在很多情况下，我们在执行脚本之前等待页面加载。在这些情况下，在`head`元素中包含脚本是没有用的，因为脚本在很早的阶段就被加载了，但是它会在运行之前等待页面被加载。问题是，如果您的脚本包含在`head`中，浏览器将在页面本身之前加载它。这意味着如果你的脚本很大，你的访问者必须等到脚本加载后才能看到页面。

开发 Modernizr 是为了确定您是否可以在网页中使用一些最新的功能，如 CSS 过渡或转换。排除一些特殊情况，为了在用户的屏幕上显示一些东西，你不需要这些特性。有一些脚本必须包含在`head`标签中，但大多数都没有。Modernizr 也不例外。在大多数情况下，你不需要将它包含在`head`中，你可以在`body`结束之前包含这个库。

在继续之前，我想澄清一点:如果使用 Modernizr 的网页需要很长时间加载，负责任地包含这个库不足以提高性能。采用负责任的方法意味着，每当您想要包含 JavaScript 文件或其他潜在的大型资源时，您都必须考虑这一点。如果你优化了一个资源被包含的方式，你不会看到很大的不同。然而，如果你优化了你所有的资源，差别是巨大的。

正如我提到的，有些情况下你必须在`head`中包含 Modernizr，而有些情况下则没有必要。这取决于你的项目和你的需求，这正是我接下来要讨论的。

## 定义你的需求

定义你的需求是你在加入 Modernizr 之前应该做的第一件事。你可以用这个库测试很多不同的东西，但是你的项目可能不需要所有这些测试。如果你访问[这个页面](http://modernizr.com/download/)，你会看到 Modernizr 给了我们一种方法，只需要测试就可以构建我们自己的定制版本的库。生成的文件比完整版本的库要小，所以下载时间会更短。

![customized build](../Images/508bb41ccb2f834d1b219c3f7323a70d.png)

通常，您不知道项目发布后会需要哪些特性。每次添加特性时都生成一个新的构建并不是一个非常有吸引力的选择。一个可能的解决方案是使用完整版本开发您的项目，并且在发布项目后只生成您自己的版本。一个更好的方法是使用自动化工具，如 [grunt-modernizr](https://github.com/Modernizr/grunt-modernizr) 抓取 CSS 和 JavaScript 文件，找到你正在使用的所有特性。一旦完成，它将创建相应的定制 Modernizr 构建。

通过使用 grunt-modernizr 而不是自己构建一个定制版本，您可以确保不会意外地包含一个无用的函数。例如，您可能在给定时刻需要一个测试，但是随后又放弃了它，而没有从定制的 Modernizr 构建中删除该测试。请记住，在决定您在项目中使用的测试或特性是否真的有用时，grunt-modernizr 不会取代您。因此，对于每一个可能的测试现代化，你应该问自己是否真的需要这个测试。

例如，该库有一个测试来确定 CSS 属性`text-shadow`是否受浏览器支持。您可能认为了解这些信息对于不应用不受支持的属性很有用。但是，如果浏览器不支持 CSS 特性，它不会使网站崩溃或崩溃，该属性将被忽略。因此，你应该思考一下，如果阴影没有显现出来，对你的网站来说是不是一个大问题。也许你的影子是为了增加一个酷的效果，在这种情况下，如果游客看不到它也没关系。增强的体验是为更新浏览器的用户准备的，但是你的网站肯定可以在没有文本阴影的情况下生存。结论是，测试这个特性是否可用可能是无用的。

有些情况下，您想要添加文本阴影来提高文本的可读性。如果是这样的话，对于不支持这个特性的浏览器，你必须有一个后备行为，因此你需要执行测试。但是这个测试的需要也取决于您想要使用的回退类型。CSS 中有一些回退根本不需要测试。总之，在决定之前好好考虑你的需求。

对于 html5shiv 可以进行类似的讨论，它使您能够在 Internet Explorer 的旧版本中支持 HTML5 元素。Modernizr 可以为您包含它，但是您应该拥有它吗？如果您的网站不支持旧版本的 Internet Explorer，确保您可以在这些浏览器中样式化 HTML5 元素是没有用的，因此您不需要 html5shiv。我个人认为不支持某些浏览器是一个错误。对于一些旧版本的 ie 浏览器来说，拥有一个工作网站并不是很困难。总之，您应该使用 html5shiv，但不一定要通过 Modernizr。遵循一种负责任的方法，我们通常将这个 shiv 包含在`head`元素内的内联`script`标记中(更多细节请参见下一部分)。

总而言之，一定要选择你真正需要的测试。有些测试经常会被遗忘，CSS 回退并不总是需要 Modernizr 才能工作。

## 有些功能可以等等

我们都学会了在单独的文件中编写脚本，连接和缩小它们，并在 HTML 代码中链接到缩小的文件。好处是多方面的，从在几个页面上包含脚本的可能性到可以用来在后续访问中允许更快下载的浏览器缓存。包含文件的`script`可以放在 HTML 代码的任何地方，而不仅仅是在`head`中。更重要的是，把它放在 HTML 代码的底部有几个好处。例如，在其他元素被解析之前，文件不会被下载。即使你的脚本很大，也不会妨碍你的用户看到页面。然后，您的脚本将被下载，增强的体验将开始。

在这里，我讨论的是一个可以等待页面结束加载的脚本。同样，大多数 Modernizr 特性也可以等待。我们创造了增强的体验，一旦基本的体验可用，就可以使用。负责任的方法背后的精神是，用户希望看到你的网站的内容，他们希望迅速看到它。围绕内容的良好环境总是更好，但前提是信息在那里。这就是为什么我们在页面底部加载脚本来增强体验。

也就是说，仍然有一些 Modernizr 特性我们必须包含在`head`中，比如 html5shiv。为了支持 HTML5 元素，旧版本的 Internet Explorer 需要在看到第一个 HTML5 元素之前加载这个 shiv。这意味着您不能推迟它的加载，但是您仍然可以改进包含它的方式。一个例子是，只有当浏览器需要 html5shiv 时，才可以用条件注释包含它。另一个例子是，您可以直接将这个 shiv 包含(内联)到 HTML 代码中，而不需要外部文件。缓存不可用，但刀没那么大。不使用外部文件的好处是可以避免 HTTP 请求。

为了确定是否需要在`head`中包含 Modernizr，您需要首先考虑您想要显示什么以及如何显示。对于您使用的所有测试，您必须考虑如果在页面显示后执行测试，网页是否会被破坏。我们总是可以提供一个回退行为，然后，一旦在`html`标签中添加了正确的类，这个行为将被增强的体验所覆盖。了解变化是否很大对你来说至关重要。事实上，如果页面加载后一些块移动，您可能会失去您的用户。如果变化很大，也许你应该在`head`中加入 Modernizr。但是，在此之前，看看是否有可能通过更好的回退行为使更改不那么明显。

## 效率呢？

我们希望在页面底部加载 Modernizr，以改善加载时间。然而，正如 [Paul Irish 所说](https://github.com/Modernizr/Modernizr/issues/878#issuecomment-41448059)，<q>Modernizr 的许多测试(尤其是 CSS 测试)会导致回流</q>。通过这些测试，浏览器可能需要重新计算一些样式。考虑到 DOM 树和文档中已有的样式的复杂性，这些重新计算可能需要或多或少的时间。如果库包含在`head`中，它将在主体的任何元素被处理之前被执行。如果`body`为空，浏览器的计算就不那么复杂，因此花费的时间也就更少。

此时，您必须做出一个重要的决定:在页面底部加载 Modernizr 所节省的时间会因为执行时间而完全浪费吗？不幸的是，很难提供一个通用的答案，这取决于你的具体情况。根据 DOM 树的复杂性，测试可能快也可能慢，所以执行一些测试来看看在您的情况下执行 Modernizr 需要多长时间。请记住，根据您测试的浏览器和版本，时间可能会有很大的不同。

谈论 Modernizr 的效率也是再次提及您可以创建的定制构建的另一个机会。通过只选择你需要的测试，无用的测试将不会被执行，如果它们影响了 DOM 树，它的时间节省了！

## 结论

通过这篇文章，您应该对 Modernizr 有了更好的理解，并且知道如何将它包含在您的页面中。我们已经讨论了一些情况，在这些情况下，你可以把它放在页面的底部，而在其他情况下，它应该放在`head`中。不管你的解决方案是什么，只要包含你需要的特性，就能为那些网速慢的用户提供良好的体验。

在本文中，我讨论了 Modernizr，但是这个库并不是唯一可以从负责任的方法中获益的库。例如，考虑到 jQuery 用于影响 DOM 树，并且使用 jQuery 的脚本经常在整个文档准备就绪时执行，为什么还要将其包含在`head`标签中？

负责任地发展不仅仅是一个时尚术语。这是我们应该尽可能遵循的方法。顾名思义，强行下载无用数据是相当不负责任的。

## 分享这篇文章