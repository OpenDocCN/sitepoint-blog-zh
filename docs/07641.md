# 泽维尔·诺里亚:代码园丁

> 原文:[https://www.sitepoint.com/xavier-noria-the-code-gardener/](https://www.sitepoint.com/xavier-noria-the-code-gardener/)

| ![](../Images/cf6afa86bd288f8017ec68c21c9c8617.png) |
| *泽维尔获得了 2010 年*的[红宝石英雄](http://www.youtube.com/watch?v=ffCxpBD-_Rs)
奖 |

Xavier Noria (加泰罗尼亚语发音为“sha–vee–aay ”)在 Ruby 社区非常有名。他是一名来自巴塞罗纳的自雇 Ruby 开发人员，也是 Rails 核心团队的成员，并在 2010 年[Rails conf](http://en.oreilly.com/rails2010)期间获得了 [Ruby Hero](http://rubyheroes.com) 奖。你们中的许多人可能见过他本人；今年，他已经在欧洲各地的许多 Ruby 会议上发表了演讲。

但是给我印象最深的是 Xavier 作为“代码园丁”的角色——这个短语是我从他两年前的一个小 Rails commit 中得到的。你可以在我去年写的一篇关于我最喜欢的 Rails 提交的[文章中读到更多关于这个提交的内容。上周，Xavier 和我有机会聊了一个多小时——请继续阅读，了解更多关于他的背景、Rails 4 的未来、他对文档的热情，以及最重要的关于小变化重要性的哲学。我也有机会问 Xavier 如何使用正则表达式来确定一个数是否是质数！](http://patshaughnessy.net/2011/12/6/learning-from-the-masters-some-of-my-favorite-rails-commits)

## Ruby 入门

问:你是如何开始使用 Ruby 和 Rails 的？

![](../Images/fee027f7dc2de0a709a81ad5fa1e2700.png)

12 年前，我开始以计算机编程为生；当时我 30 岁，所以我参加聚会迟到了。但是我转行做计算机编程，因为我热爱它。

我曾经专业地使用 Java 工作过一段时间，并且在我工作的研究实验室中做了大量的 Perl 工作。我业余时间在巴塞罗那大学教了 7 年 Perl。2005 年，有人联系我，问我:“嘿，有没有什么新东西引起了你的注意？”2005 年，每个人都在谈论 Ruby on Rails，乍一看，它似乎值得关注。所以我想:“是的，这个 Ruby on Rails 看起来很有前途。”我没有专业地做过任何 Ruby 编程，但是因为我喜欢动态语言，所以我尝试过一点点 Ruby。

然后我们在一个真实的项目中尝试 Rails，而不仅仅是做一个“hello world”应用程序或类似的东西，我们对这个小项目的体验感到非常惊讶，我们认为你可以找到一个基于这项技术的公司。所以我们在 2006 年成立了一家 Rails 商店；我们只做了铁轨。这是我们的品牌:我们是西班牙的铁路专家。

问:你一直在说“我们”——你和谁一起工作？

![](../Images/fee027f7dc2de0a709a81ad5fa1e2700.png)

与[奥古斯丁·昆卡](http://loscuenca.com/agustin-cuenca/)。我们在 2005 年做了第一个项目，然后在 2006 年和其他合作伙伴一起创立了 [ASPgems](http://aspgems.com) 。公司现在还活着，做的很好，但是后来我独立了，在 2009 年离开了。

## 在 Rails 核心团队中工作

问:你是如何开始为 Rails 做出贡献并成为核心团队的一员的？

![](../Images/fee027f7dc2de0a709a81ad5fa1e2700.png)

我参与开源已经 10 年了。我在 CPAN 有一些 Perl 模块；我一直在 IRC 里帮忙，做类似的事情。在 Rails 中，每当我发现需要修复的东西，比如一个 bug 或其他东西，我总是会尝试贡献一个补丁——但我不会处理票证或类似的东西。当我需要什么东西的时候，我会试着贡献一个补丁或者补丁什么的。

让我参与 Rails 项目本身的是文档。总的来说，我认为 Ruby 文化中的文档是缺乏的。有很大的改进空间。尤其是在 Ruby on Rails 中，我对我们拥有的文档不满意。所以普拉蒂克·纳伊克有了这个天才的想法，创造了 T2 的 docrails。Docrails 是用于快速文档修复的 rails 的一个分支，它定期与 master 交叉合并。开始时，你只需要向 docrails 请求就可以得到它的 commit 位，现在它有了公共写访问权。

我是第一个要求 Pratik 提交的人，然后我开始疯狂地编写文档。文档有几个方面需要改进。一个轴是内容本身，这是最重要的事情。然后还有其他同样重要的事情，比如排版的一致性等等。没有惯例或准则；真是一团糟。我前面说过，我 30 岁时开始做开发人员，但在那之前，我做过几年数学教科书的校对。

哦，真的吗？

![](../Images/fee027f7dc2de0a709a81ad5fa1e2700.png)

所以你知道，我的眼睛受过这种训练。如果这必须是斜体，而不是斜体，那么我马上就能看到！

问:我还是占你便宜吧！我能给你发一份我的新电子书的草稿吗？我从来没有意识到你是一个专业的校对…

![](../Images/fee027f7dc2de0a709a81ad5fa1e2700.png)

是的，我很乐意！

所以我们制定了一些文档指南，我开始在 Ruby on Rails 的源代码中大量应用这些指南。我做了很多工作，大部分都不为人知——但我不在乎。我在修理我想修理的东西。然后偶尔我也和代码打交道。我的比例大概是 80/20 左右。在那些日子里，我的大部分贡献都与文档有关。最终，核心团队的人知道了这项工作，我开始和他们有了更密切的联系，也有了更多的机会从内部了解这个项目。最终我被邀请加入核心团队。

问:祝贺你——太棒了！在核心团队工作是什么样的？好玩吗？难？累吗？

![](../Images/fee027f7dc2de0a709a81ad5fa1e2700.png)

太棒了！在团队中，个人和团队工作之间有一个很好的平衡。它没有写在任何地方，但对于一些重要的事情，我们试图讨论并达成共识，但在大多数情况下，我们是孤独的。核心团队中的每个人都在自己感兴趣的地方工作。我们有两个交流的地方——一个是在[篝火](http://campfirenow.com)中的一个房间；另一个是在[大本营](http://basecamp.com)的项目。

问:你真的和车队交流过吗，不管是像我们现在这样通过 Skype，还是面对面？

![](../Images/fee027f7dc2de0a709a81ad5fa1e2700.png)

至少对我来说，所有的东西都是在营火或大本营里写的，或者很少在电子邮件里写。但我知道，比如说《Rails 3 days》中的 [José](https://twitter.com/josevalim) 和 [Yehuda](https://twitter.com/wycats) 配对的几率很小。

问:他们实际上在各自的功能上一起工作？

![](../Images/fee027f7dc2de0a709a81ad5fa1e2700.png)

是的。我不知道现在是否还有人这样做。但通常一切都是书面的。

## Rails 4 中会有什么

问:很多人都想知道 Rails 4 将会推出什么……我知道我们没有时间一一介绍，但你现在能告诉我们一点吗？

![](../Images/fee027f7dc2de0a709a81ad5fa1e2700.png)

这是一个重要的发布——有很多东西。在过去的几天里，我一直在浏览变更日志，以便开始为发行说明准备材料。以下是一些亮点…

首先，需要 Ruby 1.9.3。

问:…那是因为你使用了只在 1.9.3 中有效的语法吗？

![](../Images/fee027f7dc2de0a709a81ad5fa1e2700.png)

大家一致认为，我们只想关注 Ruby 的最新稳定版本，而不想花时间在以前的版本上。因此，由于这是一个主要版本，我们将只使用 1.9.3。我们只打算“正式”支持 1.9.3。可能您的应用程序也运行在 1.9.2 版本上，但是您自己在那里。它不会与 1.8 一起运行，这是肯定的。在 1.8 和 1.9 之间有很多带条件的代码，所有这些都被删除了。

哦，我明白了。所以你的测试套件只能在 1.9.3 上运行？

![](../Images/fee027f7dc2de0a709a81ad5fa1e2700.png)

是的，没错。

此外，还有许多新功能:我喜欢的一点是，我们已经改用补丁动词作为我们支持的 HTTP 动词集的一等公民。

问:补丁动词是做什么的？是更新吗？

![](../Images/fee027f7dc2de0a709a81ad5fa1e2700.png)

是的，这个想法是，它做一个更新。过去你用 PUT 动词做更新，但是 PUT 的语义是我发送给你的这个实体的创建或替换。然而，在 web 编程中，大多数时候你并没有发送完整的资源。所以现在在更新资源的表单中，在“_method”隐藏参数中你将得到补丁。但还是路由到更新。PUT 将继续路由到 update，以使升级更容易——所有当前请求都将在同一个地方结束。

问:开发者需要了解什么？无缝吗？它是透明发生的吗？

![](../Images/fee027f7dc2de0a709a81ad5fa1e2700.png)

是的，它应该是无缝的。

许多人想要改变的另一件事是对属性的大规模赋值的控制。它在模型层；许多人想把它放到控制器层，这将在 Rails 4 中实现。该特性被称为[强参数](http://weblog.rubyonrails.org/2012/3/21/strong-parameters/)–批量分配仍然发生，但您在控制器层对其进行配置。“attr_accessible”和“attr_protected”不可用。它们被提取到一个插件中。

另一个好东西是用于队列的 API。您可以挂钩几个队列，并有一个统一的 API 与它们对话。事实上，由于这个 API，邮件发送者可以在 Rails 4 中异步发送邮件。

问:有意思……

![](../Images/fee027f7dc2de0a709a81ad5fa1e2700.png)

此外，另一个主要亮点是支持我们所说的“俄罗斯娃娃缓存”

问:是的…我最近看过一些那方面的照片。你能在几分钟内解释一下吗？

![](../Images/fee027f7dc2de0a709a81ad5fa1e2700.png)

如果你在一个给定的视图中大量缓存所有的片段——假设你有两个或三个级别的缓存——并且你使用了一种分代技术，即加上一个时间戳，这样键就会自动过期。现在，如果您更改一个嵌套模板的静态内容，那么您必须使父容器无效。在这个特性出现之前，你必须以某种方式手动操作。Rails 4 中的这个新特性可以自动计算模板内容的 MD5 数字签名。

最后，主动资源用完了。它没有被大量使用，将成为一个插件。

还有更多的东西，但这些是几个亮点。

## 代码园丁

问:你还记得我去年写的那篇文章吗？我在文章中称你为“代码园丁”我希望你不会为此生气或难过…我希望这不是冒犯！

![](../Images/fee027f7dc2de0a709a81ad5fa1e2700.png)

相反，有人突出微小的贡献是不寻常的。我喜欢你的评论。

问:你真的花了很多时间做这件事吗？你真的是“代码园丁”吗？

![](../Images/fee027f7dc2de0a709a81ad5fa1e2700.png)

当有什么引起我的注意时，我会去解决它。对我来说，我对写一个大东西，对使这个代码统一或对修正那个小的打字错误同样感到兴奋。事情是这样的，如果我在读源代码的时候发现了一个小问题，我会马上去修改它。

问:所以你非常注重细节。如果我想象你在花园里拔草——那是你喜欢做的事情。

| ![](../Images/e5d8b1b7d3561312e43027e583a2b214.png) |
| *Xavier 的“代码园艺” [Rails commit](https://github.com/rails/rails/commit/fb6b80562041e8d2378cad1b51f8c234fe76fd5e)
从两年前* |

![](../Images/fee027f7dc2de0a709a81ad5fa1e2700.png)

是的，我认为这种贡献是重要的，因为这些细节有助于形成代码并保持代码的美观。如果我看到任何东西——不管是重要的、大的还是小的——我都不在乎，我只是去编辑和推送。

我没有以任何方式限定门票-对我来说，修复一个打字错误和修复一个错误或任何其他变化一样重要。如果有人发这样的补丁，只要不是怪物补丁，我会马上接受。这也是我非常喜欢 docrails 的一点，因为 docrails 提倡你可以做这种事情。

问:假设有人在读这篇文章，他想为 Rails 做贡献，但以前没有做过？开始为 Rails 项目做贡献的好方法是什么？

![](../Images/fee027f7dc2de0a709a81ad5fa1e2700.png)

最简单的方法就是去 [GitHub](https://github.com/rails/rails/issues) 做门票。处理票证可能意味着很多事情:可能是准备修复某个东西的补丁，可能是测试现有补丁是否仍然通过，或者其他任何事情。如果你在文档方面很有经验，那么你也可以在源代码中搜索那些没有被正确记录的地方。你可以去记录那些地方。另外， [Rails Guides](http://guides.rubyonrails.org) 也总能从愿意贡献文档的人那里受益。这是这个项目非常非常重要的一部分。

## Ruby 会议

问:在过去的几个月里，你参加了许多不同的会议: [RailsClub Moscow](http://railsclub.ru) 、 [BaRuCo](http://baruco.org) 、[陆如 2012](http://rulu.eu) 、 [RailsBerry](http://railsberry.com/2012) 和 [EuRuKo](http://www.euruko2012.org) 。这些会议中你最喜欢的是什么？

![](../Images/fee027f7dc2de0a709a81ad5fa1e2700.png)

是的，我想这是我旅行最多的一年。我参加了所有的会议，除了在 EuRuKo，我在会议的前一天参加了一个研讨会。所以这是有趣的一年。所有的会议都很棒。

我参加会议的动机是为了与人接触。我也喜欢参加会谈，但是，你知道，会谈不是我去的主要动机。

问:所以你最享受的是之后在酒吧或酒馆的时光？

![](../Images/fee027f7dc2de0a709a81ad5fa1e2700.png)

我喜欢休息时间……我不经常聚会——凌晨 1 点左右，我会去酒店休息。

问:对于西班牙人来说，凌晨 1 点听起来太早了！我以为在西班牙，你凌晨 1 点才刚刚吃完晚饭…

![](../Images/fee027f7dc2de0a709a81ad5fa1e2700.png)

哈哈——确实如此。但是我喜欢休息到会议的第二天。有两种类型的会议日程:一种是整个上午的会谈，另一种是更少的，有半个小时或更多的休息时间。我更喜欢第二种风格，在这种风格中，你有时间去和人们交谈，少做报告。

问:你有机会去美国参加会议吗？

![](../Images/fee027f7dc2de0a709a81ad5fa1e2700.png)

老实说，对我来说太远了。我只去过美国一次，说实话，我去只是因为组织者“建议”我参加…因为我要去接受红宝石英雄奖。

问:恭喜你！那是几年前的事了？

![](../Images/fee027f7dc2de0a709a81ad5fa1e2700.png)

是的，是在巴尔的摩举行的 2010 年铁路博览会上。

## 正则表达式和素数

问:我不记得在哪里看到过这个，但最近我第一次听说如何使用正则表达式来确定一个数是否是质数。然后我在你的[数学中看到了一行正则表达式 repo](https://github.com/fxn/math-with-regexps) ，就像这样: