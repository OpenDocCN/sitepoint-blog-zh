# 强化 Apache——与作者的对话

> 原文：<https://www.sitepoint.com/hardening-apache/>

**信息安全已经成为各种类型和各种规模环境中系统管理员的标准职能。安全难题中最关键的一块是锁定生产和开发 Web 服务器。**

托尼·莫布里(Tony Mobily)在 Apress 出版的新书《强化 Apache 》将这种最流行的 Web 服务器的安全提升到了一个新的高度，并将所有经验水平的用户带入了安全配置的世界。

本书直观地介绍了设置过程，从下载和验证，到配置和修改，再到在生产模式下运行。下面是*强化 Apache* 的目录:

1.  安全安装和配置

3.  常见攻击

5.  记录

7.  跨站点脚本攻击

9.  Apache 安全模块

11.  监狱里的阿帕奇人

13.  自动化安全性

15.  App。答:阿帕奇资源

17.  App。HTTP 和 Apache

19.  App。c:章节检查点

##### 与作者的一次聊天

Tony Mobily 以前为现已解散的 Wrox Press 撰写过专业的 Apache Security，他了解自己的 Apache。这位西澳大利亚的居民开始成为一名程序员，他将自己早期的工作描述为“想成为”黑客。

“开始时，我想我有点像‘脚本小子’(我当时很年轻，我使用了预先制作的漏洞！);但是后来，由于我的编程技能，我设法更深入地挖掘这个令人惊奇的领域，并且我变得更加意识到潜在的技术和问题。或许，就在那时，我成为了一名真正的‘黑客’——如果我可以说我是一名‘黑客’的话，”Mobily 告诉 SitePoint。

然而，他很快意识到自己的优势在于系统管理，并开始接触 IBM 的 AIX 和 Linux。随着互联网的出现，他也搭上了顺风车，并决定“网络安全是他的游戏”。

当被问及是什么激励他开发 pen Hardening Apache 时，Mobily 的回答透露了他对这个主题的热情。

“必须有人做这件事，但似乎没有人做得对，而且看起来也不会在不久的将来这样做。例如，如果你看 PHP，你可能会找到 35 本书。其中 15 个完全是垃圾。其中 10 个是可读的。其中 8 个做得非常好。其中两个是真正的瑰宝——经过深思熟虑、精心写作、精心编辑和精心出版。

“对于 Apache security 来说，这不会发生，我的目标是写一本‘写得非常好的书’。使用[Wrox]的第一次尝试并不成功。我只是一个团队的一部分，很多人说这本书不行，因为太碎片化了。随着 Apache 的加强，我想把它做好。我相信我做到了。”

##### 基本原则

从一开始，Mobily 就要求读者有耐心，因为他涵盖了一个在管理员心目中并不总是最重要的安全元素:下载的有效性和精简、干净的安装。

对一些人来说，这可能不是一个主要问题；然而，有些网站基础设施需要最高级别的安全性，无论是出于合规性原因，还是仅仅为了安抚偏执的管理层。

Mobily 超越了通常的 MD5 校验和，提供了使用 GnuPG 验证文件的入门知识，即使它是从授权来源下载的(考虑到可能的站点和源文件攻击)。

提供了一个非常可靠的从源代码构建 Apache 的指南，它涉及 1.3.x 和 2.0.x 两个版本。

##### 检查泄漏

这本书第一次向我介绍了 Nikto T1，这是一个由 Cirt.Net T2 的人们创造的方便的工具，用于全面扫描你的网络服务器的安全性。

如 Cirt 网站所述，

<q>Nikto 是一款开源(GPL) web 服务器扫描器，它针对 web 服务器的多个项目执行全面测试，包括超过 2600 个潜在危险文件/CGI、超过 625 个服务器上的版本以及超过 230 个服务器上的版本特定问题。扫描项目和插件经常更新，并且可以自动更新(如果需要)。</q>

它包括对 Unix 系统(当然包括 Linux 和 Macintosh OS X)和基于 Windows 的机器的支持，并且是来自同一组的 htmap 的替代品。

对于那些对其管理下的服务器进行安全性、漏洞和配置紧缩的彻底检查的人来说，这是一个极好的起点。
配置

我特别喜欢 Mobily 关于在设置虚拟服务器之前配置 httpd.conf 的评论。它本末倒置，耐心地确保系统已经准备好托管这些域，从安全角度来看减少了 Apache 模块，并做了一些调整。

其中包括对使用 mod_security、mod_bandwidth 和 mod _ dosage 等第三方模块来提高安全性的精彩解释。

作者的一些技巧包括在 httpd.conf 中使用“ServerTokens Minimal”修改头——这将从作为 HTTP 请求的一部分发送的头中删除 Apache 版本号。

另一个可能有争议的变化是建议通过一个`<Location />`容器禁用 HTTP 跟踪，或者在所有容器之外使用 mod_rewrite 作为一个全局指令。如果你需要更多的信息，请看 W3C 对 HTTP TRACE 的定义。

```
RewriteEngine on 

RewriteCond %{REQUEST_METHOD} ^TRACE 

RewriteRule .*  [F]
```

请注意，书中提供的所有代码示例都可以在 [Apress 网站](http://www.apress.com)上在线下载。

##### 阿帕奇管理的关键因素

这本书详细介绍了 Apache 中两个最常讨论的函数，mod_rewrite 和 logging，并提供了一些有见地的方法，通过这些方法可以有效地使用这两个函数来提高安全性。特别是，部署一个使用加密进行数据传输的独立 Web 日志服务器的完整计划包含在本书中。

Mobily 解释说，“日志记录绝对重要，应该在专用于日志记录的远程服务器上完成。日志文件应该通过 TCP 连接(而不是 UDP)传输，并且应该加密以防止人们篡改其内容。

关于日志记录的章节专门关注如何实现这一点，Mobily 认为他的解决方案非常有创意。

“也许伐木没有安全风险；相反，没有适当的记录是一个巨大的安全隐患，”他说。

##### 在监狱里管理阿帕奇

许多系统管理员对 Chroot 监狱犹豫不决。事实上，这可能是一项艰巨的任务，尤其是如果您还必须使用一个数据库和几种脚本语言。Mobily 在他的书中解释了这项任务，包括让 Perl 和 PHP 在监狱中与 Apache 一起工作的细节。

Chroot jails 在服务器上创建了一个准根扇区，因此，如果它们遭到破坏，受到破坏的攻击者只能被囚禁在一个目录子集内，而不是真正的根文件系统。这是因为该程序包含了一个命令外壳“相信”/，它指的是文件系统的特定扇区，而不是真正的服务器根目录。

挑战在于将所有需要的库文件放在监狱中，这是运行一个简单的 bash shell 所必需的。Mobily 通过他的报道让这个过程不那么痛苦。

“你可能会觉得拥有一个大部分文件都在‘笼子’里的服务器很奇怪，”Mobily 评论道。“人们可能会想:这有什么区别吗？为什么要用笼子呢？嗯，关键是，即使笼子里的所有信息都可能被破坏，您仍然可以相当确定服务器本身没有被修改，没有包含令人讨厌的 root kit，等等(反正不是通过 Apache)。”

“如果您意识到您被破解了，您可以简单地从备份中分解一个 tar 文件(可能是一个非常大的文件！)与整个 chroot 监狱的内容(当然，您将创建该文件的每日副本)，然后分析您的日志文件，找出是谁进行了攻击以及如何进行的。在服务器级别，相当于完全重新安装，这是一个更加痛苦和耗时的过程！”

##### Windows 上的 Apache

虽然 Apache 环境的很大一部分是在 Linux/Unix 平台上运行的，但是也有大量 Apache 的新用户，他们经常将自己的第一个站点放在 Windows 桌面上进行生产。我们问作者对那些在 Windows 上使用 Apache 的人有什么建议。

“第一条规则是:了解你的系统。如果你真的必须(或者想)在 Windows 上运行 Apache，你必须对 Windows 了如指掌。不幸的是，这说起来容易做起来难。因此，我的建议是:非常了解 Windows。或者，如果你想节省一些时间并获得一些好的结果，安装 Linux 并购买一本好书来研究它，”Mobily 建议。

##### 日志安全和日志分析工具

当加强对日志文件的控制或使用非传统方法(如前面所述)时，原始日志和分析应用程序之间的交互会变得复杂。

Tony 认为这是一个常见的问题——你创建了一个非常安全的系统，但是要从中获取任何东西都变得非常困难。如果您将日志发送到安全的日志服务器，您很可能会遇到某种系统管理问题。问题的根源在于日志机器应该只允许用于日志记录的连接，并且(很可能)只允许用于 ssh 连接的连接。

“那你能做什么？这种情况下的技巧很简单:让日志服务器本身连接到 Web 服务器，每天以“默认”格式上传信息。然后，像往常一样，从 Web 服务器提取并格式化您需要的所有统计数据，拥有一个安全的架构意味着更多的工作和知识。这可能是为什么大多数公司似乎放弃了它，并使用“交叉手指”的路径，”Mobily 补充说。

##### Apache 和 SSL

Mobily 认为 SSL 的使用在一定程度上提高了 Apache 的安全性——他还对自签名证书的使用提出了警告。

"自签名证书仍然允许公司加密连接；所以，在某种程度上，他们还是好的。他们没有告诉客户，公司的身份是由可信的机构或公司验证的，”他说。“我不确定我是否会在生产服务器中使用它们，因为你现在可以很便宜地获得证书，而且(更重要的是)因为网络用户不应该被训练对他们浏览时出现在他们面前的对话框说‘是’。”

##### 在命令行上配置

我分享了作者几乎完全在命令行上配置 Apache 的方法，因为我已经从终端 shell 学会了管理。然而，鉴于控制面板和图形管理工具的迅猛增长，我向 Tony 征求了意见。

“老实说，我从未使用过 GUI 来配置 Apache！所以，我真的不能说是否有一个图形用户界面做正确的工作。然而，正如我之前所说的，为了保护您的系统，您必须对其了如指掌，”Mobily 回应道。“在我看来，安全地配置 Apache 意味着染指 httpd.conf 文件。在书中，我建议拥有一个基本的、简短的配置文件，并在发现需要新功能时慢慢充实它。”

##### 多平台 Apache

最后，我知道 Apache 是那些运行在无数平台(包括 Linux、Macintosh、Netware、Unix 和 Windows)上的更独特的开源解决方案之一，我询问 Tony Web 服务器在任何特定平台上开箱即用是否更安全。

“我不这么认为。例如，我不会在 Windows 上运行高风险的关键任务服务器，因为它比 Linux 更难强化。但就 Apache 而言，规则或多或少保持不变(从操作系统到操作系统)，”Mobily 说。

***硬化阿帕奇***
**作者:**托尼·美孚里
**出版商:**阿普瑞斯
**价格:**
**29.95 美元更多信息:**[http://apress.com/book/bookDisplay.html?bID=320](http://apress.com/book/bookDisplay.html?bID=320)

## 分享这篇文章