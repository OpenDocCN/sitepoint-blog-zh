# 暴躁的程序员的测试包:回顾

> 原文:[https://www . site point . com/grumpy-programmers-testing-bundle-review/](https://www.sitepoint.com/grumpy-programmers-testing-bundle-review/)

在你的新 PHP 包教程中，我得到了一些关于我的基本 TDD 测试实践的建设性反馈，我决定阅读克里斯·哈特杰斯[“暴躁测试包”](https://leanpub.com/b/grumpy)，这是一套两本书，由[暴躁程序员构建可测试 PHP 应用程序指南](https://leanpub.com/b/grumpy#grumpy-testing)和[暴躁程序员的 PHPUnit 食谱](https://leanpub.com/b/grumpy#grumpy-phpunit)组成。我希望这些书能阻止我使用我在那篇文章中展示的拙劣做法，这也是最初引发马修·威尔·奥芬尼批评的原因。在这篇文章中，我想与你分享我所学到的东西，以及这对我有多大的帮助。

## 构建可测试 PHP 应用程序的坏脾气程序员指南

![](../Images/71fcd40c0c30ac48bbb4d70f8b309562.png)

打开这本书时，我注意到的第一件事是页数很少。对于 20 美元的高价，人们期望超过 68 页(包括奉献、介绍、目录等)。不过，人们不应该根据封面(或页数)来判断一本书，所以我不顾这一点，热情地一头扎了进去。

这本书总共有 15 章，只有第 7 章才真正开始。如果你刚刚阅读了[彼得关于代码分析工具的教程](https://www.sitepoint.com/analyzing-php-project-jenkins/)，并且熟悉像[流浪者](https://www.sitepoint.com/blog/)这样的环境隔离(例如我们的[家园改进](https://www.sitepoint.com/quick-tip-get-homestead-vagrant-vm-running/)盒子)，你可以直接跳到它，因为那些是作者在前 22 页中涉及的唯一主题。不幸的是，由于严重的过时，一切都走下坡路了。

*   作者提到 PHPUnit 及其通过 PEAR 的安装，当这是[不再支持](https://github.com/sebastianbergmann/phpunit/wiki/End-of-Life-for-PEAR-Installation-Method)。这会让不熟悉情况的新读者感到困惑。事实上，我呼吁所有 PHP 作者和开发人员公开摒弃 PEAR，将其视为过去的遗迹，不再用于任何目的。如果您的博客帖子或书籍中有 PEAR 说明，请更新您的材料以使用 Composer。
*   作者提到我们将在特定版本的 OS X 上使用的应用程序，但随后继续谈论虚拟机并提到了流浪者。这甚至让人怀疑提到原始设置的必要性，因为它只会让其他操作系统的用户感到困惑，如果要提倡 VM 驱动的最佳实践，这应该是完全不相关的。
*   作者提到了流浪者不稳定的问题，但现在情况不再是这样了——流浪者已经稳定和没有问题有一段时间了，暂时的错误不应该被指出来，因为它们往往很快失去相关性。
*   在某一点上，Phix 项目被提及，在其鼎盛时期，它是一个关于创建可共享组件的令人钦佩的预编写指南。Composer 使其过时，网站将很快关闭，所以对它的引用应该反映这一点
*   一些环节也死了，比如 http://framework.zend.com/manual/en/zend.dom.query.html。忽略这样一个事实，即今天有更好的组件适合 DOM 遍历任务，一个没有官方编辑和出版社的作者应该*总是*维护一个给定的已发表的盈利性文章的链接列表，并保持它们最新

在接下来的章节中，代码示例很少，但那些都是精心构建的，有助于说明坚实的原则在开发可测试应用程序中的重要性——这当然是本书的主要目的。我对这些例子的一个不满是它们没有得到充分的解释，并且经常需要参考 PHPUnit 文档。例如，代码:

```
// Create a mock object
$testRequest = $this-> getMock(
	'\Grumpy\Request' ,
	array( 'getUri' )
);

// Create our test response
$testRequest
	-> expects()
	-> method( 'getUri' )
	-> with( '/dashboard' );
```

…虽然在技术上是合理的，但并没有被解剖。找出`expects`、`method`和`with`方法做什么需要访问文档，这打破了流畅的阅读流程，并通过诱导一种“我应该已经理解了吗？我为什么不呢？”

另一方面，有些部分得到了很好的演示和描述。嘲弄脸书连接提供商的特殊案例揭示了轻松嘲弄的概念，并且不必比 PHPUnit 的官方文档更好地依赖外部资源。

就像今天书籍或会议演讲形式的许多其他材料一样，在接下来的两到三章中，我们提倡坚实的原则，如果你对坚实的含义有一丁点儿的了解，那么绝大多数内容对你来说都是(非常)熟悉的。阅读亚历杭德罗·格瓦西奥(Alejandro Gervasio)的[绝对令人惊叹的教程](https://www.sitepoint.com/author/agervasio/)(我还没有找到比他更好、更务实的固体概念解释)和这本书的另一大部分(不仅仅是这本书！)很快就过时了。

然后是这本书突然的结尾。我说结束是因为从第 9 章开始，这些章节变成了重新发布的博客文章。一本最后更新于 2013 年、最初出版于 2012 年的书**不得**引用 5-6 年前未经修改的资源。这简直不可接受:

*   随着像[http://psysh.org/](http://psysh.org/)第 9 章[这篇 5 年前的博文](http://www.littlehart.net/attheballpark/2009/12/15/shells-and-sandboxes/)的副本这样的工具的出现，似乎过时了。
*   第 10 章是这篇旧博文的副本。它在本书中的相关性值得怀疑。
*   第 11 章是[这篇文章](http://littlehart.net/atthekeyboard/2010/09/07/twitter-asks-continuous-integration-landscape-for-php-developers/)的转贴，这篇文章已经 5 年了，完全过时了。关于 PHP 世界中最新的 CI 解决方案，请参考[这些教程](https://www.sitepoint.com/continuous-integration-php-ci/)。
*   第 12 章，我找不到的另一篇博文的转贴，谈到了基础设施债务——从个人开发环境转移到整个团队统一环境的 VM 水域的艺术。这个话题在本书的开头几章已经以一种更简短、更有效的形式提到过，所以不知道为什么还要重复。
*   第 13 章谈到了对变化的恐惧，这是升级的有效威慑。这是一篇好文章，但更适合作为这本书的导言。
*   一个善意的耳光，第 14 章几乎是一个庞大的 7 岁。虽然作者的免责声明提到内容仍然相关，但我可以向你保证，无论如何都不相关。它谈到了严重过时的框架版本，这些版本今天已经失去了所有的相关性(这本书提到的 CakePHP 和 CodeIgniter 版本已经过时，ZF1 虽然很糟糕，但被反模式困扰的 ZF2 所取代，Symfony 从那时起已经完全改变了它的架构)。

在结尾部分，克里斯说:“我知道这本指南中有很多东西需要你考虑。”但是……真的没有。像这样过时的书应该被完全重写，它们的旧内容应该被重写以更好地适应今天的环境，新的版本应该被出版。毕竟，这就是新版的目的。

由于通过阅读这本短书吸收的新知识量有限，考虑到价格，它的页数很少——特别是考虑到你为这本书的两章半而不是 15 章付费，因为它只在第 7 章开始，在第 9 章以博客副本开始结束——偶尔的错别字表明缺乏专业的英语编辑，以及它的过时，我给它 1/5，不能建议你购买它。

我认为[在 PHP 中实现遗留应用程序的现代化](https://www.sitepoint.com/modernizing-legacy-applications-php-review/)是构建可测试 PHP 应用程序的更好参考，因为它采用实践的方法，涵盖了测试以及所有其他修复和最佳实践。虽然贵一些，但很值得。

![](../Images/5aac2c617bf6fb7c7ff4876e3fe1da6f.png)

## 坏脾气的程序员的 PHPUnit 食谱

失望之余，我继续看第二部分。

![](../Images/57ac700ce802f050eae097bf7e614f8a.png)

在贾斯汀·瑟尔斯精彩的前言之后，这本书的前 22 页给人一种清新的感觉。在这一小段中，人们已经学到了比整个第一本书更多的东西——运行不同类型的测试和产生不同输出的各种选项，大量的好建议，以及 PHPUnit 无休止和令人生畏的文档对新手来说不容易做到的事情。

虽然我更希望代码样本更真实，而不是 foos 和 bar，但是 mocks 和 stubs 都得到了很好的解释，它们的子类型都得到了定义(间谍和假人！)，并展示了示例用例。仅在 Test Doubles 一章中，我就从“当我可以使用真正的类时，我为什么要使用 mock”转变为“好吧，我不会再使用真正的类了”。关于数据提供商的章节非常简短，但它在不到 10 分钟的时间里解释了一些我从来不知道的事情——如果我在写这篇评论的介绍性段落中提到的帖子之前读过它，我就可以避免马修的嘲笑了:)

这本书远非完美，也有其不足之处。再次，有稍微过时的安装说明。梨子再次被提到，作曲家有点过时的方法在最前面。这整个部分可以改写成一个单独的段落，其中 PHPUnit 位于`composer.json`的“require-dev”块中，尽管对于读者来说，我们是否真的需要任何安装说明都是值得怀疑的——这本书的目标读者是已经对 PHPUnit 感兴趣并可能已经在使用它的人。完全删除安装说明将增加书的寿命，同时更快地关注目标内容。

同样，这本书需要更新到最新的 PHPUnit 版本，例如，这里不再有“getObjectForTrait”，而是有了 [this](https://phpunit.de/manual/current/en/test-doubles.html#test-doubles.mocking-traits-and-abstract-classes) 。

与前一本书一样，链接需要更新，书中也有一些拼写(“测试 API”)和格式错误，再次表明缺乏技术编辑，但没什么大问题:

![](../Images/306e4a0228b95f53e505c47efb81805f.png)

![](../Images/6b2846769ea5dba33540e2c02e96b2a0.png)

总而言之，我提到的缺点是吹毛求疵——第二本书是一本优秀的 PHPUnit 用户指南，我真的很兴奋能够继续测试、测试、测试。3.5/5–如果没有上述问题，应该是 4.5/5。

![](../Images/7fe5288ad14aa3a86ab70f8a78bceeef.png)

## 结论

作为其组成部分的总和，该捆绑包令人失望。第一本书是一个彻底的失误，但我喜欢并打算继续使用第二本书作为未来的参考，特别是如果更新。看到 Leanpub 出版物又一次缺乏质量，真是令人难过。在传授知识方面没有受过正式训练的人通常拒绝承认他们需要专业帮助，并向朋友、同事和家人寻求评论和意见——这是一个可怕的想法。你需要的是一个不偏不倚的专业人士，他可以直截了当地告诉你，在某些情况下纠正你的错误，在另一些情况下指出遗漏的标记。过时的说明是一回事，是作者的唯一责任，但技术错误、死链接和格式问题在现代出版界都很容易解决，而且没有任何借口——在博客帖子或书中。

例如，有一个简单的死链修复方法。将图书中的链接指向缩短形式，并在需要更新时更改缩短链接的端点。那就没必要以这种方式再版你的书了。例如——一个显示“最新文档”的链接却指向 PHPUnit 3.7 的文档，这远远不是最新的。然而，如果你让它指向类似于`http://grm.py/phpunit_assertdoc_latest`的东西，你所需要做的就是改变链接上的最终目的地，你就一切就绪了，无限期地。你甚至可以为自己设置一个提醒，每 6 个月检查一次链接——当它们都在一个地方，很容易更新时，不应该超过一个小时。

总而言之，如果你发现 PHPUnit 烹饪书打折了，我会推荐你去买——但是在它得到作者的喜爱并焕然一新之前，花全价买它是不值得的。转而去阅读[用 PHP](https://www.sitepoint.com/modernizing-legacy-applications-php-review/) 实现遗留应用程序的现代化——你会学到更多真实的、令人难忘的例子。

## 分享这篇文章