# 本地化 Android 应用程序

> 原文：<https://www.sitepoint.com/localizing-android-apps/>

## 介绍

本地化是根据设备的语言设置为您的应用程序提供适当资源的过程。

如果您的应用程序针对特定的语言环境，那么就没有必要对其进行本地化。如果它的目标是说不同语言的不同地区，它可能会增加其覆盖范围，并使它更适用于说其他语言的人。

您的应用程序应该提供适用于所用地区的文本、音频文件、数字、货币和图形。

在 Android 层次结构中，资源文件放在`res`文件夹的子目录中。要限定在特定地区使用的资源，您可以在`res/`中创建额外的目录，在目录名的末尾包含一个连字符和[ISO 639-1 语言代码](http://en.wikipedia.org/wiki/List_of_ISO_639-1_codes)，可选地后跟一个两个字母的[ISO 3166-1-阿尔法-2 地区代码](http://en.wikipedia.org/wiki/ISO_3166-1_alpha-2)(前面有小写字母“r”)。

包含区域限定符更具体地针对资源。例如，您可能不想使用西班牙语的语言限定符“-es”，而是想为西班牙语(-es-rES)和 Estados Unidos (-es-rUS)提供不同的资源，这两种语言分别代表西班牙和拉丁美洲的西班牙语。

当用户运行您的应用程序，并且设备的语言被设置为您指定的语言时，Android 系统将加载该语言的资源。

在下面的文件层次结构中可以看到一个支持英语(默认语言)和法语的应用程序的例子。

```
MyApp/
    src/
        MainActivity.java
    res/
        drawable/
            background.png
        drawable-fr/
            background.png
        layout/
            activity_main.xml
        values/
            strings.xml
        values-fr/
            strings.xml 
```

您可以为`res/`文件夹中允许的任何目录提供特定语言的目录。子目录名称与 Android 构建系统相关联，您不能指定自己的名称。好吧，你可以，应用程序将运行没有错误，但任何资源，你包括在该子目录将被忽略。

资源也必须保存在`res`的子目录中。如果保存在根目录下，会有构建错误。关于受支持的`res`子目录[的列表，请查看文档](http://developer.android.com/guide/topics/resources/providing-resources.html#table1)。

上面的例子显示了一个应用程序，它有不同的`strings`和背景图像文件用于法语和英语地区，但是共享相同的布局文件。

因为英语是应用程序支持的默认语言，所以不需要包含带有`-en`扩展名的资源。

## 默认资源

您必须在项目中提供默认资源。这些是在非限定资源目录下找到的资源，例如`drawable/`和`values/`。提供默认资源很重要。如果你的应用找不到与设备配置相匹配的资源，并且没有默认资源可以依靠，它将会崩溃。

在上面的层次结构示例中，您可能会尝试限定所有资源，从而将英语限定符添加到针对英语地区的文件中，如下所示。

```
MyApp/
    src/
        MainActivity.java
    res/
        drawable-en/
            background.png
        drawable-fr/
            background.png
        layout/
            activity_main.xml
        values-en/
            strings.xml
        values-fr/
            strings.xml 
```

这不是个好主意。当应用程序在不支持区域设置的设备上运行时，应用程序将会崩溃。

确保为所有资源定义了默认资源。您的默认字符串文件应该是完整的。本地化文件可以是默认字符串的子集，但默认必须包含所有这些字符串。

这种类型的忽略可能无法检测到，尤其是因为 IDE 不会突出显示它，如果使用具有支持的区域设置的设备或仿真器进行测试，您将看不到问题。

### 测试默认资源

您应该测试您的默认资源，以确保它们在默认文件中都可用。

为此，只需将设备或仿真器的区域设置更改为应用程序不支持的区域设置。如果你运行应用程序并得到一个错误信息和一个强制关闭按钮，那么它可能正在寻找一个在默认子目录中不可用的资源。

## 限定符优先级

由于 Android 允许您针对不同的设备使用场景指定不同的资源，有时您使用的配置可能会匹配多个替代资源。

限定词有不同的优先级，用于确定加载的资源。优先级基于下面显示的顺序。

1.  MCC(移动国家代码)和 MNC(移动网络代码)
2.  语言和地区
3.  布局方向
4.  最小宽度
5.  可与
6.  可用高度
7.  屏幕大小
8.  屏幕外观
9.  屏幕方向
10.  用户界面模式
11.  夜间模式
12.  屏幕像素密度(dpi)
13.  触摸屏类型
14.  键盘可用性
15.  初级文本输入法
16.  导航键可用性
17.  主要非接触导航方法
18.  平台版本(API 级别)

例如，考虑下面的应用程序的层次结构

```
MyApp/
    src/
        MainActivity.java
    res/
        values/
            strings.xml
        values-fr/
            strings.xml
        values-land
            strings.xml 
```

该应用程序为法语地区和景观模式提供了替代资源。如果用户将法国作为他们的地区并将他们的电话切换到横向模式，因为语言优先于屏幕方向，所以加载的是`res/values-fr/strings.xml`文件，而不是`res/values-land/strings.xml`中的横向特定文件。

理解优先规则可以节省您调试的时间，当您认为应该加载资源时，为什么不加载呢？

关于 Android 如何找到最佳匹配资源的更多信息，请看文档。

## 使用多个限定符

您可以为资源目录指定多个限定符。在上面的例子中，当您想要使用适合多个场景的资源时，这就很方便了。

在上面的例子中，默认版本的应用程序有一个不同的资源文件用于横向模式。但是当在法语地区进入风景模式时，没有法语和风景资源。

语言限定符优先于屏幕方向限定符，因此系统不会考虑`values-land`中的字符串值。

您可以使用`values-fr-land`添加法语和景观资源。当在目录上使用多个限定符时，您必须按照它们的优先顺序放置它们，否则资源将被忽略。`values-land-fr`不是有效的目录名。

## 注意事项

*   请记住，不同的语言有不同长度的单词和句子，一些语言从上到下阅读，另一些从后到前。仅翻译字符串文字可能不足以本地化应用程序。在处理布局时，您应该考虑这些语言差异。您可以为需要不同显示的每种语言创建不同的布局。然而，这使得您的应用程序更难维护。只要有可能，最好使用片段来创建动态灵活的用户界面。

*   如果您的应用程序使用自定义字体，您应该为字体系列不支持的外来字符制定一个后备计划。

*   不要硬编码资源。不要在代码中使用字符串，而是使用`R.string`来访问`strings.xml`文件中的字符串。不要在你的代码中使用图像路径，而是使用`R.drawable`。这不仅使维护更容易，也使你的应用本地化更容易，更不容易出错。

*   您不能在`res`中创建额外的子目录。这种限制会使资源文件的排序变得困难，特别是对于大型项目，将大量文件组织到子目录中可能会更好。你能做的是[决定一个适合你和你的组织的文件命名约定](http://stackoverflow.com/questions/5582079/layout-files-naming-conventions)，这样分类和查找特定的文件就更容易了。

*   避免创建不必要的资源文件。如果有一些公共资源，那么它们应该在地区之间共享。例如在`strings.xml`中，你可能有一些你不想翻译的普通字符串，比如应用标题。对于这些类型的共享资源，将它们保留在默认目录中，不要将它们复制到您的特定目录中。

*   本地化基本上是由 Android 系统处理的，但是您可能希望根据用户的语言环境来更改代码中的某些内容。要获取区域设置，请使用`Context`对象。

    ```
    String locale = context.getResources().getConfiguration().locale.getDisplayName(); 
    ```

## 结论

本地化你的应用程序可能会极大地扩大你的应用程序的市场。这在那些可能存在大量机会，而英语(或你的应用程序的默认语言)并没有被广泛使用的国家尤为重要。你应该对你的目标市场进行研究，确定你想包含的语言，并为他们开发语言。

如果你要开发一个支持不同地区和语言的应用，在发布之前检查一下 Android 本地化清单以确保一切正常是值得的。

## 分享这篇文章