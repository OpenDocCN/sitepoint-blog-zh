# 一个实用测试者的思考

> 原文:[https://www.sitepoint.com/thoughts-of-a-pragmatic-tester/](https://www.sitepoint.com/thoughts-of-a-pragmatic-tester/)

先坦白一点:你不写测试。你知道你应该，但你没有。我不能责怪你——有许多常见的问题阻止开发人员编写测试。

一个误解是单元测试是不相关的。通常是这样的:开发人员认为，“我需要进行单元测试，我应该使用 [PHPUnit](http://www.phpunit.de/) ，因为它是一个标准。不过，我对此了解不多。”然后，他访问 PHPUnit 站点，阅读文档的第一章，然后是第二章，然后是第三章……这让他一头雾水。“大家都用 PHP 写计算器吗？我开发网络应用程序。为什么向我展示如何测试计算器？”接下来会发生什么？开发人员关闭文档，认为测试在某种程度上与计算器有关，并且对他来说太复杂了，无法理解。

也许类似的事情也发生在你身上。也许不是。但是你真的应该知道要测试什么，怎么测试。这些知识来自经验，所以在本文中，我将分享一些我在单元测试方面的经验。(如果我有些夸张，有时有些不准确，请事先接受我的道歉；我的目标是帮助你开始写测试，一点点吹捧有助于这项事业。)

## 功能测试

PHPUnit 没有问题，决定编写那个第一个单元测试的专业开发人员也没有问题。假设单元测试总是从正确的事情开始是有问题的。你的项目是什么？我假设它是一个 web 应用程序，你应该把它作为一个 web 应用程序来测试！如何测试 web 应用程序？你打开一个网页，点击一些链接，填写一个表格，然后看到预期的结果。这就是你的客户所做的，那么你为什么要以其他方式开始测试你的应用程序呢？当然，作为开发人员，您可以通过自动化过程来改进测试。这就是验收或功能测试的主要思想。

关于功能测试，维基百科是这样说的:

> 功能测试是一种黑盒测试，它的测试用例基于被测软件组件的规范。通过输入和检查输出来测试函数，很少考虑内部程序结构。

当然，PHPUnit 可以用于功能测试。但是 PHPUnit 并不是唯一可用的工具。你可能知道，[硒 IDE](http://seleniumhq.org/) 用途广泛。我们也可以使用它，但是让我们面对它…我们是 PHP 开发人员，更喜欢 PHP 测试工具。

是一个现代的测试框架。一个简单的验收(或功能)测试可以用一个非常简单的 PHP DSL(特定领域语言)来编写。这里有一个例子:

```
<?php
$I = new WebGuy($scenario);
$I->wantTo("send a feedback");
$I->amOnPage("/");
$I->click("Feedback");
$I->see("Submit your feedback");
$I->fillField("Body","Your site is great!");
$I->click("Submit");
$I->see("Thanks for your feedback!");
```

代码检查我们可以从一个站点提交反馈。它执行或模拟浏览器，并在站点内执行定义的操作。所有断言都基于页面内容。如果我们在最后一个回复中没有看到“感谢您的反馈”的文字，测试失败。简单吧？

为什么不从把你所有的特性描述成测试开始呢？只需编写常见的使用场景，并在您的站点上执行它们。功能测试证明用户能够重现您的步骤，并看到相同的结果，因此您的应用程序运行良好。

作为替代，您可以考虑使用其他流行的工具，如 [PHPUnit 和 Mink](http://mink.behat.org/phpunit.html) 、 [Behat](http://behat.org/) 或 Selenium IDE。

## 单元测试

但是单元测试呢…它们什么时候会派上用场呢？让我们从一个定义开始，同样来自[维基百科](http://en.wikipedia.org/wiki/Unit_testing):

> 单元测试是一种测试单个源代码单元以确定它们是否适合使用的方法。单元是应用程序最小的可测试部分。在过程编程中，一个单元可以是一个完整的模块，但更常见的是一个单独的函数或过程。在面向对象编程中，一个单元通常是一个完整的接口，比如一个类，但也可以是一个单独的方法。

单元测试是关于测试你的代码和你的内部 API。当决定何时进行单元测试时，确实有一个规则:当你编写自己的类、模块、库、框架等时。用单元测试覆盖它们是绝对必要的。

但是“计算器问题”呢？我们再陈述一遍。我们不写计算器，而是在 MVC 框架和 CMSs 之上构建网站。框架委派了大部分的例行任务，因此我们的代码除了触发框架 API 的方法之外什么也不做。但是框架的 API 已经被它的开发者测试过了，为什么还要再测试一次呢？

你在这里看到的是大多数流行的 MVC 框架的问题；对于业务逻辑存储在哪里，没有简单的约定。如果我们想测试“可以创建页面”这一特性，我们应该测试一个控制器，它从一个表单中获取参数，然后将参数传递给一个验证并保存它的模型。没有负责页面创建的单元，也就是说，没有创建页面的单个函数或类。为了测试一个特性，我们需要在不同的模块中进行三个或更多的单元测试。这合理吗？我认为这是浪费时间。检查“可以创建页面”的一个功能测试就足够了。

如果你的功能测试已经检查了用户可以做的所有事情，那么单元测试是测试用户被禁止做的事情的好方法。不可能预测用户可以在站点上执行的所有操作，但是在单元测试中，您可以验证特定的操作没有被执行——没有电子邮件地址的用户不会被保存到数据库中，不能用相同的登录创建两个用户，等等。编写单元测试来检查窗体和模型的验证规则、控制器的安全规则等等。

有各种各样的情况不能用功能测试来重现。比方说，你网站的每 100 个成员都会收到某种形式的奖金。你应该手动注册 100 个用户，只是为了检查最后一个人会收到她的奖金吗？大概不会。需要对这样的特性进行单元测试。下面是一个 PHPUnit 测试用例示例:

```
<?php
class BonusTest extends PHPUnit_Framework_TestCase
{
    public function setUp() {
        $this->bonus = new Bonus();
    }

    public function testProvideBonusTo100thUser() {
        // let's check there are 99 losers
        for ($i=0; $i < 99; $i++) {
            $user = new User();
            $user->setName(uniqid());
            $user->save();
            $this->assertFalse($this->bonus->hasBonus($user));
        }
        // and only one winner
        $user = new User();
        $user->setName("Winner!");
        $user->save();
        $this->assertTrue($this->bonus->hasBonus($user));
    }
}
```

作为单元测试的工具，你可以使用 PHPUnit，或者其他现代测试框架，比如 [Atoum](https://github.com/mageekguy/atoum) 或者 [EnhancePHP](http://www.enhance-php.com/) 。它们被设计得不那么“企业化”，因此对于新手来说更容易熟悉。如果你喜欢用 Ruby 风格进行测试，可以查看一下 [PHPSpec](http://www.phpspec.net/) 或者 [Spectrum](https://github.com/mkharitonov/spectrum/) 。此外，前面提到的测试框架 Codeception 可以用来测试您的代码，就像它测试您的站点一样。

## 摘要

务实地编写您的测试。使用功能(验收)测试来测试应用程序的行为，使用单元测试来测试代码。测试常见用法、不当用法情况和罕见事件非常重要。但是请记住，即使 100%的代码覆盖率也不能保证代码质量或稳定性。

<small>图片 via /T5】</small>

## 分享这篇文章