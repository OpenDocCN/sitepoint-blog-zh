# PHP 7 革命:返回类型和移除工件

> 原文：<https://www.sitepoint.com/php-7-revolution-return-types-removed-artifacts/>

随着 PHP 7 发布的计划日期迅速临近，内部团队正在努力工作，试图通过移除工件和添加一些渴望已久的特性来尽可能多地修复我们热爱的语言。我们可以研究和讨论许多 RFC，但是在这篇文章中，我想着重讨论引起我注意的三个。

## PHP 5.7 与 PHP 7

正如我在[上一期新闻简报](http://sitepointnewsletters.cmail1.com/t/ViewEmail/y/494CA3DDEF91C214)中提到的，5.7 已经被否决，转而支持直接迁移到 PHP 7。这意味着在 5.6 和 7 之间不会有新的版本——即使新版本只是给那些仍然停留在过时代码上的人一个警告灯。最初，5.7 并不应该有新的特性，而是应该对即将在 v7 中发生变化的代码发出警告。

![](img/e35e5934e74ca5142cf671fc5a4e2bd4.png)

它还会警告一些在 PHP 7 中被保留的关键字，这样人们就可以通过一种“自动”兼容性检查器(以整个 PHP 版本的形式)来加速他们的代码。然而，事情是这样的，正如我在时事通讯中所说的，大多数在技术上有足够能力通过保持最新版本来跟随 PHP 升级的人通常不是那种实际使用可能在 PHP 7 中崩溃的代码的人。

请注意，虽然[投票已经结束了](https://wiki.php.net/rfc/php57)，但这并不妨碍它在以后的某个时间点复活。由于缺乏重大变化，第一轮投票中的“反对”选民似乎反对 5.7，但随着最近的变化和对其他 RFC 的新投票，这可能会被重新考虑。让我们看看会发生什么。

## 返回类型

随着绝大多数人投票赞成，PHP 最终获得了返回类型。投票结果仍然新鲜，但已经确定。从 PHP 7 开始，我们将最终能够以如下形式指示函数的正确返回类型:

```
function foo(): array {
    return [];
}
```

一种进步？肯定！但是完美？不幸的是，没有:

*   返回类型只能是我们现在拥有的类型*，这意味着没有标量值，没有返回类型，如*字符串*、 *int* 、 *bool* 等。这意味着返回这些值的方法和函数仍然是无符号的。您可以通过为这些值返回包装器的实例来解决这个问题，但是在绝大多数情况下这是多余的。*
**   没有多个返回类型。如果你的函数返回一个数组，或者一个迭代器对象，没有办法像我们在 docblocks 中那样通过`array|Iterator`来表示。*

 *有些人还抱怨类型声明在参数列表的右括号之后，而不是在函数名之前，但对我来说，这是吹毛求疵。像现代 C++这样的流行语言使用“after”语法，和 RFC 声明一样，这保留了搜索“function foo”的可能性，而不需要任何必要的正则表达式修改。更重要的是，这符合 HHVM 所使用的，所以这是一个额外的意外兼容性优势。

![](img/874ad2a2788ed91ba8d9337ece609b62.png)

其他人抱怨 PHP 的“严格化”,但是正如一位评论者所说，当你开始针对接口编码或者继承其他人的代码时，你真的会发现它的价值。此外，只要它是可选的，并且它的存在不会以任何方式影响 PHP 的一般性能或稳定性，就没有什么坏处。对我来说，抱怨它类似于抱怨 OOP 被添加到 PHP 中，而当时过程意大利面在大多数情况下都工作得很好。语言在进化，这是朝着正确方向迈出的一步。

你怎么想呢?

## 移除工件

即将到来的版本提议[移除 PHP4 风格的构造函数](https://wiki.php.net/rfc/remove_php4_constructors)(有待投票)。你可以在 RFC 中读到这意味着什么，这很简单，在这里重复也是徒劳的——但实际上非常有趣的是这种举动似乎给一些人带来了精神痛苦。比如[这个](http://www.tonymarston.net/php-mysql/please-do-not-break-our-language.html)。*“请不要破坏我们的语言”*，托尼恳求道，他似乎打算利用它的破碎的特性。

![](img/a2242879aaf28fb0851f0e4eff006697.png)

尽管有明显的愤怒，但这篇文章写得很好，但它让我想知道——如果你已经保持这样的代码库这么长时间，真的有必要升级到 PHP 7 吗？如果*需要升级到 PHP 7，那么简单地找出有问题的类并修复它们的构造函数不是更容易吗？当然，如果你的代码库中有足够多的单元测试来确保一切顺利的话，你可以把这件事委托给低年级学生。如果你没有单元测试，如果你的应用程序一团糟，你真的希望从迁移到 PHP 7 中获益吗？首先更新你的应用程序不是更好吗[？](https://www.sitepoint.com/modernizing-legacy-applications-php-review/)*

句子*“这意味着我 10 年前写的代码今天仍然可以运行，10 年后仍然可以运行。”对我来说,*是疯狂的——你绝对不应该期望任何语言的主要版本都是这样。从现实世界来说，你不应该期望今天被允许拥有奴隶，仅仅因为很久以前的一项法律允许你拥有。是的，公元前的分裂是在一场血腥的革命之后，但是当大多数奴隶主忏悔或死亡时，就有了和平。

![](img/434dad649d6f0c755b53c0b21e6dbd99.png)

诚然，托尼是对的，他认为移除这个特性需要花费精力，而保留它却不费吹灰之力。但是从长远来看，解决这些构造函数有时引起的问题需要更多的集体努力，而不是现在就去解决它。

可以理解的是，BC 中断总是让一些人不高兴，即使主要版本完全可以为了进度而中断 BC。但是想象一下当这些人发现[这个](https://wiki.php.net/rfc/remove_deprecated_functionality_in_php7)的时候的热情。见鬼，想象一下如果 WordPress 去年没有进入 2001 年并更新到`mysqli`而不是`mysql`会发生什么——要么没有 WP 安装在 PHP 7 上工作，要么 PHP 7 会保留一个不安全和长期被否决的功能，唯一的原因是让 WP 用户高兴。

我给那些害怕 PHP 7 的人的建议是——停止。如果你不想升级，就不要。如果你能在 5.3 或 5.2 上呆这么长时间(看看你，CodeIgniter)，你可以在 5.6 上再呆十年——但是让我们拥有现代 PHP。把进步留给那些愿意接受它的人。

你怎么说？这种去除文物的行为是无稽之谈还是需要的？

## 旁白:扩展 API 的变化

作为一个有趣的旁注，PHP 7 中有一些*变化，实际上可能会导致扩展移植到版本 7 的一点延迟。用于构建 PHP 扩展的 API 仍在改造(阅读:清理)过程中，一切都可能发生变化——尽管如此，Sara Golemon 的这条挑衅性的推文还是引起了相当多的关注。*

> 该死的。PHP7 扩展 API 中有一些令人惊讶的变化。不是无缘无故的，但现在是转投 HHVM 的好时机。
> 
> —Sara mg(@ Sara mg)[2015 年 1 月 3 日](https://twitter.com/SaraMG/status/551240819819433984)

她基本上是说，从 5.6 到 7 的扩展开发的变化将是如此之大，你还不如学习如何制作 HHVM 扩展。然后，她继续就该主题撰写了一个冗长的系列文章，通过例子深入解释了如何创建 HHVM 扩展。

你开发扩展吗？你研究过这些变化吗，或者你觉得现在判断它们是否有效果还为时过早？

编辑:我注意到 Sara 后来[开始记录](http://article.gmane.org/gmane.comp.php.devel/93164)一个兼容 HHVM 和 PHP 7 的新扩展 API。我们可以——看起来——拥有兼容两种运行时的扩展！

## 结论

和往常一样，PHP 领域并不缺乏戏剧性。像历史上所有的重大革命一样，PHP 7 革命在产生令人敬畏的东西之前也将会流血。PHP 7 还有很长的路要走，所以即使你陷入了火枪射击的交叉火力中，也有足够的时间进行掩护。除非你一直睡在坦克履带下，否则双方都帮不了你什么。

你觉得这些 RFC 怎么样？你对 PHP 7 总体感觉如何？它朝着你希望的方向前进了吗？请告诉我们——我们想听听你的想法！

## 分享这篇文章*