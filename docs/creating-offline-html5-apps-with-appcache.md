# 使用 AppCache 创建离线 HTML5 应用程序

> 原文：<https://www.sitepoint.com/creating-offline-html5-apps-with-appcache/>

AppCache 是应用程序缓存的缩写。顾名思义，AppCache 是一种实现离线 HTML5 web 应用的技术。

你可能会认为这与传统的 web 应用程序概念相矛盾，因为网页总是被下载并提供给用户。那么，如果你是离线的，如何加载页面呢？答案是不，我们不能。但是页面可以在用户在线时下载，然后缓存起来供以后在离线模式下使用。

这就是 AppCache 的工作方式。当您转到启用脱机功能的网页时，浏览器会在后台下载并缓存该网页。稍后，当您尝试在脱机模式下访问页面时，浏览器会从其缓存中检索页面并为您加载。很有趣，是吧？

因此，在本教程中，我将详细解释 AppCache 如何工作，以及如何构建出色的离线 HTML5 应用程序。最后还有一个演示离线记事本应用程序。您可以尝试一下并下载源文件。

**注意:**在继续之前，查看一下[兼容性表](http://caniuse.com/offline-apps)以了解哪些浏览器支持 AppCache 功能。

## 基本面:

您可能会想整个过程是如何工作的，浏览器是如何决定缓存哪些页面的。好吧，让我们来看看。这一切都从一个简单的**缓存清单**文件开始。缓存清单文件存储需要下载和缓存以供脱机访问的所有资源。文件应该以扩展名`.manifest`结尾，但是您可以自由选择扩展名。

为了启动缓存过程，您只需要将浏览器指向这个清单文件。是怎么做到的？只需在需要缓存的网页中的`<html>`标签上添加一个名为`manifest`的属性。

例如，如果希望缓存`index.html`页面，可以创建一个名为`mycache.manifest`的清单文件，并添加一个指向该文件的属性`manifest`。

```
<html manifest="mycache.manifest">
<head>
<title>Offline Page</title>
</head>
</html>
```

在清单文件中，您可以添加需要缓存的资源列表。当页面`index.html`指向清单文件时，它被隐式地添加到应该被缓存的资源列表中。

**注意:**清单文件应该由 mime 类型`text/cache-manifest`的服务器提供。如果您使用的是 Apache，只需在根目录中放一个包含以下内容的`.htaccess`:

`AddType     text/cache-manifest     .manifest`

## 货单里有什么？

我们已经讨论过清单文件列出了所有应该可以脱机使用的资源。但是怎么做呢？格式是什么？清单文件有四个可选部分，分别是:

*   隐藏物
*   网络
*   撤退
*   设置

但是，每个清单文件都以下列内容开头:

`CACHE MANIFEST`

在接下来的几行中，您可以添加需要缓存的资源。以下示例将 3 个资源`scripts.js`、`style.css`和`picture.jpg`添加到清单文件中。由于没有指定节名，这些资源隐含在`CACHE`节中。

`CACHE MANIFEST`

脚本. js

style.css

picture.jpg

现在让我们假设`index.html`通过属性`manifest`指向这个清单文件。当浏览器第一次访问这个页面时，它发现有一个清单文件与这个页面相关联。因此，浏览器浏览清单中的资源列表，并开始在后台下载它们。请注意，指向该清单的页面`index.html`也将被下载并在离线时可用。

上面的代码片段对于任何只有一个页面的应用程序来说都足够了。但是如果你有多个页面，你会怎么做呢？在这种情况下，您只需要将应该缓存的每个页面的名称添加到清单文件中。如果你不这样做，浏览器将无法知道 web 应用程序中是否有其他可以离线访问的页面。还有一种方法可以实现这一点。您可以让应用程序中的每个页面都指向清单文件。当浏览器访问这些页面时，它会自动开始下载它们。

现在您已经了解了清单的基础知识，让我们来看看文件中不同的部分。

## 缓存:

本节列出了应该下载并存储在本地的所有资源。页面一加载，浏览器就会开始在后台下载这些资源。但是，如果一些资源已经在缓存中，那么这些资源将不会被重新下载。

## 网络:

本节列出了不应缓存的 URL。例如，您的页面可能包含对动态加载股票报价的脚本的调用。因此，这种类型的资源不会被缓存并脱机。相反，如果您有互联网连接，将从原始来源检索数据。

<ode>缓存清单</ode>

网络:

stock-quote.php

缓存:

style.css

脚本. js

picture.jpg

您还可以在 NETWORK 部分添加*，这意味着不在缓存中的任何资源都可以通过 internet 下载。

**回退:**

如果在应用程序缓存中找不到任何资源，回退是指定要显示的页面的一种聪明方法。

`CACHE   MANIFEST`

回退:

/ /offline-message.html

“/”在 FALLBACK 部分有特殊的含义。这意味着如果在应用缓存中找不到任何页面，将显示`offline-message.html`而不是显示错误。

## 设置:

这包括应用缓存行为的设置。目前`Cache Mode`是唯一可用的设置。它可以被设置为`prefer-online`，这表示如果存在活动的互联网连接，则应该忽略缓存的数据。

### 事件的整体流程:

当整个过程工作时，一系列事件被触发。总结一下，让我清楚地描述一下在缓存过程中触发的这些事件。

1.  当浏览器找到指向清单文件的`<html>`元素的`manifest`属性时，就会触发一个`checking event`。
2.  如果清单文件对浏览器来说是全新的，它将执行以下操作:

*   浏览器将在触发一个`downloading`事件后开始下载清单中提到的资源。下载时，浏览器会定期触发`progress`事件来通知下载文件的数量。
*   下载完资源后，最终会触发一个`cached`事件。

1.  如果浏览器已经遇到清单文件，它将执行以下操作之一:

*   如果清单没有被更改，它什么也不做。
*   如果清单文件被更改，浏览器将触发一个`downloading`事件，并开始下载清单中提到的资源。照常下载文件时`progress`事件也将被触发。
*   下载完成后，触发`updateready`事件。

在上述过程中，如果出现任何错误，浏览器将触发一个错误事件。

请注意，在下载过程中，如果任何资源由于任何原因无法下载，总缓存将被忽略，错误事件将被排队。

### 让我们创建一个离线应用程序:

在我的上一篇教程中，我解释了如何使用 indexedDB 创建一个记事本应用程序。现在让我们让它离线工作！

首先在这里试用一下这个应用程序的演示。它基本上是一个笔记应用程序，使用了一点 JavaScript 和 indexedDB api。只需访问页面。断开互联网并再次访问该页面。由于应用程序缓存，您仍然可以访问 web 应用程序。如果你下载了整个应用程序，你会在应用程序的根目录下找到以下文件。

*   添加. png
*   back.png
*   bullet.png 格式
*   delete.png
*   notebook.png
*   index.html
*   style.css

因此，这里有 3 个简单的步骤，应该遵循添加任何 HTML5 应用程序的离线支持。

#### 第一步:

用下面的内容创建一个`.htaccess`文件，放在根目录下。

`AddType text/cache-manifest .manifest`

#### 第二步:

创建将列出应该缓存的资源的清单文件。命名为`mycache.manifest`。然后将所有资源添加到文件中。

缓存清单

添加. png

back.png

bullet.png 格式

delete.png

notebook.jpg

style.css

#### 第三步:

给`index.html`的`<html>`元素添加属性`manifest`。属性的值应该是`mycache.manifest`。

现在，我们完成了！我们有一个全新的 HTML5 应用程序，离线工作非常好。

附上离线记事本应用程序的代码示例供下载。

## 结论:

让网络应用离线是真正的革命。AppCache 打开了许多可能性的大门。使用它，你可以创建从桌面浏览器到移动浏览器的离线应用。你甚至可以将这些离线网络应用打包成安卓或 iOS 应用。你用它做什么取决于你的创造力。所以，只要玩玩应用程序缓存，尝试并开始开发令人惊叹的离线应用程序。

## 分享这篇文章