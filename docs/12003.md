# 浏览器嗅探发臭的 5 个原因

> 原文:[https://www.sitepoint.com/why-browser-sniffing-stinks/](https://www.sitepoint.com/why-browser-sniffing-stinks/)

![Browser sniffing](../Images/501ae449ef9eb0f9a3379b986f8e23dc.png "Browser sniffing")浏览器嗅探是指检测访问者使用的网络浏览器，以提供特定版本的页面、脚本、图像或其他内容的行为。这项技术在大约 10 年前很流行，因为微软和网景公司引进了他们自己的技术，而网络标准还处于起步阶段。在那个黑暗的日子里，编写两个或更多的客户端脚本来在不同的浏览器中实现相同的功能是相当常见的。

幸运的是，网络进步了。很少需要为不同的设备派生代码，但是 [Opera 最近对版本 10](https://www.sitepoint.com/opera-10-user-agent/) 的体验表明浏览器嗅探仍然是一种常见的技术。

从技术上讲，浏览器嗅探似乎相对简单。您使用 JavaScript 中的`navigator.userAgent`或服务器上的`HTTP_USER_AGENT`环境变量获得一个用户代理字符串，并相应地解析它。但是，不要自满；**不应该使用浏览器嗅探！**

## 1.字符串解析很难

用户代理字符串不符合特定模式，例如:

*   **IE8:** Mozilla/4.0(兼容；MSIE 8.0Windows NT 6.0 三叉戟/4.0；SLCC1
*   **火狐 3:**Mozilla/5.0(Windows；u；Windows NT 6.0en-GB；rv:1.9.0.10)壁虎/2009042316 火狐/3.0.10
*   **Opera 9:**Opera/9.64(Windows NT 6.0；u；en) Presto/2.1.1

浏览器、版本、渲染引擎、操作系统、语言以及有关媒体播放器和的信息。NET 框架都可以通过各种方式传递。测试每个组合是不可能的；Opera 10 报告 9.8 版本是因为一些嗅探器误认为是 1 版本。

## 2.有许多浏览器需要处理

十年前，只有三种主要的浏览器，每种都有一个或两个重要的版本。今天，至少有五种主流浏览器，在不同的平台上运行着多个版本。确保你只在正确的时间使用正确的浏览器而不影响其他人并不容易。

## 3.可扩展性降低，维护增加

不同设备的不同代码集更难维护，而且永远无法适应未来。此外，每次发布新的浏览器或版本时，您的代码都可能中断。这种情况越来越常见。

## 4.浏览器伪装

多年来，Opera *通过传递浏览器的用户代理假装*是 Internet Explorer。这帮助 Opera 用户访问通常拒绝非 IE 浏览器的网站。今天仍然可以做到。

## 5.这很少需要

Web 标准使得浏览器嗅探在服务器端的必要性大大降低，除非您碰巧实现了一个浏览器统计应用程序。

JavaScript 确实有几个跨浏览器兼容性问题，但是对象检测通常是更好的解决方案。例如，IE7 和更低版本没有对 XMLHttpRequest 的本地支持，XMLHttpRequest 是 Ajax 请求的基本对象。但是，也可以使用相同的 ActiveX 对象，大多数库都实现了如下代码:

```
 var xhr = (window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject("Microsoft.XMLHTTP")); 
```

一个可能的例外是针对特定浏览器的渐进式改进。例如，为了支持 IE5.5 和 IE6 中的 24 位 png，可以使用浏览器嗅探，以便仅在必要时替换图像。然而，这是一种变通办法，一旦人们停止使用这些浏览器，这种办法最终会被取消。

跨浏览器 CSS 也是可能的——是的，甚至在 IE6 中。条件样式表在极端情况下会有所帮助，尽管我个人避免使用它们，因为它仍然感觉太像浏览器嗅探了！

另见:[为什么 Opera 10 的用户代理气味难闻](https://www.sitepoint.com/opera-10-user-agent/)

你会避免浏览器嗅探吗？有什么情况是必须的吗？

## 分享这篇文章