# 用简历追踪你的黑客

> 原文：<https://www.sitepoint.com/track-your-hacks-with-cvs/>

以下内容转载自《科技时报》第 130 期。

非常巧合的是，在过去的一周里，我不得不三次破解一些开源软件的代码，这些代码进入了我工作的网站。首先，我必须修改 [phpBB](http://www.phpbb.com/) ，在我管理的一个私人论坛的主页上添加一个[嵌入式日历](http://www.easyphpcalendar.com/)。接下来，我对 WordPress 的 [K2 主题的代码做了一些定制的调整。最后我不得不黑掉](http://binarybonsai.com/wordpress/k2/) [phpAdsNew](http://phpadsnew.com/) 来产生 XHTML 严格输出。

在每一种情况下，黑客都要求我实际修改软件的代码。显然，我不喜欢这样做，因为当下一个版本到来时，更新的文件将覆盖我的修改，我将需要重新实现它们。

通常我只是在某个地方记录我的黑客行为，并抱怨软件缺乏定制功能，但一周三次太多了。让我向您展示我是如何用一种非常规的方式使用一个通用开发工具解决这个问题的！

CVS(并发版本系统)是一个跟踪一段时间内对一个项目中的文件所做的更改的系统，这些更改可能是由多个开发人员所做的，每个开发人员同时处理他或她自己的项目文件副本。事实证明，这对于管理您对开源软件的定制攻击非常有用。

在过去的几年里， [Subversion](http://subversion.tigris.org/) 已经作为 CVS 的替代品涌现出来，它消除了 CVS 在移动或重命名文件方面的一些麻烦。由于这种变化通常不会发生在你修改现有脚本的时候，而且由于 SitePoint 已经有了一个不错的关于 CVS 的[介绍，所以在这次讨论中我将坚持使用 CVS。如果你知道 Subversion，你可以用它来代替。](https://www.sitepoint.com/article/harness-power-cvs-site)

## 安装

您首先需要为自己创建一个 CVS 存储库(如果您还没有的话)。因为我用的是 Windows，所以我设置了 [CVSNT](http://www.cvsnt.com/) 来做这个。如果你在 Linux 上，你可以使用[原装的 CVS 软件](http://www.nongnu.org/cvs/)。你还会想要一个易于使用的客户端程序(我推荐 [SmartCVS](http://www.smartcvs.com/smartcvs/) )，除非你特别喜欢在命令提示符下工作，在这种情况下，我已经包含了下面所有的命令。

当你的 CVS 服务器设置好后，将你破解的软件版本的“干净”副本作为一个新的模块(或项目)存储在存储库中(例如`cvs import phpBB2 phpBB2 init_ver`)。在存储库中标记这个“干净”版本，以指示它所代表的软件的版本号(例如`cvs tag release-2-0-17 .`)。

立即从这个初始版本在存储库中创建一个分支(例如`cvs tag -b custom-mods-branch .`)，然后从分支中取出文件*的副本到一个方便的工作目录中(例如`cvs checkout -r custom-mods-branch phpBB2`)。这个副本是你记录你的黑客的地方。*

在您刚从分支机构签出的“干净”副本上复制您站点的(被黑客攻击的)软件文件副本，然后执行 CVS 更新以识别被黑客攻击修改过的文件(例如`cvs update .`)。检查这些更改以确保它们都是需要的。

![Review hacks in your CVS client](img/364db8316b2b4a7fc2982bf288a2dbcc.png)
**图一。将 hacks 视为工作副本中的变更**

现在，您可以在这个分支中跟踪您所做的修改。只需根据您的喜好修改这个分支的工作副本中的文件，并将您的更改提交到存储库中。要使用这些技巧更新您的站点，请删除目标目录中的所有内容，然后将最新版本的分支文件导出到您的站点(例如`cvs export -D /home/www/htdocs phpBB2`)。

## 与新版本合并

当软件的一个新版本出来的时候，把它的文件提取到你一开始做的“干净”的拷贝中，把所有的修改提交到 CVS 中，然后把更新的文件标记为发布(例如`cvs tag release-2-0-19 .`)。这些更新将存储在您的存储库的主干中，因此它们不会影响您的被黑版本(在分支中跟踪)。

现在，回报来了:要用最新正式版本中的变化来更新你的软件的被黑版本，只需转到你的分支的工作副本，合并来自主干的所有变化(例如
`cvs update -j release-2-0-17 -j release-2-0-19`)。你被黑的文件应该随着官方更新中的改变而无缝更新。

当您执行合并时，您的攻击发生在与正式版本中的更改接近或同一行的文件将报告冲突。在将正确的版本提交到分支之前，您必须打开这些文件并自己解决冲突(CVS 将有助于在冲突点包含代码的两个版本)。然后你应该在分支上设置一个标签来指示你在哪里进行了合并(例如`cvs tag merge-2-0-19 .`)。

实际上，CVS 将为您执行所有它能执行的更新，然后将挑选出那些似乎干扰您的攻击的更新，以便您可以处理它们。如果这都没用，我不知道还有什么用！

![A typical CVS tree for hack management](img/b0f7f57e5bbb0ee24cae2dfa3293cd93.png)
**图二。显示合并版本的 CVS 树。**

下一次正式更新出来时，您可以执行另一次合并，但请记住更新合并的起始标签，这样您就只能获得自上次合并以来的更改(例如`cvs update -j release-2-0-19 -j release-2-0-21`)。

## 关于供应商分支的注释

观众中的 CVS 大师们可能会在这一点上竭力反对。事实上，CVS 会为您签入的每个模块自动创建一个 [**供应商分支**](http://ximbiot.com/cvs/wiki/index.php?title=CVS--Concurrent_Versions_System_v1.12.12.1:_Tracking_third-party_sources) 。您可以将软件的每个新版本导入到这个特殊的分支中，然后将分支中的更改合并到您的(被侵入的)主干中。

那我为什么不用这个呢？事实是，使用一个普通的分支就像我上面描述的一样简单，并且不需要你学习所有关于供应商分支和它们的陷阱。此外，您可以在不支持供应商分支的更简单的 CVS 客户端中完成这项工作(比如免费版的 SmartCVS)。

## 分享这篇文章