# 谁偷了我的 CPU？

> 原文：<https://www.sitepoint.com/who-stole-my-cpu/>

云最重要的特性之一是多租户共享资源。如果不能共享和优化资源利用率，云运营商就无法为其业务提供可扩展性和支持“规模经济”。IaaS 公共包含其“云魔法”以及计算、存储和网络设备等实际硬件。这些资源的利用应该通过满足需求(按时间)来优化，因此它们必须在云消费者之间共享。

## ****什么是偷时间？
****

 **衡量服务器如何利用其 CPU 的基本指标是空闲容量，即空闲的 CPU 数量。CPU 利用率由以下各项的分配复合而成:

*   用户–正在运行的应用程序
*   系统——操作系统
*   中断–硬件中断
*   等待–等待 I/O 作业结束
*   窃取–与虚拟机无关的周期
*   空闲–没有工作正在进行

窃取时间(ST)也称为“窃取的 CPU ”,存在于虚拟化计算环境中——这是 CPU 用于运行内部虚拟机任务的时间，虚拟机管理程序将 CPU 周期分配给其他“外部任务”,这些任务可能是由您的一个嘈杂邻居引起的。

## 亚马逊云上的 ST

我在 AWS 论坛上研究了这个主题，发现当 CPU 利用率达到峰值一段时间时(由云运营商配置)；系统会自动将 CPU 的使用率降低到一定的百分比，同时“偷走”其余的 CPU。这是有意义的，因为云必须保护自己免受过载和崩溃的威胁。你可以在亚马逊 AWS 常见问题中找到更多关于微实例类型的信息:“微实例提供少量一致的 CPU 资源，并允许你在额外的周期可用时将 CPU 容量增加到 2 个 ECU。它们非常适合于低吞吐量的应用程序和网站，这些应用程序和网站定期消耗大量的计算周期，但在其他时间，后台进程、守护进程消耗很少的 CPU "[阅读更多信息](http://aws.amazon.com/ec2/faqs/#How_much_compute_power_do_Micro_instances_provide)
在亚马逊开发者论坛上，您可以找到以下内容:
“例如，当我可能需要执行“yum update”时，系统在一分钟内就变得没有响应。我本来预计它会在三到五分钟内完成，就像它一直做的那样，但今天这种节流大约在三十秒到一分钟内发生。”[检查螺纹](https://forums.aws.amazon.com/thread.jspa?messageID=374345)

亚马逊没有详细说明实际的 Xen 配置，尽管他们说:“该实例被设计为在本质上只有两个级别的 CPU 使用率下运行:正常的低后台级别，然后是比后台级别高得多的短暂峰值级别。”[阅读更多](http://docs.amazonwebservices.com/AWSEC2/latest/UserGuide/concepts_micro_instances.html)根据我[了解到的](http://www.axibase.com/cloud/2010/07/22/ec2-monitoring-the-case-of-stolen-cpu/)，使用标准监控工具监控 CPU 会误导云用户。例如，由于底层基础设施上的虚拟化层，Linux 实例不会报告正确的 CPU 使用值。要获得 EC2 实例上 CPU 使用率的准确值，云用户应该只依赖 CloudWatch 指标。
关于 CPU 利用率的另一个重要方面是工作负载模型。我了解到您应该区分两种工作负载模型——批处理工作负载和实时工作负载。前者为短缺提供了更大的容忍度，并且可以等待可用能力。批处理模型描述了一个产生稳定利用率或 CPU 使用总量的任务，因此一旦出现严重利用率，它将在以后得到补偿。实时工作负载平衡永远不会得到补偿，过载将受到云运营商的限制。此外，Amazon AWS 等云运营商倾向于部署更批量的工作负载模型来控制物理层上的负载。
为了利用 AWS 微实例，您需要能够控制您的在线资源行为。您也可以尝试播放您的 web 服务器配置设置，例如，限制客户端的数量。您应该使用 S3 来托管静态文件，如图像、视频和音频。利用其他 AWS 服务来支持您的应用程序性能需求，可以将一些负载转移到其他云资源，从而降低 EC2 实例的整体 CPU 消耗。无论如何，重要的是利用弹性环境并部署水平(或垂直)扩展方法来保护环境。

## 加入讨论

按照不同实例类型的不同 Xen 配置，比如微 CPU 的规则，我想知道——您是否需要为不同实例类型设置不同的自动扩展 CPU 阈值？

## 分享这篇文章**