# 离线优先:你的下一个渐进增强技术？

> 原文：<https://www.sitepoint.com/offline-first-next-progressive-enhancement-technique/>

您的客户可能需要原生手机应用程序而非网络应用程序，主要有三个原因:

1.  原生应用更快。如果你正在创建下一个愤怒的小鸟，这当然很重要，但是很少有应用程序需要游戏般的响应。也就是说，只要稍加小心，使用 HTML5 技术就可以创建一个快速动作游戏。至于它能否在一系列设备上运行良好，则是另一回事了)。
2.  客户端不知道更好:*“应用很酷！我们所有的竞争对手都有应用，我们需要一个。”接受一点教育就能解决这个问题。*
3.  移动应用程序离线工作。但是网络应用也可以——只不过这些技术相对较新，我们很少有人去费心。还没有。

采用 AppCache 让 web 应用程序离线工作已经有好几年的历史了。该过程定义了应该缓存哪些文件，以便浏览器可以在互联网连接中断时执行应用程序。这相当简单，但是:

*   Web 开发人员一想到连接失败就不寒而栗。我正在火车上写这篇文章，感觉好像失去了几个主要器官。虽然连接正在改善，但对于通勤者和数百万生活在偏远地区和发展中国家的人来说，这仍然是一个问题。
*   向现有应用添加离线功能很困难。您需要重新处理 Ajax 调用和网络请求，然后考虑连接状态的变化。但是如果我们一开始就考虑到了呢？

移动优先被认为是一种良好的实践技术。你从一个简单的——也许是线性的——的站点视图开始，这个视图可以在所有浏览器上工作，不管年龄和设备。然后，更现代的浏览器使用媒体查询来应用样式增强，并在更大的屏幕上呈现更典型的桌面视图。换句话说，对于使用更大显示器的更好的浏览器来说，布局是逐渐增强的。

类似的方法可以用于离线应用程序吗？应用程序会认为它处于离线模式，并采取相应的行动。当连接恢复时，该应用程序将逐步增强，以检索更多数据或保存到云中。

离线优先是一个已经被几个[和其他](http://blog.joelambert.co.uk/2012/11/26/offline-first-a-better-html5-user-experience/)讨论过的概念，尽管它没有被广泛使用。有几个一般概念使它可行。

## 1.消除对服务器的依赖

大多数应用程序逻辑必须从服务器转移到客户端。本质上，服务器将成为一个轻量级的数据存储库，但重要的是，无论连接状态如何，客户机应用程序都应该工作。

## 2.创建客户端数据代理

你不能依赖 Ajax 调用。数据代理将管理所有路由，例如

1.  如果连接可用，就可以对实时服务器进行 Ajax 调用(假设有必要)。
2.  如果连接不可用，或者在 Ajax 调用期间失败，则使用 localStorage、IndexDB 或其他合适的客户端存储机制。

请注意，HTML5 服务工作器通过一个命名的 JavaScript 文件路由所有数据请求。虽然目前几乎没有浏览器支持或标准化，但该技术是专门为此目的而设计的。

## 3.尽可能同步

当连接恢复时，您将需要一个进程来处理客户端和服务器之间的同步。使用 Web Worker 后台进程和空闲期间的批量上传/下载可以提高效率。

## 4.考虑设备使用因素

移动设备有进一步的复杂性。例如:

*   切换到另一个应用程序的行为可能会关闭浏览器。理想情况下，您的 web 应用程序应该总是保存应用程序状态，以便用户可以返回到他们离开的地方。
*   当您的应用程序不在打开的浏览器标签中运行时，可以使用[页面可见性 API](/introduction-to-page-visibility-api/) 来减少处理和带宽需求。
*   理想情况下，你的应用程序应该使用[电池状态 API](https://www.w3.org/TR/battery-status/) 来表现良好。例如，当电池电量下降到临界水平以下时，即使连接可用，它也可以恢复到本地存储。

## 5.测试。然后再测试。

测试非常困难，因为无论连接性如何，您的应用程序都需要保持可操作性，例如

*   该应用安装在不支持本地存储或其他重要技术的设备上。
*   连接会随机中断和重启。
*   应用程序被缓存，但是在可以进行第一次服务器通信之前连接性下降。
*   该应用程序可同时在两台或多台设备上运行。

对一系列设备进行严格测试似乎是唯一的选择。

不是每个应用程序都可以采取离线优先的方式；多人动作游戏将毫无意义。然而，如果一开始就考虑到这一点，这种技术可以被许多 web 应用程序使用。我喜欢它，但我怀疑在现有系统中实现的开销可能会使单独的移动应用程序看起来更具成本效益！

你考虑过线下优先吗？你已经在做了吗？还有其他并发症吗？还是付出的努力太多，得到的收益太少？

## 分享这篇文章