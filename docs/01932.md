# 优化 Android 中的电池和数据消耗

> 原文:[https://www . site point . com/optimizing-battery-and-data-consumption-in-Android/](https://www.sitepoint.com/optimizing-battery-and-data-consumption-in-android/)

电池和网络数据消耗是开发者在开发移动应用时必须处理的两个核心问题。这在移动技术中更令人担忧，因为智能手机的资源有限。我将在这篇文章中关注两个关键点:电池寿命和网络数据减少。我将通过一些提示和例子来说明如何节省电池寿命和保持网络消耗最小。

## 优化电池寿命

消耗大部分电池的硬件组件是 CPU、传感器和屏幕。传感器包括 GPS、NFC、蓝牙等。

记住这一点很容易确定开发人员在开发时应该关注什么。在许多情况下，将 CPU 利用率保持在所需的最低水平、最小化无线电利用率和最小化网络操作等任务很难实现，但对于构建顶级应用程序来说却是必需的。

在接下来的几节中，我将介绍一些对电池消耗有影响的因素。此外，我将提到一些如何避免或减少电池消耗的技巧。

## 小心使用动画

很明显，动画需要 CPU 的大量处理能力，因此会消耗大量的能量。根据[文档](https://developer.android.com/training/wearables/watch-faces/performance.html#Animations)，大多数动画每秒 30 帧看起来很流畅。因此，超过 30 帧可能会浪费处理能力，而且会浪费更多的电池。

文档中的另一个提示是让 CPU 在动画之间休眠。这是因为连续的动画会导致设备屏幕不断变化。正如我前面提到的，屏幕是电池消耗的主要因素之一。

## 图像资源

在屏幕上渲染大图像位图也会导致高电池消耗。在屏幕上显示图像是不可避免的，但是这里有一个提示，不要使用比需要的大的图形元素。

如果位图资源具有可以裁剪的透明像素，那么这样做是个好主意。裁剪掉不必要的像素会影响性能，并消耗较少的电池。

## 小心使用唤醒锁

应用程序的任务不仅仅发生在应用程序出现在屏幕上以及用户与之交互的时候。有些应用程序甚至需要在手机睡眠时执行操作。当手机处于睡眠模式时，此任务无法完成。

为了在手机睡眠时执行任务，应用程序需要唤醒屏幕，为此它需要利用[唤醒锁](https://developer.android.com/training/scheduling/wakelock.html)。

唤醒锁用于保持屏幕和 CPU 开启。唤醒锁的一个常见例子是在手机游戏和视频播放应用程序中，即使用户没有交互，屏幕也保持打开。
唤醒锁的问题是，如果使用不当，可能会让设备长时间处于唤醒状态，从而消耗电池和资源。
要正确使用唤醒锁，请遵循 Android 开发者[文档的指导方针](https://developer.android.com/training/scheduling/wakelock.html)。

## 电池优化策略

对于应用程序的一些非关键任务，可以在其他时间推迟执行，这是一个很好的策略，在设备充电时这样做。这通常是后台任务的情况。
在设备充电时延迟此类任务不会影响电池寿命。在这种情况下，一个例子可以是与某个 web 服务的数据同步。

针对这类任务的一个很好的解决方案来自 Google 的 [JobScheduler](https://developer.android.com/reference/android/app/job/JobScheduler.html) API。这个 API 是专门为后台任务创建的，以便有效地安排它们与其他应用程序作业一起运行。因此，如果您的应用程序必须执行繁重的任务，请认真考虑。

## 高效联网和电池续航时间

到目前为止，我一直在指出的是一些对电池寿命有影响的因素，但没有一个提到的因素比网络操作消耗更多的电池。

网络是电池消耗的最重要来源。因此，我们需要一些方法来减少这种操作带来的电池消耗。

为了清楚地了解网络操作对电池消耗的影响，我们必须首先了解网络操作在资源利用方面的执行方式。网络操作通过所谓的无线电来执行，无论是 WiFi 还是 3G/4G 无线电。

为了节约能源，Android 系统不会让收音机一直处于全功率状态，否则电池寿命会迅速缩短。为了证明这一点，让我们看看 3G 无线电台的不同状态。

![Radio States](../Images/6ac2b9ca8696acd8be7d790b02e25cf0.png)

*   **全功率**–网络无线电激活，执行一些网络操作。
*   **低电量**–使用 50%电池电量的中间状态。
*   **待机**–无网络操作，低电池消耗。

当设备没有网络任务要执行时，无线电状态机转换到低空闲状态，以消耗明显更少的电池。当网络连接建立后，系统将无线电转换到全功率状态。根据 Android 开发者[的文档](https://developer.android.com/training/efficient-downloads/efficient-network-access.html#AppsStateMachine)，无线电将在使用的整个时间内保持全功率状态，加上额外的 5 秒尾时间，然后是 12 秒的低能量状态，然后进入待机状态。

对于所执行的一个网络操作，如果我们认为网络操作是在 1 秒内执行的，则设备会失去电池电量 18 秒，这在大多数情况下是真实的。如果你想一想，在一个单一的网络操作中有大量的能量被浪费。

在本文的以下部分中，我将提供一些技巧和智能解决方案，以避免在执行网络操作时过度使用电池资源。

## 批量连接

如前所述，单个网络任务无效地消耗大约 18 秒的电池。
如果将所有的网络连接组合在一起，一个接一个地执行，会怎么样？显然，在这种情况下，收音机不会经历每一次网络呼叫中唤醒和睡眠的全过程。它将保持活动状态，直到所有网络连接完成，然后进入待机状态。

如果我们做一个简单的数学，每一个操作中的 18 秒过程，在一个大的网络操作中累积起来。总的来说，无线电保持活跃的时间比具有单独任务的时间短。

这里的问题是，任务必须分组在一起，并在同一个全功率窗口执行。事实是，并不是所有的请求都可以等到组形成之后。这种解决方案对于后台任务更有效，而 [JobScheduler](https://developer.android.com/reference/android/app/job/JobScheduler.html) API 可以帮助完成这些任务。JobScheduler API 将来自许多应用程序的任务进行分组，以更好地利用资源。

## 预取数据

在大多数情况下，很难预测用户将在应用程序中做什么以及加载什么数据。如果可能，最好预取尽可能多的数据，以避免不必要的请求。
例如，如果您正在开发一个音频播放器应用程序，并且对应用程序的声音具有缓存功能，那么预加载列表中的下一首曲目是一个好主意，因为用户很可能会播放下一首曲目。

## 广告是电池消耗的一个因素

移动广告是许多应用的主要收入来源之一，但广告是电池消耗的一个重要因素。广告使用处理能力来显示彩色图像甚至视频，但也消耗网络。广告利用大量带宽加载大量内容，导致更多电池消耗。

我不是要求在移动应用中删除广告，因为广告是开发者获得收入的最常见方式之一，但尽量不要用广告来夸大。对于电池和从广告中获得收入来说，一个很好的解决方案是将广告限制在你的应用程序中的少数几个地方。

## 使用监控工具分析电池

为了更好地了解电池消耗，你需要一种方法来监控应用程序的统计数据。Android Studio 有一个内置的监控工具，用于检查应用程序消耗的资源。

根据前面提到的联网策略，您可以确定联网对电池的影响。下图显示了就网络任务而言，什么是好的网络策略，什么是坏的网络策略。

很好的例子——网络任务被分组
![Good example](../Images/16a03a46f1b41f6568059353623ca472.png)

不好的例子
![Bad example](../Images/e2daaf1c0720f65191e2fe129dde2dce.png)

第二个图像中的网络突发是糟糕的网络策略的明显例子。

### 电池历史记录

[电池历史学家](https://developer.android.com/studio/profile/battery-historian.html)是谷歌提供的另一个伟大的工具，它通过使用 Android bug 报告文件来提供电池分析。它通过显示哪些进程正在消耗电池，提供了 Android 设备电池统计的详细概述。
下图举例说明了该工具在电池监控方面的功能。

![battery-historian/](../Images/5e3bc8a6af6524db63023af52cf46adc.png)

电池历史记录是开源的，可以在 [GitHub](https://github.com/google/battery-historian) 上获得。

## 包扎

如果您正在构建一个需要大量资源的大型应用程序，电池优化应该是要记住的关键优化问题之一。

我希望本文中提供的技巧和指南能够很好地帮助我们了解在网络操作和电池优化的环境中应该关注什么。

## 分享这篇文章