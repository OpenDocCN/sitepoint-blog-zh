# 对 Appserver.io 团队的采访

> 原文:[https://www.sitepoint.com/interview-appserver-io-crew/](https://www.sitepoint.com/interview-appserver-io-crew/)

如果您可以在不使用 Nginx 或 Apache 的情况下可靠地运行 PHP，但也不依赖其内部服务器会怎样？如果您可以在 PHP 中使用真正的多线程进行异步操作，充分利用多核处理器，而没有黑客攻击或大量回调，会怎么样？如果您在与生产环境相同的环境中为 PHAR 打包的 web 应用程序提供拖放安装支持，会怎么样？进入 [Appserver](http://www.appserver.io) (应用服务器)。

Appserver 是用 PHP 开发的，可以让你做所有的事情，甚至更多。我没有必要用技术规范来烦你——相反，Appserver 的工作人员正在尽力解释它是什么，为什么是它，以及你为什么想要它。

![Screenshot from 2013-10-04 15:40:56](../Images/73f4572915e97b3f86569da49854089c.png)

布鲁诺:今天加入我们的有蒂姆·瓦格纳、约翰·“汉斯”·泽尔格，偶尔还有斯特凡·威尔科默。让我们从一个简短的介绍开始。作为一个团体，你是谁？作为个人，你的角色是什么？

![](../Images/1a0a6a14f0e27c42df086fea3f1970f9.png)

蒂姆:我们只是为[科技分部有限公司](http://www.techdivision.com/ "Techdivision GMBH")工作的几个人，该公司是德国南部的一家网络代理公司。Hans 实际上是 Magento 的负责人，我仍然是开发部的负责人。实际上我们没有真正的角色。只要有可能，我们都会尝试一起开发新功能…

![](../Images/bb4274df2d0b87f833b62e9aed4026a5.png)

12 年前，我开始在技术部为蒂姆工作。2006 年，我和我的兄弟约瑟夫接管了这家公司，我们开始致力于基于开源网络的项目。2007 年推出 Magento 时，我们开始快速发展。Hans 和 Tim 于 2008 年和 2009 年加入我们的团队。从那以后，我们在 PHP 领域做了很多项目。作为一名技术人员，我最初负责技术，但在过去几年里，我的角色更多地转向财务控制和公司战略。

![](../Images/4a853204684bac81d556c33d07f8e29e.png)

Hans: 我和 Tim 在 TechDivision GmbH 的几个客户项目上合作了很长时间。自从我认识 Tim 以来，他就有了用 PHP 开发应用服务器的想法。我从一开始就被迷住了，所以我一有空就开始和他一起做这个项目:)

![](../Images/1a0a6a14f0e27c42df086fea3f1970f9.png)

**Tim:** Hans 更加关注 pthreads 集成和 UI 定制，比如新管理界面或网站的设计和实现。我更关注配置、优化和部署之类的东西…

**布鲁诺:**那么，Appserver 是什么，你为什么要开发它？

![](../Images/4a853204684bac81d556c33d07f8e29e.png)

汉斯:好的，我认为这是蒂姆的职责……他对应用服务器有着准确的理解:)

![](../Images/1a0a6a14f0e27c42df086fea3f1970f9.png)

Appserver 是一个中间件解决方案，它提供诸如 servlet 容器、持久性容器、消息队列、定时器服务(可以用作某种 CRON 作业)和 web socket 服务器等服务。我们从 servlet 容器开始，它或多或少是一个 web 服务器，不像 Apache/Nginx，更像 Tomcat。由于许多 PHP 应用程序实际上还没有准备好在 servlet 容器中运行，因为它们还没有任何 servlet，所以我们为这些应用程序集成了一个默认的 servlet 来使它们工作。

**Bruno:** 有些人可能第一次遇到“servlet”这个术语。你能详细阐述一下吗？

![](../Images/1a0a6a14f0e27c42df086fea3f1970f9.png)

蒂姆:servlet 是一个类，开发者可以在其中实现他的功能。例如，当您使用 servlet 引擎时，您没有用于引导的`index.php`。相反，您有一个可能具有控制器类角色的 servlet，并且主要的引导将由 servlet 容器自动完成。

![](../Images/4a853204684bac81d556c33d07f8e29e.png)

**Hans:** 另外重要的一点是，Appserver 包括一个 web 服务器(servletcontainer ),所以你不需要 Apache 或 Nginx 或任何其他替代的 web 应用程序。

**布鲁诺:**所以，PHP 本身就是为你的 app 服务的？它是使用 5.4 版本中的内部 PHP 服务器，还是其他完全不同的东西？vhost 配置如何计算在内？

![](../Images/4a853204684bac81d556c33d07f8e29e.png)

汉斯:没错。PHP 本身服务于安装在 Appserver 上的应用程序。我们不使用从 5.4 开始包含的内部 php webserver，因为我们将提供用干净的 php 代码编写的 Appserver 的全部功能。所以大家不用先学 C 就可以完善 webserver 功能。现在，您可以编辑主配置文件`etc/appserver.xml`来添加指向特定 webapps 的 vhosts。不久的将来，我们将为 Appserver 提供一个后端配置面板，您可以在这里更方便地进行这种配置。

布鲁诺:听起来很棒！性能呢？这种类型的 PHP 的服务能力比得上 Nginx 或者 Apache 这样的老派解决方案吗？您是否运行过任何基准来比较它们？

![](../Images/1a0a6a14f0e27c42df086fea3f1970f9.png)

我今天和另一个 PHP 开发者讨论了这个问题:)我们最近用 Magento 做了一些测试。在我的本地机器(Mac OS X Mountain Lion)上，Magento 目录页面将在大约 320 毫秒内交付，我们的 Appserver 需要 340 毫秒。据我们所知，大多数开发人员将使用应用服务器来服务现有的应用程序，如 Magento 或 TYPO3.Neos。我们将在即将发布的版本中针对这些类型的应用程序优化我们的 servlet 容器。由于我们还没有进行性能优化，我们实际上非常确定最终的性能会在 Apache 或 Nginx 附近。我再补充几张截图:)

[![magento_appserver](../Images/bba0b2cdf032fd4abe58d114c2271494.png)T2】](https://www.sitepoint.com/wp-content/uploads/2013/10/magento_appserver.png)

[![magento_apache](../Images/3419f07d707971db603d74d5130ccc7c.png)T2】](https://www.sitepoint.com/wp-content/uploads/2013/10/magento_apache.png)

**Bruno:** 那么关于线程——这似乎是 Appserver 的主要卖点之一——你能向我们的初级读者解释一下线程实际上是什么以及 PHP 为什么需要它吗？

![](../Images/1a0a6a14f0e27c42df086fea3f1970f9.png)

蒂姆:汉斯是这个问题的合适人选:)

![](../Images/4a853204684bac81d556c33d07f8e29e.png)

Hans: 多线程对于 Appserver 和 PHP 的未来来说是一件非常重要的事情，这要感谢 Joe Watkins，他在几年前启动了 PHP 的 [pthreads](http://pthreads.org/) 扩展。通过 pthreads，我们能够同时异步处理来自浏览器到 servlet 容器(webserver)的每个用户请求。想象一下在线程中无法处理请求的情况。每个用户都会阻塞其他用户的请求，只要 PHP 处理它并提供响应。正如你们中的许多人现在会说“好吧，为什么不像 react-php 那样使用基于事件的循环？”在您的应用程序中使用线程的主要优势在于，所有的 cpu 内核都将被使用，而不是只有一个内核满负荷运行。另一个大的好处是你的代码将保持干净和可调试，而不会有回调大屠杀；)

布鲁诺:这点我不能否认:)

![](../Images/1a0a6a14f0e27c42df086fea3f1970f9.png)

此外，除了应用服务器之外，我们认为线程化是一种可以将 PHP 带到 web 应用开发新高度的功能。在我们的项目中，我们总是面临 PHP 缺乏的大数据导入等问题。正如 Hans 之前所说，使用线程允许我们使用机器的所有资源来导入数据，而不是让 23 个内核等待一个内核来完成工作。

**布鲁诺:**优秀。现在，关于线程的话题..我看到过数百个关于 PHP 和线程安全的问题。你的文档还说它要求 PHP 被编译成线程安全的。到底什么是线程安全，为什么有人会用线程不安全的方式编译 PHP，如果前者更好的话？

![](../Images/1a0a6a14f0e27c42df086fea3f1970f9.png)

蒂姆:布鲁诺，你说得对，这个问题我们讨论了很久。最后，我们找到了一个我们认为几乎适合所有人的解决方案:)为了解决每个人都必须自己编译 PHP 为线程安全的问题，我们创建了一个运行时，它提供了一个独立于系统的编译为线程安全的 PHP 运行时环境。这意味着您只需要安装这个运行时，应用服务器就会工作。实际上，我们已经有了 Mac OS X 10.8.x 和 Debian Wheezy 的软件包。希望在下一个版本中，我们也能在 Fedora 和 RH Linux 上使用 RPM。由于我不是 C 开发人员，希望能解释准确。线程安全意味着内部全局变量也必须是线程安全的，并且应该在每个上下文中对每个扩展可用，这些扩展应该在线程安全的编译环境中工作，但不会因为创建本地存储而发生冲突。我们还讨论了有许多声明说我们会有问题，因为有许多扩展不是线程安全的。这是真的，但是不管线程安全性如何，它们中的许多都工作得很好，所以我们提供了 Appserver 以及许多主机商也提供的所有默认内容，这对于现在来说应该足够了。此外，我们正在联系我们认为可能有用的扩展的维护者，并讨论如何修复那些不安全的线程。因为仍然有一些扩展不是线程安全的，并且线程安全对于运行大多数应用程序来说是不必要的，所以默认情况下 PHP 将会在没有线程安全的情况下交付。在 windows 上，有线程安全编译的二进制文件可用，因为在一些 Windows 多线程 web 服务器环境中，如 Apache 2，您需要启用线程安全以使一切按预期工作。

布鲁诺:那么，Appserver 是一个完整的包了？鉴于 Appserver 独立提供应用程序，它是一个像 XAMP 包一样的集合整体，还是用户仍然需要预装软件才能运行它？

![](../Images/1a0a6a14f0e27c42df086fea3f1970f9.png)

是的，应用服务器是一个完整的包，但是在 Linux 系统上，我们只交付了编译好的 PHP 和几个配置文件，并使用了系统提供的库(安装将由发行版依赖管理自动完成)。这是为了确保一旦发行版发布了更新，安全修补程序就会被关闭。由于 Mac OS X 没有像 APT 或 YUM 那样的依赖管理解决方案，我们提供了不属于默认的 Mac OS X 发行版，但运行应用服务器所必需的一切。运行时的另一部分是启动和停止应用服务器的 init 脚本和 Mac OS X 启动守护进程的 plist 文件。

Bruno: 那么，我假设 Appserver 封装得足够好，不会影响人们当前的 PHP 安装，这是正确的吗？用户仍然可以使用他们的旧设置并运行 application server，而没有任何副作用？

![](../Images/4a853204684bac81d556c33d07f8e29e.png)

汉斯:绝对正确。对我们来说，保持用户运行系统的干净是很重要的一点。

![](../Images/1a0a6a14f0e27c42df086fea3f1970f9.png)

Tim: 我们还没有发现任何副作用，因为我们不会覆盖或替换发行版提供的任何内容。

**布鲁诺:**牛逼。关于现在的许可 Appserver 是完全开源的吗？如果是，你打算在可预见的将来保持开源，还是打算让部分内容成为专有的？

![](../Images/1a0a6a14f0e27c42df086fea3f1970f9.png)

蒂姆:斯特凡会给你答案:)

![](../Images/bb4274df2d0b87f833b62e9aed4026a5.png)

**Stefan:** 由于我们都是开源爱好者，Appserver 将总是以完全开源的代码交付，但由于我们认为该产品将增加 PHP 环境的企业功能，我们相信客户将会对该产品的企业服务和支持有很高的需求。满足这些客户需求的想法是交付具有一些更复杂的监控和扩展功能以及 SLA 和支持的特殊版本。

**Bruno:** 我接下来也想问这个问题——所以你计划建立一种“免费增值”模式？换句话说，您将为企业版的实现和开发提供商业支持和微调？

![](../Images/bb4274df2d0b87f833b62e9aed4026a5.png)

Stefan: 正是。我们没有任何计划或确切定义的订阅模式，但我们正在努力，因为我们真的认为这对企业客户来说是一个重要和必要的部分。我们不确定是否应该称之为企业版，但是我们现在也把它作为一个工作名称。

布鲁诺:好的。那么，就贡献而言，你现在最需要社区做的一件事是什么？

![](../Images/1a0a6a14f0e27c42df086fea3f1970f9.png)

蒂姆:我们最需要的是那些愿意尝试应用服务器并尝试在其中运行他们最喜欢的应用程序的人。此外，我们将感谢每一位有兴趣成为我们开发团队一员的开发人员，他们和我们一样着迷于将应用服务器作为实现企业 PHP 应用程序的标准解决方案提供给所有 PHP 开发人员:)随着 NodeJS 这样的解决方案的出现，我们认为 PHP 也有必要采取下一步措施，进入这个未来，在这个未来，有必要基于真正的企业中间件解决方案来交付真正的企业应用程序。

**布鲁诺:**这么一个测试部落？我想我们可以帮上忙:)

![](../Images/4a853204684bac81d556c33d07f8e29e.png)

汉斯:当然总会有测试，但是我们希望人们分享我们的热情，用他们的想法和经验把 PHP 和 Appserver 带到一个新的水平。

布鲁诺:有道理，约翰。没有社区就没有产品。Appserver 目前的开发状态如何，您预计它什么时候可以投入生产？

![](../Images/1a0a6a14f0e27c42df086fea3f1970f9.png)

Tim: 我们认为 servlet 容器实际上处于 alpha 状态，这是我们必须交付的第一部分。其他服务正在大量开发中，只能用于测试目的。我们有一个基本的[路线图](https://github.com/techdivision/TechDivision_ApplicationServer#roadmap)，关于什么版本将提供什么功能/服务，但我们还不认为这是最终版本。我们希望在今年完成 servlet 容器，这意味着 0.7 将在 12 月发布。对于交付 1.0 版计划的所有服务的生产就绪系统，我们的目标是明年年中:)

布鲁诺:很好，希望你能在截止日期前完成！鉴于这将是我们目前所能得到的最接近单一软件包的解决方案，用额外的 PHP 扩展升级 Appserver 会有多容易或多难？例如，我是 [Phalcon](http://phalconphp.com) 的忠实粉丝，能够在多线程环境中使用如此强大的东西肯定会是一个成功的组合。

![](../Images/4a853204684bac81d556c33d07f8e29e.png)

**汉斯:**您可以通过集成的 composer 二进制文件轻松升级 Appserver 组件`/opt/appserver/bin/composer update`。当然也有可能安装你最喜欢的 PHP 扩展，假设它是线程安全兼容的。当我们把 Appserver 作为一个完整的包交付时，你会在“bin”文件夹中找到所有的 php 工具，比如 PECL 和 PEAR。

![](../Images/1a0a6a14f0e27c42df086fea3f1970f9.png)

蒂姆:我从来没有听说过费尔康，但在快速浏览了网站后，它似乎真的很有趣。同时我已经编译好了，看起来可以用:)

![](../Images/4a853204684bac81d556c33d07f8e29e.png)

汉斯:蒂姆，多敏捷啊！:D

![](../Images/bb4274df2d0b87f833b62e9aed4026a5.png)

斯特凡:我真的很感动:)

![](../Images/1a0a6a14f0e27c42df086fea3f1970f9.png)

**Tim:** 你可以通过克隆 github 库并在 extension ext 目录中输入`/opt/appserver/bin/phpize`来实现。之后，您可以用`./configure --with-php-config=/opt/appserver/bin/php-config && make && make install`配置和编译扩展。之后，您必须使用`echo extension=phalcon.so >> /opt/appserver/etc/conf.d/phalcon.so`添加扩展，并使用`/etc/init.d/appserver restart`重启应用服务器。应该可以了:)

布鲁诺:哈。太棒了！在我们结束这次采访后，我将立即尝试一下，听起来好得难以置信:)你提到了 Composer，并且 [Quora 问题](https://www.quora.com/PHP/What-do-you-think-of-PHP-Application-Server-based-on-pthreads)给出了所有组件都可以通过它下载的提示。你能详细说明一下吗？

![](../Images/1a0a6a14f0e27c42df086fea3f1970f9.png)

蒂姆:是的，当然。因为应用服务器的每个组件都是一个 Composer 模块，所以您可以使用 Composer 更新应用服务器本身。为此，在应用服务器的基本目录中输入`bin/composer update`。仅此而已:)但是由于我们处于重度开发阶段，我们实际上不推荐这样做，因为很有可能获取一些实际上不兼容的东西。我们希望下一个版本会有一些带标签的包，所以这种情况不会再发生了。顺便说一句，你可以在 [github](https://github.com/techdivision) 上找到所有组件。

布鲁诺:太好了:)你有计划在世界各地的 PHP 大会上展示 Appserver 吗？

![](../Images/1a0a6a14f0e27c42df086fea3f1970f9.png)

是的，我们有:)我们在 2013 年 10 月 28 日星期一下午 5:00 到 6:00 在慕尼黑的 PHPConference 上有一个会议(【http://phpconference.com/2013/en/sessions】T2)，我也在 11 月 8 日下午 4:00 到 5:00 在汉堡有一个关于 PHP 开发者大会的会议([http://www . Developer-Conference . eu/session _ post/thread-basi erte-anwendungsentwicklung-MIT-PHP/)](http://www.developer-conference.eu/session_post/thread-basierte-anwendungsentwicklung-mit-php/)

布鲁诺:那是很好的曝光，毫无疑问。也许我们会在某些会议上遇到:)那么，人们在哪里可以找到一些示例应用程序来玩呢？他们可以去哪里进一步了解这个项目？

![](../Images/1a0a6a14f0e27c42df086fea3f1970f9.png)

是的，我希望如此，布鲁诺:)你也可以在我们的 github 存储库中找到示例应用程序。实际上我们有一个 Magento 和一个 TYPO3。有效的近地天体例子。为了进行尝试，您可以克隆存储库并使用 ANT 运行 init-instance 目标。这将在应用服务器 webroot `/opt/appserver/webapps`中安装示例。安装后，你必须打开网址`http:127.0.0.1:8586/magento`或`http://neos.local:8586/setup` (Neos 需要在你的`/etc/hosts`文件中有一个名为`neos.local`的主机条目才能工作)来完成你的浏览器安装。此外，我们正致力于基于 PHAR 的应用程序部署。我们已经用 Magento 和 TYPO3 完成了一些测试。Neos 成功——你可以在我们的脸书页面([https://www.facebook.com/appserver.io](https://www.facebook.com/appserver.io))的视频中看到这一点。这也将是我们这个月发布的下一个版本 0.5.8 测试版的一部分:)我们最终会在我们的网站上提供可安装的 PHAR。他们将有一个签名，以便在应用服务器安装完成时可以验证他们:)为了将来更容易，我们将创建一个类似于 appstore 的东西，在那里您可以直接从管理界面下载您想要在应用服务器中运行的应用程序——我们认为这将使开始变得更容易一些！

**布鲁诺:**肯定！好东西，我一定会关注这个项目的发展。在我们结束之前，你还有什么想让我们的读者知道的吗？

![](../Images/4a853204684bac81d556c33d07f8e29e.png)

汉斯:我们目前正在编写文档，所以与此同时，任何需要帮助的人都可以加入我们在 freenode #appserver 上的 irc 频道。Tim 和我在那里的时间最多:)

![](../Images/1a0a6a14f0e27c42df086fea3f1970f9.png)

Tim: 我们真正想说的是:成为应用服务器团队的一员，享受开发酷东西的乐趣。我们将开始在著名的地点一起进行代码冲刺，一起计划事情，发布一个伟大的软件解决方案，它将改变 PHP 生态系统…希望如此；)

![](../Images/4a853204684bac81d556c33d07f8e29e.png)

汉斯:几周前，我们在西班牙的马略卡岛举行了代号为“春天”的活动。非常高效和放松:)

布鲁诺:棒极了:)非常感谢各位，祝你们今后发展顺利，我相信在未来几周我们会在 IRC 上谈得更多——我肯定会尝试的。

## 分享这篇文章