# 如何使用 AppFog 设置蓝绿色部署方法

> 原文:[https://www . site point . com/set-blue-green-deployment-methodology-app fog/](https://www.sitepoint.com/set-blue-green-deployment-methodology-appfog/)

*本文由 [AppFog](https://www.ctl.io/appfog/) 赞助。感谢您对使 SitePoint 成为可能的赞助商的支持。*

构建大型 web 应用程序涉及几个步骤。众所周知，这一过程中最困难的步骤之一是部署。您的工程团队经常会面临这样的情况:代码需要快速发布，而您的生产环境需要尽快更新。在这样的环境中，部署过程必须足够平稳以避免中断用户体验，但又足够快速以避免停机并保持业务目标。

AppFog 的团队知道拥有一个强大的架构来支持维护和扩展您的应用程序是多么重要，这就是为什么他们开发了一个工具，让您可以专注于编写代码，同时处理与基础架构相关的细节。有了 AppFog，像运行时环境、负载平衡和报告之类的事情不再是需要你花费那么多时间的问题。AppFog 甚至可以帮助您无缝地部署您的应用程序，无论您有多少用户，或者您的部署通常有多大。

如果您曾经发现自己难以为您的工程团队提供轻松的部署策略，那么 AppFog 提供的蓝绿色部署方法可能适合您和您的团队。

## 什么是蓝绿部署方法？

自动化部署中涉及的一个已知挑战通常被称为“切换”，它指的是将软件从测试的最后阶段转移到实际生产中。转换需要快速进行，以便防止停机或至少将停机时间降至最低。蓝绿色部署策略通过确保您的应用程序有两个独立的、尽可能接近相同的生产环境来实现安全部署。在任何时候，这些环境中的一个是实时的，而另一个没有接收用户流量。如果您的“蓝色”环境是活动的，那么您的部署前测试将在您的“绿色”环境中进行。一旦您的测试在绿色环境中通过，您就可以将流量从蓝色环境重新路由到绿色环境，绿色环境现在拥有通过所有 QA 和其他测试的更新代码。

蓝绿部署策略允许在活动环境中发现错误时立即回滚，因为您可以简单地将流量重新路由到两个相同的非活动生产环境中的任何一个。你可以在这里阅读更多关于蓝绿部署方法的信息。

## 如何开始使用 AppFog

正如我们上一篇介绍 AppFog 和 12 因素应用方法的文章中所述，AppFog 是一款用于管理网络资源、中间件、操作系统、虚拟化、服务器、存储和运行时的产品。你需要做的就是专注于编写你的代码。AppFog 由 CenturyLinkand 构建，依赖于通用的开源云铸造平台。

要在 CenturyLink 控制面板中启用 AppFog，请转到 [https://control.ctl.io](https://control.ctl.io/) ，登录，您会看到下拉导航栏中列出了“AppFog ”:

![CenturyLink control panel](../Images/9426e9adecabe167d97171b43b07725d.png)

然后，启用部署到 AppFog 地区、美国东部和/或美国西部。每个区域都有自己的“添加区域”按钮，以便在 AppFog 中启用它:

![CenturyLink control panel](../Images/7a95a843ee62322dd9e527eaa9c4d0ef.png)

在您的帐户上启用 AppFog 后，您可以管理区域和空间的成员资格、从终端登录以及部署应用程序。

使用 Cloud Foundry CLI，部署就像导航到源代码所在的目录并运行一样简单:

```
cf push [name of app]
```

在遵循蓝绿色部署策略的同时更新该应用程序需要一些额外的步骤。

初始部署应用程序后，可以通过运行以下命令来部署应用程序的更新:

```
cf push myapp-Green -n myapp-temp
```

这个命令告诉 Cloud Foundry 将您的代码推送到一个临时路径，而不是您的主路径，假设您的应用程序在 AppFog 的东部地区，访问这个临时路径的 URL 应该是:

```
myapp-temp.useast.appfog.ctl.io
```

到目前为止，我们有一个蓝色的环境，这是当前活动且尚未更新的应用程序，还有一个绿色的环境，这是刚刚部署的临时环境。

现在这两个环境已经存在，我们可以将临时环境进行轮换，这意味着它将由 AppFog 自动进行负载平衡，这样流量将被传送到这两个环境中的一个。

为此，我们将运行:

```
cf map-route myapp-Green useast.appfog.ctl.io -n myapp
```

一旦应用程序的新更新版本按预期运行，我们就可以将所有流量转移到该版本，在蓝绿部署术语中，这意味着将流量从蓝色环境转移到最近更新的绿色环境:

```
cf unmap-route myapp-Blue useast.appfog.ctl.io -n myapp.
```

完成蓝绿色切换后，我们可以运行以下命令来删除临时路由:

```
cf unmap-route myapp-Green useast.appfog.ctl.io -n myapp-temp
```

要了解更多关于 AppFog 的蓝绿色部署，请参阅他们的文档。特别是，仔细阅读在使用数据服务或提供状态的服务时应该考虑的事项—这是一个应该小心处理的复杂问题。

## 结论

虽然运行一个成功的大规模 web 应用程序会面临许多挑战，但部署并不一定是其中之一。一个成功的蓝绿色部署方法可以决定一个零停机的成功产品和一个有问题的产品。AppFog 的工具只需四个命令就能让你进行蓝绿色的部署，这样你就可以重新开始构建一个令人惊叹的产品。

## 分享这篇文章