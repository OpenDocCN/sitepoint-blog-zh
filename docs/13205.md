# Rails 2.0 中的 Cookies 和会话

> 原文:[https://www.sitepoint.com/cookies-and-sessions-in-rails-20/](https://www.sitepoint.com/cookies-and-sessions-in-rails-20/)

正如我们所知，HTTP——构建网络的协议是无状态的——这意味着与服务器的每个事务都不知道之前的任何事务。为了解决这个问题，我们使用 cookies 来跟踪会话和模拟状态。基本上，cookie 存储在用户的计算机上，它提供了一个密钥，服务器可以用它来检索任何会话信息。

在以前的 Rails 版本中，我们的会话存储有很多选择——p store、ActiveRecordStore、DRbStore 和 MemoryStore。PStore 始终是默认值，它将会话数据存储在一个临时文件中。这种方案确实有一些限制，比如某些情况下的竞争条件(也就是说，如果两个实例试图同时写入同一个会话，您的数据可能会被破坏——存储大量 AJAX 调用的大量信息是一个原因)以及伸缩问题——使用 PStore 运行多个服务器几乎是不可能的。

因此，大多数生产系统会使用其他存储，特别是 ActiveRecordStore，它将所有会话数据存储在系统数据库中。

为了避开 PStore 中的这些限制，Rails 2.0 将引入一个新的默认存储:CookieStore，它将所有会话信息存储在客户端计算机上的一个或多个 cookies 中。对于任何对此粗略浏览的人来说，这似乎是一个安全风险，它可能是——然而，作为开发人员，您可以做一些事情来使这个过程更加安全。

首先，让我指出商店不是以纯文本的形式存储的——在 environment.rb 文件中有一个新的伪造密钥，您应该将它设置为一个长的随机字符串。会话信息根据该密钥进行哈希运算，因此服务器可以检查伪造企图。所以第一步是确保这个密钥足够长并且足够随机。

其次，不要在会话哈希中存储敏感信息。大多数应用程序可以只存储一个用户 id。这是一个最佳实践，而不仅仅是以 Rails 为中心。

第三，如果你特别多疑，看看其他会话存储选项。CookieStore 确实是最小公分母的选择，其他类型的商店可能更适合生产系统。你可以在[斯科特·巴隆的博客](http://scott.elitists.net/sessions.html)上看到其他商店类型的描述。他还对不同类型的商店进行了基准测试(不过请注意，由于这篇文章现在已经很旧了，新的 Cookie 商店不包括在基准测试中)。

## 分享这篇文章