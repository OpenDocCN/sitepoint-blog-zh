# 多租户和谷歌应用引擎(GAE) Java

> 原文:[https://www . site point . com/multi tenance-and-Google-app-engine-gae-Java/](https://www.sitepoint.com/multitenancy-and-google-app-engine-gae-java/)

多租户应用程序，一个实例服务于多个组织，但同时为来自应用程序其他租户的数据和应用程序提供虚拟隔离。由于硬件、操作系统以及某些情况下的应用程序代码对于应用程序的所有租户都是相同的，因此基于租户的聚合数据进行维护、监控和增量更改变得更加容易。它还提供了规模经济，从而可以以较低的成本向租户提供服务。

多租户原则并不是一个新现象，它已经存在了至少几十年，但是随着云计算的出现，多租户架构在云应用领域获得了更多的一席之地。当你在像 DropBox 这样的存储服务上创建一个帐户时，你会从他们的存储空间中获得 2GB 的空间。您的 2GB 空间是专属于您的，没有人可以访问它，除非您共享它。但是分配给每个用户的空间可能在同一物理存储设备或一组物理存储设备上。所以你是 DropBox 多租户存储系统的租户之一！

## 多租户级别

### 硬件和资源多租户

这是最简单的多租户形式，并且已经存在很长时间了！当你在亚马逊 S3 上为你的应用程序获取存储时，你是在共享存储空间上获取空间，你是基础设施的众多租户之一。大多数 IaaS 消费者是他们所使用的基础设施的租户。

### 数据多租户

数据多租户在数据存储级别实现。根据安全性和法规遵从性约束以及组织的目的，体系结构多租户的程度可能会有所不同。想要安全和完全隔离数据的组织可能会选择为他们的组织设置一个隔离的数据库。其他可能的变化可能包括为同一数据库中的一个组织提供一个模式，或者为每个组织提供单独的一组表。关于这个主题的详细论述可以在[这里](http://msdn.microsoft.com/en-us/library/aa479086.aspx)找到，但这不是我们在这里讨论的主要焦点。

当我们谈论数据多租户时，访问数据的应用程序代码是相同的。应用程序可能会托管在多个服务器上以进行扩展，但本质上用户界面屏幕、逻辑和租户的定制都是相同的，只是数据不同。

![](../Images/8af88f69fbb9c247b03e51e7ecb490e4.png)

### 应用程序多租户

贯穿应用程序的多租户是最复杂的类型，也是最难实现的类型。因此，每个 tenat 都有不同的逻辑和屏幕来访问不同的数据，但仍然共享公共资源，这怎么可能呢？让我们来看看这样一个系统的高层架构:![](../Images/11af8365fc405fe388f1cf83c5571a03.png)

一个完整的多租户系统在数据级别实现多租户，类似于我们之前讨论的数据多租户。在应用程序级别，运行时引擎将特定于租户的元数据和定制数据组合到内核代码中，从而提供特定于租户的应用程序。对于每个租户有不同种类的模式/对象的情况，同样的逻辑可以应用于数据级。有了对象数据库，为每个租户使用不同的模式/对象，甚至为同一对象使用不同的属性来满足不同租户的需求就容易多了。

拥有一个完全编织的多租户应用程序的复杂性源于在整个应用程序中为租户提供过滤器，同时能够实现规模和速度的承诺。各种机制，如元数据缓存，被用来实现这一点。SalesForce 应用程序是通过应用程序编织多租户的最佳实例。

## 谷歌应用引擎中的多租户

迄今为止，GAE 提供了命名空间 API 来实现数据级的多租户。命名空间 API 可用于数据存储、任务队列和内存缓存。Blobstore API 还不支持名称空间，所以您的二进制资产必须在应用程序级别用应用程序中设计的机制进行划分。命名空间 API 还支持 Google apps 域，因此如果您的租户将成为 Google Apps 用户，那么您可以将他们的域名设置为他们数据的命名空间。有各种各样的策略来使用名称空间，例如在用户级别、google apps 域级别等等。

通过使用部署描述符中配置的过滤器，可以在请求进入应用程序之前设置名称空间。还可以在对其他名称空间的请求中设置名称空间以获取公共数据，这些数据可以被取消设置或再次设置为旧的名称空间。

### 示例使用案例

*   将命名空间设置为当前的 google apps 域–这将为每个 google apps 用户拆分数据。这可以在过滤器中完成，以便进入应用程序的请求是名称空间感知的。在下面这段代码中，我们检查名称空间是否为空，如果为空，我们将其设置为当前的 google apps 域。

[source code language = " Java "]
if(namespace manager . get()= = null){
namespace manager . set(namespace manager . getgoogleappsnamespace())；
} [/sourcecode]

如果为每个用户拆分数据，那么用户 ID 可以用作名称空间；

[source code language = " Java "]
userservicefactory . getuserservice()。getCurrentUser()。get userid()；[/源代码]

*   可以跨不同的租户使用公共名称空间来访问所有租户共有的数据，例如，可以从公共名称空间中检索美国所有城市的邮政编码

[source code language = " Java "]
String current ns = namespace manager . get()；
namespace manager . set(" COMMON _ NS ")；
//从公共命名空间
Namespace manager . set(current ns)中获取所需数据；[/源代码]

*   单独的命名空间可用于在开发、质量保证和试运行环境之间分离数据，GAE 的版本可用于为各自的环境托管不同阶段的代码库。
*   应用程序的各种模块的代码库可以像邮件一样部署在不同的版本中。APP_NAME.appspot.com 和特定于该模块的数据可以存储在单独的名称空间中。
*   公共数据可以存储在公共名称空间中，需要时可以切换名称空间。

## 分享这篇文章