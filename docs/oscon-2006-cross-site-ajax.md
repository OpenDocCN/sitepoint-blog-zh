# OSCON 2006:跨站点 Ajax

> 原文：<https://www.sitepoint.com/oscon-2006-cross-site-ajax/>

本周，凯文·杨克从俄勒冈州波特兰市的 [OSCON 2006](http://conferences.oreillynet.com/os2006/) 发回报道。

由于犹豫不决(在 OSCON 的任何时候，实际上都有三个不同的会议我认为是“必看的”)，我去了 [Plaxo](http://www.plaxo.com/) 开发者 Joseph Smarr 的<cite>跨站点 Ajax:构建丰富的 Web 2.0 混搭的挑战和技术</cite>，主要是因为我将在 9 月的 [Web Directions](http://wd06.com) 上就同一主题发表演讲。幻灯片将在 Plaxo 博客上发布。

如果你一直生活在岩石下，混搭是通过组合几个专门的 web 应用程序提供的服务构建的 web 应用程序，通常使用 AJAX 作为粘合剂。mashups 开发人员面临的一个主要挑战是同源策略，作为一种安全措施，它阻止一个站点上的 JavaScript 与其他站点联系。为了让 mashups 真正发挥作用，开发人员需要找到一种绕过这种限制的方法。

## 到目前为止的故事…

对于这个问题，存在许多众所周知的解决方案，但是它们都有自己的问题。因为同源策略只影响浏览器，所以服务器端代理是最显而易见的方法，您的 JavaScript 联系您的 web 应用程序，然后 web 应用程序向另一个域中的服务发出请求。不幸的是，这使您的服务器成为瓶颈，而不是允许每个客户端直接联系服务。

另一种选择是使用 Flash 电影作为代理。Flash 对它发出的请求有一个类似的同源策略，但是如果目标服务在其域上提供了一个`crossdomain.xml`文件，则该策略可以被取消。如果 Flash 看到此文件，并且它包含想要发出请求的域的列表，则允许跨域请求。当然，闪存是一种专有的、非基于标准的技术，可能不适合您。

一个更复杂的解决方案叫做 JSON-P，它动态地向页面添加一个`script`元素来发出请求。`<script>`标签不受同源策略的约束，因此`src`属性可以指向另一个域，请求将会顺利通过。

由于浏览器期望从该请求中接收并执行 JavaScript 代码，这正是以这种方式调用的服务需要返回的内容，但是您需要该代码为您的应用程序做一些有意义的事情。支持这一点的最常见方法是在请求的查询字符串中发送代码中回调函数的名称，服务可以使用该名称在对请求的响应中进行函数调用。

JSON-P 目前存在的问题包括缺乏错误处理，要求通过 HTTP GET 发出请求，以及服务可能返回可以在应用程序中执行的恶意代码(例如，窃取安全敏感的 cookie 值)。

## 有什么新鲜事？

Plaxo 想要建立一个系统,允许你从你的 Gmail 地址簿中挑选电子邮件地址，并把它们插入到第三方网站的文本字段中，只需点击第三方网站上的一个按钮(并在第一次提供你的 Gmail 登录凭证)。这将要求第三方网站能够跨域访问 Gmail，而上述解决方案都无法做到这一点。

“JavaScript 虫洞”是 Plaxo 对其开发的解决方案的称呼，尽管这种技术很巧妙，但也相当曲折，以至于很难用语言来表达——但我会尝试一下:

Plaxo 的地址簿选择器等服务的提供者提供了一个 HTML 文件，任何使用该服务的站点都必须添加这个文件。该文件为服务提供回调机制，以将数据返回到请求站点。

当服务被调用时(例如，浏览器在弹出窗口中从 Plaxo 打开地址簿选择器)，用户完成与它的交互(例如，用户选择一个或多个联系人并单击“ok”)，服务的弹出窗口将来自请求站点的回调 HTML 文件加载到一个`iframe`中。回调 HTML 文件包含一个`<script>`标签，它使用上面讨论的 JSON-P 技术从 Plaxo 请求服务调用的结果(例如用户选择的联系人)。因为 HTML 文件托管在请求站点上，所以响应中返回的 JavaScript 能够将这些结果写入该站点上的原始页面(例如，将选择的电子邮件地址插入适当的表单字段)。

Smarr 表示，Plaxo 正在努力创建一个“通用 JavaScript 虫洞”标准，其他服务可以轻松采用，消除了每个服务提供自己的回调 HTML 文件供网站所有者安装的需要。这个解决方案将包括站点所有者提供一个可信域列表的能力，这些域的服务将能够根据请求使用回调来更新站点的页面(例如，在表单中插入电子邮件地址)。

JavaScript 虫洞并不是万灵药——它也有 JSON-P 的缺点，因为它是围绕这种技术构建的——但对于需要在用户与服务交互后修改请求站点页面的服务来说，它无疑是最灵活的(如果不是唯一的)解决方案。

## 从这里去哪里？

如果我们现在考虑未来，也许我们可以获得一个不需要我们“闯入自己的房子”来构建混搭的平台。Smarr 认为(我也完全同意),开发人员现在应该讨论这些问题，以塑造未来的平台，从而支持 mashup 开发人员的需求，而不损害目前已经存在的严格的(但对用户不可见的)安全模型。

已经提出了一些解决方案。一种可能是建立一种标准的方法来定义站点之间的信任关系。Flash 通过`crossdomain.xml`做到这一点，web 服务通过证书和 IP 白名单做到这一点，通用 JavaScript 虫洞解决方案也做到了这一点。但是这会压制 mashupss 的自由吗？目前，mashup 允许开发者想出一个主意，然后“就这么做”吗？形式化的信任关系会滋生服务契约和许可协议，这会扼杀 mashups 的精神。

桌面上的其他想法包括提议的浏览器增强功能，如[克里斯·霍兰德的`ContextAgnosticXmlHttpRequest`](http://chrisholland.blogspot.com/2005/03/contextagnosticxmlhttprequest-informal.html) ，与当前的`XMLHttpRequest`对象不同，它将允许跨域请求，但不会发送任何 cookie 或 HTTP 认证头，并且可能只连接到在 HTTP 响应中发送`X-Allow-Foreign-Hosts`头的服务器。道格拉斯·克洛克福特提议的`JSONRequest` 将在类似的限制下工作，但将特定于 JSON 格式的服务。但是这些解决方案提出的限制可能走得太远了。

无论您喜欢哪种解决方案，真正的信息是 AJAX 的未来，特别是 mashups 的未来是广阔的，您需要参与定义其发展的过程。还没有简单的答案，这些问题也不会很快消失。但也许最重要的是，浏览器开发者比以往任何时候都更愿意倾听，我们需要告诉他们我们作为开发者想要什么。

## 分享这篇文章