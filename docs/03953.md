# TransloadIt 入门—关键概念

> 原文:[https://www . site point . com/image-uploads-manipulation-transload it/](https://www.sitepoint.com/image-uploads-manipulation-transloadit/)

Transloadit 是一项文件处理服务，主要用于处理图像、视频和音频。

它允许你对这些文件执行各种操作——由它所谓的“机器人”来执行；例如，调整图像大小和优化图像，从视频中提取缩略图或将文件从一种格式转换为另一种格式。

TransloadIt 还允许您将文件直接上传到他们的服务器进行处理，而不是通过您的应用程序。事实上，您可以完全绕过您的服务器，将处理后的文件直接传输到亚马逊 S3 桶、Rackspace 云文件帐户或通过 FTP 传输到您自己的服务器。换句话说，您的应用程序只需要关心在哪里可以找到结果文件，而不必直接处理或存储它们——这对于运行分布式应用程序或集群上的应用程序来说是很好的。

在本教程中，我们将详细了解 Transloadit，特别是使用它来处理图像。我们将会看到一些关键的概念，比如构建“汇编指令”来告诉它我们想要对上传的图像文件做什么。我们将“劫持”一个文件上传表单，将一个文件直接发送到 TransloadIt，运行一组指令来生成许多“衍生物”——不同大小的图像——然后将它们保存到亚马逊 S3 桶中。最后，我们将看看如何使用这些操作的结果来通知我们的应用程序新生成的文件，以便我们可以相应地更新我们的数据库。

在我们详细研究 Transloadit 之前，有必要后退一步，讨论一下为什么首先要使用第三方服务来完成这样的事情，而不是自己实现它。

## 为什么要使用第三方服务？

自己实现图像处理并不困难，有各种各样的库可以满足这一需求。那么，你为什么要使用第三方服务来处理它呢？

*   首先，它可以让你专注于你的应用程序到底是什么。当您可以将开发精力集中在任务关键型功能上时，为什么还要在用户资料照片功能上花费额外的时间和精力呢？

*   图像处理可能相当耗费资源。特别是，调整大图像的大小会占用大量内存。使用 Transloadit 这样的服务可以减轻服务器的负载。

*   处理文件通常需要在服务器上安装额外的库或程序；例如用于图像的`gd`或`Imagemagick`或用于视频和音频的`ffmpeg`。通过使用第三方服务，无需担心安装、配置或维护它们。

*   Transloadit“作业”可以在后台运行，而不是阻碍应用程序的执行。虽然在您自己的应用程序中有解决这个问题的方法——例如像 [RabbitMQ](https://www.rabbitmq.com/) 或 [Beanstalkd](http://kr.github.io/beanstalkd/) 这样的队列，或者像 [Gearman](http://gearman.org/) 这样的作业服务器，但是使用 TransloadIt 可以将您从实现它们所需的额外开发工作和安装步骤中解放出来。

*   Transloadit 服务器在处理文件上传方面进行了高度优化，因此性能可能会比您自己实现它们好得多。

*   允许文件上传到你的网络服务器也有各种各样的安全隐患，你必须考虑到。通过使用第三方服务，这些风险得到了一定程度的缓解。

*   它是分散的。你可以对它进行设置，这样上传的文件就可以通过该服务直接进入外部存储解决方案，比如 S3，而不必存储在你的网络服务器上。虽然这在小规模应用程序中可能看起来不是一个巨大的优势，但是当它发展到拥有多个服务(例如一个集群)的时候，您就会获得好处。

根据你的申请，你的首选主机解决方案，你的专业知识或者你手头的时间，这些都不一定适用。也许没有；这不是所有情况下的最佳解决方案。

自然也有坏处。以下是一些例子:

*   它引入了额外的故障点。
*   这可能意味着将敏感文件委托给第三方。
*   最后，还有财务成本。

考虑到所有这些优点和缺点，让我们开始详细了解一下这项服务。然后，在第二部分中，我们将通过一个实例来演示如何使用它。

## Transloadit 入门

Transloadit 提供了一个免费的沙盒帐户，给你总共 1GB 的空间来玩——这足够你完成本教程，甚至更多。有许多[付费计划](https://transloadit.com/pricing)可供选择，每个月给你不同的容量。在撰写本文时，付费计划起价为每月 19 美元。

容量的实际定义根据您使用服务的目的而有所不同。为了说明这在图像处理上下文中的含义，您可以通过将原始文件的文件大小添加到最终处理后的图像的总大小中，来确定处理一个特定图像上传所涉及的使用情况。所以假设你上传了一张 800kb 的图片，依次用来生成 400Kb 的大版本，200Kb 的中版本和 30Kb 的缩略图。如果您使用可能的最小版本作为下一次调整大小的输入，那么将使用(800 kb+400 kb)+(400 kb+200 kb)+(200 kb+30Kb)= 2，030Kb 接近您的限制。当你开始处理视频或音频时，这些计算变得更加复杂，所以你可能会想咨询他们的网站。

如果您打算继续学习第二部分中的实际例子，现在可能是注册的好时机。[前往网站](https://transloadit.com/)，点击“开始”。

现在让我们来看看一些概念和组成服务的组件，以便更好地理解这个过程。

### 概念

#### 装配

程序集本质上是一组指令，它告诉 Transloadit 服务您希望它们对特定文件(或文件组)执行什么操作。

实际上，您可能会为不同类型的文件创建不同的汇编指令。此后，您可能会为子类型创建稍微不同的汇编指令。例如，用户简档图片/头像可能需要一组特定的尺寸，而简档横幅则需要完全不同的一组尺寸；因此，在这种情况下，您需要为每个组件创建一组汇编指令。

汇编指令包含一系列步骤，精确地定义了要执行的处理和顺序。每一步都由一个机器人执行。

#### 机器人

“机器人”就像一个工人，执行某种处理。有许多不同类型的机器人:

**导入机器人**可以从各种来源获取文件，而不仅仅是通过基于表单的文件上传。例如，您可以创建一个机器人，它通过 HTTP、使用(S)FTP 或从亚马逊 S3 桶下载文件来导入文件。

**装配流程逻辑机器人**可用于过滤输入文件，例如，您可以设置一个机器人来拒绝非图像文件。

图像机器人对图像文件执行许多不同的任务，最显著的是调整大小。还有优化图片文件或者截图的机器人。

视频和音频机器人对那些特定的文件类型执行动作。因为本教程关注的是图像，所以我们不会详细讨论这些，但是请关注后面的后续文章。

**文件导出机器人**用于将装配结果转移到某种形式的永久存储器中。需要注意的是，TransloadIt 并不托管您的文件；虽然他们在处理后通过 S3 桶提供下载，但它们不会被储存超过 24 小时。您有责任确保您的文件存储在您控制的地方。您可以设置一个机器人将您的文件传输到亚马逊 S3 存储桶、Rackspace 云文件，或者使用 FTP 将它们传输到您的服务器。

#### 建筑组装说明

汇编指令是以 JSON 格式定义的，或者作为一个散列来定义的，您可以在各种可用的库中使用它。大多数情况下，您可能会使用官方的 jQuery 插件来与客户端应用程序中的服务进行交互，但是也有其他可用的选项。您不必从客户端应用程序中使用它——服务器端库也是可用的。

在第二部分中，我们将详细研究如何构造汇编指令。

#### 模板

汇编指令告诉机器人如何处理你的文件，但也包括运行它们所需的任何附加信息。当涉及到文件导出步骤时，这是一个真正的问题，因为它们需要凭据才能访问您的 S3 桶或 FTP 服务。在客户端代码中明确定义这些将是灾难性的，因此你应该使用模板。

当您调用 TransloadIt API 时——例如，当使用 jQuery 插件时——不需要定义汇编指令，而是可以在 TransloadIt 的服务器上创建一个包含相关汇编指令的 JSON 文档，然后通过它的惟一 id 引用该模板。模板在服务器端加密，以增加安全性。

您还可以在运行时将额外的参数或覆盖现有的参数合并到一个模板中——同时，保护您的敏感信息(如 S3 证书)免受窥探。

#### 签名

签名避免了在客户端代码中暴露 TransloadIt 身份验证凭据的问题，就像模板保护与存储相关的凭据一样。

签名本质上是一个短暂的访问令牌，它在服务器上生成，传递给客户端应用程序，然后用于向服务进行身份验证。如果有人获得了这种价值，那么它很快就会变得毫无用处。签名还被“绑定”到一组特定的汇编指令或一个特定的模板，使它们更加安全。

#### 变量

您可以在汇编指令中使用变量。这些在确定已处理文件的文件名时特别有用。因此，例如，如果您正在调整一个上传的用户头像的大小，您可以提供用户 id 或用户名来构成结果文件名的一部分。稍后，我们将看到您可以定义的各个步骤的名称如何也可以用作变量。

#### 使用表单域

当您从客户端应用程序(如上传表单)使用 TransloadIt 时，变量可以从表单字段中派生出来。因此，在上面上传用户头像的例子中，您可以将用户 id 放在一个隐藏的表单字段中，然后将其合并到您发送到 TransloadIt 服务器的指令中。

## 摘要

在第一部分中，我们对 TransloadIt 服务进行了高层次的了解。我们已经研究了它能做什么，以及使用这样一个服务来执行您可能要自己实现的任务的优缺点。

我们已经了解了为了充分利用 TransloadIt 而需要理解的一些概念，有了这些背景知识，我们就可以开始构建一个实际的例子了。请继续关注第二部分。

## 分享这篇文章