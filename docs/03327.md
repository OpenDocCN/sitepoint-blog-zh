# HTTP/2:优点、缺点和你需要知道的

> 原文:[https://www . site point . com/http 2-the-pros-the-cons-and-what-you-need-to-know/](https://www.sitepoint.com/http2-the-pros-the-cons-and-what-you-need-to-know/)

每当你访问一个网页时，你的浏览器通过向网络服务器请求该网页的所有资源来获取它。自从 web 诞生以来，这主要是通过 HTTP/1.1 来完成的。

随着时间的推移，技术的发展，[网站变得越来越复杂，资产越来越多](https://www.sitepoint.com/2mb-web-pages-whos-blame/)，HTTP/1.1 协议越来越紧张，需要很多变通办法让[处理性能问题](https://www.sitepoint.com/complete-guide-reducing-page-weight/)。

![developers at work](../Images/0a46e9cfa8a476945b19cefc1364ede9.png)

正如我们今天所知道的那样，网页经常塞满了各种资源——比如图像、文本、字体等等。这使得它们比 20 世纪 90 年代甚至 21 世纪初的那些要重得多。因此，它们需要更多的时间来加载，所以网页设计者和开发者想出了巧妙的解决方法来回避这个问题。不过，很明显，HTTP 协议本身也需要更新。

[HTTP/2](https://http2.github.io/http2-spec/) 会给页面交付给浏览器的方式带来一些变化。虽然普通互联网用户可能看不到很大的区别，但设计师和网站开发者会注意到相当大的区别。本文将探讨这些变化是什么，以及作为一名熟练的技术用户，它们将如何影响您。

## HTTP/1 如何工作

为了获取你想访问的网页，你的浏览器与服务器通信。它们交换信息——浏览器通过单独的请求请求图像、字体和其他所需的资源，服务器依次发送这些信息作为响应。

因此，通过许多连接的大量数据会导致拥塞，并且页面加载速度会变慢。为了克服发送太多请求的问题，并充分利用 HTTP/1，有创造力的开发人员使用了内联、连接和图像精灵。对他们来说幸运的是，当 HTTP/2 到来时，对性能速度的困惑将在很大程度上成为过去。

![developers at work](../Images/231eda095cd5bc769a0c7e65ec5eb33a.png)

## HTTP/2 将如何工作

您的浏览器仍然会向服务器发送请求，并获得带有所需资源的响应，以使网页看起来像它应该的那样，但是两者之间的一些细微差别将会改变。HTTP/2 带来了新的特性，比如多路复用流、服务器推送、头压缩和二进制格式——我将依次研究每一个特性。

### 多路复用器流

还记得许多连接将文本、字体和图片等资源从服务器传递到浏览器时造成的拥塞吗？多路复用通过将这些资源分成更小的部分，通过一个连接传递它们，然后在它们到达最终目的地(浏览器)后重新组合这些资源，从而消除了这个问题。

### 服务器推送

服务器推送代表了一种向浏览器交付资产的更有效的方式。在 HTTP/1 环境中，HTML 页面被发送到浏览器，浏览器必须解析它并决定它可能需要哪些资产，然后从服务器请求这些资产。

HTTP/2 在这方面更加主动，发送浏览器可能需要的资源，而无需浏览器请求。这些资产进入浏览器的缓存，需要时可以立即使用，这对性能是一个优势。

### 标题压缩

在 HTTP/1 中，发送的每个请求都附有一小段附加数据——HTTP 头——描述浏览器或服务器的行为。平均而言，浏览器能够同时建立大约 6 个连接，但是考虑到加载一个典型网页所需的连接数量[可能高达 100 个左右](http://httparchive.org/trends.php#bytesTotal&reqTotal)，这就留下了大量要检索的数据，这需要时间和带宽。

当建立 HTTP/2 连接时，所有的报头都被打包成一个压缩块，作为一个整体发送。它传递得更快，当传输完成时，报头块被解码。

### 二进制而不是文本格式

文本格式有一些额外的开销，需要改进，而二进制格式不需要任何解析。它也更加紧凑。服务器的额外工作意味着等待网页加载的额外时间。这就是为什么二进制格式更容易处理，是一个合理的改进。

![developers at work](../Images/5dba8313547779b54bfbd050104b9df9.png)

## 开发者现在可以做什么不同的事情

开发人员将不再需要绘制图像、内联和连接文件，因为不再需要减少网页上的请求数量。基本上，这将是他们日常生活中最大的变化。然而，关于可能以某种方式影响他们工作的内部变化，还有更多要说的。

### 需要注意的事项

虽然实际的 HTTP/2 规范并不要求，但是大多数支持 HTTP/2 的浏览器都需要 HTTPS 加密。这意味着，如果你的 HTTP/2 站点不是通过加密连接提供服务的，访问者将不得不寻找其他客户端来访问你的站点，否则就会错过。

虽然这些天有一些通过 HTTPS 提供服务的网站的推动，但是浏览器的这一要求已经招致了批评，并且对于一些考虑转换到 HTTP/2 的人来说无疑是一个绊脚石。(关于什么是 HTTPS 以及如何实现它的更多技巧，请阅读 SitePoint 最近的[对 HTTPS](https://www.sitepoint.com/https-basics/) 的介绍。)

对于公众来说，网络将毫无痛苦地转变。新版本协议工作所需的修改和升级将在服务器和浏览器中进行。服务器将随着时间的推移而更新，最终支持这两种协议。支持新协议的浏览器[会自动切换到 HTTP/2。同时年纪大的也不会懂。作为开发人员，您需要知道您的浏览器和您使用的服务器是否都支持 HTTP/2，以确保连接升级到它。](http://caniuse.com/#feat=http2)

## 一些争议

虽然许多人对 HTTP/2 充满热情，但其他人，如 Poul-Henning Kamp，却不那么[印象深刻](https://www.varnish-cache.org/docs/trunk/phk/http20.html)。Kamp 认为 HTTP/2“实际上只是 HTTP/1.2 的一个冠冕堂皇的名字”，并暗示它很可能不会持续很长时间，如果它真的起飞的话。

据他说，新协议并没有解决实际问题，而是过于关注带宽。他建议，更好的关注点应该是取消 cookies 这个概念，代之以会话/身份设施。在一个高度安全的世界里，这将在一定程度上改善隐私。Kamp 认为，实际上，HTTP/2 并没有显著改善隐私。

## 看出区别了吗

[这个 Akamai 演示](https://http2.akamai.com/demo)展示了在两个版本的协议中如何同时加载资源。第一张图片是通过 HTTP/1 和六个并发连接加载的(如果你使用的是 Google Chrome)，而第二张图片是作为一个整体通过 HTTP/2 加载的，所有部分同时加载。

![akamai demo screenshot](../Images/6c444350155771960b30898a007cb4f6.png)

如果您想更深入地了解数据通过协议中的连接是如何不同地加载的，[看看这个 golang.org 的例子](http://http2.golang.org/gophertiles?latency=0)。它允许您尝试不同的延迟设置，以便您可以看到数据是如何在不同容量的设备上同时加载的。延迟时间越长，HTTP/2 在性能方面的优势就越明显。

![Golang gophertiles screenshot](../Images/951230d78c689898c9348816cac281d2.png)

## 结果

对于普通用户来说，HTTP/2 将会变得更加容易，那些从事网络工作的人可以做出一些选择。

一般来说，网站会更安全，加载速度也会更快。该协议没有带来任何根本性的变化，可能是因为这些变化在技术上和政治上更难实施。这就是 HTTP/2 可能不会为我们服务那么久的原因。

技术世界每年都在以更快的速度发展，所以几年后我们可能会需要别的东西。我个人的希望是，下一个协议将更灵活，更勇敢的迎接不断变化的技术的挑战。

## 分享这篇文章