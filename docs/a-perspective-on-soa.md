# SOA 透视

> 原文：<https://www.sitepoint.com/a-perspective-on-soa/>

作为一名二十年的开发人员，我想总结一下我对一个多次遇到的话题的想法: [SOA](http://en.wikipedia.org/wiki/Service-oriented_architecture) 。SOA 的高层次定义是将服务开发和组合成更大的东西。希望这种组合作为产品是有用的，而每个服务应该是独立的和可重用的。

SOA，作为一个流行词，已经在技术文章中被大量使用，许多开发人员可能认为“嘿，这在我的简历上看起来不错。”在其他情况下，引入 SOA 是一个管理决策，因为这三个字母似乎很容易解决任何问题。毕竟，我们都被教导“分而治之”，对不对？

在您继续阅读之前，我可能应该警告您:我认为在许多情况下，SOA 是错误的方法。我为许多使用 SOA 的公司工作过，看到过许多项目失败或举步维艰。最近我有了一个小小的顿悟，我必须说:我真的很喜欢拥有单片 web 应用程序的想法。我可能应该解释一下…

## 发展

通常，开发人员在本地机器上工作并启动他的应用程序。对于一个 [Rails](http://rubyonrails.org/) 开发者来说，基本上你所要做的就是在你的项目目录中运行`rails server`。当您从应用中分离出一个服务时，您必须单独启动该服务，然后才能开始工作。当某些东西不工作时，您将不得不浏览应用程序和服务的日志。

当然，这是可行的，听起来并不像是一个大开销，但是考虑一下涉及到 5 个甚至 10 个服务。现在，您必须启动所有这些程序，如果出现问题，还需要找到日志等等。稍后你将尝试自动化，也许使用一些配置管理工具自动安装所有的服务，甚至引入一些集中的日志管理工具。底线是:与单一的应用程序相比，你将需要更多的时间来做同样的事情。

## 测试

让我们讨论一下测试。您想用自动化的[集成测试](http://en.%20%20wikipedia.org/wiki/Integration_testing)来测试您的应用程序，对吗？。一种选择是使用运行在集成系统上的现有服务，并对其进行测试。我们已经这样做了很多次，但我们经常忘记检查那里运行的是什么版本的服务。我可以向你保证这是消磨几个小时的好方法。

然而，你可以嘲笑一切。这基本上使你的测试工作加倍，因为当改变一个服务的行为时，你现在也必须改变你的模拟。也许您决定在运行集成测试时启动每个服务的新实例。这可能是最安全的方法，但是需要时间来实现，并且在每次测试中也需要时间。

## 部署

您必须部署这些服务和您的 web 应用程序。需要一些管理工作来了解部署什么以及可能的副作用。如果你做了[连续部署](http://en.wikipedia.org/wiki/Continuous_deployment)并且每一个绿色测试的提交都可以上线，那么，大部分时间你都是没问题的。然而，如果你一周部署一次，这肯定会变得更加困难。许多人认为部署一项服务比部署整个应用程序更容易。

我不明白。当负载均衡器后面有一个由 [Rails](http://rubyonrails.org/) web 服务器组成的集群时，您可以一个接一个地进行部署，而不会对用户造成任何影响。一般来说:在生产环境中部署一个服务通常也意味着拥有一个该服务的集群，以确保部署不会对用户造成影响。因此，您可能需要为每个配置的服务配置一个负载平衡器。这很快就会变得很糟糕。

## 缩放比例

在单片应用程序中，缩放是非常容易的。如果您的应用程序运行缓慢，您将添加一些服务器进行扩展或购买一些更大的机器。也许您拆分了数据库，拥有了更多的数据库服务器([分片](http://en.wikipedia.org/wiki/Shard_%28database_architecture%29))。拥有几项服务意味着您必须扩展每项服务。如果一项服务非常繁忙怎么办？现在这个服务需要另一台机器，你必须单独监控哪些服务变慢了。

## 操作

在操作中，您需要对系统的健康状况进行一些监控。您可以使用 [Munin](http://munin-monitoring.org/) 来绘制响应时间图，或者使用 [Nagios](http://www.nagios.org/) 来查看所有服务器是否启动并运行。有了 SOA，你通常要监控十几个服务。

## 性能和可靠性

与仅仅调用库/ [gem](http://rubygems.org/) 或应用程序内部的一些代码相比，与服务建立 HTTP 连接要慢得多。您必须记住您的服务调用是如何设计的。接口必须非常复杂，因为目标应该是每个用户请求只调用一次服务，以保持较低的延迟。记住，每次调用您的服务都需要几毫秒的时间。如果您调用它一次，这是可以接受的，但是如果您调用它一百次来服务一个用户请求，您就有大麻烦了。

如果你认为你的[到服务的套接字连接](http://en.wikipedia.org/wiki/Network_socket)和你的应用内部的方法调用一样可靠，你会感到惊讶。在 Linux 中，套接字连接像打开文件一样被处理。如果你的一个服务变慢了，(可能是一个[索引](http://en.wikipedia.org/wiki/Database_index)丢失了)，每个服务调用都会超时。由于您的客户仍在发送请求，套接字的数量会增加。最终，您将遇到套接字限制，必须找出哪个服务对灾难负责。与此同时，您的应用程序已关闭，您可以享受所有警笛和闪烁红灯的轻松旋律。

## 选择

话虽如此，你有什么选择？

一种选择是垂直分割系统，而不是水平分割。也就是说，不要把底层的东西放到服务中，试着把你的应用分成不同的领域，也许一个 Rails 应用管理用户配置文件，一个与他人交互等等。这些应用程序可以共享数据库，或者拥有不同的数据库，如果需要的话，可以通过 [REST](http://en.wikipedia.org/wiki/Representational_state_transfer) 服务进行通信。

什么时候服务是足够的？

在大公司里，每个部门都有自己的一套应用程序。他们甚至可能使用几种编程语言或框架。如果他们需要与许多应用程序都需要的服务进行通信，比如防欺诈，我不认为有任何方法可以绕过 SOA。

## 摘要

在我看来，对每个开发人员和架构师来说，重要的一点是考虑拥有服务的后果。我们不应该因为它很酷而这样做，也不应该仅仅因为其他公司这样做，因为这可能会导致未来的麻烦。请记住，在提取服务代码时，我们还有另一个应用程序要部署、维护和监控。此外，我们有额外的网络通信可能会失败，并且比在同一台机器上调用函数或库要慢得多。

简单来说:如果事情变得太大太丑，我们还有其他技术，比如水平分割我们的应用或者创建库/宝石。

你对 SOA 有什么看法或经验？

## 分享这篇文章