# 以太坊:交易成本是如何计算的

> 原文:[https://www.sitepoint.com/ethereum-transaction-costs/](https://www.sitepoint.com/ethereum-transaction-costs/)

*这篇关于以太坊交易成本的文章最初发表在 [Bruno 的 Bitfalls 网站](https://bitfalls.com/2017/12/05/ethereum-gas-and-transaction-fees-explained/)，经允许在此转载。*

**发送比特币交易时，其费用与其规模成正比。[输入输出](https://bitfalls.com/2017/10/03/read-bitcoin-blockchain-data-blockexplorer/)越多，越贵。再加上[未决交易](https://blockchain.info/unconfirmed-transactions)的因素，仅基于这两个因素，交易费用就可能飙升。**

* * *

为了更好地理解我们将要提到的术语，建议你在开始阅读这篇文章的其余部分之前阅读以下材料。

*   [什么是加密货币？](https://bitfalls.com/2017/08/20/cryptocurrency/)
*   什么是区块链，它是如何工作的？
*   [以太坊是什么，和比特币有什么不同？](https://bitfalls.com/2017/09/19/what-ethereum-compare-to-bitcoin/)
*   [什么是挖矿，PoW 和 PoS 挖矿有什么区别？](https://bitfalls.com/2017/10/23/whats-the-difference-between-proof-of-work-pow-proof-of-stake-pos-and-delegated-pos/)

编程术语(变量、循环)的基础知识可能也会派上用场。

* * *

有了以太坊，假设我们谈论的是一种协议内的编程语言，那么用很少的文本或代码(这在 BTC 世界中是非常便宜的)就有可能计算量很大。让我们看看这个循环，例如:

```
while (i++ < 1000) {
    j = j + i;
} 
```

这个循环意味着“只要`i`小于 1000，就加 1，然后将`i`和`j`相加，并将结果写入`j`，然后重新做一遍。”如果`i`是 0，这个循环将执行 1000 次，如果是负数，将执行更多次。

为了以一种公平的方式支付这种计算成本——因为它必须在所有矿工的机器上同时执行，他们在这上面花费了他们的资源和时间——引入了**气体**的概念。天然气被用来支付 EVM 境内这些所谓的智能合同(以太坊计划)的执行费用。例如，上面的`i` + `j`是一个求和运算，每次执行都要花费 3 个 gas，那么执行 1000 次就是 3000 个 gas。

为了恰当地解释*气*，我们先来盖一下 *EVM* 。

## EVM

EVM 代表*以太坊虚拟机*。但是什么是虚拟机呢？

### 虚拟计算机

虚拟机是运行在特定计算机上的软件，它包含另一个完全封装在主计算机内部的操作系统。例如，虚拟机允许您在 Linux 中运行 Windows，在 Windows 中运行 Linux，在 macOS 上运行 Windows，如下图所示，或者任何其他组合。

![Windows inside macOS](../Images/3031304840a880d13e499ce2ddbee995.png)

我们使用虚拟机将我们日常使用计算机的环境与我们工作或编程的环境分开。这使我们能够阻止病毒(它们无法侵入虚拟机并进入主操作系统)，帮助防止无限循环使我们的主操作系统崩溃，并阻止像臭名昭著的 WannaCry 勒索软件这样的硬盘损坏。此外，例如，虚拟机让我们可以在 Linux 上使用 Windows 游戏，或者让我们可以轻松地在同一编程语言的不同版本的环境中编程，而不会混淆。

### EVM

以太坊虚拟机内置在基于以太坊协议运行的软件中。它执行智能合约——用 Solidity 语言编写的以太坊程序。EVM 包含在以太坊网络的[完整节点](https://bitfalls.com/2017/11/26/whats-bitcoin-node-mining-vs-validation/)中，在其中它执行这些以太坊用户编写的程序。

以太坊的任何[矿工](https://bitfalls.com/glossary/#mining)同时执行智能合约代码。这意味着以太坊程序(dapps——去中心化的应用程序)在每个人的电脑上同时执行(去中心化)。

然而，这些程序的执行不是免费的。矿工们花费自己的电力、时间和硬件来做这件事。为了支付他们执行计算机指令的努力(如“将值 5 存储到变量 X 中”)，引入了*气体*的概念。

## 气体、乙醚和 GWei

**Gas** 是计算机需要执行的特定操作的成本单位，当我们广播包含以太坊程序的事务以运行 *dapp* 时，它会执行该指令。例如，将两个数字相加需要 3 个汽油。把它们相乘要花 5 块钱。将一个 256 位的字存储到区块链需要 20000 汽油，这意味着存储 1kb 的数据需要 640000 汽油。

正如美元有分一样，以太也有自己的基本单位:卫。如果我们把卫作为以太的基本单位，我们得到下面的定义表:

| 单位 | 魏 |
| --- | --- |
| **魏** | one |
| 奎/阿达/妇女组织 | One |
| mwei /巴贝奇/微微醚 | 1.000.000 |
| gwei /香农/纳米醚/纳米 | 1.000.000.000 |
| szabo /微醚/微 | 1.000.000.000.000 |
| 芬尼/米利醚/米利 | 1.000.000.000.000.000 |
| **乙醚** | 1.000.000.000.000.000.000 |

*提示:使用[这个转换器](http://tools.bitfalls.com/eth/)在以太单元之间转换。*

根据[这个资讯网站](https://ethgasstation.info/)的报道，目前天然气的平均价格为 10 吉威(10 千兆威)。鉴于 1 GWei 是一个以太的十亿分之一，前面提到的存储一个 1kb 字的成本是 640000 * 10，也就是 640 万 GWei。这相当于 0.0064 eth，以每 eth 450 美元的价格计算，相当于大约 2.88 美元。

上表开头一直到`>>this specific marker<<`的文字都在 1kb 左右。因此，将这一小段文本存储到区块链实际上要花费 2.88 美元。然而，那只是存储成本！我们的智能合约也可以有一些逻辑，如求和或相乘，然后存储数字，或在特定的挖掘块上激活的触发器等。显然，将数据存储到区块链本身是非常昂贵的。存储在 BigchainDB 或 IPFS(T2)更好，而区块链是全球处理和验证数据的更好解决方案。

### 为什么是气体？

为什么直接用汽油而不是乙醚支付费用？

EVM 可以执行的所有可能操作的所有气体价格都硬编码在以太坊协议和我们与之连接的[客户端](https://www.ethereum.org/cli)(程序)中，如 Geth、eth、奇偶校验等。如果代码将它们列在 ether 中，那么我们必须在每次 ether 值波动时更新代码，以保持计算工作的价格在正常范围内，并保持系统可用，这显然是不可持续的。

通过在成本之上增加这一*气体*层，并使用 GWei 支付气体，我们可以选择改变交易中使用的气体量和支付的金额。它完全在我们的控制之下，不会让系统失去平衡。

这就把我们带到了最后一节。

### 限制/成本与价格

**汽油限额**是我们愿意在一次交易中花费的*最大汽油量*。我们用来广播以太坊交易的大多数软件都有能力自动估计执行一项功能所需的气体量。它通常会马上给出一个数字。例如，简单的货币 A- > B 交易通常只需要 21000 气。调用特定智能契约函数的更复杂的函数可能会运行几十万甚至几百万个 gas。消耗的天然气量称为**天然气成本**。

作为用户，我们可以修改我们希望在一个事务上花费的气体量并减少它，但是如果事务在执行过程中用完了气体，我们将丢失我们发送的气体。它已经被花了，交易被拒绝。另一方面，如果我们提供的天然气多于需求，剩余部分会退还给我们。因此，发送比执行事务所需更多的 gas 总是更好。

**天然气成本**是每单位天然气的 GWei 价格。

因此，以太坊交易的总成本实际上是必需的气体量乘以每气体单位的 GWei 价格。这是我们将支付的最大交易费；任何额外的汽油都会被退还，所以费用经常被大大高估。

让我们看一个例子。

![25 Gwei](../Images/b7d9e4df1abc20b08fc8a20bcc5ec5d0.png)

在上图中，我们正在执行一个事务，由于其复杂性，估计需要 135963 gas。对于 25 GWei 的价格，我们将支付的最大交易费是 1.57 美元，这在我们发送的总额中是微不足道的(0.38 eth = 178 美元)。如果我们将天然气价格提高到 250 GWei，交易成本将相应增加:

![250 GWei](../Images/a8e9d730fa853f97ab2324f18b8f073e.png)

较高的交易费用有效地鼓励了矿商在队列中其他人之前处理我们的交易，从而加快了执行速度。如果我们不着急，我们可以让油价保持在起始价，交易的确认不会超过 10 分钟。但是，如果我们很急，想要在几秒钟内完成(例如，如果我们正在处理一场拍卖)，很容易提高油价，牺牲一些钱来保证成功。

## 结论

Gas 是以太坊虚拟机中每个计算操作消耗的工作单位。它是用以太支付的，以太坊协议的令牌，每个计算操作都有不同的气体成本。天然气价格(GWei 或十亿分之一乙醚)根据网络拥塞和用户对快速确认的偏好而变化。

对于我们想要在以太坊网络上部署的智能合同，两个术语是重要的:气体限制和气体价格。汽油限额是我们在执行交易时愿意花费的最大汽油量。实际需要的天然气量(只有在交易执行后才知道)称为*天然气成本*。气价是每单位气体的价格，用 GWei(或十亿分之一乙醚)表示。交易的总费用将是气费和气价的乘积，而最大交易费将是气限和气价的乘积。差额将退还给交易的发送方，以保持系统的公平性和可用性。

## 分享这篇文章