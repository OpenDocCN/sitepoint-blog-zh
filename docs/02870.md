# 清理 CSS 代码库

> 原文:[https://www.sitepoint.com/cleaning-up-a-css-codebase/](https://www.sitepoint.com/cleaning-up-a-css-codebase/)

你刚刚被安排到一个现有的项目中，接替一名离职的开发人员。或者你刚刚打开了几年前的旧项目。当你看到这些代码时，你会感到恐惧和害怕。你只能做一件事:收拾这个烂摊子！你听起来熟悉吗？当然有，我们都会在某个时候遇到这种情况。

你知道清理 CSS 代码库将是一项艰巨的任务。有这么多事情要做，时间却这么少——尤其是当客户/老板/同事提倡老话“不要修理没坏的东西”时。你真的不知道从哪里开始！

你很幸运，因为我已经完成了我的 CSS 清理工作，我在这里给你一些开始做这件事的提示。一切都是为了抓住垂手可得的果实。

## 该死的棉绒

在本节中，我将假设您的代码库使用 [Sass](http://sass-lang.com) 。不仅仅是因为现在这是一个合理的假设，还因为我注意到 Sass 的不良使用通常是混乱的代码库的部分原因。尽管如此，即使您没有使用预处理器，这篇文章也可能与您相关，所以请多包涵。

当我需要接管代码库时，我喜欢做的第一件事就是 lint it。林挺是运行一个寻找潜在错误和不良实践的程序的过程。我相信让代码变干净是让代码变好的第一步。[这里有一个关于“lint”一词词源的颇有见地的堆栈溢出线程](http://stackoverflow.com/questions/8503559/what-is-linting)。

萨斯有一个基于红宝石的棉绒，叫做 [SCSS 棉绒](https://github.com/brigade/scss-lint)。你可以自己配置或者从 Sass-Guidelines 获取推荐的配置文件[来立即开始。还有一个 Node.js 版本叫做](http://sass-guidelin.es/#scss-lint) [Sass-lint](https://github.com/sasstools/sass-lint) ，虽然它们不是 100%互操作的，所以你的里程数可能会有所不同。

试着在你的 Sass 文件夹上运行 Sass 林特来检查错误。很有可能你会被一大堆错误淹没。这通常是你想要放弃的时候。但是请容忍我！在这一点上，你可以尝试使你的林挺文件在你并不真正关心的规则(如颜色格式)方面不那么严格，或者你可以预先解决这个问题并从中摆脱出来！

## 修复发现的林挺错误

是时候解决需要解决的问题了。有两种方法可以做到这一点。第一种方法是一个接一个地检查文件，更新看起来错误和/或奇怪的内容，比如糟糕的命名约定、嵌套过深的选择器、格式不良的代码等。第二个(也是我最喜欢的)方法是从一点搜索和替换开始。我不知道你怎么想，但是我喜欢正则表达式，所以当我不得不这么做的时候总是很有趣。

例如，假设您想要在所有浮点数(即 0 到 1 之间的数值)前面添加缺失的前导零——SCSS-林特公司的[前导零](https://github.com/brigade/scss-lint/blob/master/lib/scss_lint/linter/README.md#leadingzero)规则。你可以搜索`\s+\.(\d+)`(所有跟在一个空格和一个点后面的数字)，替换为`\ 0.$1`(一个空格，一个零，一个点，找到的数字)。或者，如果您想遵守 SCSS-林特的 [BorderZero](https://github.com/brigade/scss-lint/blob/master/lib/scss_lint/linter/README.md#borderzero) 规则，您可以在 IDE 中将`border: none`替换为`border: 0`。简单的像馅饼！

我最近在 GitHub 上启动了 scss-lint-regex 存储库，将这些正则表达式收集在一个地方。如果你正在为林挺的一个大项目而奋斗，一定要去看一看。也要小心搜索和替换，因为它有时会有意想不到的副作用。每次替换之后，一定要执行一个`git diff`来检查更新了什么，这样你就可以确保你没有引入一个 bug。

一旦你完成了横向编辑，你将无法逃脱手动文件抓取来清理所有需要清理的东西(糟糕的缩进，缺少或额外的空行，缺少空格等)。).这需要很多时间，但对下一步会有很大帮助，所以从这点开始很重要。

## 修改结构

当我加入一个现有的项目时，我经常发现令人不安的是缺乏适当的项目架构。在最开始的时候可能有一个，但是事情通常会失去控制，这个简单的方法论的想法在过程中的某个地方丢失了。然而，这非常重要。

只要你觉得舒服并坚持下去，你选择哪种方法并不重要。可能是 [SMACSS](https://smacss.com/) ，可能是 [7-1](http://sass-guidelin.es/#the-7-1-pattern) ，可能是[ITCSS](https://speakerdeck.com/dafed/managing-css-projects-with-itcss)——随你挑！然后尝试重新构建，使代码符合所选择的方法。我主要使用 Sass 指南中介绍的 7-1 模式，所以如果您决定走这条路，我会给你一些提示来改进。

从 [*供应商*文件夹](http://sass-guidelin.es/#vendors-folder)开始，因为它是不问问题的那个。将任何未打包的第三方库移动到那里(也就是说，任何没有通过 [npm](https://www.npmjs.com/) 或 [Bundler](http://bundler.io/) 被视为常规依赖的库)。

然后，移动到 [*摘要*文件夹](http://sass-guidelin.es/#utils-folder)。确保项目的所有变量、混合、函数和占位符都在这里定义。在这里，只要不在代码库的所有文件中出现变量和混合，就可以随意组织它。我也倾向于在那时寻找不必要的变量(和混合变量)。事实上，我经常发现无数的变量只使用一次或两次(换句话说，不值得)。

一旦你完成了，这是你的电话。你可以试着确保 [*基本*文件夹](http://sass-guidelin.es/#base-folder)中的所有东西实际上都是基本的东西，而不是组件相关的，或者你可以查看一下 [*布局*文件夹](http://sass-guidelin.es/#layout-folder)以检查关于整体布局的所有东西是否都在那里，并且是否被正确记录。

最后，你将不得不处理 [*组件*](http://sass-guidelin.es/#components-folder) ，这可能是一项艰巨的任务。我在这里的建议是，尽量让组件变得小，尽可能地可重用。只要你能使它们不依赖于上下文，并且易于阅读、理解和更新，那么数量翻倍也没关系。

例如，拥有如此小的组件并不是一件坏事:

```
.quote {
  padding: 10px;
}

.quote__attribution {
  font-size: 80%;
}

.quote > :first-child {
  margin-top: 0;
}

.quote > :last-child {
  margin-bottom: 0;
}
```

模块化思考。小。简单。独立。

## 去除多余的

我认为好的和坏的 CSS 之间的最大区别是使它工作所需的代码量。CSS 作为一种语言是很容易掌握的。任何人都可以通过一点点的尝试和错误做出几乎所有的布局。然而，能够用最少的 CSS 构建一些东西并保持这种方式是一个真正的挑战。

已经过去 3 年多了，但是尼古拉斯·加拉格尔的这条推文仍然是我最喜欢引用的关于 CSS 的话:

> 在“坏”的 CSS 中，很难写出“好”的 CSS。在“好的”CSS 中，很容易附加上“坏的”CSS 并引发代码腐烂。
> 
> ——尼古拉斯(@ neco las)[2012 年 9 月 26 日](https://twitter.com/necolas/status/251089236873338881)