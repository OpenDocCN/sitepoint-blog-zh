# OAuth 解释道:Foursquare 的一个简短案例研究

> 原文:[https://www.sitepoint.com/oauth-explained-with-foursquar/](https://www.sitepoint.com/oauth-explained-with-foursquar/)

作为当今的开发人员，无论是 web、电话、桌面还是小部件，您几乎肯定遇到过将您的工作链接到某种 API 的需求。这里可能是一个 cURL 请求，或者那里是一些 XML 或 JSON 共同点是访问受限材料的一般方法是通过提供用户名和密码以及对 API 的每次调用来请求它。这意味着对特定 API 的每个交互都会传递您的详细信息。它们通常以某种方式加密，但总的来说，就理想的安全实践而言，这并不理想。此外，要求将细节记录在某个地方会使它们变得潜在脆弱。

OAuth 是一个相对较新的开放认证协议，它允许安全的 API 通信，而不需要在每个请求中不断传递用户名和密码。OAuth 的想法是由一群致力于 OpenID 的 Twitter 实现的人在 2006 年提出的。在回顾了 OpenID 和其他现有的行业实践(如 Amazon Web Services API 和 Flickr API)之后，决定为应用程序身份验证编写一个新的开放协议提案。在谷歌的支持下，该运动迅速壮大，并于 2007 年 7 月起草了初始规范。今天，我们发现自己正在使用 OAuth Core 1.0a，新的 2.0 规范正在起草中。

## 它是如何工作的？

这里有一个真实世界的例子——一个你可能已经遇到过甚至不知道的例子。

让我们沿着 OAuth 的路径来看看 [foursquare](http://foursquare.com/) 是如何代表你发送推文的:

*   foursquare 最初向 Twitter 注册了一个“应用程序”。在这样做的过程中，他们被提供了一个名为“消费者密钥”的令牌集及其配对的“消费者密钥秘密”foursquare 在它们的应用程序代码中使用它们，并作为 OAuth 模型的一部分来生成请求。
*   从用户的角度来看，当你登录 foursquare 并点击“请链接我的 Twitter 账户”按钮时，foursquare 使用其消费者密钥联系 Twitter 并生成一个“请求令牌”。然后你会得到一个特殊的网址，把你带到 Twitter 的网站。
*   如果您还没有登录 Twitter，系统会像往常一样提示您登录，然后会出现一个屏幕，询问您是否愿意让该应用程序访问您的帐户。
*   点击“允许”告诉 Twitter，这个使用其特定消费者密钥请求访问的应用程序(foursquare)应该可以访问您的 Twitter 帐户。然后 Twitter 会用一个附加的编码验证字符串将你重定向回你的应用程序(foursquare 网站)。
*   然后，foursquare 应用程序读取之前生成的请求令牌，并接受返回的验证来请求 Twitter 生成最终的令牌集，称为“访问令牌”和“访问令牌秘密”。
*   现在，当你在 foursquare 上执行一个动作并被发布到 Twitter 上时，foursquare 会调用 Twitter API，方法是使用 Twitter 提供的消费者密钥和新存储的帐户访问令牌创建一个请求。

在所有这一切中，你的 Twitter 用户名和密码永远不会被 foursquare 看到，更不用说存储了。

顺便说一下，我发现的这个过程的最好的图形表示是由 Digg 在这里记录的。

## 我该如何实施？

随着所有这些关于代币和秘密的讨论不断出现，你可能会发现自己一脸茫然。令牌是如何生成的以及以什么样的顺序生成的，这看起来非常令人望而生畏。幸运的是，OAuth 和其他人已经构建了大量的工具、类和简单的代码，可用于各种语言。OAuth 通过他们的网站提供了一个很好的资源列表。

## 目前谁在使用它？

自从 OAuth 的概念提出以来，它已经被主流 web 服务广泛采用。Twitter 是该协议最大的支持者之一，它不仅将 OAuth 实现为其主要的(很快将成为唯一的)API 认证方法，还将其作为其“使用 Twitter 登录”服务的基础。今天，你还会发现雅虎、Vimeo、Digg 和许多其他公司使用的协议。

对于那些对更精细的工作方式感兴趣的人来说，有大量的[文章](http://en.wikipedia.org/wiki/Openid#See_also)和[规范文档](http://tools.ietf.org/html/rfc5849)详细介绍了协议如何通信

## 分享这篇文章