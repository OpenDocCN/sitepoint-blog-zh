# JavaScript 中的高性能字符串连接

> 原文：<https://www.sitepoint.com/javascript-fast-string-concatenation/>

串联，或连接字符串，是任何编程语言中的一个重要工具。这在 web 应用程序中尤其重要，因为字符串通常用于生成 HTML 输出。一些语言提供了快速的字符串处理类，比如。NET 和 Java 中的 StringBuffer/StringBuilder。

在 JavaScript 中有多种连接字符串的方法:

```
 str = "a" + "b";
str += "c";
str = str.concat("d", "e"); 
```

您也可以连接字符串数组:

```
 str = ["a", "b", "c", "d", "e"].join(""); 
```

如果你只是连接几个字符串，你应该使用最实用的方法。在所有浏览器中，性能的提高或降低都可以忽略不计。

## 串联许多字符串

考虑以下功能相同的示例。第一个使用字符串串联运算符:

```
 // standard string append
var str = "";
for (var i = 30000; i > 0; i--) {
	str += "String concatenation. ";
} 
```

第二个使用数组连接:

```
 // array join
var str = "", sArr = [];
for (var i = 30000; i > 0; i--) {
	sArr[i] = "String concatenation. ";
}
str = sArr.join(""); 
```

哪个会执行得最快？

一些开发人员会认为串联运算符更快，因为它使用的代码更少，并且不需要双倍内存需求的数组。对于其他人来说，传统观点认为数组连接更快——在 JavaScript 解释器中内存效率更高。

事实要复杂得多。在所有最新的浏览器中，这两种方法都很快，在一台中档电脑上只需 80 毫秒就能完成。以下是我自己完全不科学的基准测试的结果:

*   Chrome 6.0 :标准的字符串追加通常比数组连接更快，但都在 10 毫秒内完成。
*   Opera 10.6 :同样，标准追加更快，但是差别很小——通常是 15 毫秒，相比之下数组连接是 17 毫秒。
*   Firefox 3.6 :浏览器通常需要 30 毫秒左右。数组连接通常有边缘，但只有几毫秒。
*   IE 8.0 :标准的追加需要 30 毫秒，而数组连接需要两倍多的时间——通常是 70 毫秒。
*   Safari 5.0.1 :奇怪的是，一个标准的追加不超过 5 毫秒，但是一个数组连接要慢十倍以上，为 55 毫秒。

最新的 JavaScript 引擎针对字符串连接操作符进行了优化。阵列连接仍然很快，但是性能没有提高。

## 美中不足的是

IE7 是世界上第三大最常用的浏览器，占有 14%的市场份额。IE6 又占了 8%。如果您已经放弃了对这些老化应用程序的支持，就没有必要继续阅读了。

还在吗？这是令人震惊的:IE7 和以下版本使用串联处理程序重复复制字符串，导致时间和内存使用呈指数增长。使用串联运算符的代码需要大约 2.5 分钟(150，000 毫秒)来执行，并且浏览器始终没有响应。相比之下，阵列连接在不到 200 毫秒的时间内完成，快了 800 多倍。

如果您支持 IE7，数组连接仍然是连接大量字符串的最佳方法。

*PHP 呢？请尽快收听测试结果……*

## 分享这篇文章