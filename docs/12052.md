# 使用验证码之前要检查的 10 件事

> 原文:[https://www.sitepoint.com/captcha-alternatives/](https://www.sitepoint.com/captcha-alternatives/)

![Spam bot](../Images/414b382e89183c27349ef2de95e831f7.png "Spam bot") [所有的验证码系统都注定失败](https://www.sitepoint.com/avoid-captchas/)。不幸的是，这并没有阻止热切的开发者在最基本的网络电子邮件表单中使用验证码。

没有人喜欢验证码。他们不好玩。并非每个人都可以使用它们，例如视力受损或没有图形功能的人。他们减缓了注册过程，最终，他们将导致更少的*真实*注册。

验证码最大的问题是它们把责任推给了用户。用户不在乎你是否收到了成千上万的垃圾短信或虚假账户:那是你的问题。验证码应该是最后一道防线，而不是第一道。

绝大多数黑客企图和僵尸程序都可以在不求助于验证码的情况下被阻止。如果你使它变得适度困难，垃圾邮件发送者将简单地转移到下一个更容易的目标。这里有一些基本的技术，将停止大多数的欺骗企图。

## 1.验证服务器端的一切

您需要使用服务器端代码验证每个字段——即使您有强大的客户端验证。特别小心电子邮件标题中的字段。电子邮件地址可能是需要检查的最重要的值:使用一个好的正则表达式，并注意 HTML 标记、SQL 注入或返回字符(PHP 中的 n 和 r)。

## 2.检查类似垃圾邮件的内容

大多数垃圾邮件发送者会发布网站链接。如果这不是你所期望的，这可能意味着垃圾邮件机器人。第三方工具如 [Akismet](http://akismet.com/) 可能会有所帮助。

## 3.检查恶意发布并获取值

如果您的表单需要三个 POSTed 字段，那么第四个字段的存在可能表明有黑客企图。类似地，检查没有传递额外的 GET 值。

## 4.检查 HTTP 头

更简单的垃圾邮件僵尸工具很少会设置用户代理(HTTP_USER_AGENT)或引用页面(HTTP_REFERER)。您当然应该确保 referrer 是您的表单所在的页面。

## 5.使用蜜罐领域

垃圾邮件程序通常会尝试完成每个表单域，以便通过基本验证。蜜罐字段是对用户隐藏的字段(CSS `display`设置为 none)，因此传回的任何值都可能来自机器人。该字段应被标记为“请留空”或类似的帐户与 CSS 禁用或使用自定义样式表。

## 6.检测 JavaScript 是否存在

如果您的页面可以运行 JavaScript，您几乎可以肯定它已经被人类用户加载到浏览器中。一个简单的页面内动态生成的 JavaScript 函数可以执行简单的计算，或者为发布的数据创建校验和。这可以以表单值的形式传递回来进行验证。

估计有 10%的人禁用了 JavaScript，因此在这种情况下有必要做进一步的检查。

## 7.显示验证页面或第一次发布尝试失败

机器人很难对服务器的响应做出反应。如果你对帖子的有效性有任何疑问，显示一个中间页面，要求用户确认他们的数据，然后再次点击提交。

## 8.记录用户响应的时间

解释人类行为是识别机器人的最佳方式之一。用户需要一点时间来完成表格，而机器人几乎是瞬间完成的。我以多种形式使用下面的方法，它一直很有效:

1.  当生成表单页面时，记录当前服务器时间。
2.  时间值被编码成一个字符串。实际的编码算法由您决定，但它必须是不明显的，并允许解码回原始值。我还建议使用唯一的用户数据，比如 IP 地址，作为加密密钥。
3.  编码的时间放在一个隐藏的表单值中。
4.  当表单被回发时，该字段被检查并解码回一个时间。现在可以将其与当前服务器时间进行比较，以确保响应时间落在特定窗口内，例如在 20 秒和 20 分钟之间。

这个过程有几个好处:它不依赖于客户端技术，时间值必须在返回的数据中，即使您的表单是伪造的，它也限制了可以发送的伪造提交的数量。

## 9.记录一切

记录表单提交过程中发生的所有事情。这不必是一个优雅的解决方案；写入文件就足够了。您收集的信息在发现黑客企图和实施解决方案时将是无价的。

## 10.处理极端情况

对于合法用户来说，上面的一些技术将会失败，例如检查 JavaScript 或 HTTP 头。它只可能影响一小部分用户，所以验证码*可以在这些情况下使用*。

或者，如果对少数用户的数据有效性有任何疑问，您可以在流程中添加人工验证。确保操作简单，即向管理员发送电子邮件，只有在收到回复后才接受帖子。

验证码对于可能导致重大金钱损失或成为非法活动明显目标的网站(如网上银行和网络邮件)来说是必不可少的。然而，它们对大多数形式来说都是多余的:技术的结合将阻止大多数机器人，而不会使真实用户的注册变得困难。

## 分享这篇文章