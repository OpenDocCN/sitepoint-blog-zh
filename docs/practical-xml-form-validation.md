# 实用 XML:表单验证

> 原文：<https://www.sitepoint.com/practical-xml-form-validation/>

我喜欢 XML。真的。尽管如此，当我听到它有多棒的时候，我的眼睛还是和其他人一样呆滞。这可能很奇妙，但是作为一名 Web 开发人员，XML 对我有什么帮助呢？

我在自己的网站上使用 XHTML，但这并没有提供任何比使用 HTML 更好的优势。我有 RSS 聚合功能，但这让我的读者受益，而不是我。

自私的时候到了。是时候问“XML 如何帮助我了？我该如何使用它来使构建网页变得更容易？”

##### 这个概念

当我构建网页时，有一个地方总是让我很恼火，那就是表单验证。即使您开发了用于页面验证的函数库，每当您构建新表单时，您都需要创建一个新的外部 JavaScript 文件并设置适当的变量，或者将它们包含在页面本身中。它可以而且应该做得更好。

SitePoint 已经发表了几篇关于用 JavaScript 加载 XML 文件的文章([Read and Display Server-Side XML with JavaScript](https://www.sitepoint.com/blog/)and[XML and JavaScript in Mozilla](https://www.sitepoint.com/article/xml-javascript-mozilla))，但是没有一篇详细介绍了该技术的实际优势。我认为它非常适合提供无缝 Web 表单验证的任务。

这个想法是，我们可以创建一个 XML 词汇表，上传这些特殊的 XML 文件来指定我们对表单施加的约束，而不必在外部 JavaScript 文件中包含这些混乱的变量。

##### 戒律

在构建 XML 词汇表时，我喜欢记住一些规则。词汇应该是:

*   简单的
*   容易理解
*   简明的

这些概念之间有相当多的重叠，但我觉得它们都很重要，足以单独表达。词汇表应该简单，以便于创建和解析。它应该是容易理解的，这样任何不熟悉它的人都可以看到它，并且至少对它做了一个有根据的猜测。它应该简洁，以减少不必要的打字和印刷错误。

在设计 JavaScripts 时，我试图记住的最重要的考虑是不引人注目的 DHTML。您应该能够将外部 JavaScript 文件链接到您的页面，并让它工作。这对页面作者来说更容易，他们不需要在页面上添加东西，也鼓励作者构建不启用 JavaScript 也能正常工作的页面——这是一个全面的胜利。

##### XML

当我开始设计 XML 格式时，我特别决定选择简单性而不是易懂性。因此，在本例中，您不会发现不同表单域一起工作的有效性，例如在日期中。除了最常见的文本输入之外，该格式也不支持表单控件。这些是将来对脚本进行扩展的明确可能性，但是为了简单起见，它们现在已经被排除了。出于类似的原因，只为每页一个表单提供验证支持。

为了让 JavaScript 知道要挂钩到哪个表单，以便能够劫持表单提交事件，根元素`<form>`具有属性`id`。在`<form>`标签内是一连串的`<element>`标签，每个标签指定一个文本输入的规则。

有两种类型的`<element>`标签。一种类型具有属性`sameas`，该属性被设置为等于另一个`<element>`的 id。这用于指定元素是确认值，例如确认密码或电子邮件地址。

另一个主要的类型`<element>`有一系列的属性。属性是一个指向表单元素的指针，它为表单元素指定了规则，并且是必需的。另一个必需的属性是`name`属性，用于自动生成错误消息。

可选属性是`min`，指定最小字符数，以及`max`，指定最大字符数。省略任何一个都不会限制字符的上限或下限。省略这两者意味着输入可以包含任意数量的字符。另一个可选属性是`req`，设置为 true 或 false，指定输入是否必须填写。

在`<element>`标签中，可以输入一系列 0 个或更多的`<regex>`标签，指定输入必须匹配至少一个的模式。如果字段中的文本不匹配任何模式，那么`<error>`元素(也是`<element>`标签的子元素)的内容将指定要使用的错误消息。对于其他情况，JavaScript 会自动生成错误消息。

##### JavaScript

我不想详细描述这个脚本，因为这是多余的信息，令人厌烦，而且与导入 XML 相关的所有部分已经在别处讨论过了。查看示例—所有文件都可以在此处下载[。](https://www.sitepoint.com/examples/xmlvalidation/xmlvalidation.zip)

实际上，这个脚本检查浏览器是否能够处理 XML 文件的导入。如果可以，它导入 XML，然后执行另一个函数来解析新导入的 XML。如果它不能处理 XML 文件的导入，函数返回，浏览器不做任何事情。

为了找到要导入的 xml 文件的文件名，JavaScript 获取当前页面的 URL，并用. XML 替换当前文件扩展名。因此，如果您的页面名为 myform.xml，那么相关的 XML 文件应该名为 myform.xml

如果浏览器导入了 XML，它现在会获取所有的`<element>`标签并创建一个`ElementValidator`对象的数组，这些对象的节点作为其构造函数的一部分。我选择使用对象而不是函数和数组，因为我觉得对象更适合验证器包含的各种数据，并且使用方法而不是外部函数使全局名称空间更干净。从概念上讲，让一个元素知道如何检查自己更有意义。

当一个验证器被创建时，它对应的元素被赋予一个`onblur`函数，一旦用户停止工作并把注意力转移到其他地方，这个函数就检查它的有效性。这意味着，如果用户输入的内容有误，他们会得到即时反馈。为了改善给用户的反馈，错误类被添加到不正确的表单输入的父类中，文本被插入到文档中，并解释用户做错了什么。这是以[卡尔西咨询公司的简化形式错误](http://kalsey.com/simplified/form_errors/)的方式完成的。

当表单被提交时，一个 JavaScript 函数运行所有的验证器对象，让它们检查它们的有效性。如果有任何对象无效，表单提交就会停止，用户会看到一个警告框，要求他们检查输入的内容。

当然，如果用户禁用了 JavaScript，或者没有使用 Mozilla 或 Internet Explorer 版本 5 或更高版本，他们不会立即看到任何错误消息，而必须等待服务器将错误返回给他们。

##### 结论

现在，您有了它——一种快速简单的方法来使 XML 符合要求，并让它帮助您。这是在页面中插入表单验证的一种有用而快速的方法。也许这足以让我停止逃避，在自己的网站上使用表单验证。世事难料。

这种方法的优缺点是什么？

在我看来，这些优势是:

*   不引人注目的–除了插入 JavaScript 和一些 id 之外，不需要改变页面的结构。
*   **易于更改**–如果您发现某些验证中有错误，或者意识到以前不需要验证的内容现在需要验证，您可以快速更新您的 XML 文件并将其再次上传到您的网站。
*   **用户友好**–当用户在表单域中输入错误的值时，他们会立即得到明显的通知。

缺点是:

*   **兼容性**—目前，这段代码只能在 IE 5+和 Mozilla 中运行。
*   **有限的**–为了简单起见，这个解决方案目前只支持文本输入。当然，如果愿意，任何人都可以自由地将当前的脚本扩展到更复杂的表单验证例程。

我希望我已经扩展了您的视野，让您了解了使用 XML 来改进 Web 页面的可能性——或者，至少，我已经为您提供了一个整洁的新表单验证技巧，可以添加到工具箱中。

***致谢***

Peter-Paul Koch 的 [Import XML page](http://www.quirksmode.org/dom/importxml.html) 对于提供一个只需要轻微修改的工作脚本非常有帮助。

Scott Andrew 的 [addEvent 函数](http://www.scottandrew.com/weblog/jsjunk#events)(通过 [Simon](http://simon.incutio.com/) 找到)同样有助于加快进度。

最后，当我挣扎于 Mozilla 和 Internet Explorer 中不同的事件模型时，麦克·豪尔的 [DHTML 事件页面](http://brainjar.com/dhtml/events/)拯救了我的理智。

## 分享这篇文章