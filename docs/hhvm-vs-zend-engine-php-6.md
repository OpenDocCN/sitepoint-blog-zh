# PHP 6 中的 HHVM vs Zend 引擎

> 原文：<https://www.sitepoint.com/hhvm-vs-zend-engine-php-6/>

![](img/4dbf851ecae4480c126714f2b37c1012.png)

传说中的 PHP 6 姗姗来迟。这个 web 开发世界的独角兽已经“出现”了几十年，现在还不清楚它是否真的会在这十年发生，或者只是一个想法，PHP 用户群的幻想。像 5.4 > 5.5 和 5.5 > 5.6 这样的次要版本带来了[这么多新功能](https://www.sitepoint.com/new-features-php-5-6/)这些天无论如何，我们经常把它们视为主要版本。

我个人对 v6 的幻想是函数命名的一致性，在全局命名空间污染方面彻底打破与 PHP <6 的向后兼容性，以及将所有数据类型完全重写为类，就像在 Scala 或 Dart 中一样，但是，嘿，我们都有自己疯狂的梦想。

想看一篇关于 PHP 6 不幸命运的好文章，请点击[这里](http://philsturgeon.co.uk/blog/2013/01/php-6-pissing-in-the-wind)——确保不要跳过评论。这里有一些关于核心 PHP 开发人员态度的有价值的经验。

## 承诺

没有多少人知道这一点，但是 http://www.phpclasses.org 经常有一些有趣的，虽然很尴尬的播客。有时候很难从这些谈话中筛选出有用的信息，但是 Manuel 的*目录*通常会有所帮助。如果你对 PHP 的变化很好奇，想了解最新的新闻，为什么不在锻炼、编码、烹饪或做其他事情的时候启动它呢？在曼努埃尔·莱默斯和塞萨尔·罗达斯的[最新版](http://www.phpclasses.org/blog/post/225-Is-Facebook-HHVM-going-to-Replace-Zend-Engine-in-PHP-6--Lately-in-PHP-podcast-episode-43.html)中，一个有趣的话题出现了——脸书的 [HHVM](https://www.sitepoint.com/hhvm-revisited/) 取代了 PHP 6 中的 Zend 引擎。

尽管这纯粹是参与者的猜测，不管你是否相信 PHP 6，你必须承认这是一个有趣的想法。正如我们在 [HHVM](https://www.sitepoint.com/hhvm-revisited/) 的文章和 [HHVM 的博客](http://hhvm.com)中看到的，HHVM 在兼容大多数流行的库、CMS 和框架方面已经取得了长足的进步。该团队正在尽可能地提高性能，同时保持它与各种产品的现有代码库兼容。让我们考虑一下 HHVM 在 PHP 6 中取代 ZE 的可能性，看看利弊。

## 赞成者

很明显，性能。HHVM 比普通 PHP 快得多，即使在 5.5 中内置了默认的 OpCache。它使用*更少*的资源来做*更快*的事情。人们不可能看不到这一点的优势——如果你愿意的话，只需考虑云部署费用的节省。更少的 CPU 和 RAM 使用意味着更少的实例时间。

下一个优势是 HHVM 得到了脸书的支持。脸书使用 HHVM 部署他们自己的 PHP 代码，所以他们需要确保它尽可能高效。1%的 CPU 峰值对他们来说意味着数万美元的支出，因此他们宁愿将这笔钱扔给 HHVM 团队以确保这种情况永远不会发生，这是很自然的。因此，开发 HHVM 的人比 Zend Engine 和 PHP 的实际核心开发人员更有经验和专注——尤其是在当今高并发高流量的世界。作为一个例子，考虑这样一个事实，脸书在 PHP 主流版本发布前三年就有了生成器。

另一个优势是能够通过他们内部开发的黑客“语言”静态输入最新版本的 HHVM。Hack 是 PHP 的衍生物，但是支持静态类型。您用`<?hh`而不是`<?php`开始您想要在编译前进行类型检查的文件，编译器会完成剩下的工作。一篇关于 Hack 的更详细的文章正在编写中，将很快发表。这种方法进一步提高了编译的质量，使得本地代码更高效，HHVM 的 PHP 也更快。

然而，这真的与速度有关吗？

## 坏处

目前 HHVM 的主要缺点之一是无法安装依赖 Zend Engine 的定制扩展。正如塞萨尔所说——HHVM 和泽就像两辆看起来很像的车，但它们的内部结构完全不同。

我会扩展这个比喻，说两辆车有不同的引擎，或者不同的换档系统。试图将一氧化二氮安装到电动汽车上根本行不通，无论你如何努力，因为一氧化氮依赖于燃烧过程，而电动汽车不存在这一过程。

不幸的是，这意味着今天的大多数扩展除非被转换，否则无法在 HHVM 上安装，而且由于大多数扩展都是开源项目，开发人员得不到报酬，这种情况很可能会引发 Python3-hell*。

另一个缺点也是我们在优点下面列出的那个缺点——它是由脸书开发的。虽然脸书目前仍然健康，但塞萨尔和曼努埃尔推测，它在未来几年可能会走下坡路，我倾向于同意这一观点。此外，脸书有可能大胆尝试完全从 PHP 转向更快、更结构化的东西，如 Dart——如果这两种情况发生，会发生什么呢？HHVM 是开源的，没错，但是没有脸书的银行和经验丰富的幕后推手，没有数十亿的用户基础来定期测试和基准，HHVM 的发展将会大幅放缓。开源社区只是缺乏专业知识、资源和奉献精神来恰当地接管。

最后但同样重要的是，已经有人在努力通过其他方式来大幅提高 PHP 的速度。我们已经广泛介绍过的 Phalcon 框架已经用 C 语言编写，速度快得惊人，使用 Zephir 语言，用户可以很容易地为 PHP 的 Zend 引擎版本编写实际的 PHP 扩展。这意味着闭源和/或编译的 PHP 应用程序已经以接近本地的速度运行，几乎可以与 HHVM 匹敌。

## 结论

这里没有明确的获胜方案。如果 HHVM 取代了 ZE，PHP 社区将会受益，尽管新版本可能会在用户规模上受到影响，直到 HHVM 能够支持通用扩展，或者为它重写扩展。如果它仍然是一个独立的项目，我们有两种想法——依靠香草 HHVM 和 Hack 将我们的框架和类编译成尽可能最好的本机代码，或者依靠优秀的旧 ZE PHP，我们的旧扩展，并使用尖端的语言和框架，如 Phalcon 和 Zephir。

无论你怎么看，很明显 PHP 已经准备好迎接新的黎明了。类似于其他主流语言的可变函数支持和参数解包的出现证明了它的成熟，高质量低级开发人员的出色工作推动了该语言及其运行时前所未有的发展。对于我们这些 PHP 用户来说，输掉这个游戏的唯一方法就是根本不玩它。

我们不要丢下任何人。有 HHVM/哈克和/或费尔康/泽菲尔的教程吗？把它们扔给我们。

**Python3-hell 指的是 Python3 已经问世超过 3 年，是 Python2 的一个改进，但与 Python2 相比，Python3 仍然很少被采用。*

## 分享这篇文章