# 结对编程:好处、技巧和建议

> 原文：<https://www.sitepoint.com/pair-programming-guide/>

成对编程——一对大于其各部分之和。你可能听说过结对编程，想知道在你的工作场所是否值得一试。从表面上看，这听起来很简单，但是两个开发人员坐在一起并不是实现高效结对的全部条件。

诸如日程安排、工具选择和分心等后勤和个人障碍会阻止你充分利用配对。但是潜在的优势可以让我们认识到并克服这些挑战是值得的。

## 为什么配对？

让两个以前从事不同项目的程序员在一个项目中一起工作，如何能更有效率呢？不是什么都要花两倍的时间吗？对于一个局外人来说，结对的想法一开始听起来可能会适得其反，但是当你开始思考我们为什么编码以及我们试图完成什么时，优势就变得明显了。

编程不是在最短的时间内写出最多的代码，甚至不是在越来越紧的期限内交付最多的功能。您可以让工程师们夜以继日地工作，将新功能推向生产，但是如果这些功能是由个人根据他们对整体架构的独特理解独立完成的，他们的工作效率会有多高呢？最终的代码很可能充满了技术债务，如隐藏的错误、性能问题、特殊的语法和低效的设计，这些设计可能无法有效地使用资源，并且当其中一个缺陷出现时，可能会使修改代码变得更加困难和耗时。

你需要你的代码有意义，写得好，这样它才能无缝地协同工作，并且可以很容易地修改。您需要它来封装所需的功能，以便您的最终产品能够正常工作并按预期执行。您需要它具有弹性，以便它能够承受组织变化(这是合作的自然组成部分)，以及环境变化和新的客户期望，这些变化和期望可能会在没有太多警告的情况下使当今可行的解决方案过时。

为了使这成为可能，开发人员需要能够清楚地就基本需求达成一致，快速掌握可能需要的任何新的或现有的技术，并不间断地专注于测试创造性的解决方案和开发值得提供给客户的产品。

结对编程有助于解决这些现实世界中的挑战。当两个开发人员成对一起工作时，他们产生的代码质量会随着他们对代码如何工作的共同理解而提高。这使得下一个阅读代码的人更容易捡起代码并在必要时修改它，并且减少了团队中唯一知道部分代码如何工作的人可能赢得彩票并带着宝贵的知识离开团队的危险。

如果你试图将复杂的编码艺术等同于重复性的流水线工作，那么[神话般的工作时间](https://en.wikipedia.org/wiki/The_Mythical_Man-Month)中的时间成本远没有 50%看起来直观。一些[经验研究](https://collaboration.csc.ncsu.edu/laurie/Papers/XPSardinia.PDF)得出结论，结对编程可能会导致两个程序员单独工作完成相同任务的时间增加约 15%,但产生的代码质量也会高得多，需要修复的可见缺陷减少约 15%。将这一点与共享所有权、更深入的参与和更快的解决问题结合起来，这是因为不止一个人参与解决一个问题，结对编程为什么是一种受欢迎的方法是显而易见的。

## 结对到底是什么？

那么，两个开发人员如何合作来实现结对带来的生产力和质量的提高呢？这主要是学习如何协同工作的问题，这不一定是我们大多数人学习编码的方式。

根据定义，结对编程只有在两个人在一台计算机上一起工作时才开始。但是这在实践中是如何运作的呢？

### 两个人…

结对编程的基本要素是与你的结对一起工作。当一项任务被接受时，它需要在从事这项工作的两个人之间分享，并且当他们配对时，他们都需要完全投入到这项任务中。这意味着他们都需要以同样的方式理解需求，并共同努力，就如何满足需求达成共识。

结对帮助人们更好地表达他们的想法和期望。当你独自工作时，你头脑中隐含的理解需要交流，这样你和你的搭档都知道你们在同一页上。事先尽可能明确地了解工作和方法将有助于让结对体验变得更加愉快。结对需要大量的交谈，因为这是让两个头脑同时积极参与到问题中的最好方式。

由于这个原因，结对经常与敏捷故事写作联系在一起，在敏捷故事写作中，一个特性的需求是用一致的、简单的语言定义的，产品和工程人员同样可以很好地理解，没有任何模糊的空间。通常，两人一组会要求故事用[小黄瓜](https://github.com/cucumber/cucumber/wiki/Gherkin)拼写出来，这是一种使用普通的、非技术性的短语的方式，这些短语很容易翻译成[自动化测试](https://cucumber.io/)，因此两人一组可以验证并演示每个功能都如预期那样工作。

用小黄瓜写作意味着把一个功能分解成一个简单的**故事**关于一个想要这个功能所能提供的东西的顾客:

```
As <a customer of the product>
I want <something desirable>
So that <I can achieve a specific goal> 
```

然后，所有的**验收标准**都以一致的语法写出，定义了与该故事相关的预期排列和场景:

```
Given <a customer in a particular state>
When <something specific happens>
Then <there is a specific outcome>

Given <a customer in a particular state>
When <something different happens>
Then <there is a different specific outcome>

etc. 
```

当然，使用这种精确的措辞并不是强制性的，但是如果一个特性的需求不能以这种极简的方式表达，那么期望就有可能是模糊的。这是一个潜在的危险信号，当两个程序员开始讨论需要什么时，他们更容易发现。

一旦两个人接受了一个故事，他们应该能够定义他们如何知道他们已经完成了，以及他们将如何证明这一点。在此基础上，他们可以一起想出如何最好地完成这项工作。

事实上，从事某项功能的两个人应该事先了解足够多的信息，这样他们就可以在编写任何代码之前，根据第一个验收标准*编写一个自动化测试，确保新的测试失败，然后在重构之前编写足够的代码使测试通过，然后开始下一个验收标准。这种方法被称为[行为驱动开发](https://www.sitepoint.com/bdd-javascript-cucumber-gherkin/)，虽然它不是结对编程定义的一部分，但它与[测试驱动开发](https://www.sitepoint.com/learning-javascript-test-driven-development-by-example/)完美地融合在一起。*

### 一起工作…

当你让两个或更多的人一起工作时，他们需要做的第一件事就是就工作时间表达成一致。如果两个开发人员不同时一起工作，这就不是真正的配对。因此，计划一起工作的开发人员必须协调他们的时间表，并确保他们都同意工作的时间和地点。

我见过的一个错误是，试图通过安排整整八小时的时间来最大限度地增加他们作为一对在一起工作的时间，有时还试图超过这一时间一起工作。结对是一项密集的工作，需要高度的专注和参与。一天中尝试配对超过五六个小时是非常费力的，即使是对我们中最有弹性的人来说，这也可能会使它变得更长。在制定结对时间表时，试着在一个典型的八小时工作日内商定一个固定的有限时间，留出时间吃午饭、发邮件、处理个人任务等。这些个人任务对我们的工作是必不可少的，但它们也是在配对过程中不应该尝试的干扰。

当约定的配对时间结束时，提醒你的搭档也是一种社交尴尬。出于这个原因，设置一个闹钟会是个好主意，它会把这个消息告诉你们两个人，而不会给一方或另一方带来负担。

技能水平是另一个双方都有困难的领域。一个合理的假设是，不管你在做什么，和你一起工作的人有不同的背景、经历和对这个话题的适应程度。预先认识到这一点很重要，所以你们都不会觉得有必要去隐藏这个事实。结对的好处之一是，一起工作自然会提高任何学习新事物的人的技能，无论是编程语言还是交流方式。

如果你觉得你比你的搭档更有技巧，请表现得大方一点。当你学到新东西时，用你希望被对待的方式对待他们。记住，重点不仅仅是完成工作，而是要确保你们双方都有足够的知识和对最终结果的所有权。

为此，至关重要的是，每个程序员都有机会坐在键盘前驾驶，而其他人则观察和浏览代码。轮流的概念可能对任何一个作为程序员独自工作的人来说都是新的，所以当你适应在导航时用语言表达你的意图，或者在驾驶时执行别人的想法时，会有一个学习曲线。

一个刚接触结对但对手头的任务很熟悉的程序员可以很容易地进入尽可能长时间地扮演驱动者角色的模式。类似地，如果你不在键盘前工作，也不太熟悉代码，你很容易发现自己的注意力又回到了手机、电子邮件和其他任务上。当这种情况发生时，你会发现一个人独自编写代码，而另一个人坐在同一个房间里浏览社交媒体。

一对情侣可能在轮流上有困难的迹象之一是沉默。结对是一个嘈杂的过程，涉及许多问题、反馈、讨论和协作。当一对情侣发现他们已经超过一两分钟没说一句话了，很可能这一对已经停止了。

一种防止配对陷入这种反模式的有用技术是使用[番茄定时器](https://www.sitepoint.com/the-pomodoro-technique-time-management/)。当你以 25 分钟为增量工作时，这些计时器会保持秒的倒计时，然后告诉你休息五分钟。通过在这些休息时间交换驾驶员和导航员的角色，两人可以避免陷入只有一个驾驶员的长时间对话。

### 在一台电脑上…

只有当两个人把全部注意力都放在一台电脑上时，配对才会起作用。在配对过程中，最好避免两个(或更多)活动屏幕的干扰。即使一个人只想查找一些相关的代码示例或检查后台进程的状态，最好在一台共享的计算机上完成。如果是搜索，两个开发人员都可以看到搜索是如何构建的，以及会出现什么样的潜在结果。如果是状态更新，两个开发者都不需要被落下。

所以在任何一对中，两个开发者都必须能够清楚地看到他们一起工作的屏幕。配对的一个重要工具是一个足够大的显示器，这样两个开发人员都可以清楚地看到正在写什么。根据具体情况，如果你不介意挤在一起，并使用足够大的字体和足够的对比度，这可以通过共享笔记本电脑来实现。一个更好的解决方案是一个更大的桌面或壁挂式显示器，这样可以更舒适地显示和查看代码。

如今，远程配对是一个非常可行的选择。有许多很好的解决方案，从 [Slack](https://slack.com/) 或 [Zoom](https://zoom.us/) 工具到成熟的[集成开发环境和支持屏幕共享、电话会议或两者兼有的文本处理器](https://www.sitepoint.com/collaborative-coding-tools-for-remote-pair-programming/)，允许桌子对面或世界另一边的两个人一起工作。即使你坐在一个开放的办公室里，屏幕共享也能让双方更容易看到屏幕上的代码，并更舒适地与屏幕上的代码进行交互。(我只是鼓励你保持专注，在远程配对时，不要冲动地在单独的窗口显示你的电子邮件。这是不尊重人的，对你的搭档来说这是显而易见的，你的分心会让你错过一起学习和产生高质量结果的机会。)

如果一对共处一地的人共享一台机器，他们需要就他们共享的电脑、键盘、鼠标等的配置达成一致。带有所有自定义硬件宏的人体工程学键盘可能不是共享的最佳选择。但是，如果你不介意使用相同的笔记本电脑或键盘和鼠标，在一对中从导航员到驾驶员的角色互换可能就像交换位置一样简单。

一个流行且非常健壮的解决方案是积极利用像 Git 这样的版本控制系统。经常将您的代码提交到一个共享的存储库中，这样每个开发人员在转换角色时都可以获得最新版本并在他们自己的设备上工作。使用版本控制来处理成对交换还有一个额外的好处，那就是为将来的日志记录和潜在的回滚创建更详细的代码更改历史。如果 Git 日志变得过于混乱，总是有可能在执行 pull 请求之前，将这些额外的提交压缩成一个更有意义的提交。

在更高的层面上，一旦你开始与另一个开发人员结对，你将会注意到你们各自处理任务的方式上的一些差异。你们中的一个人可能知道一些奇特的键盘快捷键，对常见的 shell 命令有一些特殊的别名，或者由于其独特的特性而更喜欢使用特定的 IDE。就代码本身而言，对于变量如何命名、如何构造提交消息、何时使用注释等，你们可能都有不同的隐含理解。

结对是一个机会，让这些无意识的技术变化变得可见，这样每个人都可以从关于我们如何更有效地编码的经验和知识的隐藏财富中受益。

## 如何开始配对

在建立肌肉记忆和学习大声表达想法的过程中，往往需要一段时间的调整，这些想法曾经只是你脑海中的想法。也有必要建立可行的后勤工作，让两个人一起工作，这可能意味着在时间表、地点和设备方面做出调整。当你让这个工作正常进行时，你可以尝试将这个过程扩展到整个团队，增加一些功能，比如针对团队的 [mob 编程](https://mobprogramming.org/mob-programming-basics/)，或者[混杂配对](https://agilefaq.wordpress.com/2007/11/03/what-is-promiscuous-pairing/)，让团队中的每个人都有机会对团队的所有故事进行配对。

努力完成学习阶段通常会带来显著的改进，无论是对代码的质量，还是对创建代码的人的快乐和可持续性。如果你的整个团队或组织都采用结对，新人的学习曲线将变得更加容易，从而改善入职流程，帮助每个人更有效率。

## 分享这篇文章