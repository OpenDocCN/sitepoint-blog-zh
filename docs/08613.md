# 构建高性能网站

> 原文:[https://www . site point . com/building-a-high-performance-website/](https://www.sitepoint.com/building-a-high-performance-website/)

建立一个快速的网站是困难的。

领导一项改善站点性能的计划更加困难。

有了许多可以用来提高站点速度的技术，项目经理们不断地被技术和项目管理问题所困扰。你关注前端还是后端优化？在制定提高网站性能的策略之前，你需要从你的网站开发团队那里了解什么？哪些优化应该手动完成，哪些应该通过站点性能服务自动完成？

拥有这些问题的最佳答案对于任何提高网站性能的计划的整体成功都是至关重要的。在选择提高网站速度的技术之前，项目经理必须首先掌握影响网站性能的因素，并分析这些因素是如何影响网站的。这一点，加上对现有站点优化技术的理解，将有助于项目经理做出最明智的站点性能决策。

## **前端对后端**

 *有幕后的选择，你的内部或签约网站开发人员可能会无形地为你创造，这将影响如何容易或困难，将提高你的网站性能和优化的长远目标。此外，这些“黑暗”决策可以分为两个不同的类别:前端选择和后端选择。

前端选择(这里有很多选择！)当最终用户通过浏览器访问您的网站时，会影响您的网站的组装方式。

后端选择往往比前端选择更加僵化和不灵活。这些选择涉及到关于如何托管和维护网站的决策，此外还有许多不同的第三方提供商做出的相同选择，这些提供商通常集成到现代网站中(想想社交网络和广告小工具)。

您应该非常清楚四个具体的指标，因为您可以从这些指标中应用的解决方案和技术会影响前端和后端的选择。

### 到达第一个字节的时间

这实际上是两个独立指标的结合:查找的时间(它有自己的内部连接时间成本)和连接到你的网页的时间。网页正常运行所需的每个资源都会出现这种情况。

一种被称为域名服务(DNS)的服务位于网络堆栈的“最低”层，提供我们所知的现代互联网。如果没有 DNS，设备将无法找到组装网站所需的资源。所有 DNS 服务并不平等。每个设备(和设备上的浏览器)可能有不同的策略，这些策略会影响它从哪里获取 DNS 信息以及保存(缓存)该信息的时间。

DNS 解析在许多资源请求中分摊。它经常被分摊到多个浏览器会话甚至浏览器实例中(例如 Firefox 与 Chrome 或 IE)。

另一个连接时间是建立到后端服务器(你的和你的站点依赖的第三方资产)的 HTTP 连接需要多长时间。这通常是比 DNS 更昂贵的操作，因为它本来就更复杂，并且受制于更长的“代码路径”。

建立连接后，后端决策会影响为满足请求必须完成的工作量。提供静态资源(例如脚本、样式表和图像)通常比执行应用模板和替代用户特定资源的代码快得多。这就是生活。

### **标题时间**

标题时间是对最终用户的第一个指示，表明他或她的浏览器已经执行了 DNS 查找，连接到主域，并且您的 web 服务器已经提供了定义网页的第一个资源(HTML 文档)。

标题时间记录了从初始请求到用页面名称更新浏览器中的标题栏所用的时间。许多用户可能没有注意到这一变化。然而，它确实发生了，这是一个非常重要的数据点。

达到这一步只是用户浏览器自动化的一长串动作的开始。

2011 年的网站平均拥有不到 50 个资源(图片、javascript 文件、CSS 文件等)。浏览器将解析(分析)HTML 文档，并构建一个迷你计算机程序，它必须执行该程序，以获得网页要求*必须*存在的所有其他资源。不幸的是，当前的 web 标准并没有资源是可选的这一概念，如果很难或很贵就可以忽略它。

49 个其他资源将在标题更新后立即被请求和处理。

### **显示时间**

这是你的网站可以使用的时候。简单来说，这是浏览器已经开始渲染的点。Render 是工程师们用来描述将所有指定的样式表和内联样式应用到文本、图形资源和 HTML 布局标记的过程的时髦词汇。

显示时间变得更加复杂，因为一些浏览器(尤其是移动设备)采用了许多技术来“优化”小屏幕的布局。这需要时间，并且每个设备制造商能够应用不同的规则和启发法。

如果你的站点有大量的文本，那么显示的时间通常是用户可以真正开始阅读页面的时间。

如果你的站点有大量的图形，那么显示的时间通常是用户开始看到布局的时间…但是图形可能需要一些时间来渲染，因为有一些高级的图像技巧，比如渐进式渲染。

### **T** **输入法到互动**

这是你的网站完全互动的时候。区分“展示”和“互动”的最简单的方法是找到一个在加载时不允许你滚动的网站。

我来自波士顿，在这里，我们是体育迷。所以当地报纸的体育版就是一个很好的例子。这些是高度模板化的页面——内容和广告经常变化——但整体结构不会。

我最喜欢(最不喜欢)的网站是《波士顿先驱报》(抱歉，伙计们)。当我点击关于汤姆·布拉迪的最新报道时，这是一个经常快速加载的网站，我通常可以读到“折叠上方”的前两段。但是，我不能向下滚动。为什么？因为站点页面使用的同步广告是在显示时间之后、完全交互之前下载的。我无法告诉你有多少次我发现自己被这种行为“卡住”并有点沮丧。

## **管理你的团队**

为了弥合交付团队与营销和业务团队之间的差距，并加速规划和实施过程，最好有一些共同点。

询问以下 10 个问题将极大地有助于确定今后使用哪些网站性能技术:

1.  我们打开压缩了吗？
2.  我们提出了多少资源请求
3.  我们有多少第三方资产？
4.  如果第三方小工具变得不可访问或非常慢，我们的网站会怎么样？
5.  我们是否调整了图片的大小以缩小它们的尺寸？
6.  我们是否对图像进行了编码以允许渐进式渲染？
7.  我们的主机提供优化服务吗？
8.  我们使用的是后端模板系统吗？如果是，我们的目标是移动设备吗？
9.  我们在做异步 javascript 请求吗？
10.  我们是否合并并最小化了我们的 javascript 文件？

## **策略**

### 建立基线

在开始性能和优化流程之前，确定一个基准非常重要，这样您就可以衡量成功并了解投资回报。它可能看起来没有必要或过于复杂。然而，如果没有这些，你将永远无法回答老板最终会问你的最简单的问题:

*   我们的网站有多快？
*   我们到这里花了多少钱？
*   保持前进需要多少成本？

一种方法是:您可以在不同的域中部署站点的两个不同版本。例如，在执行优化之前，一个子域(例如 old.domain.com 是非常好的)可以包含你的网站的副本。为了进行比较，你需要在同等的硬件上运行。

建立基线的另一个关键点是:你实际上是在测量和学习随着时间的变化。当有如此多的工具和服务可用时，未能衡量将受到惩罚…由于缺乏用户，他们最终会因为糟糕的性能而放弃你的网站。

### 手动与自动优化

如果您有一个包含高度动态内容的模板系统，那么您可能需要考虑优化模板系统。这可能需要一些特殊目的的合同，但投资回报将在模板系统被使用的数千次或数百万次中分摊(对于请求的每个页面)。

如果你有一个内部团队和/或资源和预算，首先让团队了解最新的技术。给他们买一本史蒂夫·索德的书 [*高性能网站*](http://shop.oreilly.com/product/9780596529307.do) 。给团队几天时间阅读这本书并做所有练习。

如果你在经营一家敏捷商店，你可以把培训变成一个两三点的故事。验收将展示书中提供的许多样本的本地副本。

如果你有一个大量图片的网站，你需要找到一种方法来确保你以最好的规模和质量提供图片。以全分辨率和全比例交付图形是速度杀手。如果你是一个图片网站，你会在上传过程中自动处理这个问题。

如果你是一个目录网站，你可能只是简单地把高分辨率的图像转储到一个数据库中，这个数据库是由模板系统按需动态组装的。这将需要规划一些开发故事，以创建一个定义和创建半自动任务的自动化流程，从而根据最小、最大和首选分辨率转换图像，以验证数据库不会定期受到高分辨率图像的污染。

推迟资源加载很容易做到，但需要对网站的工作流程有敏锐的理解。

例如，如果你有一个网站*可能*允许与客户支持代表进行互动聊天，你就有了一个嵌入式聊天系统，通常还有几十张可以用作表情符号的图片。

一个新用户在第一次访问网站时可能都不会用到，没有理由加载大量的资源。执行延迟加载有许多技巧。

将定义资源的标记提取到一个单独的 HTML 文件中，用 AJAX 调用一次性加载该标记，并对 DOM 产生副作用。另一种选择是在 defer loaded、hidden iframe 中加载这些资源。无论采用哪种技术，都需要一些 javascript 编程来实现。

CSS spriting 是一种非常强大的资源“减少”技术。简单地说，CSS spriting 指的是将图像组合成一个更大的图像的技术，该图像只需加载一次，就可以在不同的时间以不同的方式使用。

每次你删除对后端服务器的资源请求，都会直接提高网页的速度。此操作改善了用户体验，并提高了后端系统的可伸缩性和吞吐量。

第三方资产在许多方面都是最难处理的。你希望你的网站是现代的，并连接到社交媒体，但一旦你这样做了，你就完全在他们的控制之下。使用一种称为脚本注入的技术，这些小部件很容易集成到标记中。谷歌在“广告注入”中使用这种技术已经超过 10 年了。

如果这些可注入的脚本是同步加载的(它们总是同步加载的)，就会导致完全的页面加载失败。这是因为每个脚本都会影响附加到这些脚本的 HTML 文档的 javascript 引擎的全局状态。

考虑这个问题的最简单的方法是，HTML 页面实际上是一个软件程序，在许多方面与用于实现浏览器的 C 和 C++代码没有什么不同。浏览器是执行其他程序的软件程序。现代浏览器隔离它们正在执行的每个程序，以确保一个坏程序不会影响另一个程序的性能。然而，执行 HTML 程序的一个关键方面是顺序很重要。因为顺序很重要，所以浏览器*必须*等到一个脚本注入完成后才能执行下一个。一个浏览器*可以*在后台加载将要执行的脚本，但是它*必须*等到前一个脚本完全加载(或者加载失败)后才能向下移动。

做额外的工作来手动地(异步地)产生副作用，可以在显示时间和交互时间方面带来巨大的好处。然而，它确实需要特殊用途的编程技能，并且随着时间的推移会变得脆弱。谨慎明智地投资。

我们使用的一个技巧是提供小部件的图像作为“脚手架”，并动态异步注入最终的渲染。

这是面向 AJAX 的广告正在采用的技术，使用 iframes 和高级 CSS 排序技巧在后台加载广告，只有在成功加载后才进行交换。这些都是 JSONP 协议的变种([http](http://en.wikipedia.org/wiki/JSONP)[://](http://en.wikipedia.org/wiki/JSONP)[en](http://en.wikipedia.org/wiki/JSONP)[)。](http://en.wikipedia.org/wiki/JSONP) [维基](http://en.wikipedia.org/wiki/JSONP) [。](http://en.wikipedia.org/wiki/JSONP)[org](http://en.wikipedia.org/wiki/JSONP)[/](http://en.wikipedia.org/wiki/JSONP)[wiki](http://en.wikipedia.org/wiki/JSONP)[/](http://en.wikipedia.org/wiki/JSONP)/[JSONP](http://en.wikipedia.org/wiki/JSONP)。

JSONP 和相关技术在手动优化和动态异步呈现空间中至关重要。确保你的团队熟悉这些方法，并将它们应用到你的网站中。

### **自动化优化**

上述许多优化都可以动态执行，无需对您的站点进行任何代码更改。

怎么会这样呢？你为什么要这样做？

显然，这是一个理想的场景:您不必手动修改您的站点；你不必成为 DNS 和 CDN 提供商的专家；您不必手动编码您的站点来处理特定的 CDN 您不必将外部资源转换为内联数据；你不必将图像组合成精灵；而且，您不必手动分析图像分辨率并创建不同大小和分辨率的图像。

自动化优化可以作为服务交付的原因是 HTML“程序”的本质。HTML 文档资源是编程数据(和代码)的连续块。您的浏览器必须检索和组装这些块。此外，当 50 个资源变成 20 个资源来提供需要解析和执行的相同“数据+代码”时，您的浏览器工作得更少，消耗的带宽更少，引入的故障点更少。

当然，和往常一样，这里需要考虑一个权衡。这种权衡是在将最新和最好的性能技巧自动应用到您的站点上…和您的团队可以为您站点上的每个页面手动应用的速度之间进行的。

如果您外包了网站开发，并且没有运行自己的基础设施(后端服务器)，那么您的选择可能会有限，因为您的网站托管服务可能会在普通的入门级计划中禁用压缩。他们这样做是因为压缩需要后端计算，而后端计算是同一台机器上托管的许多其他站点之间的共享资源。

这里的简单选择是升级到一个更昂贵的托管计划。请向您的主机提供商寻求帮助。

如果您使用完整的虚拟机或专用服务器，您仍可能会关闭压缩，因为默认情况下它通常是禁用的。您可能无权访问配置文件。再一次，在这里向你的主人寻求帮助。

## **有用的资源**

构建高性能网站的技术是众所周知的，有许多书籍和免费工具可以帮助您理解这一点:

*   史蒂夫·索德斯(谷歌性能工程师，雅虎前工程师)写过两本关于前端优化的优秀书籍:[http://stevesouders.com/](http://stevesouders.com/)
*   20 款免费网速测试在线工具[http](http://sixrevisions.com/tools/free-website-speed-testing/)[://](http://sixrevisions.com/tools/free-website-speed-testing/)[six revisions](http://sixrevisions.com/tools/free-website-speed-testing/)[。](http://sixrevisions.com/tools/free-website-speed-testing/)[com](http://sixrevisions.com/tools/free-website-speed-testing/)[/](http://sixrevisions.com/tools/free-website-speed-testing/)/[工具](http://sixrevisions.com/tools/free-website-speed-testing/)/[/](http://sixrevisions.com/tools/free-website-speed-testing/)[免费](http://sixrevisions.com/tools/free-website-speed-testing/)[–](http://sixrevisions.com/tools/free-website-speed-testing/)[网站](http://sixrevisions.com/tools/free-website-speed-testing/)–[速度](http://sixrevisions.com/tools/free-website-speed-testing/)–[–](http://sixrevisions.com/tools/free-website-speed-testing/)[测试](http://sixrevisions.com/tools/free-website-speed-testing/) [/](http://sixrevisions.com/tools/free-website-speed-testing/)
*   谷歌的 PageSpeed 评估工具是另一个极好的来源:[http://code.google.com/speed/page-speed/](http://code.google.com/speed/page-speed/)

## 分享这篇文章*