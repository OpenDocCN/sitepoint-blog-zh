# CSS 架构:完成 MetaCoax 重构

> 原文：<https://www.sitepoint.com/css-architectures-completing-metacoax-refactoring/>

驯服失控的 CSS 绝非易事。如果你已经研究了任何顶级的[可扩展的和模块化的 CSS 架构](https://www.sitepoint.com/css-architectures-scalable-and-modular-approaches/)，你可能会同时欣喜地发现你的团队的 CSS 困境的原因，但又被如何开始对你的文档和工作流进行建议的改变的前景所吓倒。

MetaCoax CSS 重构过程提供了一种方法，随着时间的推移，随着代码变得越来越清晰和易于管理，可以分阶段对 CSS 进行修改。CSS 架构系列的最后一篇文章描述了四阶段过程的最后两个阶段，以及使用它的成功故事。

让我们来看看让你的 CSS 在可伸缩的生命中获得新生所需要的最后步骤。

## 第三阶段:圆滑的选择器，分组和分离

第 3 阶段的重点是使样式表更加轻量级。它通过全面优化选择器和模块化代码，根据样式类别将 CSS 分成单独的文件，并创建样式模式库和站点样式指南，继续消除冗余。这个阶段假设您已经实现了阶段 1 和阶段 2，因为这些变更是在早期变更的基础上的附加层。

这是我们要做的:

*   更多模块化
    *   对相关的类使用状态名和 JavaScript 名
    *   将所有样式移动到模块化级别
*   圆滑的选择器
    *   完全消除作为选择器的元素
    *   完全消除作为选择器的 id
*   分组并分开
    *   干(“不要重复自己”)它了
    *   明确区分 CSS
    *   为@media 做一个规划

### 更多模块化

识别和确定站点上的模块的过程可能会持续下去，因为随着时间的推移，模式可能会变得更加明显，因为您模块化了站点代码的更多部分。

到目前为止，我们已经做了大量的工作来清理旧的选择器，并用新的样式和新的选择器来替换它们，这样可以用更少的代码行来完成工作，并且可以在整个站点中重用。从[面向成年人的 CSS](https://www.sitepoint.com/css-architectures-scalable-and-modular-approaches/)开始，将样式保持在模块级别意味着它们是真正可移植和可回收的，与模块本身相关，而不是绑定到页面、页面部分或容器。这几个最后的技术将确保我们继续使用干净的代码。

在这项工作继续进行的同时，还有几个类您应该确定要建立:states 和 JavaScript。面向成年人的 OOCSS、SMACSS 和 CSS 建议命名类，以便它们清楚地表示状态和 JavaScript 的类，从而使它们在样式表中保持清晰，更容易查找和更新。

#### 州级

我喜欢的一个来自 SMACSS 的实践是当我有元素的状态类时使用状态名。状态类是独立的，通常是一个类选择器。例如，模块可以通过状态进行扩展，如下所示:

```
.is-collapsed
.is-active
.is-error
.is-hidden
```

在 SMACSS 中，状态类是唯一可以！重要的可以(有时应该)用。

如果状态规则是为特定模块制定的，建议在类名中也包含模块的名称。例如:

```
.is-navitem-hidden
```

就我个人而言，我觉得这种语法很别扭。我发现下面的语法更容易浏览，可以让我快速找到规则集。

```
.navbar-is-hidden
.is-hidden-navbar
```

#### JavaScript 特定的类

尼古拉斯·加拉格尔是一名杰出的前端开发人员，他经常创建专门与 JavaScript 相关的类。他建议[只对 JavaScript 挂钩使用某些类，不要给它们附加任何表示](http://nicolasgallagher.com/about-html-semantics-front-end-architecture/)。这样一个 JavaScript 类应该这样命名:

```
.js-login
```

像这样的类名可以减少改变模块或组件的结构或主题会无意中影响任何所需的 JavaScript 行为和复杂功能的可能性。

### 圆滑的选择器

到目前为止，您已经重塑了样式表中的选择器，消除了它们的大部分膨胀:限定符被删除，选择器不再基于 DOM 中的高层元素，组合子应该是三个或更少。我们现在已经准备好进行选择器清理的最后一步，使它们真正精简和优化。

#### 完全消除标签作为选择器

此建议适用于布局、模块、状态或主题样式。它与重置或基本样式无关。现在你已经记住了:元素选择器与 HTML 结构联系太紧密，不可能在模块或组件级别，对吗？因此，如果 CSS 中仍然存在选择器，并且其中包含一个元素，那么就要考虑如何将选择器转换成直线。类，并且[使它成为](http://www.youtube.com/watch?v=-ZxHAZChcYU)。

#### 完全消除作为选择器的 id

类似地，如果样式表中有# IDs 作为选择器，那么这些样式可能与文档本身或文档中的某个位置联系太紧密。更重要的是，这还意味着选择器的特定性太高，将继续鼓励编写更特定的选择器来覆盖这种样式——这将再次使样式表变得冗长而笨拙。就是不做。去掉带有# IDs 的样式，一劳永逸地赋予它们相同的特异性。

### 分组并分开

修改样式表的最后一个建议是，通过把相似的放在相似的地方，把不相似的分开，从而获得对 CSS 的统治。

#### 擦干它

干 CSS 的力量来自于“不要重复自己”这个想法的力量。虽然我还没有找到一种方法将许多枯燥的 CSS 实践合并到 MetaCoax 过程中，但我确实喜欢选择器智能分组的某些方面，以获得相同的风格。

例如，如果像 font-weight: bold 这样的东西在样式表中重复了无数次，我可以看到这样一种情况，许多元素的选择器以{font-weight: bold:}作为主要样式进行分组。然而，一旦样式的选择器被完全优化，我将把这种实践作为一系列技术中的最后一项来应用。

#### 明确区分你的 CSS

回到第 2 阶段，我们在样式表中创建了 SMACSS(或等效的)类别。现在是时候更进一步，将这些部分分成单独的 CSS 文件:base.css、layout.css、module.css、state.css 和 theme.css。

我不得不承认，我个人并不喜欢单独的文件，因为我不喜欢在多个地方寻找我需要的样式。但是，如果您花费大量时间滚动一个非常长的样式表，这种做法会很有用。

#### 为@media 做一个规划

在为响应式设计提前做计划时，SMACSS 还有另一个关于如何管理@media 查询的好建议。Snook 建议将媒体查询添加到它们所影响的布局和模块样式中，[将媒体查询放在模块(或布局)状态的周围](http://smacss.com/book/state)，而不是像通常所做的那样将它们分组在样式表的末尾。

是的，媒体查询声明很可能会被多次声明，但是所有的模块信息都被保存在一起，这允许单独测试模块。而且，如果您遵循了前面的建议，模块样式无论如何都将位于一个单独的文件(module.css)中，因此您不必在一个巨大的 css 文件中寻找它们。

## 第四阶段:分享是关爱

MetaCoax 流程中 CSS 优化和缩放方法(特别是来自成年人的 CSS)的最后阶段是创建一个样式模块库(也称为*模式库*)和一个网站样式指南。模式库是所有各种模块和组件本身的存储库。相比之下，样式指南是一个文档，它说明了在整个网站的上下文中每个组件的正确使用，以及这些组件如何协同工作。

这种风格指南应该包含你的网站页面上可以找到的所有元素以及它们对应的所有风格。初始页面元素不会被绑定到页面布局，而是在一般页面的上下文中独立工作。稍后将添加布局元素，并测试组件在页面内部的工作情况。创建这两者的目的是为了让你的网站向前发展时更加一致。

虽然这是项目的“最后”阶段，但它并不是最后才完成的。在项目早期开始。模式库和附带的风格指南不应该作为事后的想法添加到项目的末尾——它们是 CSS 代码重构过程的重要组成部分。

这是我们要做的:

*   创建模式库
*   创建网站风格指南

### 模式库

构建模式库是一种在完全中立的环境中为样式创建测试用例的方法。当对代码进行调整时，创建模式库应该同时进行。以下是一些建议，可以帮助您开始为网站闪亮的新 CSS 构建模式库:

1.  确定站点中的独特元素和组件。还要注意文本、标题、链接和按钮的主要颜色。
2.  开始设计页面的核心元素:标题、链接、表格、引号、无序列表和有序列表以及表单。
3.  页面的模块/组件的样式独立于它们所依赖的页面，以使页面真正模块化。
4.  样式化覆盖基本样式的组件，例如搜索框、面包屑导航、主题按钮和模块中的变体。包括交互风格:悬停、聚焦和活动状态。
5.  将所有的代码和样式片段输入到一个工具中，该工具中的模式易于访问和管理。

作为重构过程的一部分，您无论如何都要执行步骤 1 到 3。创建模式库的棘手部分是弄清楚如何构建它。网上有很多启发和模仿的好例子。MailChimp UI 模式库是单页面模式库的一个很好的例子。 [PatternPrimer](http://patternprimer.adactio.com/) 是一个独立于页面布局环境创建代码片段的很好的例子([也可以在 GitHub](https://github.com/adactio/Pattern-Primer) 上找到)，并且特别适合移动优先响应设计。Pears 模式工具是一个用 WordPress 构建的迷你模式库 CMS，用于在一个独立于上下文的所有样式库中输入和管理标记和样式的公共模式。

### 网站风格指南

现在您已经有了网站的组件，是时候创建一个样式指南了，它说明了在整个网站的上下文中所有组件是如何协同工作的，而不仅仅是一页一页地。通过用模式库中捕获的样式创建一个样式指南，你将打破降临到许多站点的悲剧循环，CSS 是由许多人开发的，他们不知道以前的开发人员做了什么，没有文档可循。

然而，注意一些潜在的风格指南问题是很重要的。它们不应该太死板，就像传统的图形标准手册一样，经常会扼杀创造力，鼓励无用的官僚主义。样式指南需要是活的、有呼吸的实体，并且实际上是确定哪些样式是模块的过程的一部分，可以独立存在，不管在页面上的位置如何。风格指南应该是网站设计团队和开发团队之间的接触点。

怎么强调都不为过:确保创建一个风格指南不会是另一件麻烦事的万全之策是在你修改网站上的风格时创建它。在创建模式库之后，在文章[前端样式指南](http://24ways.org/2011/front-end-style-guides/)中，Anna Debenham 提出了为你的站点创建样式指南的最后步骤:

1.  最后添加布局，并将组件放置到位。每个布局都可以作为单独的文档呈现。
2.  记录您的编码过程:命名约定以及分组、组件分类等决策背后的思想。
3.  鼓励团队和所有前端开发人员的参与，以确保总体人才共享。

专业建议:保持风格指南尽可能的简洁明了，比如 MailChimp 的这个[品牌资产指南。没有必要写一本大部头的书——风格指南越长，人们阅读它的机会就越低，更不用说使用它并遵循指南了。](http://mailchimp.com/about/brand-assets/)

Starbucks.com 风格指南([http://www.starbucks.com/static/reference/styleguide/](http://www.starbucks.com/static/reference/styleguide/))是一个基本的，非常有条理和有文档记录的风格指南，它也为构建一个在线风格指南提供了很好的指导。[雷卡风格指南](http://kaleistyleguide.com/)为你的网站 CSS 生成 [Twitter 引导](https://getbootstrap.com/2.0.2/)样的文档，因此值得一看。安娜·德本汉姆收集了一系列精彩的风格指南[甚至更多的例子](https://gimmebar.com/collection/4ecd439c2f0aaad734000022/front-end-styleguides)。

有了样式指南，在网站构建时没有记录样式的日子就一去不复返了，让每个开发人员自己想办法实现相同的样式。的确，对于有许多不同布局选项的大型网站来说，一个风格指南将是一项巨大的工作。但最终它将是非常值得的，因为它将在未来为网站的开发者提供便利。

## MetaCoax 成功

围绕过程发展的理论是很好的智力练习，但最好的想法是那些可以付诸实践的想法。我通过结合几个系统的最佳实践开发了 MetaCoax 过程，并用一个有 7500 行臃肿不堪的 CSS 代码的网站对该过程进行了测试。MetaCoax 流程做得怎么样？

*   将 CSS 的总行数从 7，500 减少到 2，250
*   消除了大多数内联样式和无意义的元素
*   实施[当前新的最佳实践](http://msdn.microsoft.com/en-us/magazine/jj983725.aspx)
*   建立了一个网格，消除了 327 个宽度实例和 738 个边距实例
*   还删除了以下内容:
    *   1259 个 div#实例和 836 个 div 实例
    *   包含 body#的 936 种款式
    *   的 126 个实例！重要的
    *   189 个上边距实例和 112 个下边距实例
*   使网站的代码对未来更加友好

而且……所有这些都是在网站没有明显视觉变化的情况下完成的！

## 可扩展和模块化的 CSS FTW！

所以，你有它:原则，实践和一个过程，给你的 CSS 一个修补，这不仅会帮助你，而且你的开发团队——并有可能改变你的整个网络部门的工作流程变得更好。即使你没有遵循这个过程，我希望你现在有勇气正视任何 CSS 更新项目，并对如何去做有新的信心。所以，前进吧，我的朋友，开始你的 CSS 重构吧！

## 进一步阅读的链接

*   [CSS Lint 页面](https://github.com/stubbornella/csslint/wiki/_pages)
*   [打破好习惯](https://vimeo.com/44773888)——哈里·罗伯茨在 2012 前沿趋势会议上的讲话
*   大屁股

* * *

本文是来自 Internet Explorer 团队的 HTML5 技术系列的一部分。通过 3 个月的免费浏览器堆栈跨浏览器测试@ [来尝试本文中的概念。即](http://modern.ie/)。

## 分享这篇文章