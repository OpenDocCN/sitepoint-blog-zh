# 无刷新链接

> 原文:[https://www.sitepoint.com/no-refresh-links/](https://www.sitepoint.com/no-refresh-links/)

在网站上看到实际上不会导致浏览器加载新网页的链接已经变得相对平常。许多这样的链接被用来触发客户端 JavaScript 脚本，以某种方式改变现有页面。这种效果的其他示例包括各种在线货币计算器，在这些计算器中，您可以在一个表单字段中键入一种货币的金额，然后按一个按钮，另一种货币的等值金额就会出现在第二个表单字段中，而无需加载新页面。

连接这些例子的共同线索是 HTML 元素的使用，该元素是为获取新的网页而设计的，但它的使用方式阻止了这种情况的发生。当点击链接时，通常会加载一个新的网页。提交表单时，通常会将其内容发送到 Web 服务器，并请求创建新的网页。通过使用客户端脚本，可以很容易地防止这种情况发生，以达到其他效果。

但是如果客户端脚本还不够呢？如果点击链接或提交表单时要采取的动作必须由服务器端脚本执行(例如，更新数据库)，该怎么办？不需要在浏览器窗口中加载一个新页面，还能做到这一点吗？

这是克劳德·李约瑟在早期的一期《科技时报》上向我提出的问题。他和我都在行动中看到了这种效果。他看到 www.mp3.com 点击他们网站上的链接时，会无缝地将一首歌添加到他的个人曲目列表中。当我填写并提交一个小表单时，我看到 www.milehighcomics.com 在我的购物车中添加了一个项目。这两项任务都在页面显示没有任何变化的情况下完成了(正如 Claude 所说，“甚至没有一点闪烁。”)

起初，我发现这种效果相当分散注意力。毕竟，当一个在线购物网站的用户做了一些重要的事情，比如将一件商品添加到他或她的购物车中时，用户期待对该行为的某种形式的反馈是正确的。我意识到，这种“不刷新”类型的链接不需要排除适当的反馈。例如，可以同时显示一个简单的 JavaScript 弹出消息，说明“该商品已添加到您的购物车中”。

接下来的问题是如何创建一个链接，在不改变当前页面视图的情况下向 Web 服务器提交请求。不幸的是，我对已经实现这种效果的网页设计公司的询问没有得到答复。创建无刷新链接的方法似乎是一个保守得很好的秘密。《科技时报》读者提出的一些想法包括将结果页面加载到一个不可见的框架中，并让请求调用的服务器端脚本休眠很长时间。前者是一个相对较好的解决方案，只是 Netscape 在创建宽度或高度为零的框架时不太合作。后一种解决方案虽然很有创意，也更接近我的想法，但会导致大量僵尸进程在服务器上运行。

##### 那么是怎么做到的呢？

然后法比奥·迪亚斯在圣诞节给我写信(多么合适！)他发现了隐藏在超文本传输协议(HTTP)规范中的一个有前途的珍闻。对于那些不知道的人来说，HTTP 是用于 Web 浏览器和 Web 服务器之间通信的协议。基本上，HTTP 通信是由发出页面请求的浏览器发起的。然后，Web 服务器响应这个请求，首先用一个代码表示响应的类型，然后用新页面的 HTML 内容(如果合适的话)。最常见的响应代码是 200，这意味着请求成功，随后是请求的网页。另一个常见的响应代码是 404，这意味着请求的文档不存在。

Fabio 发现的是响应代码 204，即“无内容”响应。这个响应对浏览器说，“我已经按照你的要求做了，但是没有新的页面给你显示。“事实证明，这正是 www.mp3.com 和 www.milehighcomics.com 的无刷新链接的工作方式！

尽管任何服务器端脚本语言都可以用来生成`204 No Content response`，但是让我们从一个 PHP 示例开始。下面是我们的链接，实际上什么也不做:

```
<a href="204.php">Click me!</a>
```

同样，下面的表单在提交时不会对页面造成任何可见的更改:

```
<form action="204.php" method="POST">
```

这只是一个普通的 HTML 链接，一个普通的 HTML 表单；神奇之处在于`204.php`，这两个 HTML 元素调用的脚本:

```
<? header("HTTP/1.0 204 No Content"); ?>
```

这一行 PHP 返回上面讨论过的`204 No Content`响应。如果你的 Web 服务器装有 PHP，你自己试试吧！如果您的服务器抛出一个 500 错误(内部服务器错误)，很可能您运行的是一个带有 the CGI 版本的 Apache 服务器，而不是(更快、更强大的)Apache 模块。在这种配置中，您必须使用以下替代语法:

```
<? header("Status: 204 No Content"); ?>
```

无论你最终使用哪种代码，当你点击链接时，你的浏览器应该什么也不做。但是，根据您使用的特定浏览器和 Web 服务器，可能会启动一个小动画，指示您的浏览器正在加载页面。这是这种方法的一个不幸的副作用，这使得包含适当的反馈变得更加重要。例如，链接和表单的下列变体将通知用户已经采取了该动作:

```
<a href="204.php" onClick="alert('Done!');">Click me!</a>
```

```
<form action="204.php" method="POST" onSubmit="alert('Done!');">
```

在这种情况下，反馈并不那么重要；然而，如果我们要扩展`204.php`来做一些有趣的事情，比如更新 MySQL 数据库中的计数器，那么我们肯定希望让用户知道发生了一些事情。

```
<?  

  $ok = mysql_query("UPDATE Counters SET Hits = Hits + 1 WHERE ID=42")  

          or die("A database error has occurred. Please try again.");  

  header("HTTP/1.0 204 No Content");  

?>
```

请注意，上面的脚本可能会也可能不会生成页面来响应用户的操作。如果查询正常发生，那么将发送`204 No Content`响应，并且不会向浏览器返回任何 HTML 文档(同样，如果您在 Apache 服务器上使用 PHP 的 CGI 版本，请使用上面给出的替代形式)。如果查询由于某种原因失败，对`die()`的调用会向浏览器返回一个带有错误消息的页面，而对`header()`的调用永远不会发生(因为`die()`会在脚本完成时终止脚本)。

可以使用更复杂的方案来确定是否向浏览器发送新页面(例如，取决于变量的值或鼠标点击的坐标)，可以想象这种能力在简单的在线游戏等领域的应用。

对于观众中的 ASP 爱好者，下面的脚本(用 VBScript 编写)相当于上面的 PHP 示例。它不会向浏览器返回任何内容，您可以通过向脚本添加所需的命令来随意让脚本执行任何操作。

```
<% Response.Status = "204 No Content" %>
```

下面是如何使用 CGI.pm 在 Perl 中实现这一点:

```
print header(-status=>'204 No Response');
```

我应该提一个警告。在这个小技巧的所有上述版本中，以及在其他脚本语言中，发送`204 No Content`响应的命令前面不能有任何页面输出。例如，在 PHP 中，如果您的脚本结构如下，它将失败并出现错误:

```
<HTML>  

<HEAD><TITLE></TITLE></HEAD>  

<BODY>  

<?  

  if (some condition) {  

    header("HTTP/1.0 204 No Content");  

    exit();  

  }  

?>  

...
```

这里的问题是出现在 PHP 代码之前的 HTML 标签。当您的脚本已经开始向浏览器传输网页时，它不能决定不向浏览器发送该网页。

除此之外，这种技术相当简单。这只是表明我们如何能把一项技术视为理所当然。《科技时报》的许多读者和我都是在与网络打交道的过程中建立起自己的职业生涯的，然而网络所基于的协议却在很大程度上被忽视了——或者 HTTP 可能没有 CSS 和 JavaScript 那么吸引人。

如果您对阅读更多关于 HTTP 标准的内容感兴趣，您最好的选择是直接进入源代码:[RFC 2616:HTTP 1.1 标准](http://sunsite.dk/RFC/rfc/rfc2616.html)。

## 分享这篇文章