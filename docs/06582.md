# 卢布主义者码头工人

> 原文:[https://www.sitepoint.com/docker-for-rubyists/](https://www.sitepoint.com/docker-for-rubyists/)

Docker 是一个非常棒的工具，我认为它将对我们的开发方式产生巨大的影响。但是，如果您没有太多使用 Linux 容器(或虚拟机)的经验，Docker 的基本思想及其好处可能有点难以理解。

本文将概述 Docker 是什么，它是如何工作的，以及它与 Ruby/Rails 的关系。

## 虚拟机和 Linux 容器

假设我们想在 Windows 7 机器上运行 Linux 发行版*(反之亦然)。我们可以使用虚拟机来完成这项工作。*

本质上，虚拟机在一个操作系统(在我们的示例中，Windows 7-这被称为主机操作系统)中创建了一个环境，另一个操作系统可以在其中“生存”(在我们的示例中，Linux 发行版，即来宾操作系统)。然而，有效地完全隔离客户操作系统*并非易事。事实上，这是一个如此困难的问题，以至于在很长一段时间里，它被认为是不可能的。然而，我们现在有几个不同的虚拟机*管理程序*实现。*

 *虚拟化有两种不同的理念，*完全虚拟化*和*半虚拟化*。

完全虚拟化是指客户操作系统不知道它正在虚拟化环境中运行。这样做的明显好处是，不必修改操作系统就可以实现虚拟化。然而，也有明显的缺点，其中之一是有时，客户操作系统需要知道关于虚拟化和真实硬件的信息。

另一方面，半虚拟化需要对客户操作系统进行小的修改，以换取更高的效率和透明度。半虚拟化是 Denali 虚拟化项目中首次提到的一个术语，这一概念由此发展而来。如今，有许多不同的虚拟化选项:Xen、VMWare 等。如果您想了解更多关于虚拟机的知识，请查阅 Xen 研究论文，如果您对操作系统设计有一点了解，这是相当容易获得的。

虚拟机允许我们轻松地分配服务器资源。Amazon EC2 本质上是由强大的硬件服务器上的虚拟机运行的。我们都知道 PaaS 提供商为过去困难而昂贵的部署过程做了些什么。但是，虚拟机会产生大量开销——您有文件系统、外围设备等。

容器(见下一节)有点像轻量级虚拟机，因为它们使用相同的底层操作系统。然而，进程可以与操作系统的其余部分完全隔离。

## 集装箱、chroot 和 Docker

容器背后的基本思想是容器中的进程运行在单独的根文件系统/目录下。基本上，这意味着进程可以创建自己的文件/目录，完全独立于主机操作系统和同一系统上的其他容器(如果有的话)。

在 nix 系统上有一个叫做“chroot”的操作可以在某种程度上做到这一点。本质上，它允许你运行一个程序，但是，用一个不同的根目录。因此，您可以在根目录为“~/any”的情况下运行“useradd”命令，如果您尝试运行“ls”，您会发现 bash 会尝试在“~/any/bin/ls”中查找“ls”，而不是“/bin/ls”。

这样做的好处是，您可以将底层文件系统划分为许多不同的根文件系统，在每个文件系统下运行不同的进程，这样就可以将进程分开。然而，这并没有解决整个问题；您仍然只有一个网络堆栈，而且整个过程非常繁琐和烦人。

Linux 容器是由 chroot 和它的一些缺点发展而来的。但是，像许多与 Linux 相关的东西一样，容器实际上可能有点难以使用。因此，Docker 出现了，它让那些不想花大量时间学习 Linux 容器系统复杂性的人觉得 Linux 容器很棒，很有用。Docker 有一些非常棒的特性，包括:文件系统、网络和资源隔离、日志记录和(个人最喜欢的)交互式 shell。

Docker 允许您创建可以从工作站带到服务器的容器，并期望它在服务器上以相同的方式运行(因为一切都是隔离的)。

## 形象

显然，要在容器上做任何有用的事情(不像上面的 chroot 示例)，您需要一组基本的实用程序，比如“ls”、“mkdir”等。Docker 允许您拥有提供这组二进制文件的图像。然后，您可以使用“docker run”命令，或者 docker 配置文件来详细说明您希望您的容器做什么(例如，安装 rvm、安装 ruby、运行您的代码，等等)。).

显然，编写所有这些配置文件看起来工作量很大。仔细想想，每个使用 Rails 的人可能都使用大致相同的容器布局。幸运的是，有人已经为我们解决了这个问题。

## 多库

Dokku 简直太棒了。这是一个“迷你 Heroku”在 100 行代码下的 Bash！它使用 docker 来制作和管理 Linux 容器。您可以使用“pipe to bash”安装程序风格来安装它(过去我已经表达了对此的厌恶；您将未知代码输入到 shell 提示符中，这也是根用户权限):

```
wget -qO- https://raw.github.com/progrium/dokku/master/bootstrap.sh | sudo bash
```

您可以通过简单的推送来使用 git 部署应用程序:

```
git remote add dokku git@HOSTNAME:APPNAME
git push dokku master
```

这解决了一个真正重要的问题(在我看来)——你可以通过一个 EC2 或 DigitalOcean 实例获得 Heroku 的简单性！对于你想在 EC2 上部署的每个新应用来说，这曾经是一个相当烦人的过程。

## 包装它

希望这能澄清一些关于 Linux 容器的问题，Docker 是什么，它给我们作为 web 开发人员带来了什么好处。我发现 docker.io 网站对这一概念的介绍非常简洁——本文希望填补这一空白。

## 分享这篇文章*