# 关于 PHP 会话安全性的说明

> 原文:[https://www.sitepoint.com/notes-on-php-session-security/](https://www.sitepoint.com/notes-on-php-session-security/)

在此总结[的一个讨论——为您的站点登录系统使用会话时需要注意的事项；](https://www.sitepoint.com/forums/showthread.php?p=1129516)

1.**共享 web 服务器**–如果 PHP 作为 Apache 模块运行(因此会话文件属于 web 用户),并且可能当 PHP 被用作 CGI 时(取决于会话是如何实现的),服务器上的任何其他人都可以读取您的会话文件(通常在/tmp 目录中)。

浏览会话文件的人(可能)不知道会话所应用的服务器的站点(因此可能无法使用他们找到的用户名/密码组合)，但是您可能仍然会将敏感信息(如信用卡详细信息)放在所有人都能看到的地方。此外，他们还获得了有效会话 id 的列表…

如果您只是在会话中存储密码，您可以通过使用 [md5()](http://www.php.net/md5) (最好是两次)单向加密密码来解决这个问题。但是，如果您需要恢复会话变量的值，这并没有什么帮助。

使用自定义会话处理程序将会话存储在数据库中可能是最好的解决方案。如果性能是个问题，你可以考虑 MySQL 堆表(假设 MySQL 和 Apache 运行在同一台机器上)。如果它的流量非常高，是时候考虑购买自己的服务器了…

2. **XSS 利用**(和会话劫持)——使用 JavaScript 的用户可能会被愚弄而泄露他们的活动会话 id。

有人要“劫持”一个会话所需要的只是唯一的会话 id。就像火车站储物柜的钥匙。储物柜不会检查你是否是钥匙的有效所有者，然后才允许你打开它，这样任何有钥匙的人都可以进入。

研究 XSS 和如何预防它。

承认会话劫持无法完全防止(例如，对 IP 地址的检查被 AOL 阻止，AOL 在每个页面请求上或多或少分配一个新的客户端 IP ),所以仔细检查用户登录时可以执行的“关键操作”,例如当更改密码时——需要旧密码，而会话劫持程序(希望)不知道旧密码。显示信用卡信息——像亚马逊一样，只显示最后四位数字。基本上限制了某人在劫持会话时可能造成的损害。

3.**URL 中的会话 ID**(和劫持)–如果你在 URL 中使用会话 ID(与会话 cookie 相反)，确保场外链接不包含会话 ID(否则远程站点将能够劫持)–PHP 应该负责这个问题。此外，你的访问者可能会在 referrer 字段中给出会话 ID-理想情况下，通过重定向页面传递站点链接，以消除 referrer(虽然，不幸的是，一些浏览器保留了最近 3 次查看的页面，我相信-不确定事实)。

理想情况下，不要在 URL 中传递会话 ids 如果用户需要“登录”,就要求他们接受一个 cookie。

4.**场次固定**(劫持前)(见 http://www.acros.si/papers/session_fixation.pdf)。

如果你给你网站的访问者分配了一个会话，在他们登录之前(例如 T2 的点击路径分析)，确保你在他们登录的时候给他们分配了一个新的会话 id，这样如果有人预先为他们生成了初始的会话 id，他们就不会得到新的 ID。

对于 PHP 4.2.0+，参见 [session_regenerate_id()](http://www.php.net/session_regenerate_id) (特别是用户提交的评论)。对于 PHP < 4.2.0，当用户登录时，你必须销毁会话并重新创建，在两者之间携带任何存储的数据。 [session_id()](http://www.php.net/session_id) 函数可能也很有用(我自己还没有在这个上下文中探索过)。

5.**嗅探数据包**(使用 SSL[HTTPS])–可以在客户端和服务器之间“嗅探”会话 ID。如果是一个涉及金钱交易或其他敏感个人信息的网站，SSL 是一项要求。

否则，如果没有 SSL，您就必须承担风险(就像您每次使用 FTP 客户端时一样……)。

6. **Cookies 不用于会话数据**–注意，不要使用 Cookies 存储敏感信息。

与会话不同，Cookie 数据存储在客户端站点上。除了“嗅探风险”，绝大多数 Windows 用户对安全没有什么概念，可能“被 haxor 拥有”。

否则，cookie(除了 PHP 为您创建的会话 cookie 之外)通常意味着长期(即两次访问之间)数据持久性(例如“记住我”)，而不是“活动会话”持久性。

可能有更多需要注意的事情(或需要纠正的事实)——欢迎提出建议。

## 分享这篇文章