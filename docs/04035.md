# JavaScript 依赖性反弹:打破神话的渐进增强

> 原文：<https://www.sitepoint.com/javascript-dependency-backlash-myth-busting-progressive-enhancement/>

在 Louis 最近的论坛主题中，[我们正处于脚本依赖的反弹期吗？](https://community.sitepoint.com/t/are-we-in-a-scripting-dependency-backlash/175614)他评论道:

> 我认为，从某种意义上说，我们正处于某种脚本依赖的反弹中，这可能是一件好事。

TL；速度三角形定位法(dead reckoning)

*   我同意。其他几个人也是如此，包括网络大师 PPK([](http://www.quirksmode.org/blog/archives/2015/01/the_problem_wit.html)*)和杰里米·基思( [*角动量*](https://adactio.com/journal/8245) )和杰克·阿奇博尔德( [*渐进增强仍然重要*](http://jakearchibald.com/2013/progressive-enhancement-still-important/) )。*
**   尽管 JavaScript 框架迅速崛起，但相对较少的 web 应用程序适合 JavaScript 框架。*   渐进式改进仍然是解决 web 开发问题的最佳选择，例如广泛的浏览器支持、维护和应用程序的未来验证。*

 *让我们定义一下我们正在讨论的术语…

## 什么是 JavaScript 依赖？

客户端框架的使用越来越多。这些提供了类似服务器端的编码模式，如 MVC、模板视图、可重用组件、表单验证等等。 [AngularJS](https://angularjs.org/) 可能是最著名和最受欢迎的解决方案，但它不是唯一的解决方案。

与服务器端框架不同，客户端替代方案必须运行在支持 JavaScript 的现代浏览器上。没有 JavaScript，他们会失败。[潮汐](http://tidal.com/)就是典型案例；如果 JavaScript 不可用，用户会看到一个空白页。没有内容，没有错误，没有报名表。

虽然没有理由不显示消息，但是依赖 JavaScript 的应用程序有一些很好的用例:

*   原型
    模仿网站和应用很快，因为客户端框架提供了丰富的组件和快捷方式。
*   仅客户端应用
    如果你的应用很简单，除了初始下载之外不需要服务器交互，那么 JavaScript 框架可能是个不错的选择(假设你可以删除不需要的东西)。
*   当你了解你的受众和他们使用的设备时，实施 JavaScript 不是问题。Angular 最初是为企业应用程序设计的。
*   考虑一下动作游戏、谷歌地图和文档。开发无 JavaScript 的替代品是徒劳的。谷歌创建了一个基本的 HTML 版本的地图，但它实际上是一个不同的应用程序，并于 2010 年被放弃。

还有其他情况，但大多数面向公众的网站和应用程序不属于这些类别。没有人会阻止你使用客户端框架，但是，当你有一把锤子时，一切看起来都像钉子。再次引用路易的话:

> 开发人员似乎只是为了使用新工具而使用新工具，而不是因为他们在解决实际问题。

## 什么是渐进增强？

渐进增强(PE)不是一种技术，而是一种开发方法。我在 2009 年写了[几个教程](https://www.sitepoint.com/progressive-enhancement-1-html/)和[例子](https://blogs.sitepointstatic.com/examples/tech/pe/pe-html-css-js.html)，但是这个概念从 2003 年就开始讨论了。

您建立了基本的用户体验，然后在浏览器支持时添加更多高级功能。将体育推向逻辑的极端:

1.  您创建了一个纯 HTML 应用程序，其中所有重要的处理都在服务器端完成。它可以在任何浏览器中工作；移动设备，Lynx，IE1.0 或者你扔给它的任何东西。
2.  你用 CSS 增强布局。CSS 是 PE 就绪的，因为浏览器会忽略它们不理解的属性。您可以使用媒体查询或[@支持规则](https://developer.mozilla.org/en-US/docs/Web/CSS/@supports)等选项进一步增强它。该应用程序仍然可以在任何地方工作，但为具有现代 CSS 功能的浏览器提供了更好的体验。
3.  您可以用 JavaScript 增强功能。JavaScript 是最不稳定的层，因为语言和 API 支持因浏览器而异。假设它运行，您在使用它们之前测试设施是可用的。例如，当支持`canvas`或`SVG`时，您可以将数据表转换成漂亮的图表。

每个浏览器都会收到它所能处理的最好的应用程序。可能没有两种浏览器提供完全相同的体验。移动优先响应式设计和较少使用的[离线优先](https://www.sitepoint.com/offline-first-next-progressive-enhancement-technique/)是渐进式增强技术的例子。

让我们来看看对体育的批评。

## 神话:没有人禁用 JavaScript

很少有人知道 JavaScript 是什么。很少有浏览器允许用户(轻易地)禁用 JavaScript。

这绝对是真的。

体育评论家然后总结道:

> 没有 JavaScript 的人得到他们应得的

认为 JavaScript 在任何时间、任何地点、任何人都可以使用，达到应用程序要求的水平，这是很危险的。每个人都有 JavaScript，对吧？说明了一点。

渐进式改进不是为了迎合那些禁用 JavaScript 的人。它是关于当某些 JavaScript 特性可用时增强体验。当 JavaScript 被禁用时，应用程序可能会提供一个糟糕的界面，但是用户仍然可以得到*一样的东西*。

## 误解:没有人使用旧的浏览器

我们说的*【老】*是什么意思？对于大多数开发者来说，它是任何一个超过 12 个月前发布的浏览器。不是每个人都能使用最新最棒的应用程序:

*   大型组织和政府部门
*   残疾人
*   发展中国家的人们
*   社区中不太富裕的阶层
*   任何拥有 iPhone 5.0 或 Android 4.0 及以下版本的人。

这些部门对你来说可能并不重要。但是它们永远不会变得重要吗？

渐进式改进对您的受众没有任何假设。对于客户端框架来说，情况并非如此。那些不能使用你的应用程序的人将从服务器日志中消失。这很快成为一个自我实现的预言:*“没有人使用我们的应用程序是在一个旧的浏览器上，所以我们可以继续下去…”*

## 误解:渐进式增强是反 JavaScript 的

渐进式改进包含了 web 的基本优势。在世界上任何地方，开发一个可以在任何网络设备上运行的网站或应用程序都是可能的。设备越好，用户体验就越好。

客户端框架使得 JavaScript 成为一种绝对的依赖。你不再为网络编码了。您的应用程序使用 web 作为特定运行时引擎的交付机制。浏览器是你的操作系统，更新可能会破坏你的应用。

## 误解:渐进式增强对用户和设备做出假设

体育就是不做假设。你不要假设任何事情——这是这项技术的核心前提。

JavaScript 框架让你误以为每个人都在功能强大的设备上使用功能强大的浏览器。我们以前做过这些假设。假设每个人都在宽带上有什么不同吗？或者每个人都有一个至少 960 像素宽的 17 英寸屏幕？还是说每个人现在都会用 IE6，而且会一直用下去？

## 误解:渐进式改进意味着支持过时的浏览器

渐进式改进的批评者认为你会把所有的时间都花在处理旧浏览器上。事实上，情况正好相反:您永远不需要处理旧浏览器，因为适当的后备措施已经到位。

支持旧的浏览器是 PE 的一个好处— *不是目的*。你可以支持最低级的浏览器，但是**你可以建立任何你喜欢的基线**。

例如，我目前正在开发一个应用程序，其中大多数 JavaScript 都需要运行`addEventListener`。因此，IE8 及以下版本将无法显示功能增强。我可以解决这个问题，但这不值得投资，因为这是一个没有老用户的企业应用程序。然而，IE8 用户仍然可以使用该系统，如果需要，还可以对其进行改进。

## 神话:JavaScript 框架应用更酷

您可以使用 PE 技术创建一个外观相同的应用程序。出现这种混乱是因为大多数 JavaScript 框架提供了一系列好看的预开发小部件。这些同样的小部件可以在一个逐渐增强的应用程序中使用，但是，如果没有 JS，它们将退回到基本的 HTML 替代方案。

PE 还允许你使用现代的 HTML、CSS 和 JavaScript APIs，这些还没有出现在任何浏览器中。考虑一下[获取 API](http://caniuse.com/fetch)——XMLHttpRequest 的现代替代品。它的支持很少，但我可以毫无问题地使用它，因为我可以回退到 XMLHttpRequest 或服务器请求。

JavaScript 框架牢牢地停留在现在——而不是未来。

## 误解:渐进式改进阻碍了网络的发展

或者，更具体地说，客户端框架处于前沿，推动着 web 向前发展。

抱歉，但这是错觉。类似 AngularJS 的框架实现了神奇的特性，但是，深入到表面之下，你仍然在使用 HTML、CSS、JavaScript 和 DOM 操作。充其量，这是一种抽象。在最坏的情况下，这是一个分心。

您的客户端框架的好坏取决于开发它所针对的浏览器。AngularJS 2.0 是一个完整的重写，因为在 AngularJS 1.x 发布时，诸如 [`Object.observe()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/observe) 和 [Web 组件](http://webcomponents.org/)等功能并不常见。该框架迫使您使用较旧的技术，但对您隐藏了实现。

PE 允许您使用任何现代 API，而不会破坏您的应用程序。祝您从 Angular 1 升级成功…

## 神话:JavaScript 框架使开发变得更简单

这在一定程度上是正确的——但只是在您开始构建应用程序时。您可以使用一系列的控件来缩短初始开发时间。但是你却被困在了这个框架的范围内，这可能会导致以后的问题。

假设您的应用程序已经运行了一段时间，并且客户端要求支持 *BrowserX* 。它由一个主要客户使用，并且不是特别旧；黑莓浏览器、iPhone 4、Android 3.3 等。他们可能期望几天的开发时间，但是如果你的 JavaScript 框架不兼容，这是不可能的。

对于使用 PE 技术开发的应用程序，这个问题可能永远不会出现；你可能已经在支持那个浏览器了。无需大量重写即可添加进一步的增强功能。

## 谬论:渐进增强是双倍的努力

这是评论家最喜欢引用的一句话。唯一说体育太费力的人是那些从未尝试过或尝试失败的人。

如果你没有从一开始就考虑到这一点，体育课只会花两倍的时间。试图将 PE 改造成现有的应用程序是注定要失败的——对于依赖 JavaScript 的应用程序来说尤其如此。

让我们考虑一个简单的例子，比如来自搜索查询的结果的分页列表。第一次页面加载返回所有的 HTML。它很快，而且 JavaScript 什么都不用做。在幕后，我们使用数据库查询，并将结果放入 HTML 模板。您可以快速修改相同的服务，以 JSON 数据或不带页眉和页脚的结果 HTML 的形式返回结果。当用户点击“第 2 页”时，显示结果的第二页:

*   使用 JavaScript，我们可以拦截点击，并使用 Ajax 技术获取页面结果。可以使用`innerHTML`将 HTML 数据插入页面。或者，我们可以使用 page 1 作为返回的 JSON 数据的模板。
*   如果 JavaScript、XMLHttpRequest 或 Fetch 不可用，或者 Ajax 调用失败，我们可以请求第二个完整的 HTML 页面。

这要多做一点工作，但肯定不会加倍努力。我们拥有跨浏览器容错解决方案的优势。

## 谬论:渐进式改进毫无意义——网站要么发展，要么消亡

这种观点背后的逻辑是，网站最终会过时。因此，您可以使用一个在特定时间点针对特定技术的框架。

我希望。如果你的代码是好的，它会比你预期的用得更久。糟糕的代码存在的时间更长，因为没人想碰它。

但是，再次使用渐进式改进，除了 web 将继续作为基于客户机/服务器的 HTML 系统之外，不要做任何假设。网络需要从根本上改变你的应用程序——它将不再是网络！

## 误解:渐进增强是老前辈推荐的老技术

引用奥德兹的话:

> 客户端 JavaScript 框架的激增让你和其他“老前辈”一样成为少数派。

好的，谢谢！

JavaScript 的反弹是由已经为 web 开发了相当长一段时间的人领导的。我们都是与时俱进的卢德分子吗？也许吧。或者也许是因为我们从很多很多历史错误中学到了一些东西？

JavaScript 框架提出了一些常见的问题:

*   有些混合了 HTML 和功能，就像我们以前用`onclick`处理程序一样，例如
    `<form ng-submit="doSomething()">`
*   它们针对特定的浏览器。*“最佳观看位置……”*消息和`<noscript>`标签再次出现。
*   他们对今天的网络做了一些假设——比如 JavaScript 在任何地方都能工作，每页 2MB 是合理的。
*   他们不为未来打算。

JavaScript 框架主要对开发人员有利，而不是用户。他们可以提供短期收益，但代价是更少的游客和痛苦的长期维护。

我们不要忘记 SEO。Google 索引 JavaScript 页面但是跟踪每一个逻辑分支不一定是可能的。除非你仔细编码，否则也很难链接回一个特定的 URL。

渐进式增强补充了 web 的优势:

*   它将内容、布局和功能分开，以便于维护
*   你正在为网络编写防御性的、容错的、与设备无关的代码——而不是浏览器
*   您可以支持多种设备
*   您的测试负担减轻了，因为您的应用程序在失败时仍然有效
*   SEO 和可访问性是固定的(或者需要更少的努力)
*   网站和应用将在今天、昨天和明天发布的浏览器上运行
*   没有人否定渐进增强的好处，也没有人提出更好的技术。

只有一个缺点:很明显，许多开发人员仍然不信任或不理解渐进式改进。

JavaScript 依赖反弹万岁！

## 分享这篇文章*