# 5 个 PHP 安全漏洞

> 原文:[https://www . site point . com/5-more-PHP-security-vulnerabilities/](https://www.sitepoint.com/5-more-php-security-vulnerabilities/)

在[之前的一篇文章](https://www.sitepoint.com/top-10-php-security-vulnerabilities/ "Top 10 PHP Security Vulnerabilities")中，我谈到了一些可能影响 PHP web 应用程序的常见安全漏洞。但是在开发时，除了这十个(好吧，七个)攻击之外，还有其他事情需要考虑。因此，本文提供了与安全相关的各种事物的概要；你应该做的事情，你不应该做的事情，其他人可能会尝试做的事情，无论如何都要让一篇文章足够长，让我的编辑满意。

## PHP 的安全配置文件

有时当你在酒吧闲逛时，你会听到人们(当然不是常客，而是随便逛逛的人)暗示 PHP 不是一种非常安全的语言。过去，这种感觉有一些合理的根据。

大多数历史问题都可以追溯到糟糕的默认设置。一个很好的例子是 register globals，它在 5.3 中被弃用，然后在 5.4 中被完全删除。谈论它是没有意义的；这不再是一个问题，但我们只能说它给了人们编写潜在不安全代码的机会。因`php.ini`环境而产生的不安全感现在大多被中和了，或者被更好地宣传了。

PHP 的一大优势是它是一种服务器端语言。与直接在用户浏览器中执行或可以查看代码的 JavaScript 或 HTML 不同，PHP 代码在服务器上解释，只将结果发送给浏览器。当然，如果服务器配置错误，可能会导致 PHP 代码被下载到浏览器，但这种事情不会每天都发生。

PHP 的一个缺点是灵活性，但这也是它的优势之一。对于一个 PHP 应用程序的运行来说，并不是一切都必须如此。你可以有松散的结尾，代码仍然会工作。不幸的是，松散的结尾是让黑客继续做生意的原因，所以编写安全的代码通常从严密的、技术上正确的代码开始。

## 过滤输入数据

这听起来很简单:检查你的网页上输入的数据，并确保它是不危险的。谁不会这么做呢，伙计？答案是人数惊人。

有一种观点认为，任何计算机科学专业的学生都应该经历一学期的诈骗。你知道，人们走上前来，提出给他们 100 美元，如果他们能预付 20 美元来兑现他们的“支票”。或者来自某个地方的律师的电子邮件告诉他们，一个他们从未听说过的亲戚刚刚留给他们 2500 万英镑，他们需要做的只是发送他们的银行信息。当然，目标是教导计算机人这个世界不是一个友好的地方。我们为用户设置了一个 256 个字符的区域来输入评论，一些人将使用该空间来输入 SQL 命令，试图进行 SQL 注入攻击。不再有荣誉了吗？

如果您设置了一个允许任何类型的自由表单输入的页面，您需要仔细检查输入的内容，并确保不会输入任何不好的内容。使用函数`filter_input()`来确保坏人不会把不好的东西放在你的表单中(或者甚至放在你的文件中，如果你的输入伴随着文件传输或者一些其他的 I/O 操作)。

幸运的是，SitePoint 上已经有两篇与此相关的优秀文章。第一个是 Toby Osbourn 的使用过滤函数的[输入验证，第二个是 Matthew Setter 的作为 Zend 框架](https://www.sitepoint.com/input-validation-using-filter-functions/ "Input Validation Using Filter Functions")中的验证过滤器的 [ClamAV。通过这两篇文章，你应该能够了解这个潜在问题的内幕。](https://www.sitepoint.com/zf-clamav/ "ClamAV as a Validation Filter in Zend Framework")

## 错误报告

在开发过程中，您可能希望错误消息出现在屏幕上，以便在脚本出现问题时给您提示。但是你在生产的时候，你真的希望这样吗？对于黑客来说，每一点信息都是生命的食粮，甚至关于你失败的信息也可能对那些只想破坏你的网站的人有所帮助。因此，在生产过程中，不要在屏幕上显示错误。

你怎么控制这个？谢天谢地，`php.ini`文件在那里，因为它正是为了这样的需要而存在的。事实上，可以在`php.ini`中设置四个标志来随意配置错误报告。

*   `error_reporting`–该标志决定您是否想要了解错误。显然，您想了解所有的事情，所以明智的做法是在生产和测试中都将这个设置为`E_ALL`。
*   `display_errors`–该标志表示您是否希望错误信息显示在屏幕上。在开发期间将其设置为“开”,在生产时将其设置为“关”。给黑客更多不必要的信息是没有意义的；让他们干重活。
*   `log_errors`–指示是否应将错误记录到日志文件中。显然，您会希望在生产中使用它。
*   `error_log`–指示错误信息将被写入的文件的路径。显然，为了使其生效，我们需要打开`log_errors`。

通过设置这些标志，您可以在测试过程中获得所有需要的信息，同时在生产中保护您自己。

## 会话固定

在上一篇文章中，我谈到了会话劫持，但是还有另一种类型的攻击可能发生在您的会话中:会话固定。固定是指你被诱骗使用黑客提供的会话 ID。这是怎么发生的？

一般来说，当你点击一个包含一个带有攻击者想要你使用的会话 ID 的`PHPSESSID`参数的链接时，就会发生会话固定。该链接可以将您带到一个验证您身份的表单，现在您的身份与攻击者提供给您的会话 ID 绑定在一起，允许他们查看您站点中的任何页面并访问与该页面相关的数据。

幸运的是，防止这种情况相对容易。从检查`php.ini`中的以下值开始:

*   `session.use_cookies`–控制使用 cookies 时会话 ID 的持久性。它应该设置为 1 或根本不设置。
*   `session.use_only_cookies`–防止 ID 被 GET 参数覆盖，应设置为 1。
*   `Session.use_trans_sid`–让 PHP 改变输出，以便链接中的会话 ID 等。会坚持。这应该设置为 0。
*   `session.name`–会话参数的名称。通常这被设置为“PHPSESSID ”,知道这一点对黑客来说更容易。将此值更改为更模糊的值。

此外，要遵循的一个好的经验法则是，总是在重定向到任何认证用户的请求之前执行一个`session_regenerate_id()`调用。这将确保会话 ID 不是攻击者提供的，并帮助您避免这种情况。

## 用户数据问题

如果你的网站以任何方式使用用户数据，那么你就有额外的问题需要注意。首先，也可能是最重要的一点，您需要考虑浏览器和服务器之间的数据流量。很多时候，这是一个容易的目标，尤其是有这么多人在公共开放无线网络上工作。你可以考虑在你的网站上使用 SSL 连接(例如 HTTPS)来进行所有的交易。甚至加密 PHP 建立的数据库连接也不是不可能的，这取决于您的配置的性质。

在这方面需要关注的另一件事是攻击者从您的数据库中窃取密码的能力。这稍微超出了本文的范围，因为它主要涉及如何加密您的密码，以便它们不容易被彩虹表或其他攻击方法恢复。我建议查看 Callum Hopkins 撰写的文章[为什么应该使用 Bcrypt 散列存储的密码](https://www.sitepoint.com/why-you-should-use-bcrypt-to-hash-stored-passwords/ "Why You Should Use Bcrypt to Hash Stored Passwords")以获得更多信息。

## 摘要

就这些吗？我的意思是，如果你在这篇文章和我之前的文章中做了所有的事情，你的网站会安全吗？是啊，当然。把你所有的钱都放在一个纸袋里，随身携带。

绕过安全的方法比其他任何东西都多。最后，如果你只做一件事，怀疑你可能容易受到攻击的方式，不要相信任何用户输入，除非它被一丝不苟地删除。

是的，我知道那是两件事。你明白我不相信别人的意思吗？

<small>图片 via[Fotolia](http://us.fotolia.com/?utm_source=sitepoint&utm_medium=website_link&utm=campaign=sitepoint "Royalty Free Stock Photos at Fotolia.com")T3】</small>

## 分享这篇文章