# 经济实惠、可扩展的网站简介

> 原文:[https://www.sitepoint.com/affordable-scalable-websites/](https://www.sitepoint.com/affordable-scalable-websites/)

某天早上，你醒来，拿起咖啡，查看昨天有多少人访问了你的网站。(拜托，承认吧！我知道我每天都这么做！)你看着数字，它们就是看起来不对。也许你的咖啡不够浓——其中肯定有小数点！他们都太大了！你昨天接待了一万名新访客…而且还在快速攀升。你终于成功了！

接下来，你检查你的电子邮件，发现你的 ISP 告诉你，你需要升级到一个更昂贵的计划，或者支付大量的带宽。哦不！怎么办？好吧，如果你的网站设计得当，你可以微笑着知道一切都在你的掌控之中。

您已经到了需要多台服务器的地步。是时候弄清楚如何在不倾家荡产的情况下保持网站的正常运行了。需要注意的是，即使您没有专用的服务器，这篇文章也与您相关——拥有几个小帐户通常比一个大帐户更有益。

本文将首先讨论一个预算可伸缩的网站的例子，然后简单地谈谈设计你自己的网站的正确方法。不幸的是，这种方法对于小型网站管理员来说非常昂贵，但是知道这一点很重要。接下来，我们将讨论如何设计一个网站，使其在未来易于扩展，并且不会迫使你彻底改变当前的工作方式。最后，我将谈谈如何将一个现有的网站转换成一个可扩展的网站，我们将探讨一些需要克服的技术障碍。

##### 可伸缩服务器简介

为什么需要专门设计一个可扩展的网站？让我给你举个例子。

我相信你一定听说过曾经非常流行的“[我热不热](http://www.hotornot.com)”网站。两个大学生有一些空闲时间，有一天他们想出了一个好主意。他们想，创建一个网站，让访问者上传自己的照片，并让其他人投票决定他们是否性感，这不是很酷吗？这是一个令人上瘾的组合，一夜之间，这个网站从没有点击率上升到每小时几百万，这并不奇怪。他们突然面临着如何维持网站运营的挑战。

他们很快做出了一个关键的观察:每个页面视图都是相互独立的。因此，如果您正在查看网站的一个页面，那么下一个页面由哪个服务器提供是没有区别的。这是因为网站只有两个部分:浏览页面和记录投票。这种情况大大简化了这些特殊的网站管理员的事情。他们只使用一个主 SQL 数据库，并让其他服务器为每个页面视图调用它。这样，他们可以分配负载，而不必显著改变程序的工作方式。

因此，他们在 7 天内升级到 7 台服务器，毫不奇怪，他们的数据库服务器开始堵塞。他们注意到，几乎每个页面都简单地从数据库中进行选择查询，并且每张投票都被直接写回到数据库中。然而，他们认为没有真正的理由立即记录投票——毕竟，如果显示的投票数是几个小时前的，谁会注意到呢？所以，一开始他们只是缓存投票数据并定期更新。

然后，又过了几天，他们的服务器又开始窒息了，他们升级到运行多个数据库服务器。从那时起，他们能够扩展到他们需要的任何规模，最终达到超过 17 台服务器！现在，让我们看看如何用更少的预算做到这一点。理想的可扩展网站架构构建一个可扩展的网站可能是一件非常棘手的事情。它涉及大量冗余、负载平衡、多个 web 服务器、一个单独的数据库服务器和备份服务器。例如，在下图中，所有到互联网的连接首先通过负载平衡器。

负载平衡器将根据您作为网站管理员设置的程序来分配流量。例如，它可以将大部分流量发送到平均负载最低的服务器。这有助于保持良好的低响应时间，即使你的网站是从 CNN.com 链接。多个服务器用于帮助保持系统容错。如果一台服务器崩溃，流量可以转移到其他服务器。这同样适用于数据库——如果主数据库离线，会有一个复制备份。

![1128_image1](../Images/fa771eac8000fcf81844617129edbefc.png)

您可能已经猜到了，这样的设置可能非常昂贵。尽管如此，如果你有时间、金钱和雄心，我还是强烈建议你研究一下这样的系统。完整架构的具体细节超出了本文的范围，但是有很多关于这个主题的书籍。

幸运的是，对于我们其他人来说，有一种风险更高，但更便宜、更容易的方法。

##### 预算可扩展架构

对于我们这些连一台服务器都买不起的人来说，更不用说七台了，有一种渐进的方法可以遵循。简单地设计你的网站，使它可以在一个或多个服务器上运行。如果你做得很好，为什么不租一个新的服务器，在这个服务器上安装你的软件，并告诉你的旧服务器新的。虽然这并不像听起来那么简单，但却是可行的。当你设计你的网站时，简单地记住一些关键的想法，如果它变得越来越受欢迎，你甚至不会流汗(除非它来自胜利之舞)。

因为我们有预算，所以要记住一些限制。我们负担不起在办公室运行服务器的费用——相反，我们将使用许多廉价的专用网络主机。我们希望能够根据流量随意添加或删除服务器，并且我们希望最大限度地减少带宽使用以节省成本。

不幸的是，大多数预算专用的互联网主机在设置上面讨论的那种分层服务器时并没有很大的帮助——它们会收取你很多钱来将几个服务器连接在一起。因此，我们希望尽可能避免使用单独的数据库服务器。请注意，如果只是偶尔对数据库进行查找或写入，那么通过互联网发送请求是完全合理的——这种情况不会占用很多带宽。

***主从网站***

首先，有许多不同的方法来设计一个可伸缩的网站。最简单的，虽然不一定是最好的，是简单地创建一个主站点和几个从站点:一个主站点，所有其他站点从这个主站点复制。所有的东西都被复制——数据库、HTML 页面，所有的东西(尽管您可能希望使用一个数据库，并让所有的服务器都链接到它，以保持一致性)。

例如，在 sitepoint.com 上，文章从哪个服务器发送并不重要。你可能在悉尼的服务器上浏览这篇文章的第一页，而在底特律的服务器上浏览第二页，你永远也不会知道其中的区别——也没有什么特别的关系。然而，他们在文章的底部有一个漂亮的小投票机制(你想按下这篇文章上数字 10 下面的按钮，看看会发生什么！).单击此按钮可以点击主服务器而不是从服务器，并相应地更新数据库。然后，如果您使用多个数据库，每天一次(或者如果您使用数据库复制，则立即)将数据复制到每个从属服务器。

将用户发送到随机服务器的最简单方法是使用循环 DNS 服务器。循环设置会将每个请求发送到随机服务器。但是，因为每个请求都发往不同的服务器，所以很难跟踪会话数据(比如用户的登录详细信息)。为了解决这个问题，您可以使用 cookies 或隐藏的 HTML 字段。

***每次访问一台服务器***

这种方法的一种变体是使用多台服务器，但是让用户在整个访问过程中查看由同一台服务器提供的页面。你可以有 www.mysite.com，www2.mysite.com，www3.mysite.com，等等。当用户访问您的站点时，他们被随机发送到一个服务器(或者，如果您将用户的数据存储在一个特定的服务器上，您总是将他们发送到那个特定的服务器)。

这非常简单，几乎不需要对你的网站做任何改动。它可以很好地处理持久数据，并且易于理解和实现。但是它有一个非常糟糕的致命弱点:如果每个人都开始链接到 www3 服务器上的一个页面会怎么样？或者 www3 崩溃了怎么办？它可能会被占用或关闭，导致其他服务器闲置。话又说回来，这种方法非常简单，非常有效，而且在预算范围内效果很好。

***按类型提供内容***

另一种方法是从一个服务器提供一种类型的内容，从另一个服务器提供不同类型的内容。一个很好的例子是将图形放在一台服务器上，将动态内容放在另一台服务器上。这允许你使用慢速服务器和高带宽提供者来处理图形，使用高质量但更昂贵的服务器来处理内容。当你已经超出了你的常规虚拟主机账户的带宽分配时，这种方法很有效。有问题吗？如果一台服务器瘫痪，实际上，你的整个网站都会沉入水中。

***缓存***

缓存也是扩展网站的一种很好的方式。他们不是让用户直接查看您的主站点，而是查看不同服务器上的缓存副本。在这种情况下，您不是提供动态数据，而是提供静态数据。一台或多台主服务器生成所有页面，并将它们推送到其他服务器，用户从这些服务器查看您的站点(要获得更自动化和更高级的方法，请使用优秀的开源 Squid 缓存程序)。

这个解决方案只需要一两台昂贵的服务器，以及几台便宜的辅助服务器。这种技术简单而有效，尽管它不适合为每个用户定制的网站。

##### 网站设计

那么所有这些如何帮助你设计你的网站呢？嗯，通过探索这些备选方案中的每一个，我们学到了一些经验教训，包括:

*   将你的网站分成几个部分。例如，将静态内容保存在一个目录中，将动态内容保存在另一个目录中，以便以后可以方便地拆分到多个服务器中。
*   **尝试允许页面仅使用 SELECT SQL 查询，**或无会话页面，以允许循环式 Web 服务。
*   不要将链接硬编码到你网站上的其他页面。这样，如果你改变了网站的位置，你可以很容易地更新你的网站。我个人是把我所有的内部链接都放在一个文件里，然后包含它们(即`<a href="$global_mysiteURL/$home_url">Click here</a>`)
*   尽可能使用缓存。这将减少你的服务器上的负载，并有助于平衡。
*   **尽量避免服务器端会话，**但是如果你需要它们，一定要设置好，以便数据可以与其他服务器共享，或者用户只使用一台服务器。

最后一点:在多台服务器之间同步网站的一个有用工具是 rsync，或者更好的是 cvs。如果您在主服务器上进行更改，只需在该服务器上提交您的更改，然后在其他服务器上运行 cvs update。cvs 将自动保持从属服务器上的所有定制不变。

##### 转换站点

“好吧”你说，“我已经有了我的网站…但是我没有采纳你的任何建议！我该怎么办？”别担心，要将你的网站转换成在多台服务器上运行，你还有很多事情可以做。

首先，让我们把简单的案例放在一边。如果你的网站完全是由静态 HTML 文件组成的，那么你就可以了。你所需要做的就是将网站复制到两个不同的服务器上，并设置一个循环域名系统。如果你的网站几乎完全是静态的，但有几个动态页面，只需将所有静态材料放在一台服务器上，将动态材料放在另一台服务器上。

现在困难的情况是:如果你有一个复杂的用户输入驱动的网站，你需要做更多的工作。首先，分析你的网站。特别是，看看所有的 SQL 代码。你能把你的站点分成不同的部分吗——比如可能使用稍微过时的数据(或者只读)的部分，以及写入数据库的部分？如果是这样，您可以简单地设置主服务器和从服务器。将写入的页面放在一台服务器上，读取的页面放在另一台服务器上。这样，您可以平衡负载并减少数据库流量。

如果以上建议都不起作用，那就考虑设置多个不同的服务器，把访问者送到他们注册的服务器上。在我看来，这是最容易的，虽然不一定是最好的方法。

如果以上选择都不成功，运行几个 Web 服务器和一个数据库服务器是您的最佳选择。这将允许你的网站几乎不加修改地运行。只是要确保将会话存储在数据库中，而不是文件中，以允许从任何服务器访问它们。请务必与您的 ISP 联系，以获得服务器之间的直接连接(或者在一个托管设施中获得您自己的机架),从而避免产生巨大的带宽费用。

##### 结论

当你的网站突然开始像豆茎一样生长，这是一件既令人高兴又令人担忧的事情。如果你有一个大的预算，不用担心，但即使预算很少，你也可以让你的网站运行。如果您在问题出现之前就开始考虑如何设计您的站点，您就可以防止任何停机事件的发生。事实上，准备一个可扩展的站点几乎不需要做什么——有了设计合理的站点，您只需投入新的服务器，就可以立即投入运行。祝你好运，为你的网站干杯！

***推荐阅读*T3】**

*   ArsDigital Systems Journal:构建一个可扩展的电子商务解决方案——这是一个关于如何构建一个合适的可扩展网站的很好的概述。
    [http://ccm.redhat.com/asj/building-scalable-ebusiness/](http://ccm.redhat.com/asj/building-scalable-ebusiness/)
*   CVS 教程——你应该尽可能地使用 CVS。是你的朋友！
    [https://www.sitepoint.com/article/831](https://www.sitepoint.com/blog/)
*   rsync 主页
    [http://samba.anu.edu.au/rsync/](http://samba.anu.edu.au/rsync/)
*   阅读更多关于“我热不热”的故事
    [http://webtechniques.com/archives/2001/05/hong/](http://webtechniques.com/archives/2001/05/hong/)
*   来自 mydomain.com 的免费循环域名系统
*   对循环网络服务器
    [http://www.onjava.com/pub/a/onjava/2001/09/26/load.html](http://www.onjava.com/pub/a/onjava/2001/09/26/load.html)的精彩描述
*   mysql 数据库复制。自动保持许多从数据库与主数据库相同。
    [http://www.mysql.com/doc/en/Replication.html](http://www.mysql.com/doc/en/Replication.html)

## 分享这篇文章