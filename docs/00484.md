# 以正确的方式提交对代码库的更改

> 原文：<https://www.sitepoint.com/committing-changes-right-way/>

好的和坏的提交之间的差别是巨大的。问你的同事或者过去的自己某个特定的变化是什么，或者事情的现状是什么，这一点都不好玩。如果您以正确的方式提交对代码库的更改，您可以避免以后的麻烦。

本文旨在为软件提交的最佳实践提供一个全面的指南。

## 何必呢？

如果你已经在 GitHub 上存储了你的项目，你可能会假设这些文件是安全的，并且无论何时你需要更新代码，你都会提取更改，这就足够了。所有这些都可能是真的。但是，让我们看看通过多做一点，你可以避免哪些潜在的问题，以及如果你这样做了，会有哪些额外的好处。

### 无论是团队还是个人，没有人是一座孤岛

上面的推理通常来自于习惯独自工作的开发人员。但是当他们需要和其他人分享代码的时候，我们可以预料事情会变得很混乱，需要很多解释。喜欢，*很多*。

记住我们的工作不仅仅是写代码。我们还需要管理事情，这需要一定程度的组织和方法。虽然在团队中工作更容易暴露组织不良导致的问题，但我们自己工作时也可以从更好的方法中受益。

## 原子提交与膨胀提交

我们都需要恢复一个小的改变，当一个大规模的提交改变了几十个文件并增加了多个特性时，我们发现自己在寻找它。如果回滚位于一个仅解决特定问题的提交中，会容易多少？

### 凌乱臃肿的方式

```
git add *
git commit -m "new components" 
```

在本例中，我们可以断定大量文件受到了影响。此外,“新组件”消息并没有告诉我们太多东西——比如哪些组件，这些组件的哪些功能，以及该功能是新的还是重构的。此外，是否正在解决任何现有的错误？

当我们需要改变或恢复某些东西时，这些信息将非常重要。我们将试图在干草堆中寻找一根针，而我们可能最终只是查看代码库，并在调试时花费宝贵的时间。

### 原子方式

```
git add ui/login.html static/js/front-end.js
git commit -m "validate input fields for login" 
```

现在我们有所进展，因为我们开始对*one 提交的情况有了更清晰的认识。*

诀窍是*我们可以半自动地提交变更，作为我们工作流*的一部分。也就是说，做一个的*块，做一些非常具体的事情(实现特定的功能，修复错误，优化算法)，测试(如果需要的话，写一个单元测试)，在我们记忆犹新的时候添加一个描述，然后马上提交。冲洗并重复。*

## 良好提交的结构

这些规则不是刻在石头上的，但是可以帮助你估计一个好的提交应该是什么样的:

*   **明确的**:没有第二次猜测那些提交的改变做了什么。
*   **有洞察力的**:清楚地描述代码做了什么，甚至在必要时提供链接或额外的信息，并标记正在解决的 bug 或问题。
*   **原子**:一次处理一件事情(想象一个“工作块”，可能是 20 分钟到 2 小时，如果是快速修复的话，甚至是 2 分钟)。

让我们来看一个模板，并对其进行分解:

```
<type/component/subsystem>: <subject>
<BLANK LINE>
<body> 
```

### 类型、组件或子系统

这将是一个软件项目中可以组合在一起的一组功能。例如， [AngularJS 调用类型](https://github.com/angular/angular.js/blob/master/DEVELOPERS.md#commits)，或者 [SrummVM 调用子系统](https://wiki.scummvm.org/index.php/Commit_Guidelines)。

#### 例子

在我的项目中，我经常使用术语“组件”，例如:

*   i18n，l18n
*   证明
*   其他，第三方
*   质量保证，测试
*   工具
*   用户界面，GUI

### (必修)科目

主题是一个简单、直截了当的行，它描述了提交做了什么，这样每个人第一眼就能有一个明确的想法。

在设置主题格式时，我通常遵循以下简单的原则:

1.  使用祈使句(“change”而不是“changed”)
2.  第一个字母不要大写
3.  没有句号(。)在最后
4.  如果有可选的正文，则追加“(…)”

#### 例子

以下是一些有效的主题:

*   i18n:支持简体中文
*   auth:重构 Google 登录
*   其他:添加 jQuery 3.4.1
*   QA:通过 AWS 部署测试(…)

如您所见，这些提交做了什么并不需要猜测，在最后一次 QA 提交中，我们还可以看到更多可用的信息(可能是相关文档的链接，或者是对修复的进一步解释)。

### (可选)主体

有时候，我们需要提供比主题行更详细的信息来提供上下文，比如在修复一个持久的 bug 时，或者在破解一个算法时。

在这些情况下，您可以简单地输入一个双断行(这样主题就像标题一样)，并根据需要输入尽可能多的信息。

#### 例子

对于我们之前的 QA 提交，我们可以这样做:

```
QA: pass AWS deployment test (...)

I added a `DJANGO_SETTINGS_LIVE` environment variable to 
[AWS Elastic Beanstalk](https://aws.amazon.com/elasticbeanstalk/)'s 
`django.config` file, so that the synchronization management commands 
in `db-migrate` are _only_ executed in production. 
```

正如你所看到的，身体可能更难跟随，这没关系，因为它是为那些积极寻找更多细节的人准备的。任何人都可以通过阅读主题来了解 commit 做了什么，而主体将为进一步的上下文服务，节省我们在 Slack 上来回的电子邮件或交流！

——“嘿，你怎么去了……”

—“阅读提交文件😑."

## 不要忘记解决问题！

最后，还有解决问题的问题(双关语！).任何像样的大中型软件开发项目*都应该*使用[问题跟踪器](https://en.wikipedia.org/wiki/Issue_tracking_system)作为跟踪任务、改进和 bug 的一种方式——无论是[亚特兰大吉拉](https://www.atlassian.com/software/jira)、 [Bugzilla](https://www.bugzilla.org/) 、 [GitHub 的问题跟踪器](https://guides.github.com/features/issues/)还是其他。

### 问题管理

如果您不知道，大多数系统都可以通过提交消息来管理问题！

您可以:

*   **关闭** / **解决**问题
*   重新**打开**之前已经关闭的问题
*   **搁置**一个问题，如果一个功能被推迟到以后

所有需要做的就是使用这些关键字和问题的 ID 号。

### 例子

*   工具:用 cron 作业合并数据库数据；解决方案 46
*   UI:添加例程以序列化用户输入；发现错误，打开 32 号门
*   auth:注释掉脸书登录；第 12 号货舱

此外，即使您不想修改某个问题的状态，也可以引用该问题作为提供上下文的一种方式，例如，“参见#12”。

所有这些引用对于任何在 tracker 上打开该问题的人都是可见的，这使得跟踪给定任务或 bug 的进度变得容易。

## 包装它

你不会总是做对的(我就是这样，不会！).事情会变得混乱，有时你会不遵守你为自己或团队设定的规则——这是过程的一部分。但希望你知道，只要对你的工作流程进行一些升级，你就可以变得非常有条理，从长远来看，可以为你自己和你的团队节省时间。

我还从经验中发现，一个项目是涉及 10 个开发人员还是完全由你来处理没有什么区别。简而言之，**以正确的方式提交对代码库的更改——这是良好项目管理的关键部分**。

### 进一步阅读

*   [用你的 Git 历史讲故事](https://about.futurelearn.com/blog/telling-stories-with-your-git-history)。Seb Jabocs 在 FutureLearn 上的一篇有趣的文章。
*   [Angular 的提交消息指南](https://github.com/angular/angular.js/blob/master/DEVELOPERS.md#commits)。即使你不使用 Angular，这也是一个有用的阅读。
*   [FreeBSD 委员会指南](https://www.freebsd.org/doc/en/articles/committers-guide/)。如果有的话，关于这个主题的深入指导。
*   如何在你的代码库中正确组织文件&避免混乱。我们解释了如何组织大型和小型项目的文件，提供了一些易于遵循的最佳实践。
*   [跳跃启动 Git](https://www.sitepoint.com/premium/books/jump-start-git?utm_source=blog&utm_medium=articles) 。这本简明的指南旨在帮助初学者在一个周末内快速掌握 Git。
*   [职业饭桶](https://www.sitepoint.com/premium/books/professional-git?utm_source=blog&utm_medium=articles)。Wiley 的这本书更进了一步，给了开发者成为 Git 大师所需的深度。

## 分享这篇文章