# 文件捆绑和 HTTP/2:重新思考最佳实践

> 原文:[https://www.sitepoint.com/file-bundling-and-http2/](https://www.sitepoint.com/file-bundling-and-http2/)

*这是我们最新的 JavaScript 时事通讯的社论，[订阅这里](https://www.sitepoint.com/newsletter/)*

如今，几乎所有的 JavaScript 应用程序都会使用构建过程。即使您不是从 ES2015 或 TypeScript 进行转换，对您的代码运行某种连接和缩小过程已经成为标准做法。这样做的原因是，发出一个 HTTP 请求需要相当大的开销。提供更少、更大的文件比许多更小的文件更有效。随着 web 底层协议的下一个版本 [HTTP/2](https://www.sitepoint.com/http2-the-pros-the-cons-and-what-you-need-to-know/) 的采用，可能是时候重新思考最佳实践了。

HTTP/2 基于 Google 的 [SPDY](https://en.wikipedia.org/wiki/SPDY) 协议，开发该协议是为了改善页面加载延迟，并提高现有 HTTP 1.1 标准的安全性。新协议的工作始于 2012 年，第一个开发版本是 SPDY 的直接副本。最终确定的标准于 2015 年 5 月发布，今年 5 月，谷歌宣布他们将不再支持 Chrome 中的 SPDY。

HTTP/2 和它的前身有什么不同？一个主要的区别是 HTTP/2 是一个*二进制*协议，不是基于文本的。这使得它更紧凑，解析更有效，并且不容易出错。该协议的主要优势之一是它是多路复用的，这意味着多个文件可以在一个连接上传输。另一个被吹捧的特性是服务器推送，它允许服务器在请求资源之前将资源传输到客户端，预先填充缓存。

对新协议的支持非常好，包括所有主流浏览器。服务器端，Apache2，Nginx，微软 IIS 都支持，还有 Node.js 及以上版本。大多数浏览器供应商已经声明他们将只支持 TLS 上的 HTTP/2 连接，尽管随着提供免费 SSL 证书的 Let's Encrypt 的出现，这是一个很容易满足的要求。根据 W3Techs 今年 6 月收集的数据，在排名前 1000 万的网站中，约有 8.4%支持新协议。如果你是 Chrome 用户，你可以使用 [HTTP/2 和 SPDY 指示器扩展](https://chrome.google.com/webstore/detail/http2-and-spdy-indicator/mpbpobfflnpcgagjijhmgnchggcjblin)来告诉你你访问的哪些网站是通过 HTTP/2 服务的。

HTTP/2 的采用对 JavaScript 开发者意味着什么？我们目前将多个文件连接成包的做法使得浏览器很难有效地缓存我们的代码:在一个模块中更改一行代码需要重新下载整个捆绑文件。由于 HTTP/2 的多路复用使得请求相对便宜，我们可以选择将代码分成更小的包，并更好地利用缓存来确保我们的应用程序有效地利用用户的带宽。

但是，如果请求很便宜，我们就应该完全放弃捆绑销售吗？乍一看，这似乎有道理，但是 HTTP 请求的成本并不是唯一要考虑的因素。Web 服务器在处理大量文件的效率上也有限制。随着 JavaScript 社区向更小、更集中的模块发展，将这些文件提供给客户机而不进行某种捆绑是不理想的。最重要的是，将文件组合在一起可以实现更好的压缩，节省带宽。

那么，什么时候应该考虑转换到 HTTP/2 呢？答案是，看情况。尽管浏览器支持非常好，但是如果你的目标用户仍然停留在 IE 的旧版本上，那么你就不走运了，所以一定要检查你的访问者统计，看看这是否有利于你的大多数用户。我从这一切中得到的是，对新协议的支持和采用令人惊讶地遥遥无期，作为开发人员，这是一个我们不能忽视的趋势。

你采用什么样的捆绑策略？您是否正在考虑转换到 HTTP/2，或者您可能已经这样做了？请在评论中告诉我！

## 分享这篇文章