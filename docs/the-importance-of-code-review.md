# 代码审查的重要性

> 原文：<https://www.sitepoint.com/the-importance-of-code-review/>

每个开发人员都知道平庸错误的痛苦。这里有一个错误的属性，那里有一个拼写错误的属性，一个意外复制的代码行，你错过了它，因为你参加了 16 小时的黑客马拉松。如果您感到疲劳和心烦意乱，即使是在开始 PHP 标记之前，因为在基于 Java 的 IDE 预热和重新定位光标之前开始输入而不小心放在那里的一个简单的$也会让您连续几个小时挠头。如果你有一双全新的眼睛来审视自己的所作所为，这些错误肯定很容易避免吧？

维基百科对代码审查的定义如下:

> 代码审查是对计算机源代码的系统检查(通常称为同行审查)。它旨在发现并修复在初始开发阶段被忽略的错误，提高软件的整体质量和开发人员的技能。评审以多种形式完成，如结对编程、非正式走查和正式检查。

这个定义非常精确——用更通俗的术语来说，代码评审就是让别人查看你的代码，找出你遗漏的错误。

## 代码评审的类型

正如维基百科的定义所暗示的，有许多不同的方法来检查代码的缺陷。下面是其中一些的快速分解:

*   OTS(肩后)评审——这是小团队通常处理代码评审的方式。一个开发人员会写大量的代码，然后叫另一个开发人员过来看看。另一个开发人员坐在那里，而第一个开发人员一行一行地解释他做了什么。通过这种叙述，最初的开发人员注意到了他自己的一些错误并改正了它们，而 OTS 的开发人员注意到了其他人，并把他们指出来。他们还就某些问题的解决方案分享意见，最初的开发人员有时会在评审过程完成后重做这些问题，要求再次评审。如果开发人员在远程，这也可以通过屏幕共享软件和语音聊天来轻松完成。
*   **工具辅助评审**——在线和离线都有各种工具来辅助代码评审。虽然详细查看提供的各种工具超出了本文的范围，但我们可以概括地说，有付费版本( [Atlassian Crucible](http://www.atlassian.com/software/crucible/overview "Peer Code Review Tool | Atlassian Crucible") 、 [CodeCollaborator](http://smartbear.com/products/software-development/code-review/code-review-tools "Code Review Tool CodeCollaborator") )、免费版本( [Review Board](http://www.reviewboard.org/downloads/ "Downloads | Review Board") )或者，如果您是单独开发人员，还有社区版本( [Stack Exchange Code Review](http://codereview.stackexchange.com/ "Code Review - Stack Exchange") )。不管使用哪种工具，每种工具的作用都差不多——它检索源代码的最新变更，并将它们标记为需要审查。同行——意味着同等或更高技能的开发人员——然后审查代码，将它标记为已审查或标记任何发现的错误并提出建议，并通过将它发送回原始开发人员来完成或重新启动过程。值得注意的是，许多流行的 ide 都有代码审查插件。
*   结对编程(Pair Programming)——一种非常动态的代码审查类型，结对编程是两个开发人员的热门“游戏”,其中一个开发人员编码，另一个坐在他旁边跟踪他的进度。在数百行代码之后，或者在他们到达一个预定的里程碑之后，他们会休息一会儿并交换位置。编码的人现在观察，而先前观察的人现在编码。这在避免 bug 和提高整体代码质量方面极其有效，但却要花费两倍的人力。许多公司没有为这样的风险做好准备，不幸的是，除了“两台机器上的两个人比一台机器上的两个人做更多的工作”之外，他们无法从其他角度思考。正是这种类型的审查产生了最好的结果:不仅直接避免了 bug，而且两个开发人员直接合作，并分享他们在开发过程中遇到的问题的解决方案。同样没有价值的是，这种类型的评审在不习惯它的团队中难以实现——它主要在年轻的团队中工作。

顺便说一句，还有一种正式类型的审查，由迈克尔法甘在 20 世纪 70 年代首次提出并研究(这种方法也被称为法甘检查)，现在有点过时，在行业中不受欢迎。正式检验很少在小团队中使用，主要是针对价值数百万美元的产品，因为它非常耗费脑力和金钱。它包括几个人(最多六个)坐在一起用投影仪审查代码。每个参与者都被分配了一个角色(如读者、版主或审核者),当团队注意到任何类型的 bug 或缺陷时，所有的事情都会被详细描述——从严重性，到实际的代码行，到原因和影响，甚至是这个 bug 到达客户的预计成本。这是迄今为止最专业的代码审查类型，但也是最让开发人员沮丧的，因此没有被广泛采用。研究表明，如果使用正确，其他代码审查方法也同样有效，不需要这么长时间束缚那么多人。

## 代码审查的最佳实践

一旦决定实现代码审查，可能会有一些障碍需要克服。管理层可能看不到评审花费额外时间的合理性，或者一些程序员可能认为评审是对他们努力创建的代码的人身攻击。当实现代码评审时，这里有一些你应该牢记在心的提示。

1.  知道自己的常见错误，并积极地去战胜它们。在工作中，每个开发人员都会犯一些错误，不管他有多深入“领域”。我们每一个人都有这种小故障，只是愚蠢的，被别人直接注意到。记下这些失误。又忘记过滤输入了？又忘了评论一个方法…了？有了这样的列表，开发人员可以在要求审查之前主动找出那些错误。这就是所谓的自我效应——你知道你的代码即将被审查，你不想听到审查者说“哦，你又忘记过滤输入了！”你想成为摇滚明星，忍者，让别人说“哇，这其实是一个很好的解决方案”的人。自我效应会驱使你在别人有机会看到你的代码之前改进它。
2.  同行代码评审意味着由同等或更高技能的人进行评审。作为一个常识，当一个低年级学生评审一个高年级学生的代码时，代码评审是无法进行的。低年级学生可能会注意到一些常见的差异、违反标准、打字错误，甚至像输入过滤这样的错误，但通常无法识别更大的问题。这通常需要根据团队中的技能定义一个层级，如果还没有的话。
3.  具有清晰里程碑的更少代码意味着更好的评审。只有在达到个人里程碑之后，才应该审查代码，这些里程碑应该很小，并且应该经常发生。在面向对象编程中，这一点尤其重要，但也特别可行。完成了一个新组件，该组件扩展了一个接口，该接口与一个已经审核过的适配器相关联。终于用一种特殊的方法解决了困扰部门一周的问题？太好了！一个组件接一个组件，并且一次最多保持 700-800 行代码(包括注释),这是绝对最有效的评审过程。让你需要评审的代码保持简短、简洁和独立，在完成后尽快进行评审，而此时想法还在你的脑海中。请记住——时间是昂贵的，所以也不要占用太多时间！一个小时应该足够完成这个“章节回顾”了。
4.  **收集指标。如果你使用更结构化的代码评审类型，比如工具辅助的或者正式的，这就更容易了，但是在 OTS 也可以完成。试着记下你在给定的代码行数和时间单位内发现的错误和失误的数量和类型。汇总开发人员的数据，轻松找出谁最需要帮助，谁违反了最多的标准，以及通过进行代码评审，您实际上为您的公司节省了多少资金。很快你将能够实际量化代码审查的有用性，只有到那时，公司中的每个人才会对它产生积极的兴趣。这通常是评审中最难实现的部分，因为很少有开发人员有耐心进行手工统计，但是如果采用的话，这将是有益的。**
5.  注意社交方面——发现漏洞是好事，而不是坏事！务必记住，找到 bug 是好事，而不是坏事。永远不要指责或挑出一个犯了错误的开发人员，让它成为非正式的。让人们适应代码审查——帮助你的同事接受它，而不是害怕它。代码审查不仅有用，而且很有趣。请记住，更多的时间和更困难的任务等于更多的错误——错误的数量并不表明开发人员的技能！如果你是经理或团队领导，确保没有人认为代码评审是消极的或浪费时间的。确保他们不把它看作是公司强制执行的规则，而是对他们日常工作流程的改进，不管他们为哪家公司工作，他们都应该遵守。只要有可能，争取一种个人的代码评审方法。如果你使用工具，在 OTS 也要使用。在接受代码评审为你的朋友的过程中，相互集思广益和非正式讨论问题的潜在解决方案的个人方法是非常宝贵的。

## 最后

代码审查很难实现，尤其是在一个不习惯它的老团队中。但是一旦完成，它不仅会减少代码中的缺陷数量，还会增加协作并帮助团队建设，改善开发人员之间的“兄弟情谊”,并将在整个团队或部门中传播最佳实践和技能改进。任何类型的代码审查都比没有好，所以如果你的团队今天没有使用它，建议使用它。这只会有所帮助。如果你是一个单独的开发者，找一个志趣相投的人一起审查代码——上网，社交，扩大你的开发圈子，团队合作。不要将其他开发人员视为竞争对手，将代码评审视为你的敌人，将其他人视为战友，将代码评审作为你完美前线的武器。

<small>图片 via[Fotolia](http://us.fotolia.com/?utm_source=sitepoint&utm_medium=website_link&utm=campaign=sitepoint "Royalty Free Stock Photos at Fotolia.com")</small>

## 分享这篇文章