# HTML5 输入元素的状态

> 原文:[https://www . site point . com/the-state-of-html 5-input-elements/](https://www.sitepoint.com/the-state-of-html5-input-elements/)

![Alice and input element overwhelm](../Images/155d63ac6b6b921cffb8fd4aa58d3893.png)

最近我在做一个需要日期和数字字段的项目。作为一个纯粹主义者，我更喜欢原生元素，而不是臃肿的 JavaScript 库。“Polyfills 可以覆盖过时的浏览器，”我想，“这样我们就可以在现代浏览器上保持最佳体验。”

这个特别的项目将在欧洲的几个国家进行。几乎每个国家都有自己的日期和数字格式。这让我对以下事情感到好奇:

*   HTML5 输入字段的区域设置会受到影响吗？
*   字段的期望值格式是否明显？
*   浏览器有没有其他方法来防止误解？

## 如规范所定义的

W3 有几个段落致力于 HTML5 输入元素的本地化:

> 页面以有线格式给出的时间、日期或数字然后在显示给用户之前被翻译成用户偏好的表示(基于用户偏好或页面本身的地区)。类似地，在用户使用他们喜欢的格式输入时间、日期或数字之后，用户代理在将它放入 DOM 或提交之前将其转换回有线格式。”–[4.10.1.5 日期、时间和数字格式](https://www.w3.org/TR/html5/forms.html#input-author-notes)

> 鼓励浏览器使用根据输入元素的语言所暗示的地区或用户偏好的地区的约定来呈现日期、时间和数字的用户界面。使用页面的区域设置将确保与页面提供的数据保持一致。–[关于表单控件本地化的 4.10.5.2 实施说明](https://www.w3.org/TR/html5/forms.html#input-impl-notes)

规范状态输入应该从页面或用户设置中继承区域设置。该规范还说明了*为什么*页面的区域设置优于用户设置。不幸的是，没有提供关于浏览器应该如何显示预期格式的进一步信息。

## 问题

这些规范显然推荐在用户或页面的本地呈现元素。不幸的是，有些浏览器只是使用用户的语言环境，而不是页面的。这可能会导致一些混乱和无效的输入。

考虑下面的例子:

![Example where number formatting results in odd input](../Images/0d59993ebc44111386dd977a32828406.png)

从英语语境来看，这一切似乎很正常。与此同时，在一些办公室里:“啊。一个荷兰人插了两万五的身体质量指数。那一个人一定和国家本身一样大！LOL。”如果浏览器为数字字段选择了荷兰语区域设置，并且用户认为需要英语格式，因为这毕竟是一个英语页面，那么浏览器将会错误地解释和提交值。

## 解决方案

显然，简单的输入字段不足以防止混淆和错误。解决方案相当容易预测:

*   显示预期的格式
*   约束用户输入

如果浏览器总是继承页面区域设置，则可以在应用程序中构建提示。没什么大不了的。

如果我们不能确定浏览器继承了什么，提示就成了浏览器的责任。通过占位符进行提示是一种可能，但是当字段被预填充时，占位符是不可见的。工具提示或类似的东西可能会与应用程序工具提示或其他内容重叠。

约束输入是另一种选择。这可以简单到忽略字符，或者使用`pattern`-属性指定格式。对于更复杂的值，可以使用只允许用户选择预定义值的弹出窗口，如日历或选择框。

![Datepicker on iOS](../Images/84fb6cb820ecd38dd6dec772379b520e.png)

## 什么浏览器做什么

由于规范没有非常明确地说明浏览器应该如何实现区域检测或者输入应该如何工作，所以当前的实现非常不同。我通过测试每个浏览器的以下三个问题来回答我的三个问题:

*   浏览器如何确定字段的区域设置？
*   字段的期望值格式是如何变得明显的？
*   不管解释如何，该字段可以安全无误地使用吗？

注意:以连字符(-)作为值的输入类型意味着浏览器不支持该输入类型。

### 谷歌浏览器(52)

#### 确定区域设置

| 环境 | 结果 |
| --- | --- |
| HTML 语言属性 | 不 |
| 内容语言标题 | 不 |
| 用户语言设置 | 是 |

Chrome 使用浏览器语言，或者更确切地说是操作系统语言来确定语言环境。其他的都忽略了。

#### 错误预防

| 输入类型 | 揭示预期格式 | 约束输入 | 安全吗？ |
| --- | --- | --- | --- |
| 日期 | 通过占位符 | 数字只分为三个部分，和一个日期选择器 | 不适用于预填充字段 |
| 月 | 通过占位符，但不是很清楚 | 月基于单字母键盘输入，年只是数字 | 令人困惑，但安全 |
| 周 | 通过占位符 | 两个分量都是数字 | 是 |
| 时间 | 通过组件分隔符 | 两个分量都是数字 | 是 |
| 日期-时间 | 通过占位符和组件分隔符 | 与日期+时间字段相同 | 不适用于预填充字段 |
| 数字 | 不 | 科学记数法的数字、符号和“E” | 不 |

### 火狐浏览器(48)

[MDN 状态](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input#Localization):

> Firefox 使用以下试探法来确定验证用户输入的区域设置(至少对于 type="number "):
> 
> *   尝试该元素或其任何父元素的阿郎/xml:lang 属性指定的语言；
> *   尝试任何内容语言 HTTP 头指定的语言，或者
> *   如果没有指定，则使用浏览器的区域设置。

这听起来很有希望。

#### 确定区域设置

| 环境 | 结果 |
| --- | --- |
| HTML 语言属性 | 是 |
| 内容语言标题 | 是 |
| 用户语言设置 | 是 |

#### 错误预防

| 输入类型 | 揭示预期格式 | 约束输入 | 安全吗？ |
| --- | --- | --- | --- |
| 日期 | – | – | 不 |
| 月 | – | – | 不 |
| 周 | – | – | 不 |
| 时间 | – | – | 不 |
| 日期-时间 | – | – | 不 |
| 数字 | 不 | 不 | 不 |

或许 Firefox 仍在试图找出本地化策略？

### Safari (9.1)

#### 确定区域设置

| 环境 | 结果 |
| --- | --- |
| HTML 语言属性 | 不 |
| 内容语言标题 | 不 |
| 用户语言设置 | 是 |

#### 错误预防

| 输入类型 | 揭示预期格式 | 约束输入 | 安全吗？ |
| --- | --- | --- | --- |
| 日期 | – | – | 不 |
| 月 | – | – | 不 |
| 周 | – | – | 不 |
| 时间 | – | – | 不 |
| 日期-时间 | – | – | 不 |
| 数字 | 不 | 不 | 不 |

### Safari (iOS 8.4)

#### 确定区域设置

| 环境 | 结果 |
| --- | --- |
| HTML 语言属性 | 不 |
| 内容语言标题 | 不 |
| 用户语言设置 | 是 |

想必这和 OS X 的狩猎旅行是一样的。我希望这两个会保持一致，或者至少相似。

#### 错误预防

| 输入类型 | 揭示预期格式 | 约束输入 | 安全吗？ |
| --- | --- | --- | --- |
| 日期 | 不 | 是，多选弹出窗口 | 是 |
| 月 | 不 | 是，多选弹出窗口 | 是 |
| 周 | – | – | 不 |
| 时间 | 不 | 是，多选弹出窗口 | 是 |
| 日期-时间 | 不 | 是，多选弹出窗口 | 是 |
| 数字 | – | 不 | 不 |

有趣的是，iOS 确实支持各种 HTML5 输入类型。通过一个简单的多选弹出窗口，它们约束输入，使所有可能的值都有效。

### 边缘

#### 确定区域设置

最近，微软声称 Edge 是第一个完全支持 HTML5 的浏览器。我想知道这是否包括本地化。

| 环境 | 结果 |
| --- | --- |
| HTML 语言属性 | 不 |
| 内容语言标题 | 不 |
| 用户语言设置 | 从操作系统继承 |

除了美国英语，我无法让 Edge 在任何语言环境下显示输入字段。Edge 似乎继承了 Windows 的语言设置。

#### 错误预防

| 输入类型 | 揭示预期格式 | 约束输入 | 安全吗？ |
| --- | --- | --- | --- |
| 日期 | 通过占位符 | 是，多选弹出窗口 | 是 |
| 月 | 通过占位符 | 是，多选弹出窗口 | 是 |
| 周 | 通过占位符和组件分隔符 | 是，多选弹出窗口 | 是 |
| 时间 | 通过占位符和组件分隔符 | 是，多选弹出窗口 | 是 |
| 日期-时间 | 通过占位符和组件分隔符 | 是，多选弹出窗口 | 是 |
| 数字 | 不 | 不 | 不 |

用于上述测试的测试页面在 GitHub 上有[。](https://github.com/sitepoint-editors/HTML5-input-i18n-test)

## 结论

尽管输入字段本地化*被*实现，我们开发者不能在除 Firefox 之外的任何浏览器中控制它。即使您研究出用户是否希望字段格式使用与页面或用户计算机相同的区域设置，这也是一个糟糕的选择。

不幸的是，浏览器也不清楚预期的值格式是什么。有些浏览器对某些元素做得相当好，但是许多提示太模糊或者不总是能排除错误。

幸运的是，一些浏览器确实了解这些问题，并制作了实际上非常有用的弹出窗口，消除了无效输入的可能性。在这些情况下，格式就变得无关紧要了。我确实想知道这对用户体验有什么影响，因为其中一些比依赖格式的兄弟更难使用。

现在最大的问题仍然是:我们应该使用带有聚合填充的 HTML5 输入字段，还是应该等待浏览器改进它们的实现？带有聚合填充的 HTML5 输入元素应该是标准选择。如果你的产品在多个国家都有销售，请列出你需要的领域以及它们的“风险”有多大。如果出于某种原因，它们可能包含无效的输入，您可能希望考虑使用其他输入元素、带有`pattern`属性的文本输入元素或 JavaScript。

## 分享这篇文章