# Rails 开发者的 DDD。第 2 部分:实体和值

> 原文:[https://www . site point . com/DDD-for-rails-developers-part-2-entities-and-values/](https://www.sitepoint.com/ddd-for-rails-developers-part-2-entities-and-values/)

在我上一篇关于 Rails 开发人员的 DDD 的文章中，我谈到了使用分层架构来处理领域复杂性。我展示了一些典型的违反分层体系结构的情况，并给出了一些关于如何修复它们的建议。

## 领域驱动设计的构建模块

这一次我想开始谈论领域驱动设计的构建模块，以及它们如何被用于建模。

## 实体和值

在领域驱动设计中，实体和值对象之间有一个重要的区别。

*   "一个实体不是由它的属性定义的，而是由一系列连续性和同一性定义的."实体的一个例子是银行账户。我们的系统中可以同时存在多个银行账户。他们中的一些人可以被分配到同一个分支机构或拥有相同的所有者，但只要他们有不同的身份，我们的系统就要将他们视为不同的帐户，这一点很重要。在 Rails 应用程序中，实体的身份通常由自动生成的主键来表示。

*   "值对象是描述一些特征或属性的对象，但没有身份的概念."由于没有同一性，当两个值对象的所有属性都相等时，它们就是相等的。货币就是价值对象的一个例子。

## 关于实体的更多信息

在 Rails 社区中，我们对什么是实体有很好的理解。实际上，几乎每个扩展 ActiveRecord::Base 的对象都是一个实体。

#### 实体具有以下特征:

*   实体关心他们的身份。身份通常用自动生成的主键来表示，用来比较两个实体。
*   他们是可变的。唯一不能更改的字段是主键。
*   它们有很长的寿命。大多数实体永远不会从数据库中删除。
*   由于实体是可变的和长寿的，它们通常有一个*复杂的生命周期* :
    *一个实体对象被创建。
    *保存在数据库中。
    *它是从数据库中读取的。
    *更新完毕。
    *已删除(或标记为已删除)。

由于可变性和复杂的生命周期，处理实体是复杂的。因此，每次你定义一个实体时，考虑一下你将如何持久化它，你必须使什么属性可变，什么集合(在下一篇文章中更多关于集合)应该包含它，等等。

## 更多关于价值观

另一方面，值对象在 Rails 社区中没有得到充分利用。因此，大多数 Rails 应用程序都受到原始困扰:

*   整数和字符串等原始值用于表示领域的重要概念。

首先，由于处理一组属性的逻辑分散在几十个类中，原始的困扰通常是代码重复的一个来源。第二，使用原语而不是特定领域的抽象会使高层服务变得杂乱，包含不必要的细节，并使代码的意图不明确。价值对象为原始痴迷提供了一个很好的补救方法。

#### 值对象具有以下特征:

*   值对象没有标识。
*   它们是不可改变的。例如，3 加 5 不会改变这些值中的任何一个。而是返回一个新值。理想情况下，使用值对象应该像使用原语一样。
*   值对象没有复杂的生命周期。

### 在 Rails 中创建值对象

在 Rails 中有许多创建和管理值对象的方法，我想展示其中的三种。

### 使用`composed_of`

想象一下，我们正在编写另一个博客应用程序。我们决定采用这种模式:

*   博客有很多帖子。
*   每个帖子都有很多评论。
*   帖子和评论具有与其相关联的位置属性。

我们可以这样创建帖子和评论: