# Jetty 6.0 为 AJAX 应用程序提供新的架构

> 原文：<https://www.sitepoint.com/jetty-60-to-provide-new-architecture-for-ajax-apps/>

AJAX 应用程序，即在后台与服务器通信以动态更新显示页面的网站，正越来越多地向没有考虑 AJAX 设计的 Web 服务器提出新的挑战。轻量级的 [Jetty Java Web 服务器软件](http://jetty.mortbay.org/jetty/)将提供一个新的 AJAX 友好的架构，这样就可以支持这样的应用程序，而不会使服务器不堪重负。

大多数 Web 服务器及其遵循的标准都是为处理简单的请求-响应循环而设计的，其中 Web 浏览器将发出内容请求，服务器将尽快返回响应。AJAX 应用程序打破了这种模式，通常要求 Web 服务器在事件发生时发送通知，而不需要浏览器发出特定的请求。

为了在 Web 的现有能力范围内做到这一点，AJAX 应用程序通常会向服务器发送一个请求，并期望该请求不会收到响应，直到服务器希望通知浏览器某个事件(例如，在聊天应用程序中收到一条新消息)。因为 Web 浏览器在一定时间后会放弃等待响应，所以每当超时时，AJAX 应用程序都会重新发出请求。

在浏览器方面，这是一个非常优雅的解决方案。系统的每个用户都有一个“长期请求”,请求服务器通知事件。然而，在服务器端，这可能是一个大问题。

到目前为止，Web 服务器通常是围绕“每个请求一个线程”模型设计的，因此服务器将为每个活动请求分配资源，以便生成对该请求的响应。在非 AJAX Web 应用程序中，这种模型实际上可以支持无限数量的活动用户，只要在任何给定时间只有可管理数量的用户发出请求。

在 AJAX 处理模型中，每个活动用户都有一个对服务器的“长期请求”,这个体系结构崩溃了。1000 个登录用户意味着服务器承受着 1000 个活动请求的负担，为此它将分配 1000 倍于处理单个请求所需的资源。这种负载甚至可以很快压倒一个强大的 Web 服务器。

针对这一困境的创新解决方案正在 Jetty 6.0 的当前 Alpha 3 版本(T3)中进行测试。一个叫做**延续**的新特性允许 Web 应用程序“暂停”请求，这样它就不会消耗任何资源，直到应用程序准备好为它产生响应。

起初，我对这个公认很酷的想法有点警惕。Jetty 严格遵循的官方 Java Servlet API 没有以这种方式打破每个请求一个线程的模型。因为 Java Web 开发是建立在跨服务器兼容性的基础上的，所以我担心采用像这样的非标准特性可能会非常具有破坏性。

事实证明，Jetty 团队应该得到比我所给予的更多的信任。按照他们设计 Continuation API 的方式，任何符合标准的 Java Web 服务器(也就是所有的服务器)都会像往常一样，简单地停止并等待线程中的一个事件，以获得一个“持续请求”。然而，在 Jetty 6.0 上，这种延续实际上会导致请求失败，Jetty 会在内部捕获一个异常，将请求放入队列中。这种失败释放了负责请求的线程(从而解决了请求负载问题)，但是将请求保留在文件中，直到 Web 应用程序希望通知客户端一个事件，此时，文件中的任何“长期请求”都将恢复生命并从头开始处理，就像它们刚刚被接收一样。

从浏览器的角度来看，整个事情是透明的。发送“长期请求”,当服务器上发生事件时，服务器对其进行响应。

Jetty 的首席开发人员 Greg Wilkins 在一篇博客文章中详细介绍了新的 Continuations API，并提到如果开发人员的反馈是积极的，他将提交该特性以包含在官方 3.0 Servlets API 中。

## 分享这篇文章