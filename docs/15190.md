# 缓存还是检查？

> 原文:[https://www.sitepoint.com/cache-or-check/](https://www.sitepoint.com/cache-or-check/)

网页下载速度慢是当今互联网用户最大的不满。鉴于大多数人仍然使用调制解调器拨号，这影响了很多用户。调制解调器上的“56k”标签代表“每秒 56000 比特(数据)”。由于一个字符的大小约为 10 位，一个(静态的)5k 文件的加载大约需要 1 秒钟。但实际上，你在模拟电话线上的连接速度大约是 40k，如果你考虑到 Sitepoint 论坛的索引页面大约是 80k 大小，在 40k 拨号上网时，加载大约需要 20 秒。

这意味着网上冲浪可能会非常令人沮丧，因为你要无休止地等待一个页面慢慢出现在你的眼前——如果你加载的页面图像过多，情况会更糟。

##### 时间是最重要的

互联网服务提供商(ISP)可以用来帮助克服这个问题的一个工具是使用缓存(发音为“cash”)。高速缓存的概念已经在计算机科学中使用了很多年，这也是为什么今天的计算机看起来如此之快的原因之一。

##### 什么是缓存？

实际上，缓存所做的只是存储以前访问过的数据的副本(或指向这些数据的指针)。计算机架构中的主要实现是使用一小块非常快速的内存(SRAM)来存储最近从主内存(RAM)或硬盘访问的信息的副本，这要慢得多。

例如，打开一个相当大的本地文件(比如 500k 左右)。根据您系统的速度，您第一次访问该文件可能需要 2 到 10 秒才能打开，因为计算机会查找打开该文件所需的应用程序，然后检查该文件以确保它是正确的，最后打开它(如果您安装了防病毒软件，这可能需要更长时间)。

现在，关闭文件，然后再次打开它，它应该会神奇地以更快的速度出现在你的眼前。为什么？因为您系统的内置缓存已经记住了该文件，并且确切地知道从硬盘驱动器的什么地方获取它。

这同样适用于互联网。您的 ISP 不可避免地使用某种缓存，原因很简单，它可以提高网页传送到您屏幕的速度。如果你想知道互联网是如何工作的，这里有一个基本的概要。用户拨号连接到一台“插入”网络的服务器。然后，用户键入他们想要查看的页面的 URL(统一资源定位器，或地址)。这会向 ISP 的服务器发送一个请求。然后，该服务器在互联网上查找指定的地址。如果没有找到任何东西，它将返回一个错误(通常是错误 404 文档未找到)。如果它找到了匹配的地址，它就从主机服务器中检索你想要的文档的副本，并将其返回给你的浏览器，在你的屏幕上显示出来。

无可否认，所有这一切都发生在几纳秒的时间内，但是假设你的 ISP 已经找到了你想要的文件，这时你的拨号速度就起作用了。大文件相当于缓慢的下载时间，一个网络缓存可以在你和你的 ISP 之间加速下载。

##### 缓存是如何工作的？

考虑刚刚发生的例程——您发送一个文件请求，然后服务器去寻找该文件，如果找到了，它会为您获取一个副本。现在，这似乎是这种操作的唯一方式，但事实上它是非常低效的。想象一下，在任何时候都可能有成千上万的用户请求同一个页面。如果没有缓存，ISP 的服务器必须不断返回到同一个地址，为每个请求获取文档。但是，如果使用了 Web 缓存，例程会稍有改变。

Web 缓存基本上是一个存储文档副本的大硬盘。因此，使用 Web 缓存时，检索网页的操作会发生变化。它现在是这样工作的:第一次有一个页面请求时，你的 ISP 的服务器会在缓存中查找该页面的副本。但是由于这是对页面的第一次请求，服务器找不到它，所以它忙着找到实际的地址，并向用户返回一个副本——但是这一次将文件的副本保存在缓存中。现在，第二次请求该文件时，ISP 的服务器再次在缓存中查找，嘿，很快——请求的文件出现了！然后，它简单地将副本发送回用户。

正如您所看到的，这个过程的效率大大提高了，因为获取文件所需的时间大大减少了，而且服务器可以继续查找和发送其他页面，而不必在网上搜寻这个经常使用的页面。

***看似简单不是吗！？**T3】*

嗯，概念是，但实际上可能会变得棘手。上面的例子描述了拨号用户的情况。不过，这个过程中还存在其他阶段。例如，大多数 Windows 9x 和 NT 用户在他们的机器上都有一个高速缓存，标签为“高速缓存”或“微软友好”术语，临时互联网文件。

为了测试这一点，在互联网上找一个有静态 HTML 文件的站点。让页面完全加载，然后关闭浏览器，切断互联网连接。再次打开您的浏览器，确保它设置为“脱机工作”,并将网址放回您的浏览器。如果一切正常，那么页面应该会显示出来，即使您当前没有连接到 Internet。

我们可以看到，浏览网页的程序又发生了变化。这个过程现在是这样的:从你的计算机发出页面请求，检查你的计算机缓存，然后到 ISP，ISP 检查它的缓存，然后最后它从实际的源头得到页面。开始担心了？我将在后面讨论由此产生的问题。

***不在调制解调器上？**T3】*

此过程适用于拨号连接的单个用户。然后考虑一个大型企业的情况，其中可能有 1-500 人都想上网。很明显，每个用户的机器上都没有调制解调器，因为这需要为每个用户配备一条电话线。取而代之的是，所有的用户都在一个局域网上，这个局域网与互联网有着非常高速的连接。互联网上的页面请求通过网络发送到代理服务器(或路由器),然后由代理服务器处理请求。

对于任何公司来说，这种互联网连接可能是公司通信支出中最大的一块，因为高速互联网连接共享的租赁线路可能非常昂贵。原因是带宽。

任何为网站托管付费的人都会熟悉这个概念。这实际上是对一条数据线一次能够传输的数据量的限制。对于每个被请求的页面，其文件大小会从允许的带宽量中扣除(或累加，取决于您如何看待它)。例如，你的主机可能会说你每月有 4gb 的带宽。这意味着你的 30k 网页可以被请求 133333 次(或大约 13333 次)。如果你的页面被请求的频率超过这个数，你将面临带宽超期费用。

同样的原则也适用于公司使用的电话/数据线路的租赁，尤其适用于国际带宽。

***那又怎样？**T3】*

信不信由你，这些代理服务器也可以配置成使用缓存。我有幸与一家大型企业局域网的系统管理员交谈，他刚刚投资了一大笔钱在一个新的高速缓存设施上。

 **<q>问题 1:为什么要使用缓存？</q>

1.  本地保存的对象比远程对象读取速度快得多，因此网络接收 Web 内容的速度更快。

3.  成本。目前，该公司按使用的国际带宽量收费，通过使用缓存，这一成本可以降到最低。

**问题 2:缓存的容量有多大？它是如何组织的？**

我们(目前)有 2 台 Dell 2550 机器，每台都有 1.5GB RAM 和 18GB 缓存空间。他们每天总共处理大约 800 万个网络请求。我们还与诺丁汉的其他缓存和英国国家缓存进行了比较(如果请求的网页在这些缓存中，它们就从那里获取，而不是直接从网站获取)。

**问题 3:缓存页面多久更新一次？**

缓存的“变动”是七天，尽管缓存会定期检查页面以查看是否有更新的版本。这也是由网站自己控制的，他们可以在页面上设置一个较低的过期时间。此外，动态内容永远不会被缓存。

我们可以看到，网页的路径又改变了。它不再是请求一个页面，然后你的浏览器神奇地返回它，它是这样的:

页面请求> PC 缓存>代理缓存> ISP 缓存>目的地

…有可能增加本地/区域缓存中心、国家缓存中心以及可行的国际缓存中心(会谈正在进行中！).

因此，在你想查看的页面返回给你之前，可能有 7 个不同的硬盘必须被扫描。除非高速缓存设施被正确地配置和索引，否则搜索高速缓存可能是非常耗时的事情。由于互联网服务提供商目前的状况，便宜和快捷是吸引客户的唯一途径。因此，他们必须使用缓存来快速传送网页，并尽量减少支付给电信提供商的带宽费用。

但可悲的是，这往往会导致互联网接入速度变慢！为什么？因为缓存是如此之大，以至于几乎每个请求的页面都被缓存，服务器必须在数百万个页面中搜寻，以查看它是否有该页面的副本。

##### 缓存设施的另一个问题是

我相信您在某个阶段肯定遇到过这种情况:您请求一个页面，但它看起来很旧。你还没有得到最新的版本，因为缓存已经完成了快速扫描，看到了页面地址，并返回给你。这通常很容易通过硬刷新(Windows/IE 机器上的 Ctrl 和 F5)来修复，假设高速缓存被相应地配置(即，检查所有属性[时间、文件大小等等]，而不仅仅是文件名。

如何判断你的 ISP 是否使用了缓存？T3】

嗯，最简单的方法是检查你的连接设置。如果你用的是 Windows 系统，看看互联网选项>连接，然后点击设置。如果代理服务器下的框被填写，那么你可能正在使用缓存，这很可能导致下载速度较慢。您可以通过禁用代理服务器来解决此问题，这将强制您的浏览器绕过代理缓存。

***最大化你电脑的缓存***

正如我前面说过的，缓存对你的影响完全是个人的事情(并且会随着你的 ISP 的速度而显著变化)，但是你可以在你的本地机器上禁用缓存，方法是进入互联网选项>临时互联网文件>设置，然后将滑块向下拖动到 1mb。另一件要做的事是不时清空 Internet 临时文件夹中的内容。不过请记住，这可能意味着你的互联网连接速度较慢，因为它必须从服务器上获取一个新的副本。

##### 不可缓存的

但是某些页面可以免于缓存。您可能已经注意到，在整篇文章中，我一直在谈论静态文件。简单来说，静态文件是一个普通的旧 HTML 文件，没有任何特别的功能(包括 JavaScript、Flash、CSS 等等)，也就是说，只有客户端的页面。当您的浏览器请求一个页面时，它只是检索该页面在主机服务器上的精确副本。

与此相反的是动态页面，它可以被认为是一个在服务器端做一些事情的页面，通常包括数据库的使用。检索动态页面的过程是不同的，因为当页面被请求时，不是自动检索它的副本，而是执行页面内的脚本并返回结果。考虑使用搜索工具——你向搜索引擎请求某样东西，它会自动运行，施展它的魔法，向你展示相关的材料。如果这个过程都是在客户端进行的，那么它只会呈现给你一个包含所有几十亿个链接的大页面。正因为如此，动态页面没有被缓存(如果你使用 PHP，有办法解决这个问题——参见本文。

另一种不被缓存的页面是安全页面，例如任何使用 HTTPS 协议(而不是普通页面使用的 HTTP 协议)的页面。这些页面没有被缓存的原因很明显:你不想要敏感的细节(信用卡信息，电子邮件地址，密码等。)保存了。

当被问到这个问题时，系统管理员回答说:

<q>“如果我们的用户使用我们的指令正确配置他们的机器，那么 https 或安全流量会绕过缓存直接流出网络。即使用户选择(并且他们可以选择)通过缓存发送 https 流量，它也不能被缓存，因为它是完全加密的。缓存只是‘代理’数据。”</q>

因此，您可以放心，缓存不会带来安全威胁。

##### 拥抱缓存？

根据我的经验，应该避免使用主要互联网服务提供商(例如英国的 Freeserve)使用的缓存设施，原因很简单，因为缓存中心太大，页面交付速度会大大降低。然而，本地缓存是一件好事。看看你的网络选项>网络临时文件(在 IE 中)会告诉你你的电脑发生了什么。

这样做的效果会因用户而异，并且取决于您的连接类型，但通常为了最快的浏览速度，应该将它设置为“自动”，而如果您想确保您拥有最新的页面，请选择“每次访问该页面”。

如果你使用任何类型的路由/代理软件，那么你对缓存有最终的控制权。在我南安普顿的房子里，我们有三台电脑通过代理服务器访问互联网。代理已经被配置为只缓存某些东西，比如*。jpg，*。gif 和*。swf，因为这些文件需要较长的下载时间，并且经常在页面之间重复使用。因为实际的页面本身没有被缓存，所以我可以确信页面本身是新的，如果页面发生了变化，任何新的图像都将被下载，但任何不是新的图像只是从缓存中显示出来。

AOL 在处理图像的方式上也采用了类似的方法。它显示的每个图像都被自动压缩和缓存，这就是为什么在 AOL 浏览器中查看的图像与其他浏览器相比经常看起来像块一样。可以关闭此选项，但请记住在关闭后清除您的临时 Internet 文件。

##### 作为网站管理员控制缓存

作为网站开发者，确保网站的可用性最大化是很重要的。这意味着您希望您的页面完全按照您的计划交付，而不是依赖您的用户在旧设计或过时内容的情况下进行更新。有几个技巧可以用来确保发送的是页面的最新副本。

第一种方法很简单，使用适当的头。您可以使用许多元标记来控制缓存:

```
<META HTTP-EQUIV="cache-control" CONTENT="no-cache">    

<META HTTP-EQUIV="pragma" CONTENT="no-cache">    

<META HTTP-EQUIV="expires" CONTENT="Wed, 26 Feb 1997 08:21:57 GMT">
```

第一个标记很明显，但是第二个标记很重要，因为它被设计成停止缓存刷新的页面。要使用最后一个，只需设置一个过去的日期，这样您的浏览器就会认为该页面已经过期，并会自动抓取一个新的副本(即使它没有更改)。

第二个技巧是尽可能使用动态页面，因为这些页面不会被缓存。即使不涉及数据库或动态内容，也可以通过向所有页面添加一些变量来停止页面缓存，比如时间戳或随机数。这将欺骗浏览器，使其认为页面是不同的，并每次都抓取一个新的副本，一个很好的例子可以在[www.genie.co.uk](http://www.genie.co.uk)看到。

##### 缓存或…？

在 Web 页面交付中使用缓存工具是当今关于 Web 可用性最有争议的话题之一。从好的方面来说，Web 缓存可以提高网页的传送速度，但从不好的方面来说，配置不当的缓存会给用户留下毫无意义的旧的、过时的页面。作为一个网站管理员，你必须考虑你的内容和用户群，如果有必要，作出适当的改变，以确保你的内容总是没有缓存。

有关缓存的更多信息，请查看 CacheNow！项目。

## 分享这篇文章**