# PHP 模板引擎 Smarty

> 原文：<https://www.sitepoint.com/smarty-php-template-engine/>

Smarty 是由 Monte Ohrt 和 Andrei Zmievski 编写的 PHP 模板引擎。你说又是一个模板引擎？作者(我也是)不会同意。自作聪明与群体中的其他人不同。Smarty 与其他模板引擎(如 FastTemplate 和 patTemplate)的区别在于，Smarty 将模板编译成 PHP 脚本，消除了每次访问模板时解析模板的开销。这使得 Smarty 非常适合大型应用程序和高流量网站……如果这对您没有任何意义，就认为 Smarty 非常快，在压力大和高流量的情况下也能很好地工作！

除了模板编译之外，Smarty 模板引擎还有其他几个突出的特性，我们稍后将讨论这些特性。但是首先，让我们揭开模板编译的神秘面纱…

##### 模板编译说明

“模板编译”到底是什么意思？网页和编译有什么关系？编译不就是 C++和 Java 程序员做的事情吗？是的——但这是一种不同的编译。

Smarty 解析您的模板，并根据它们创建 PHP 脚本(而不是一般编程中的二进制文件)。然后，当您的 Web 页面被查看时，Smarty 从这些 PHP 脚本中读取，而不是提取模板本身，这样就省去了再次解析模板的工作。Smarty 在何时编译方面也很聪明:它只在您对模板进行更改时重新编译模板，因此您不必担心手动编译模板(这与 JSP 类似，如果您知道它是如何工作的话)。

这样做的好处是，你甚至不需要知道 PHP 脚本在那里，也不需要知道编译是如何工作的。这些都是隐藏的，所以如果你雇佣模板设计者来处理你的模板，他们(或者你，如果你设计你自己的模板)不需要知道 Smarty 是一个“编译模板引擎”。

##### 贮藏

Smarty 还具有内置的模板输出缓存功能。Smarty 缓存模板内容的输出，节省了从数据源检索数据的开销。这种数据源通常是外部的，速度很慢，经常是应用程序的瓶颈，就像远程数据库一样。Smarty 用数据源中的数据缓存模板的输出，使您不必在每次访问网页时都连接到数据库。如果您有一个响应缓慢的数据库服务器，或者正在对数据库进行多次查询，这种缓存特性将极大地提高 Web 页面的性能和响应能力。

当然，在某些情况下，您实际上并不希望缓存模板输出，例如，股票行情自动收录器或您经常对数据库进行更改的情况，这些更改需要立即反映在您的 Web 页面上。没问题！Smarty 同样足够聪明，允许您指定应该或不应该缓存什么。

事实上，在同一个模板页面上可以有缓存和未缓存的部分，因为 Smarty 允许您准确地指定不希望缓存的内容(如页面底部的股票行情自动收录器)和希望缓存的内容(如很少更改的导航栏)。您还可以设置缓存到期时间，以便您的模板输出仅在特定的时间长度内被缓存。因此，您可以在拥有最新的动态内容和快速加载网页之间找到一个中间点。

需要注意的一点(Smarty 的作者很快就指出了这一点)是，这种缓存功能与 Zend Cache、PHP Accelerator 等完全不同。PHP Accelerator 之类的缓存工具缓存 PHP 脚本编译后的字节码，而 Smarty 缓存模板的输出。因此，Smarty 可以与 Zend Cache 协同工作，其中 Zend Cache 将缓存 Smarty 从您的模板创建的 PHP 脚本。基准测试证明，这有助于实现出色的性能。引用作者的话:

<q>*“Smarty 的 performance _ really _ excels 结合 PHP 加速器。”*</q>

##### 可变修饰符

Smarty 还提供变量修饰符，顾名思义，允许您修改变量的内容。您可以将字符串大写(例如，`{$title|upper}`会将您的`$title` 转换为全部大写字符)，截断字符串(例如，`{$content|truncate:30}` 会允许您显示`$content` 的前 30 个字符，并在其后跟随“`...`”，这对于显示电子邮件或论坛主题预览特别有用)，甚至使用正则表达式来搜索和替换字符串(例如，`{$article|regex_replace:"/bad word/":"***"}`会将`$article`中所有出现的“`bad word`”替换为“【T8”)。

变量修饰符让你的模板设计者能够修改你的模板变量，而不会被我们程序员喜欢使用的有趣的字符所迷惑。这种经过净化的“编程”方法让模板设计者对模板变量的格式有了更大的控制，尽管他们需要知道可用的变量修饰符。毫无疑问，它仍然是一个有用的特性，因为语法很简单，甚至非程序员也可以使用。

##### 模板功能

Smarty 提供了用于模板的内置和自定义函数。这些函数类似于 Smarty 模板的 API，只是自定义函数可以修改，而内置函数不能。函数允许你做一些事情，比如程序条件输出(使用`if`语句)、执行动态循环迭代(使用`foreach`或`section`)、加载配置文件、循环一组值(对改变表格行颜色有用)、保存计数器(对列表数据编号有用)等等。

循环函数(section 和 foreach)对我们这些从数据库中生成内容的 Web 页面的人特别有用，您可以用它来循环并显示结果集。

##### 过滤

Smarty 允许您指定(`register`或`load`)过滤器，通过这些过滤器，您可以在编译模板之前或之后运行模板。预过滤器是模板在编译前运行的函数；后置过滤器之后；和输出过滤器，当模板输出被请求时。

为什么是过滤器？你说。预过滤器允许您删除不需要的注释(如 Dreamweaver 创建的注释)，并确保模板中您不需要的内容不会进入编译器。后置过滤器允许您向模板添加附加信息，例如模板编译后的创建日期(作为注释)。输出过滤器让你能够修改你的模板输出，允许你做一些事情，比如在你的网页上混淆电子邮件地址，以防止垃圾邮件(使用`preg_replace()`)。

##### 配置文件

配置文件是可以存储全局模板变量的配置文件。这允许您将影响每个模板的变量(即全局变量)存储在一个中心位置。模板的配色方案就是一个很好的例子。如果需要修改配色方案，模板设计者只需更改配置文件中的值。这让他们不用再忍受通过每个模板来改变颜色的痛苦。

配置文件也允许节，这与。ini 文件。部分名称用括号括起来(如`[welcome_page]`)，仅在请求时加载。不在节中的任何东西都是全局可用的(在调用`config_load`函数时)。

##### 插件

Smarty 插件架构是在 2.0 版本中引入的，它允许您定制 Smarty 来满足您的目的(无论多么宏伟或邪恶)。我前面讨论的前置过滤器、后置过滤器和输出过滤器只是定制器可用的一些插件类型。其他插件类型有修饰符、块、编译器、资源和插入类型。

使用插件，您可以创建自己的模板函数、变量修饰符和过滤器。您甚至可以使用一个资源插件来更改您希望 Smarty 读取的数据源(默认情况下是来自平面文件)。使用资源插件，您可以将模板保存在数据库中，并使用套接字(或任何其他使用 PHP 访问模板的方法)检索它们。这意味着您几乎可以访问任何来源)。

##### 结论

Smarty 是一个高质量的模板引擎，是你在寻找 PHP 版本时绝对应该考虑的。

将 Smarty 的模板编译和 PHP 固有的生成网页的效率结合起来，您将成为这场速度竞赛的赢家。Smarty 还提供了广泛的功能，包括模板函数和变量修饰符，可以使用设计良好的插件架构进行扩展。

所有这些速度和功能并不以可用性为代价:学习曲线并不比其他模板引擎更陡峭。Smarty 还补充了优秀的在线文档和 Smarty 网站上的下载文档。

作者之一 Andrei Zmievski 也在 PHP 开发团队工作，他将 Smarty 的开发与 PHP 紧密联系在一起。因此，您可以放心，PHP 的最新变化(如 PHP 4.2.0 中最近的 register_globals 问题)将得到 Smarty 的支持。

## 分享这篇文章