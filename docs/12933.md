# Rails 是否击沉了 Twitter？

> 原文:[https://www.sitepoint.com/did-rails-sink-twitter/](https://www.sitepoint.com/did-rails-sink-twitter/)

Twitter 可以说是世界上使用最频繁的 Ruby on Rails 应用。几乎从一开始，Twitter 就培养了一批狂热的追随者。此外，从一开始，Twitter 就遭受了这种负载下的长期中断。

在过去的一个月里，[创纪录的停机时间](http://blog.twitter.com/2008/05/i-have-this-graph-up-on-my-screen-all.html)在其不断增长的用户群中引发了新的抗议。这一点，加上主流媒体越来越多的关注，迫使 Twitter 公开承认这些问题，并透露一些关于这些问题来源的细节。

尽管有很多关于 Twitter 性能问题来源的猜测，但我们最接近真实的一瞥是[这篇 Twitter 开发者博客文章](http://dev.twitter.com/2008/05/twittering-about-architecture.html):

> Twitter 基本上是一个信息系统。然而，Twitter 并没有被设计成一个消息系统。为了方便起见，Twitter 是用更适合内容管理系统的技术和实践构建的。

但是等等，他们所说的“技术和实践”到底是什么意思？他们是指 Ruby on Rails 吗？

## Twitter 和框架的诅咒

Ruby on Rails 是一个模型-视图-控制器(MVC)框架。要在 Rails 中构建一个应用程序，首先要定义一个对象集合，这些对象对应用程序将要做的事情进行建模，然后编写控制器来处理模型以响应用户请求，最后编写视图将应用程序呈现给用户。

虽然这三个元素是独立的，但应用程序的性能在很大程度上取决于它们如何协同工作。如果您的模型没有针对控制器使用它的方式进行优化，您可能会发现自己面临一些令人惊讶的性能问题。这是我认为 Twitter 面临的问题。

让我们看一个简化的例子，看看 Twitter 的问题在内部是什么样子的。

Twitter 是一个用户发布短消息(称为 Tweets)并关注其他用户的 Tweets 的网站。当网站背后的最初开发人员第一次坐下来定义他们的模型时，最简单的事情应该是为所有推文建立一个数据库表，为所有用户建立另一个表，并建立第三个表来跟踪谁在跟踪谁。

这种方法非常类似于你可能为博客这样的内容管理系统(CMS)建立的模型:每个帖子都有一个作者，所以你可以很容易地获得所有帖子的列表(即 Twitter 的[公共时间轴](http://twitter.com/public_timeline))，或者只是给定类别中的帖子(例如[我的推文](http://twitter.com/sentience))。

这没有考虑到 Twitter 收到的最常见的请求类型:只显示我关注的用户的最新推文。使用 CMS 风格的模型，这个常见的请求将为应用程序产生大量的工作，因为它必须为每个用户过滤 Tweets 的时间线。

![Twitter as a CMS](../Images/347bca799e0ffceac95baf6bf8463c32.png)

如果 Twitter 的最初开发者意识到它会处理多少这种类型的请求，Twitter 的模型可能会被设计得非常不同。正如上面引用的博文中提到的，Twitter 确实是一个消息传递系统，它的模型应该反映这一点。

消息系统的模型可能是这样的:每当用户发布一条推文，该模型就会查找哪些用户在关注作者，并将推文的副本放入这些用户的私人时间线。推文发布后会排队等候收件人，将处理负担从更常见的“让我看看我的推文！”请求。

![Twitter as a messaging system](../Images/d20531ed8ca0d1a46240c12bf0bebca3.png)

现在，让我澄清一下:这两种模型都可以用 Ruby on Rails 构建。如果你不停下来考虑你的应用程序的特性，CMS 风格的模型只是框架将引导你的方向。任何好的框架都会为您处理大多数 web 应用程序共有的东西，因此您可以专注于应用程序的独特方面。框架的缺点是，让框架带头处理那些独特的方面是非常诱人的。

事实是，Twitter 的开发人员很匆忙，抓住一切机会让框架替他们思考。几乎所有的通用 web 框架都会将他们引向同一条道路。"亲爱的布鲁图斯，这不是我们命运的错，而是我们自己的错."这里的意思并不是说 Rails 是一个糟糕的框架——只是没有一个框架能够完成关于应用程序应该如何工作的重要思考。这就是开发人员的作用。

像任何框架一样，Rails 有优点也有缺点。那些喜欢 Rails 的人认为，它的优势——使用一种新颖的、富于表现力的编程语言，几乎消除了构建 web 应用程序的繁琐工作——远远超过了它的缺点，比如扩展是一项重要的任务。事实是，如果你正在构建一个面向大众的服务，而你并没有设计它来支持它，那么世界上没有任何框架能够阻止你的应用程序自我崩溃。

SitePoint 的新书《简单轨道 2 》现已上市。[得到它](https://www.sitepoint.com/premium/library)，打造你自己的推特杀手。:-)

## 分享这篇文章