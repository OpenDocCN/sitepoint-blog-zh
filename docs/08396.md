# 马特·韦恩使用黄瓜

> 原文:[https://www.sitepoint.com/matt-wynne-on-using-cucumber/](https://www.sitepoint.com/matt-wynne-on-using-cucumber/)

![](../Images/23b3943ff1a8d9269401ddc579f87c4f.png)

我一直认为[cumber](http://cukes.info/)只是我的开发人员的测试工具包中的另一个工具。像 RSpec、Test::Unit 或 MiniTest::Spec 一样，我认为 Cucumber 只是测试代码的另一种方式:我将使用 RSpec 进行单元测试，使用 Cucumber 进行集成测试。虽然 Cucumber 面向业务的场景语言对我来说似乎很有趣，很有创意，但我从来没有真正考虑过为什么 Cucumber 测试要以如此冗长、复杂的方式编写。

上周，我有机会与[马特·怀恩](http://blog.mattwynne.net/)交谈，他是《黄瓜书【T2:测试人员和开发人员的行为驱动开发》的合著者，也是[行为驱动开发](http://dannorth.net/introducing-bdd/) (BDD)的思想领袖和教练。在一次漫长而有趣的谈话中，Matt 向我解释了 BDD 背后的基本思想，以及为什么 Cucumber 是这样设计的。正如你将看到的，Matt 帮助我重新思考如何在我所有的项目中使用黄瓜。以下是我们谈话的重点……也许在读完这篇文章后，你会开始重新考虑你使用黄瓜的方式！

## 新闻

![](../Images/44f570d8044e65576a199ad94b2af1bb.png)

马特·韦恩

问:在我们开始之前，在黄瓜的世界里有什么我们应该知道的消息吗？

![](../Images/1ae272e8b72a45535de30d801108f3bf.png)

黄瓜界的一个大消息是 [Cucumber JVM](http://aslakhellesoy.com/post/20006051268/cucumber-jvm-1-0-0) 几天前刚刚发布了 1.0 版本。Aslak 真的一直在努力做到这一点:它是一个黄瓜的移植，可以在 Java VM 上一直作为原生 Java 代码运行。

问:这是否意味着 Java 开发人员可以像 Ruby 开发人员一样轻松地使用 Cucumber？

![](../Images/1ae272e8b72a45535de30d801108f3bf.png)

他们总是能够做到，但是使用 JRuby 有点麻烦。Aslak 不久前做的一件聪明的事情是，他提取了一个名为 [Gherkin](https://github.com/cucumber/gherkin) 的库，这是围绕特征文件的核心解析库。它使用 [Ragel](http://www.complang.org/ragel/) 来解析这些文件。Ragel 是一个代码生成器，所以它用 Ruby、C、Java 和 JavaScript 生成解析特性文件的代码。Java 代码也可以移植到 C#上；例如， [SpecFlow](http://www.specflow.org/) 就是这样工作的。SpecFlow 是。NET 端口，构建在与 Ruby Cucumber 基本相同的核心代码之上。这个 JVM 版本也在使用它。

## 历史

问:你是如何开始接触黄瓜的？

![](../Images/1ae272e8b72a45535de30d801108f3bf.png)

我参加了 2008 年在英国剑桥举行的[软件实践进步](http://www.spaconference.org/)会议。这可能是我参加的第一个会议，我真的很害怕。那里有像[迈克尔费瑟斯](http://twitter.com/#!/mfeathers)这样的人；我刚刚读了他的书。[丹北](http://dannorth.net)也在那里。Dan 和 Joe Walnes 做了这个演讲，叫做[令人敬畏的验收测试](http://blog.mattwynne.net/2008/03/18/awesome-acceptance-testing/)。这都是关于他们正在编写的验收测试的种类——我想他们当时都在 ThoughtWorks 工作，并且都在谈论使用示例，并试图以一种非常非常可读的方式编写您的验收测试，以便您可以与团队中的非技术人员分享它们。这深深地引起了我的共鸣，因为我很久以前就认识到，软件项目的痛苦之处在于，你无法与业务人员建立联系。

那天晚上，我和丹、克里斯·马茨在酒吧里喝得酩酊大醉，我的 BDD 灌输完成了！

问:你知道“黄瓜”的名字是从哪里来的吗？我听说过一个传说，关于阿斯拉克的妻子是如何用黄瓜烹饪的？这是真的吗？

![](../Images/1ae272e8b72a45535de30d801108f3bf.png)

她正要咬一口黄瓜三明治——这是我听到的故事。关于那件事你得问他们。

问:我们可以再放一个谣言；也许真相会浮出水面。

## 黄瓜的用途是什么

问:我真的很喜欢读《黄瓜》。自从读了这本书，我开始觉得我可能没有用我应该用的方式来使用黄瓜。

![](../Images/1ae272e8b72a45535de30d801108f3bf.png)![](../Images/728d4d42fe9fbc7d3bd2330e7c96cc9d.png)

你什么意思？

问:嗯，我认为一般来说我的步骤、特点和场景都写得不是很好。我用编写 Ruby 代码的方式来编写它们。我没有考虑这些场景的目标受众。

![](../Images/1ae272e8b72a45535de30d801108f3bf.png)

我现在做了很多工作来培训和指导使用黄瓜的人，所以我看到了很多使用黄瓜的团队。我试图将整个团队聚集在一个房间里，从产品所有者到项目经理、测试人员、业务分析师和开发人员。我把每个人召集到一个房间里，帮助他们就他们希望自己的特写如何阅读达成共识。因为关键是当这些事情做得好的时候，黄瓜场景就成了整个团队的唯一真理。

它变成了团队中每个人都觉得自己拥有的东西。因此，不仅仅是开发人员写的东西，而是开发人员做的让浏览器四处闪烁的东西。如果业务分析师想知道在这种特殊的边缘情况下系统会做什么，他们可以搜索这些功能并查看。他们相信特征所说的。

问:那么你认为 Cucumber 是一个双人或小组编程工具吗？

![](../Images/1ae272e8b72a45535de30d801108f3bf.png)

我认为这是一个团队交流或合作的工具。所以通过玩这个游戏，强迫你们自己去描述你们想要这个软件做什么，一起，你们最终所做的是浮现所有你们实际上还没有弄清楚的事情和所有你们不确定的事情。这就是丹·诺斯所说的有意发现。

如果我把一个团队放在一个房间里，我说:“好吧，告诉我你的用户故事。没错。告诉我关于那个用户故事的接受标准。没错。让我们一起写下描述某人可能如何使用该功能的场景。”他们有一个很大很大的争论！事情就是这样。他们都有稍微不同的描述方式，稍微不同的用词。这个论点非常非常重要，因为它揭示了团队中不同人的不同心智模式。通过暴露这些差异，让它们公开化，你可以开始弥合人们不同心智模式之间的差距。你越早在一个项目中这样做，整个事情就越顺利。

问:这就是你在书中所说的“无处不在的语言”吗

![](../Images/1ae272e8b72a45535de30d801108f3bf.png)

是的，一种无处不在的语言是搭建这些桥梁的关键部分。这个术语实际上来自 Eric Evans 的书，[领域驱动设计:在软件的核心解决复杂性](http://www.amazon.com/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215)。这是一本关于 TDD 和紧急架构的好书——在敏捷项目中出现的那种架构，在这个项目中你不断地进行重构。你不断地学习设计。从许多方面来看，这都是一本难读的书，但书中一个真正容易理解的概念是“无处不在的语言”的概念。这是一个非常简单的想法:你只需要努力确保从业务人员到数据库管理员，每个人都使用相同的词语来描述项目中或项目周围的事情。

问:……因为他们可能不是——或者更糟的是，他们可能在不同的事情上使用相同的单词？

![](../Images/1ae272e8b72a45535de30d801108f3bf.png)

是的，当一个学期超载时，那就更糟了，不是吗？如果不同的人用不同的词来指代同样的事情，那么你就是在给自己设置一个陷阱。每一个单独的例子都是一个误解的机会，当你把它扩大到一个项目过程中将要进行的对话的数量时，这是很可怕的。

问:在你看来，如果你编写了场景但从未执行过，你会得到 BDD 提供的大部分好处吗？如果你从来没有写过步骤定义？

![](../Images/1ae272e8b72a45535de30d801108f3bf.png)

我想你会得到大约一半的好处。你不会得到任何回归的好东西。您还没有一个重构未来变更的安全网，未来的迭代可能会破坏现有的功能。你没有由外向内的开发来驱动你需要写的单元测试和代码——你错过了所有这些。但是你所得到的好处是，首先弄清楚你到底应该建造什么——我认为这是一半的好处，我真的这么认为。

问:我认为我犯了一个巨大的错误，认为黄瓜只是我测试工具包中的另一个工具。我从来不想用技术细节来打扰我的赞助商或商业分析师。

![](../Images/1ae272e8b72a45535de30d801108f3bf.png)

可能你同时戴着业务分析师和开发人员的帽子。可能你的客户对你必须在黄瓜规格中加入的细节不感兴趣。它们乏味得令人麻木。

问:谁应该使用黄瓜？只有开发商？还是商业人士？

![](../Images/1ae272e8b72a45535de30d801108f3bf.png)

它应该以某种方式触及团队中的几乎每个人。在我的培训中，我特别强调在团队中的每个人面前演示单个场景的全栈实现，只是为了让他们知道拼图的各个部分是什么:什么是步骤定义，什么是场景，等等。但是在命令行运行 Cucumber 的人通常要么是你的 Jenkins build，要么是开发人员。

问:但是让整个团队参与进来很重要吗？至少定义一下场景是什么？

![](../Images/1ae272e8b72a45535de30d801108f3bf.png)

在你的 cukes 是好的测试和好的文档之间总是有这种紧张。想象一下这些场景在一个光谱上:一端对于业务人员来说非常容易阅读，很好的文档，但是可能不是很好的测试。光谱的另一端是它们是真正好的全面测试，但是如果你把它们展示给产品所有者，他们会说“那是什么？我完全不明白这一点。”每次开发人员接触它们时，他们很可能会将它们拉向技术的一端，使它们对团队中的非技术人员来说不那么容易接近和阅读。日复一日，接触这些特性的往往是开发人员，因为他们可以访问 git。因此，您需要不断努力，使它们作为文档工作得更好。

## 黄瓜场景的粒度

问:你的黄瓜场景应该有多精细？你应该把它们写得多详细？我想如果他们更高层次和抽象，那么你就更有可能让客户和商业人士参与进来。

![](../Images/1ae272e8b72a45535de30d801108f3bf.png)

是啊。我发现它们在很多方面都更有用。一件事是，它们不依赖于特定的实现。因此，如果你真的需要改变用户体验，改变用户为实现目标而必须经历的旅程，你可能会谈论改变你的支持层中的一个 Ruby 方法。此外，它们对于非技术人员来说可读性更强。

这也和规模有关。在一个项目的早期，当你只有少数几个功能时，你可能会觉得在相当低的抽象层次上交谈很舒服——点击东西，等等。当你开始缩小范围时，当你有成百上千个场景时，你就不再能够阅读细节层次较低的东西。

当你更多地使用命令式风格，并且在较低的抽象层次上谈论很多细节时，会发生的另一件事是，你错过了必须给事物命名的机会。因为如果您每次登录用户时所做的事情是: