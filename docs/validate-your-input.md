# 验证您的输入！

> 原文：<https://www.sitepoint.com/validate-your-input/>

关于 MySQL 和 PostgreSQL 的前一篇博文引发了一场关于在数据库驱动的网络应用中输入验证的[讨论。](https://www.sitepoint.com/blog/)

在这篇文章中，我将试图解释什么是验证以及它为什么重要。

我记得在高中的一门 IT 选修课上，我被告知输入验证的重要性。我们被告知，所有用户输入*在被执行之前都必须经过*的验证。在那个阶段，我们使用 VBscript 在 Microsoft Excel 中“编程”,但是验证与 web 应用程序更相关，因为 web 应用程序可能被许多人使用或利用。

数据验证是检查用户输入的过程，以查看它是否是预期的格式，以及是否在该输入的允许值范围内。它有许多目的，其中一些如下。

*   如果用户提交的数据不在允许的值范围内或者格式错误，可能会导致应用程序出现意外行为，包括黑屏或无意义的屏幕。验证可以防止这种情况，而是向用户返回一条可读的错误消息。让用户知道为什么输入没有被接受，这大大提高了应用程序的可用性。
*   应用程序的恶意用户可能会通过发送不符合应用程序预期格式或超出用户应该使用的值范围的数据，来试图利用应用程序中的问题。如果不检查所使用的值，由于应用程序中的内部问题，该值可能会授予用户访问应用程序的某些隐藏方面的权限。
*   数据验证有助于确保存储的数据完整无缺。例如，确保“必填”字段确实由用户填写，可以确保数据库记录中不会有缺口(或空字符串)，这可能会导致以后处理不完整数据时出现问题，例如跟进客户。

因此，验证有许多不同的目的。

下面是一些验证示例，您可能希望应用于用户的输入。

字符串:

*   请检查字符串的长度是否有效。
*   检查字符串是否包含特定范围内的字符。
*   如果字符串是“必需的”，请检查它是否为空。

数值:

*   检查该值实际上是数字，而不是任意的字符串。
*   如果该值必须是整数，请确保它是整数。
*   检查该值是否介于最高允许值和最低允许值之间。
*   如果有一些不允许的值(例如零)，请检查它是否是这些值中的一个。

布尔值(真/假):

*   确保数值为*假*或*真*(或 0 或 1)。

枚举(选择)值:

*   检查该值是否正好等于允许的选项之一。

在某些情况下，简单地检查字符串长度是否正确或是否包含允许的字符是不够的，为此，可以使用[正则表达式](http://www.php.net/pcre)来确保字符串符合给定的格式或[模式](http://www.php.net/manual/en/reference.pcre.pattern.syntax.php)。

在我的个人项目中，我使用一个助手类来简化验证输入的任务。这个类的 load_var 方法从输入变量加载一个值，并根据给定的模式检查它。如果输入无效，该方法返回空值。

 `$username = $context->load_var('username', 'POST', 'name');
if ($username === null)
{
// report an error
}`

有时，我使用 PHP 库来生成和处理 web 表单，比如我们在 SitePoint 使用的库(亲切地称为 RapidAdmin)，或者 PEAR 的 [HTML_Quickform](http://pear.php.net/package/HTML_QuickForm) ，或者我自己的库。这样的库通常可以为您验证数据。例如， [HTML_Quickform](http://pear.php.net/package/HTML_QuickForm) 能够根据您在创建表单时指定的模式来验证数据。如果任何表单字段输入没有正确填写，HTML_Quickform 将允许您向用户显示错误消息，而不是将无效的字段值传递到您的应用程序中。

正如上一篇帖子的[评论](https://www.sitepoint.com/blog/)中提到的，MySQL 和 PostgreSQL 等数据库服务器也执行数据验证，以确保输入的值在插入数据库表时不会导致问题。这种数据验证是为了数据库，而不是您的(PHP)应用程序，所以它不能代替您自己的验证。此外，正如 Simon 指出的，MySQL 有时会在没有验证的情况下悄悄截断或转换数据，这可能会导致意外的行为，并且没有错误消息来解释。

因此，在将数据传递到数据库服务器之前，您应该始终验证数据。这使您的应用程序有机会优雅地处理这个问题，向用户返回一个可读的、友好的错误消息。最终用户不希望遇到数据库查询错误，因为用户甚至没有编写查询。

## 分享这篇文章