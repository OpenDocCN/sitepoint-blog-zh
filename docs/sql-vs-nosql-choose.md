# SQL vs NoSQL:如何选择

> 原文：<https://www.sitepoint.com/sql-vs-nosql-choose/>

在[上一篇文章](https://www.sitepoint.com/sql-vs-nosql-differences/)中，我们讨论了 SQL 和 NoSQL 数据库之间的主要区别。在接下来的讨论中，我们将把我们的知识应用到具体的场景中，并确定最佳方案。

概括一下:

**SQL 数据库:**

*   将相关数据存储在表中
*   需要一个在使用前定义表的模式
*   鼓励标准化以减少数据冗余
*   支持表连接，以便在一个命令中从多个表中检索相关数据
*   实施数据完整性规则
*   提供事务以保证两个或多个更新作为一个原子单元成功或失败
*   可以扩展(通过一些努力)
*   使用强大的声明性语言进行查询
*   提供大量支持、专业知识和工具。

**NoSQL 数据库:**

*   将相关数据存储在类似 JSON 的名称-值文档中
*   可以在不指定模式的情况下存储数据
*   通常必须进行反规范化，以便在单个文档中包含关于某个项目的信息
*   不应要求连接(假设使用了非规范化的文档)
*   允许任何数据随时随地保存，无需验证
*   保证更新单个文档，但不更新多个文档
*   提供卓越的性能和可扩展性
*   使用 JSON 数据对象进行查询
*   是一种更新的令人兴奋的技术。

SQL 数据库是可以确定需求并且健壮的数据完整性至关重要的项目的理想选择。NoSQL 数据库是不相关、不确定或不断变化的数据需求的理想选择，在这些需求中，速度和可伸缩性更为重要。简单来说:

*   **SQL 是数字化的。**它最适用于定义明确、规格精确的离散项目。典型的用例是在线商店和银行系统。
*   NoSQL 是模拟的。它最适合有流动需求的有机数据。典型的用例是社交网络、客户管理和网络分析系统。

很少有项目是完全适合的。如果您有较浅或自然反规范化的数据，这两种选择都是可行的。但是请注意，这些简化的示例场景具有广泛的普遍性！你比我更了解你的项目，我不建议从 SQL 转换到 NoSQL，反之亦然，除非它能提供相当大的好处。这是你的选择。在你的项目开始时考虑利弊，你就不会出错。

## 场景一:联系人列表

让我们重新发明轮子，实现一个基于 SQL 的地址簿系统。我们的初始初始`contact`表由以下字段定义:

*   身份证明（identification）
*   标题
*   西方人名的第一个字
*   姓
*   性别
*   电话
*   电子邮件
*   地址 1
*   地址 2
*   地址 3
*   城市
*   地区
*   邮政编码
*   国家

*问题一:*很少有人有单一的电话号码。我们可能需要至少三个用于固定电话、移动电话和工作场所，但我们分配多少并不重要——某个地方的某个人会想要更多。让我们创建一个单独的`telephone`表，这样联系人就可以随心所欲了。这也使我们的数据正常化——我们不需要没有号码的空联系人:

*   联系人 id
*   名称*(文本，如座机、工作手机等。)*
*   数字

*问题二:*我们的电子邮件地址也有同样的问题，所以让我们创建一个类似的`email`表:

*   联系人 id
*   姓名*(文字如家庭邮箱、工作邮箱等。)*
*   地址

*问题三:*我们可能不希望输入(地理)地址，或者我们可能希望输入工作、家庭、度假屋等的多个地址。因此，我们需要一个新的`address`表:

*   联系人 id
*   姓名*(文字如家、办公室等。)*
*   地址 1
*   地址 2
*   地址 3
*   城市
*   地区
*   邮政编码
*   国家

我们原来的`contact`表已经缩减为:

*   身份证明（identification）
*   标题
*   西方人名的第一个字
*   姓
*   性别

很好——我们有一个标准化的数据库，可以存储任意数量的电话号码、电子邮件地址和任何联系人的地址。不幸的是…

**模式是严格的**
我们没有考虑联系人的中间名、出生日期、公司或工作职位。不管我们添加了多少字段，我们很快就会收到笔记、周年纪念、关系状态、社交媒体账户、内腿尺寸、最喜欢的奶酪类型等更新请求。不可能预见每个选项，所以我们可能会创建一个带有名称-值对的`otherdata`表来应对。

**数据支离破碎**
对于开发者或系统管理员来说检查数据库并不容易。程序逻辑也将变得更慢和更复杂，因为在具有多个`JOIN`子句的单个`SELECT`语句中检索联系人的数据是不切实际的。*(可以，但是结果将包含电话、电子邮件和地址的所有组合:如果某人有三个电话号码、五个电子邮件和两个地址，SQL 查询将生成三十个结果。)*

最后，全文搜索很难。如果有人输入字符串*“site point”*，我们必须检查所有四个表，看看它是否是联系人姓名、电话、电子邮件或地址的一部分，并相应地对结果进行排序。如果你曾经使用过 WordPress 的搜索，你就会明白这是多么令人沮丧。

### NoSQL 的选择

我们的联系数据与人有关。它们是不可预测的，并且在不同的时间有不同的要求。联系人列表将受益于使用 NoSQL 数据库，该数据库将关于个人的所有数据存储在`contacts`集合的单个文档中:

```
{
  name: [
    "Billy", "Bob", "Jones"
  ],
  company: "Fake Goods Corp",
  jobtitle: "Vice President of Data Management",
  telephone: {
    home: "0123456789",
    mobile: "9876543210",
    work: "2244668800"
  },
  email: {
    personal: "bob@myhomeemail.net",
    work: "bob@myworkemail.com"
  },
  address: {
    home: {
      line1: "10 Non-Existent Street",
      city: "Nowhere",
      country: "Australia"
    }
  },
  birthdate: ISODate("1980-01-01T00:00:00.000Z"),
  twitter: '@bobsfakeaccount',
  note: "Don't trust this guy",
  weight: "200lb",
  photo: "52e86ad749e0b817d25c8892.jpg"
}
```

在这个例子中，我们没有存储联系人的头衔或性别，我们添加了不需要应用于其他任何人的数据。没关系——我们的 NoSQL 数据库不会介意，我们可以随意添加或删除字段。

因为联系人的数据包含在单个文档中，所以我们可以使用单个查询检索部分或全部信息。全文搜索也更简单；在 MongoDB 中，我们可以在所有的`contact`文本字段上定义一个索引，使用:

```
db.contact.createIndex({ "$**": "text" });
```

然后使用以下内容执行全文搜索:

```
db.contact.find({
  $text: { $search: "something" }
});
```

## 场景二:社交网络

社交网络可能使用类似的联系人数据存储，但它扩展了功能集，提供了关系链接、状态更新、消息和“喜欢”等选项。这些设施可能会根据用户的需求而被实现或删除——不可能预测它们将如何发展。

此外:

*   大多数数据更新只有一个来源:用户。我们不太可能需要一次更新两个或更多的记录，所以不需要类似事务的功能。
*   不管一些用户怎么想，失败的状态更新不太可能导致全球崩溃或财务损失。应用程序的界面和性能比强大的数据完整性更重要。

NoSQL 似乎是个不错的选择。数据库允许我们快速实现存储不同类型数据的功能。例如，所有用户的日期状态更新都可以放在`status`集合中的单个文档中:

```
{
  user_id: ObjectID("65f82bda42e7b8c76f5c1969"),
  update: [
    {
      date: ISODate("2015-09-18T10:02:47.620Z"),
      text: "feeling more positive today"
    },
    {
      date: ISODate("2015-09-17T13:14:20.789Z"),
      text: "spending far too much time here"
    }
    {
      date: ISODate("2015-09-17T12:33:02.132Z"),
      text: "considering my life choices"
    }
  ]
}
```

虽然这个文档可能会变得很长，但是我们可以获取数组的一个子集，比如最近的更新。还可以快速搜索每个用户的全部状态历史。

现在假设我们想在发布更新时引入表情选择。这将是在`update`数组中添加一个指向新条目的图形引用。与 SQL 存储不同，不需要将以前的消息表情符号设置为空——如果没有设置表情符号，我们的程序逻辑可以显示默认图像或不显示图像。

## 场景三:仓库管理系统

考虑一个监控仓库货物的系统。我们需要记录:

*   产品到达仓库，并被分配到特定的位置/隔间
*   仓库内货物的移动，例如重新安排库存，使相同的产品位于相邻的位置
*   订单以及随后从仓库中取出产品进行交付。

我们的数据要求:

1.  一般的产品信息，如盒子数量，尺寸和颜色可以存储，但它是离散的数据，我们可以识别和应用于任何东西。我们不太可能关心细节，比如笔记本电脑处理器速度或估计的智能手机电池寿命。
2.  最大限度地减少错误是必要的。我们不能让产品消失或被转移到已经存放不同产品的地方。
3.  最简单的形式是，我们记录物品从一个物理区域转移到另一个物理区域，或者从位置 A 转移到位置 b。这是对同一动作的两次更新。

我们需要一个具有强制数据完整性和事务支持的强大商店。只有 SQL 数据库能够(目前)满足这些需求。

## 暴露自己！

我希望这些场景能有所帮助，但是每个项目都是不同的，最终，你需要做出自己的决定。(尽管，我们开发人员擅长证明我们的技术选择，不管它们有多好！)

最好的建议是:尽可能多地接触技术。这些知识将让你对 SQL 或 NoSQL 做出理性的、不带感情色彩的判断。祝你好运。

## 分享这篇文章