# 好的和坏的 PHP 代码

> 原文:[https://www.sitepoint.com/good-and-bad-php-code/](https://www.sitepoint.com/good-and-bad-php-code/)

以下内容转载自《科技时报》第 165 期。

当在 SitePoint 面试一个 PHP 开发人员时，有一个问题我几乎总是会问，因为他们的回答告诉了我很多关于他们是哪种程序员的信息。问题是:“在你看来，好的 PHP 代码和坏的 PHP 代码有什么区别？”

我喜欢这个问题的原因是因为它测试的不仅仅是候选人对 PHP 函数的百科知识。Zend 的 PHP 认证在这方面做得很好,[测试雅虎 PHP 开发人员职位申请人的问题【显然是 T3】。](http://blog.assembleron.com/2007/05/23/php-interview-questions-from-yahoo/)

相反，这个问题的答案告诉我，例如，一个 PHP 开发人员是否经历过处理从粗心的前任那里继承来的糟糕代码的痛苦，以及他或她是否会付出额外的努力来将团队的其他成员从同样的痛苦中拯救出来。

我对这个问题的完美答案没有固定的概念，但是我知道我希望听到的事情的种类。我马上想到:

好的 PHP 代码应该是**结构化的**。长代码块可以被分解成用简单代码实现子任务的函数或方法，而不明显的代码片段应该被注释以使它们的意思简单明了。您应该尽可能地将前端 HTML/CSS/JavaScript 代码与应用程序的服务器端逻辑分开。PHP 的面向对象编程特性给了你一些特别强大的工具，可以将你的应用程序分解成合理的单元。

好的 PHP 代码应该是**一致的**。无论这意味着为变量和函数的名称设置规则，采用标准的方法来处理数据库访问和错误处理等重复性任务，还是简单地确保所有代码都以相同的方式缩进，一致性都会使您的代码更容易被其他人阅读。

好的 PHP 代码应该是**可移植的**。PHP 有许多特性，比如神奇的引号和短标签，当它们被打开或关闭时，可以破坏脆弱的代码。然而，如果你知道你在做什么，你可以通过适应它的环境来编写代码。

好的 PHP 代码应该是**安全的**。虽然 PHP 提供了开箱即用的出色性能和灵活性，但它将安全性等重要问题完全交给了开发人员。对于一个专业的 PHP 开发人员来说，深刻理解潜在的安全漏洞，如跨站脚本(XSS)、跨站请求伪造(CSRF)、代码注入漏洞和字符编码漏洞是非常重要的。

一旦候选人回答了这个问题，我通常会很清楚他们是否会被录用。当然，总有这样的可能性，一个被采访者只是不能清楚地表达这些类型的事情，所以我们也让我们的候选人参加 PHP 开发人员考试。

这次考试中的许多问题表面上看起来很简单，但它们给了考生足够的机会来展示他们对小细节的关注。

下面的“坏”代码是我们在 PHP 开发人员考试中可能会用到的一个高度简化的例子。这个问题可能类似于“你将如何重写这段代码以使它变得更好？”

```
<?
echo("<p>Search results for query: " .
    $_GET['query'] . ".</p>");
?>
```

该代码中的主要问题是用户提交的值(`$_GET['query']`)被直接输出到页面，从而导致跨站点脚本(XSS)漏洞。但是还有很多其他的方法可以改进它。

那么，我们希望得到什么样的答案呢？

**好:**

```
<?
echo("<p>Search results for query: " .
    htmlspecialchars($_GET['query']) . ".</p>");
?>
```

这是我们最不期望的*T2。已使用`htmlspecialchars`对提交值中的危险字符进行转义，从而修复了 XSS 漏洞。*

**更好:**

```
<?php
if (isset($_GET['query']))
{
  echo '<p>Search results for query: ',
      htmlspecialchars($_GET['query'], ENT_QUOTES), '.</p>';
}
?>
```

现在*这个*看起来像是我们可能想要雇佣的人:

*   “短”的 PHP 开始标记(`<?`)已经被更易移植的(和 XML 友好的)`<?php`形式所取代。
*   在试图输出`$_GET['query']`的值之前，`isset`用于验证它实际上有一个值。
*   传递给`echo`的值周围不必要的括号(`()`)已被移除。
*   字符串由单引号而不是双引号分隔，以避免 PHP 搜索要在字符串中插入的变量时的性能影响。
*   不使用字符串连接操作符(`.`)将单个字符串传递给`echo`语句，而是由`echo`输出的字符串用逗号分隔，这样可以稍微提高性能。
*   在这种情况下，将`ENT_QUOTES`参数传递给`htmlspecialchars`以确保单引号(`'`)也被转义并不是*严格意义上的*所必需的，但这是一个很好的习惯。

有点令人沮丧的是，寻找能够对此类问题给出完全满意答案的工作的 PHP 开发人员数量很少，至少在墨尔本是这样。在找到我们满意的人之前，我们花了整整三个月的时间面试这个新职位。

那么，当被问到这样的问题时，你会怎么做呢？有没有什么让 PHP 代码好坏的因素让你觉得我遗漏了？你还会在 PHP 开发人员身上寻找什么？

## 分享这篇文章