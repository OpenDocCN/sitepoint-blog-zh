# 用代码船航行在平行的海上

> 原文:[https://www.sitepoint.com/sailing-parallel-seas-codeship/](https://www.sitepoint.com/sailing-parallel-seas-codeship/)

*本文由[杂志社](http://codeship.com)赞助。感谢您对使 SitePoint 成为可能的赞助商的支持。*

![title](../Images/d00be3768b01e7a3ee35ec59a9208a42.png)

嘿，伙计！看起来你是我们中的一员，是软件开发美丽而变幻莫测的海洋中的导航员。我们 SitePoint 舰队的人总是渴望见到另一个软件水手。今天，我们为来自深海的旅伴们准备了一份特殊的礼物。在 [Codeship](http://codeship.com) 的海人们(Codeshippers！)已经创造了一种新的方式来导航持续集成和交付的水域。这可能是自专门的单元测试舰队以来最重要的发展。这叫平行宇宙，它会让你的船走得更快更短。

## 一点软件时代的历史

您很有可能正在使用某种持续集成和交付平台。Codeship 是“简单的连续交付”。如果你不知道持续集成和交付意味着什么，SitePoint 和 Codeship 已经覆盖了你:

*   我们已经写过[持续集成和持续交付](https://www.sitepoint.com/continuous-delivery-right-way-deploy-software/)。
*   我们还介绍了[连续部署](https://www.sitepoint.com/set-continuous-deployment-ninefold/)，您可以自动将成功的构建部署到您的生产环境中。Codeship 支持许多 PaaS 产品，包括 Heroku 和 AWS。
*   Codeshipper Manuel Weiss [给出了一个连续交付的速成班](https://www.google.com/url?q=https%3A%2F%2Fcodeship.com%2Fcontinuous-delivery-crash-course&sa=D&sntz=1&usg=AFQjCNFGCYQ6fT_uFLvJKzWGCVTit8Pmpw)。

软件的海洋千变万化。像 Codeship 这样的平台使你的舰队能够适应天气的变化。阅读前面提到的卷轴(链接文章),了解 Codeship 如何将你憔悴的船员变成强大的舰队。然后，回到这里阅读他们最新的导航产品。

![1_codeship](../Images/d383798f4382e747ac40d825ad601cd9.png)

## 并行:更快地覆盖测试区域

并行运行您的航行(构建)是可能的。传说以前的探险者会向多个不同的方向派出多艘船，以覆盖最大的区域并尽可能快地找到最佳路线。在今天之前，这是一项非常困难的任务。有人必须创建每个课程(VM)，重复艰苦的设置和准备，并确保课程不覆盖相同的领域。在大多数情况下，设置太难，课程太贵，让你进退两难。因此，一艘船可用于所有地区。

有了 Codeship 的新产品 ParallelCI，现在创建一个新的课程(称为“管道”)变得轻而易举。每个管道都有相同的设置，但是可以按照自己的方式运行(运行自己的命令)。现在，你可以很容易地将测试区域分成更小的路线，允许每条管道通过更少的水域。最终，你的舰队(软件)会更快地到达目的地(令人垂涎的部署地)。

## 准备航行

### 报名参加 Codeship

![](../Images/5e7a098239f6e14e1d37de5becace4d2.png)

由于我们是经验丰富的导航员，我们打算通过 Github 注册。如果你的船在其他地方的港口，你可以用 Bitbucket 或普通电子邮件注册。Github 将请求您允许 Codeship 访问您的端口(存储库),然后用适当的海事问候来问候您:

![](../Images/64d597d2483742fff37d9e82f9106bb7.png)

### 选择一支舰队

点击巨大的绿色按钮来创建你的第一个项目。船长莫加入你的船员，帮助你准备你的第一次航行。

![](../Images/9882cb8c2f6e1301145651dff0432f90.png)

点击你的舰队停靠的港口(仓库中心)，在这种情况下，Octocat(有一个关于 Octocat 是软件港口女神的传说):

![](../Images/14b30d8cd0bc825864a65b0eb40c54f2.png)

将显示您的车队(存储库)列表。

![](../Images/005a2d1502206b89c4bb2515afa2deb7.png)

在我们今天的例子中，我只有一个名为 Discourse 的舰队。Discourse 是一个开源的大型车队，运行在 Rails 上，是一个非常受欢迎的车队制造商。我想用一个很大并且有很多测试的舰队(话语超过 4000)，所以我分叉了他们的舰队。

### 规划你的路线

描述:莫现在带我们来到代码船之旅的主要导航区域:

![](../Images/4a0f19804923bdd595691694f607a64d.png)

首先，每次航行都需要类似的设置命令和任务。作为您旅行的领导者，您可以键入任何您需要的设置命令，它将由 Codeship 的拭子执行。幸运的是，我们的车队在铁轨上行驶。Codeship 已经为众所周知的框架提供了通用的设置任务，比如 Rails:

![](../Images/af9eb12e92d923913d8f52b37609cb88.png)

从下拉列表中选择 Rails 会填充“修改您的设置命令”和“修改您的测试命令”框。作为一名经验丰富的导航员，我知道话语舰队需要一点不同的设置，所以我做了一些修改:

![](../Images/07040bd187190e17d2166eadc24558a5.png)

设置是最简单的部分。当我们带着 Codeship 和 ParallelCI 进入试水时，那就是新的领域所在。Codeship 建议我们运行`bundle exec rake`作为我们的测试命令，我知道在对话中要改成`bundle exec rake spec`。然而，这将采取相同的，通过测试的老路线。Discourse 是一个成熟的舰队，它穿越特定的测试海域，所以我们想做一些自定义导航，以使旅程尽可能短。

以下是话语传播的试水:

![](../Images/1c76e0e29624954fb39bb66bbd89e0be.png)

这些水域中有些是广阔的，比如**组件**、**控制器**和**模型**。其他海域很容易导航，比如**帮手**和**完整性**。我的航海经验告诉我，较大的海域将获得专用船(管道)，而几个不太危险的水域可以组合在一起，由一艘船覆盖。

此外，作为一个老海狗，我知道我们想知道传统的单船方法需要多长时间。这样，我们可以对新方法进行基准测试，并量化我们的收益。标杆管理是成功航海的基础。

在我在本地开发水域(我的开发机器)的测试运行期间，我必须在测试航程中翻转沙漏 11 次(因此，11 分钟)。仅用一艘船使用 Codeship 导航，测试水域仅用了 5 小时多一点。

![](../Images/c8f84d58507fa0f1f6db3d95705ef36a.png)

现在，是时候把测试海分成管道了。添加新管道比擦洗甲板容易。只需点击“+添加新管道”链接，就会提示您命名管道:

![](../Images/47d0df94181ab6c7f080f5dd121bf184.png)

![14_addpipeline](../Images/d13a816f64b31dcd280858f5e6f716b5.png)

Codeship 的慷慨人士允许我们创建多达 10 个管道，但实际允许的数量将取决于该功能退出测试时您的帐户级别。

你可以在这里看到我创造的船只:

![15_allpipelines](../Images/3226833e9cf77319c0a535db122dfb72.png)

我们的航行路线都计划好了，是时候去公海了！通过将更改推送到船队(存储库)来启动航行。对自述文件(我可以直接在 Github 上编辑)做一个简单的修改就可以了。起锚了。

现在我有了一个新的变更，项目页面(点击 Codeship 左上角的项目名称)显示了一个正在进行的新旅程:

![](../Images/3ddfdbf4af388ba4c2e7ae17b7a020c3.png)

回到港口，现在的问题是走寡妇之路和等待。查看航程，我们可以看到我们的每艘船都在指定的路线上航行。当每艘船返回港口时，你会在建造面板上看到一个指示器。当他们都回来后，构建就完成了。

![](../Images/cefc0e657105c4ddaa458a8468a43091.png)

![](../Images/1ccc06945a302b52b13ffcc1ac34aeee.png)
T2】

当所有的船都回到港口时(意思是，它们是绿色的)，我们的航行就结束了:

![20_pipelines3](../Images/3c6da5cd1613febdbb51d5221f5e468b.png)

我们表现如何？看起来我们在海上的时间减少了一大半！

![21_result](../Images/b02abba5904cae9fce9fd06766fd6ce2.png)

太不可思议了。通过简单地为每个 spec 文件夹分配一个管道，我们加倍了到达部署目的地的速度。臀部！臀部！霍雷。每个人都要朗姆酒！

## 关于部署的说明

一旦一个构建有多个测试管道，它就使用多个虚拟机(VM)来完成一个成功的构建。因此，在所有测试管道都成功通过之前，无法进行部署。在这种情况下，Codeship UI 将给出多个测试虚拟机和部署步骤的可视化分离。举个例子会有帮助:

![22_deploy](../Images/3d2091de5f3181dc7d7b685e0eb38d34.png)

正如您在屏幕截图中看到的，“部署”步骤在所有测试命令完成后运行实际的部署命令。你可以在 Codeship 的视频[中看到更多相关内容。](https://www.youtube.com/watch?v=E7ujcuGtRjo&noredirect=1)

## 结论

ParallelCI 是对 Codeship 产品的一个简单但非常有用的补充。虽然我们今天使用的导航路线有点生硬(每个 spec 文件夹都有一个管道)，但我相信您可以想象出更聪明的方法来分割您的测试。例如，使用类似于 [parallel_tests](https://github.com/grosser/parallel_tests) gem 及其`—only-group`参数的东西，规格可以根据大小来划分。

无论您如何做，使用 ParallelCI 都将减少您的测试执行时间，并让您有更多的时间关注发布特性。正如航运界巨头亚里斯多德·奥纳西斯曾经说过的那样，“我们必须摆脱对大海将永远平静的希望。我们必须学会在大风中航行。”Codeship 帮助你学会这样做。

Codeship 每月免费提供 100 个版本和 5 个私人项目，可以轻松无风险地开始，所以只有无赖才会推迟注册。此外，Codeship 的水手们也在他们的博客上不断讨论新的导航技术。一路顺风，我的航海朋友。前往 Codeship 并[立即尝试 parallel ci](https://codeship.com/features/parallelci/?utm_source=SitePoint&utm_medium=article&utm_campaign=ParallelCI)。

## 分享这篇文章