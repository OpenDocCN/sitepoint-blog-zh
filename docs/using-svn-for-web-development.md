# 使用 SVN 进行 Web 开发

> 原文：<https://www.sitepoint.com/using-svn-for-web-development/>

随着我们的 web 应用程序的增长，越来越多的开发人员开始开发它们，很明显我们需要某种版本控制系统来管理我们的代码。由于 CVS 已经相当过时，而且 [Subversion (SVN)](http://subversion.tigris.org/) 引入了一些方便的特性(原子事务、Apache 捎带、更方便的分支/标记、大量其他改进)，我们选择了 SVN。最大的问题是:如何正确使用它？在想出一些或多或少古怪的想法后，我想我们终于找到了一个体面的解决方案来将 web 应用程序放入源代码控制中。请记住，这篇文章不是关于如何使用 SVN 本身，而是关于在 web 开发中使用它的系统架构。如果你需要 Subversion 的帮助，你可以在[手册](http://svnbook.red-bean.com/nightly/en/index.html)和 [FAQ](http://subversion.tigris.org/faq.html) 中找到。

在 SVN 管理 web 应用程序很棘手，原因如下:

*   当使用修订控制时，程序员总是在项目的“工作副本”上工作。在传统的软件工程中，这个副本在他的机器上的某个地方，因为它是一个独立的应用程序。然而，在网络开发中，我们谈论的是网络空间。那么每个开发者都应该在他的机器上有一个 PHP 环境吗？难道所有的程序员不应该在完全相同的服务器配置上工作吗？Windows 和 Mac 用户呢？
*   这意味着工作副本最好放在一个 web 服务器上，同时放在一个 SVN 客户端上。因此，我们需要一些接口(最简单的是 SSH)来访问它。也许富 web 客户端会更好。
*   大多数 web 应用程序都使用数据库。不同版本的软件需要不同版本的数据库设计。更糟糕的是，它们的可操作性可能依赖于数据库中的数据。没有匹配数据库结构的应用程序版本是不好的。
*   该应用程序需要部署到一个实时的网络空间。这种情况可能会经常发生，并且应该尽可能无痛。

所以这就是我们要让它工作所需要的:

*   具有实时网络空间的公共网络服务器
*   一个测试网络服务器，为每个开发者提供至少一个网络空间(工作副本)
*   有两个数据库的 MySQL 服务器
*   SVN 服务器
*   一些纪律

**网络服务器**

每个开发人员现在都能够在自己的工作目录(webspace)中进行项目工作。但是它们都共享一个开发数据库，因为代码不应该依赖于数据库中的数据。每当一个程序员完成了他的任务，他就把他的变更提交给存储库。

当您的应用程序的下一个版本准备好了，它就可以部署到实时服务器上，这也是一个工作副本。这样，更新可以非常快速有效地发布，而不必导出整个存储库。我们需要的只是一个小脚本或 webmin 来触发部署。出于安全原因，没有其他方法可以访问实时网络空间上的文件。所有需要做的是防止阿帕奇下降到。svn 文件夹。httpd.conf 中的一个小指令可以帮助我们。

```
# Disallow browsing of Subversion working copy administrative dirs.
<directorymatch "^/.*/.svn/">
    Order deny,allow
    Deny from all
</directorymatch>
```

**数据库**

对于每个版本，都有一个匹配的数据库结构。我们该怎么处理这件事？首先，保持向后兼容似乎是明智的，因为在不中断应用程序的情况下回滚到以前的版本是很重要的。这意味着:不要删除任何地方的任何东西，只扩展现有的结构。

在每个软件版本中，对数据库结构的所有更改都需要在实时数据库服务器上进行。乍一看，这应该是自动完成的。问题是:怎么做？我们不只是想将开发服务器的所有差异“复制”到活动服务器，因为那里肯定有测试表或其他半成品。这就需要仔细选择，这很痛苦。

这就是为什么您应该保留一个变更日志，在那里您可以将所有的变更附加到数据库中，以便实时使用。这需要一些训练，但是它的优点是您总是有一个现成的 SQL 文件来构建您的数据库。如果注释得当，你也可以把它当作一个变更日志。

如果出于某种奇怪的原因，您的代码依赖于数据库中的数据，该怎么办？比方说，数据库中存储了某种网站地图。这很痛苦，因为您必须手动更新该表。在每次提交之前，当有更改时，您必须将它转储到一个 SQL 文件中，以便将其置于修订控制之下。这样你的数据也变得可合并。当有很多地方可以这样做时，您应该考虑使用脚本来冻结(将数据库数据写入文件)和解冻(反之亦然)您的 web 应用程序。

**放什么进去…**

当然，您的代码属于版本控制。数据库模式、模板和图形也是如此。你不应该写的是:

*   用户数据——用户上传的文件和资料不属于这里。
*   数据库数据——不要将版本控制与备份混淆！
*   缓存数据–它是临时数据。
*   配置文件–它们需要手动创建。

甚至不要考虑将配置文件置于修订控制之下。首先，它们容易被覆盖，例如，改变你的实时服务器的数据库。第二，密码不属于版本控制！相反，您应该添加带有更改文件名的默认配置文件，如 *database.conf.default* 。

**分支和标记**

重要的是要记住，只有工作代码属于主干。毕竟，它需要随时做好部署准备。因此，无论何时，您都需要创建一个新分支:

*   你正在做一个需要自己版本控制的大项目。
*   这是一个需要很长时间才能完成的项目。您的代码在存储库中比在开发人员的笔记本电脑上更安全。
*   当不止一个人在一个项目上工作时。在他们自己的分支中，开发人员可以在不损坏主干的情况下共享他们的代码。

完成后，这些分支将合并回主干。关于标记，我唯一能说的是，每当你更新你的 live 服务器来跟踪你的发布时，创建一个标记是聪明的。

**安全**

这种方法的一个很好的副作用是，开发者不再需要访问实时服务器。如果操作正确，服务器的实时更新将通过 webmin 界面触发，这就是你在这台机器上需要的所有管理权限。这很好。为了安全，不要忘记使用 SSL 进行 SVN 交易！

## 分享这篇文章