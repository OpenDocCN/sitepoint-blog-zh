# 破解宝石:阅读 Ruby 代码

> 原文：<https://www.sitepoint.com/cracking-gems-reading-ruby-code/>

我们所有人都定期编写代码，有些人比其他人更频繁。但是我们花在阅读他人代码上的时间有一个很大的不足。

除非作者通过阅读他人的作品来考虑他人的作品，否则他们不会创作出好作品。美国开发商也存在类似的情况。

阅读大型代码库可能会令人望而生畏。这里有太多的抽象概念，所有这些概念都相互关联，在你的大脑中制造出一片混乱。

但是，有了一点经验，阅读代码就变得容易多了。我们开始吧！

## 红宝石

Ruby 世界中分发代码的标准模式是全能的 gem。

我们来考虑一下红宝石宝石是如何布局的。最快的方法就是使用“捆绑宝石”命令。

进入您编写代码的地方(我通常使用~/code)，运行命令`bundle gem <name of gem>`

这将创建一个标题为“宝石名称”的目录。如果您导航到该目录，您应该会看到几个文件夹和几个文件。

`bundle gem`命令建立了编写 Ruby gem 和所需文件结构的基本框架。

感兴趣的目录是 **lib/** ，其中包含了 Ruby gem 的大部分代码。类似地，一个 gem 可以包含 **bin/** 和 **test/** 目录。

**bin/** 包含必须构建并放到系统上的可执行文件。例如,“bundler”gem 本身在这个目录中有一个`bundle`可执行文件。

最后， **spec/** 或 **test/** 通常包含对 gem 的单元和功能测试。

## 准备工作

在深入研究 gem 的源代码之前，您应该记住几件事情。

首先，想出一个目标。我将用一个故事来详细说明这一点。几年前，我决定让自己从事底层开发(比如内核开发)。为此，我拿起了 ext3 文件系统实现的副本，并决定尽可能多地了解它。

这种方法非常不成功。

我总是被小细节弄得分心，看不到全局。这样做了大约一周后，我决定我需要设定一个目标。我决定改变文件系统缓存的方式。

当我第一次开始时，这似乎非常困难——我不知道代码是如何工作的！但是，仅仅因为有了目标，我就能够对所有的代码进行分类，并对不同的部分在我脑海中做了什么有一个大致的了解；这种感觉太棒了！

在头脑中想出一个目标会帮助你快速整理好所有的事情。

其次，你用的编辑器很重要。至于我，我通常使用 Vim。然而，我知道有几个人专门使用 ide 来阅读代码。我能看到他们从哪里来；ide 使得从一个类跳到另一个类，从一个函数跳到另一个函数变得非常容易。所以，挑一个你觉得舒服的，能让你快速移动的东西。我可以肯定地说，您将在大量文件之间切换，并大量搜索变量和方法名。

## 打开宝石

一旦你探究了根源，不要害怕去猜测！。

我的意思是，你不必花时间去研究每一个功能的实现(那会花和写代码一样多的时间！).相反，使用函数/类/模块的名称以及它是如何被使用的，并猜测它是做什么的。很多时候，这是显而易见的。其他时候就没那么多了。

如果你觉得一个函数是至关重要的，那么无论如何，要考虑它里面的每一行代码。但是，重要的是略读那些不那么重要的东西(再次强调，这就是有目标会产生巨大差异的地方——你可以衡量某件事情是否重要)。

如果一个 gem 没有足够的文档(根据一些人的说法，这种情况发生得太频繁了)，并且您需要弄清楚某个函数是做什么的，请查阅 **spec/** ！

任何项目的单元测试都是了解项目的不同部分如何协同工作以及它们各自应该做什么的绝佳方式。这对于拥有大量特性但文档很少的 gems 来说非常有帮助。

边走边记笔记是记录你到目前为止所学内容的好方法。它还能让你走上正轨，这似乎是我阅读代码时的头号问题。

您的笔记通常应该包括每个类、函数和方法的作用以及它们之间的相互关系。例如，如果您知道方法`Person.get_data`从服务器下载员工数据并调用`Util.parse_json`，并且这与您的目标相关，请记下它。

阅读可执行文件(相对于库)的代码时，一个常见的技巧是直接跳到所谓的“main 方法”。该方法“开始”操作，通常与用户通信。从这个方法中，你可以分出一部分，找出应该集中精力的部分。我发现类似的技巧对有事件循环的库很有效——找到主事件循环，找到其中您感兴趣的调用，然后跟踪线索。

最后，猜猜在试图解读宝石的代码时，最重要的技巧是什么？居然用宝石本身！这被严重低估了。请这样想:如果你从未用过微波炉，你怎么可能知道它是如何工作的？！

例如，当我开始使用 Event Machine 时，我真的很想看看这样的库是如何编写的，但是，我从来没有真正使用过它。所以，我花了一周的时间写了一个小 IRC 机器人，它有几个很酷的特性，这让我了解了事件机器是如何构造的。没有这种经历，要正确理解事物是如何工作的，即使不是不可能，也是非常困难的。

此外，当您通读代码时，通过实际测试来检查您的“发现”总是一个好主意。如果您认为`get_server_ident`方法获取服务器的名称，那么在一小段虚拟代码中使用 gem，看看是否匹配。如果你试图尽可能多地猜测并浏览大部分代码，一开始你会不可避免地误解某些方面，这是清除这些误解的好方法。

## 结论

阅读代码就像用牙线剔牙一样——这是你知道应该做的事情之一，但是，不知何故，你却没有去做。

但是，读完这篇文章后，我希望你养成习惯！这会让你成为更好的开发者。

希望这个快速指南能让你更好地穿越红宝石的水域。

## 分享这篇文章