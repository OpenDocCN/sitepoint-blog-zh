# 具有预取功能的快速网站

> 原文:[https://www . site point . com/lightning-fast-websites-prefetching/](https://www.sitepoint.com/lightning-fast-websites-prefetching/)

*本文是与 [SiteGround](https://www.siteground.com/go/article-sp) 合作创作的系列文章的一部分。感谢您对使 SitePoint 成为可能的合作伙伴的支持。*

在本文中，我将讨论预取，它是什么，以及开发人员如何使用它来让高性能网站的访问者惊叹不已。

## 什么是预取？

虽然优化网站的初始页面加载是很好的，但对于用户今天期望的高度互动的网站来说，这可能还不够。

如果浏览器知道用户将要点击哪个链接，或者他们下一步将要访问哪个页面，这样内容就能以光速自动出现在他们的屏幕上，那会怎么样？

现在，浏览器*可以做到这一点。事实上，一些主流浏览器足够聪明，可以根据访问者的浏览模式、文档标记和结构、用户的设备、连接性等做出这种猜测。因此，浏览器已经试图预测构建访问者可能访问的页面所需的资源，准备好这些资源，并在用户请求时以极快的速度显示页面。然而，开发人员可以利用他们对网站或 web 应用程序的了解，帮助浏览器更准确地挑选出那些至关重要的资源。*

这就是预取的意义所在，它是对浏览器的一种暗示，让浏览器预见用户的每一个浏览愿望，并让它瞬间实现。

你可以在伊利亚·格里戈利克领导的 **[资源提示](https://w3c.github.io/resource-hints/)** 规范中找到预取。

接下来，我将讨论:

*   dns-ppreferhing
*   链接/资源预取
*   预呈现(页面预取)

## dns-ppreferhing

互联网是由计算机可读的 IP 地址组成的网络，这些 IP 地址由人类可读的主机名引用。DNS 是将主机名转换成 IP 地址的协议。

每次浏览器对不同域上的资源发出 HTTP 请求时，它都会花费几毫秒的时间将域解析到相关联的 IP 地址。

如果一个网站有 Twitter 或脸书小工具，谷歌分析，也许还有一两个自定义的网络字体，那么它必须有其他领域的链接。这使得 DNS 查找不可避免。

DNS 预取有助于减少访问者的等待时间，因为浏览器在发送对位于其他域的资源的请求之前会执行 DNS 查找。

所以，让我们假设开发者知道一个网站将向 somewidget.example.com 发出请求。他们可以给浏览器一个提示，建议它继续操作，并通过向值为`dns-prefetch`的链接添加一个`rel`属性来预取该主机名的 DNS，如下所示:

```
<link rel="dns-prefetch" href="//somewidget.example.com">
```

现在，当对 somewidget.example.com 的请求发生时，浏览器已经提前执行了 DNS 查找，用户可以更快地获得结果。

目前，所有主流桌面浏览器都支持 DNS 预取。当缺乏对 DNS 预取的支持时，浏览器只是以通常的方式检索资源。没什么大不了的。

如果浏览器从不请求 DNS 预取的资源会怎样？幸运的是，DNS 预取并不是一个昂贵的操作，因为它不会通过网络发送超过几百个字节的数据。再说一次，没有伤害。

## 链接页面

根据[规格](https://w3c.github.io/resource-hints/#prefetch)，链接预取…

> 用于标识下一次导航可能需要的资源，以及用户代理应该获取的资源，这样，一旦将来请求资源，用户代理可以提供更快的响应。

换句话说，如果开发人员有理由假设用户可能会访问某个特定的网页，并且知道浏览器需要一些关键资源来交付它，他们可以使用`prefetch`指令。这使浏览器在用户实际导航到该页面之前，指向它应该获取的资源。

请记住，预取只适用于可缓存的资源，如 JavaScript、图像等。代码如下所示:

```
<link rel="prefetch" href="//example.com/future-image.jpg">
```

浏览器现在知道`future-image.jpg`图像很快就会被用到，所以它可以预取它并将其存储在本地缓存中。此时，因为浏览器已经完成了在后台下载资源的耗时工作，所以这种技术的好处在于，只要用户点击访问需要`future-image.jpg`的相关页面，就会超快速地呈现出来。

链接预取在创造一个快速加载网站的感觉方面很棒，但它比 DNS 预取更昂贵。如果用户从不访问需要预取资产的页面，浏览器就会下载不必要的数据并阻塞缓存。

在撰写本文时，最新版本的 Chrome、Firefox、IE/Edge 和 Opera 都支持[链接预取。不支持的浏览器会忽略这个提示。](http://caniuse.com/#search=prefetch)

## 页面预渲染/预渲染

实现页面预取或预呈现只需在链接的`rel`属性中添加`prerender`指令，如下所示:

```
<link rel="prerender" href="//example.com/future-page.html">
```

预渲染无处不在，实际上创建了用户可能下一步要去的整个页面的一个不可见版本，包括应用 CSS 和执行 JavaScript。只要用户点击相关链接，幽灵页面就会立即在他们眼前具体化，取代旧的内容。

如果链接预取是一项开销很大的操作，那么预渲染就更是如此。在这种情况下，浏览器下载整个网页及其所有资源是基于用户将访问该页面的预期，而这最终可能会发生，也可能不会发生。

此时在 IE/Edge、Chrome 和 Opera 中支持[预渲染。](http://caniuse.com/#search=prerender)

## 链接预取和预渲染的用例

因为链接预取和(在更大程度上)预呈现都不便宜，所以明确知道什么时候适合在网页上实现它们是很重要的。

计划使用资源提示的开发人员应该这样做，如果他们有充分的理由根据网站内容、用户行为、分析等假设哪些资源应该预取或预呈现。

资源提示规范指出了许多[用例](https://w3c.github.io/resource-hints/#use-cases)，其中链接预取可以改善用户体验:

*   搜索结果——假设用户对这些结果感兴趣是合理的，因此他们很可能会点击指向他们想要的内容的链接。
*   分页内容——一旦用户阅读了一篇多页文章的第一页，不难想象他们会点击链接进入下一页。
*   图片库——Google devs 在 Picasa 网络相册上使用预取功能。如果用户正在查看一张照片，开发人员有理由猜测下一张照片也将被访问，因此他们指示浏览器尽快下载它。

同样，Santiago Valdarrama 提供了一些有用的提示,告诉开发者何时可以合理地考虑在网站上实现预渲染:

> 当决定是否提前预呈现整个页面时，请考虑谷歌预呈现其搜索页面上的顶部结果，而 Chrome 预呈现页面基于用户的历史导航模式。使用相同的原理，您可以检测常见的使用模式，并相应地预呈现目标页面。您还可以像资源预取一样，在您知道用户将按特定顺序完成工作流的问卷或调查中使用它。

## 资源

如果您想深入了解，以下资源是必读资料:

*   [资源提示规范](https://w3c.github.io/resource-hints/)
*   [网络性能技巧—超越基础](https://www.sitepoint.com/web-performance-tricks-beyond-basics/)
*   [预取资源](https://developers.google.com/speed/articles/prefetching)
*   [预取、预加载、预浏览](https://css-tricks.com/prefetching-preloading-prebrowsing/)
*   [领先一步:通过预浏览提高性能](https://alistapart.com/article/one-step-ahead-improving-performance-with-prebrowsing)
*   [网页设计师和前端开发人员的前端性能](https://csswizardry.com/2013/01/front-end-performance-for-web-designers-and-front-end-developers/)

## 结论

DNS 预取、链接预取和预渲染是强大的优化技术。如果**负责任地实施**，基于开发者对网页内容和用户行为的了解，预取可以极大地改善用户体验。

## 分享这篇文章