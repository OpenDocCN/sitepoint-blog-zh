# 为了让 27%的网络更加安全，你愿意付出多少？

> 原文：<https://www.sitepoint.com/what-would-you-pay-to-make-27-of-the-web-more-secure/>

![Open Source Week](img/31a22f613e5e7d0c22f753b2e51b5549.png)

SitePoint 的开源周到了！整整一周我们都在发布关于开源、自由软件和社区的文章，所以请继续查看 ***[OSW 标签](https://www.sitepoint.com/blog/)*** 获取最新更新。

* * *

Scott Arciszewski，在 Twitter 上被称为 [CiPHPerCoder](https://twitter.com/) ，对于安全性就像 Chris Hartjes 对于单元测试一样。

![Illustration of shield with lock icon in front of digital content](img/e21f0048858f43bbda7009709d96edc3.png)

他会扑向不安全的应用程序、库和包，找到漏洞、问题和错误的实现，并帮助人们修复它们。他是几个流行的面向安全的包的主要开发者，包括但不限于以更加用户友好的方式使用 lib 钠的 [Halite](https://www.sitepoint.com/using-halite-for-privacy-and-two-way-encryption-of-emails/) 、发送加密电子邮件的 [gpg-mailer](https://github.com/paragonie/gpg-mailer) 、 [random_compat](https://github.com/paragonie/random_compat) 等等。

作为 PHP 扩展 libna 的忠实粉丝，他目前正试图评估更广泛的社区对资助 PHP 版本的专业审计的兴趣。简而言之，Scott 想贡献出他的时间来编写 PHP 版本 polyfill(如果安装了的话，它将使用 lib 钠作为一个扩展)，但是他想花钱对他的工作进行专业审计，以确保它确实是最安全的。但是事情是这样的——专业的代码审查是非常昂贵的。

Scott 抽出时间回答了一些相关问题，我们觉得推动这样一个令人印象深刻的项目曝光是结束[开源周](https://www.sitepoint.com/blog/)的完美方式。

* * *

#### 嗨，Scott，感谢您抽出时间回答一些问题！能不能给我们一个平民友好的 TL；安立纳博士？这个扩展实际上做什么，它最常用的上下文是什么？

lib 钠是一个现代且易于使用的密码术库，目前在 PECL 上可用(尽管我希望将其移植到 PHP 7.2 中)。它提供了同类最佳的加密功能(对称加密、公钥加密、数字签名、密码散列等)。)并尽力不被我们称之为旁道密码分析所攻击。

举个例子:AES 在软件中实现时，容易受到缓存计时攻击。根据完成一个特定操作所花费的时间，你可以从一个非特权进程(或通过网络)中获知你的秘密密钥。

libna 提供的一些更令人兴奋的功能包括 x 25519(Curve 25519 上的椭圆曲线 Diffie-Hellman 密钥协议)、ed 25519(edd sa-基于 Edwards 的数字签名算法-Curve 25519 上)、Argon2i 密码哈希和非常易于使用的加密 API。例如，这个代码片段加密/解密一条消息，使您不必担心选择密文攻击:

```
$ciphertext = \Sodium\crypto_secretbox($message, $nonce, $key);
$plaintext = \Sodium\crypto_secretbox_open($ciphertext, $nonce, $key);
/* var_dump($message === $plainext); // bool(true) */ 
```

如果你能从 PECL 安装 PHP 扩展，你今天就可以使用所有这些伟大的加密特性。

然而，许多 PHP 开发人员没有能力安装(或要求)可选的 PHP 扩展。技术和政治上的障碍都在起作用。

尽管存在这些挑战，但出于多种原因，利布钠仍非常受欢迎。其数字签名算法(Ed25519)是公钥认证的黄金标准。与 RSA(通过 Bleichenbacher 的‘06 攻击，如果使用 PKCS1v1.5 填充并设置 e=3，则允许消息伪造)和 ECDSA(当重复 nonce 时，导致索尼 PS3 安全崩溃)不同，Ed25519 很容易在常数时间内实现。因为有了 Curve25519，你就不用担心无效曲线攻击或者扭曲安全(或者其他很多名字古怪的密码学漏洞)。但最重要的是，Ed25519 是确定性的:您永远不会像经典 ECDSA 那样重复 nonce 并泄露您的密钥。

许多 PHP 软件将受益于 lib 钠提供的加密技术，只要他们今天能使它成为一种依赖。例如，WordPress 在其自动更新包中不使用任何类型的加密签名。如果我们可以在遗留系统上部署现代加密技术，那么如果 api.wordpress.org 受到攻击，我们就可以保护 27%的互联网免受黑客攻击。如果 WordPress 可以从 Ed25519 开始，而不是硬塞进 RSA 并引入向后兼容问题，那将会省去每个人很多麻烦。

为此，我决定为 lib 钠编写一个纯 PHP 的 polyfill，首先从 Ed25519 开始，最后可能是 Argon2i。聚敛是机会主义的；如果安装了 PECL 扩展，它将使用那个而不是我的实现。

#### 到目前为止，进展如何？有公司对此感兴趣吗？

开发正在进行中。有足够的社区利益来保证制作 polyfill，但是在第三方审核之前，我不会放心把它发布给全世界。

说实话，我在接触企业方面做得不多，因为这是美国的假日周末。然而，在我在 Twitter 上发布了这个消息后，Joomla 团队立即开始了一场严肃的讨论，讨论他们可以从预算中承诺多少钱来让 polyfill 接受审计。

最大的受益者将是 Automattic，以及任何依赖 WordPress 支付账单的人。

#### 你已经开始写这个库了吗？如果是的话，到目前为止最大的挑战是什么？

今天早上我花了很多时间将 ref10 curve25519 代码移植到 PHP。我认为最大的挑战是:

1.  PHP 的有符号整数，尤其是在没有 GMP 扩展的 32 位平台上。
2.  当我到达 Argon2i 时，内存限制可能会被证明是一个挑战。

安全挑战(`mbstring.func_overload`),事实上`chr()`不是缓存时间安全的，等等。)是我在 PIE 日常工作中遇到的那种问题，所以我不担心这些。从第一天开始，我编写的代码就是无旁路的。

#### 该库将是完全开源的，并努力与 lib 钠扩展 100%对等，对吗？

除非明确需要，否则我可能会放弃一些非主流特性(例如`crypto_pwhash_scryptsalsa208sha256`,因为我们现在有 Argon2i)。然而，在许可的情况下，它将是完全开源的(要么是 ISC，比如 lib nasal，要么是 MIT，CC0，WTFPL，或者是无许可的；我没有偏好，可供选择的太多了)。

#### 恰当的挑战——你会公开开发这个库吗？也就是说，如果其他人有时间的话，这是否是一个开放的回购协议？

一旦至少实现了 NaCl 的所有特性(lib 钠的基础),并且经过了很好的测试，这个库就会被公开。从那时起，我们将把重点放在让其他 PHP 安全和密码学专家审查实现的内容，并在 PHP 碰巧支持的奇怪平台上进行测试。

#### 如果(或者是现在“什么时候”？)您编写库，我们对其进行全面审计，这将使谁受益最大？这样的事情会有多深远的影响？

毫无疑问，WordPress 用户将受益最大，因为我们将能够讨论实现安全的自动更新，而不会将最低 PHP 版本要求提高到 7.2。

意义深远的是没有 PHP 加密项目会被落下。所有人都可以利用它，即使他们支持 PHP 的旧版本，并为不能安装 PHP 扩展的客户服务。不会有任何常见的，合理的借口来坚持像 mcrypt 这样的化石。WordPress 之外的整个生态系统可以朝着像今天的 [Halite](https://www.sitepoint.com/using-halite-for-privacy-and-two-way-encryption-of-emails/) 和 CMS Airship 这样的项目前进。

#### 由于项目将从中受益最大，以及它们默认过时的性质，我认为对于这样的扩展，PHP 版本的最低要求应该很低？

和之前的一样，我正在编写 lib 钠 polyfill 以兼容 5.2.4 版本的 PHP。然而，与`random_compat`不同，我打算最终将它分成两个分支:

*   v1 . x . y–PHP 5.2 . x–7 . x . y 兼容
*   v2 . x . y–仅限 PHP 7 . x . y；使用具有严格类型的标量类型声明

据推测，这两个分支都不需要为 PHP 7.2 和更高版本做太多工作。

#### 那么关于审计——告诉我们，它通常是如何工作的，我们在这里谈论的是哪个价格范围？

加密代码审计是由专门从事应用加密的软件安全公司提供的服务。我的雇主(Paragon Initiative Enterprises)就是这样一家提供这些服务的公司，但是审计我们自己的工作并告诉每个人相信我们做了彻底的工作是不卫生的。

密码术代码审计是昂贵的。通常情况下，他们需要信誉良好的第三方提供数十人/天的服务，而第三方通常会以每人/天 1，000 至 5，000 美元的价格向他们的顾问收取费用。但是如果你是一家公司，这是一笔很好的投资，因为大多数公司没有软件安全公司那样的安全人才。除了我的雇主，另外两家提供这些服务的公司是 NCC 集团和 Cure53。我不知道他们的账单价格，但我肯定菜单上没有“便宜”这个词；他们做得很好。

#### 这种第三方审计真的有必要吗？你不是已经和所有最好的 PHP 开发人员接触过了吗？由受人尊敬的开发伙伴进行的组织良好的同行评审难道不会有几乎相同的效果吗？

不幸的事实是，最好的 PHP 开发人员很少有超过几个小时的时间来免费查看任何东西。代码审计是一个安全专家团队的有偿工作，目的是仔细检查您的实现，找出有安全后果的错误。专注和关注的程度要高得多。例如，我为客户做的代码审计比我公开的与安全相关的 Github 问题要彻底得多。虽然它们在概念上相似，但这是天壤之别。

你可以从一个软件安全咨询公司的独立评审小组那里得到同样的结果。

如果这个多填充库最终保护了互联网上四分之一的网站，那么审计就没有商量的余地。

#### 你考虑过 Indiegogo 或 Kickstarter 为审计筹集资金吗？

考虑过，但没有承诺。万一有大公司过来说，“嘿，我们昨天就需要这个，我们会支付第三方审计的全部费用，”我不会急着让个人掏钱，除非我确定这不会发生。我几乎肯定不能自掏腰包支付审计费用，所以让别人拿出他们的钱作为 A 计划对我来说不合适。

然而，如果没有一家大型 PHP 公司(尤其是那些使用 WordPress 的公司)愿意投入，众筹肯定是我的下一步。如果发生这种情况，没有任何收益将用于支付发展，所以我不能提供太多的扩展目标。也许我可以投资任何超出目标的东西，让 Defuse Security 的 PHP 加密库也接受审计？(当然，我愿意听取建议。)

#### 除了直接做出贡献，我们或我们的读者还能做些什么来帮助这项工作吗？

告诉你的同事和老板你为实现这一目标所做的努力。

一旦库被审计，在你的项目中使用它。请让我们把 RSA 和 foot-bullety ECDSA 埋葬在属于它的过去。现代椭圆曲线加密是未来的发展方向(直到量子计算机成为现实)。

#### 你还有什么想分享的吗？

互联网上至少有 27%的网站将获得更大的弹性。我的工作场所坚信安全始于开发人员，如果成功的话，这将是一个证据，我们必须捍卫我们的理念，反对安全供应商在信息安全会议上出售他们无用的 10 万美元的闪烁盒。

我可能最终会要求公司和个人(如果失败的话)付钱给一个外部安全专家团队，让他们指出我在这个过程中犯下的任何错误。

对于任何个人不喜欢我的人(可能是因为我多年来直言不讳的安全漏洞报告)，你可能很快就有机会花钱聘请一位专家来公开告诉我我搞砸了一些事情，同时在这个过程中使互联网更加安全。你到哪里去找比这更好的交易呢？

* * *

## 结论

libna 扩展最终帮助大多数高级 PHP 摆脱了 mcrypt 和其他过时的安全方法。然而，对于共享主机上的所有人，或者那些被锁定在过时的 CMS 和 CRM 平台上的人来说，使用它远非易事。

它的 PHP 版本将改变这一点——它将帮助像 WordPress、Joomla、Magento 和其他项目实现一个 PHP 版本的 like，并取代他们过时的安全方法，所有这些都不需要强迫共享主机安装任何定制的扩展。

自然，在这种主机上的 PHP 版本在许多情况下仍然会有问题，因为许多 CMSes 和 CRM 支持早已过时的 PHP 版本，但随着时间的推移，web 生态系统的很大一部分会变得更加安全。

如果您在一家使用流行的基于 PHP 的 CRM 或 CMS 软件的公司工作，请让他们注意到这一点——让他们阅读 Scott 的回答，并告诉他们将 lib nasal 添加到他们的应用程序和系统主干的好处。今天一点小小的财务牺牲就可以防止日后代价高昂的错误。

## 分享这篇文章